1:"$Sreact.fragment"
2:I[909,["144","static/chunks/144-6ef9499ac178c5dc.js","245","static/chunks/245-30e455921c0f8f22.js","177","static/chunks/app/layout-a6c5d823159daef4.js"],"default"]
3:I[7468,["144","static/chunks/144-6ef9499ac178c5dc.js","245","static/chunks/245-30e455921c0f8f22.js","177","static/chunks/app/layout-a6c5d823159daef4.js"],"ClientThemeProvider"]
4:I[1886,["144","static/chunks/144-6ef9499ac178c5dc.js","245","static/chunks/245-30e455921c0f8f22.js","177","static/chunks/app/layout-a6c5d823159daef4.js"],"default"]
5:I[8412,["144","static/chunks/144-6ef9499ac178c5dc.js","245","static/chunks/245-30e455921c0f8f22.js","177","static/chunks/app/layout-a6c5d823159daef4.js"],"default"]
6:I[5244,[],""]
7:I[3866,[],""]
8:I[3620,["144","static/chunks/144-6ef9499ac178c5dc.js","245","static/chunks/245-30e455921c0f8f22.js","177","static/chunks/app/layout-a6c5d823159daef4.js"],"default"]
a:I[6213,[],"OutletBoundary"]
c:I[6213,[],"MetadataBoundary"]
e:I[6213,[],"ViewportBoundary"]
10:I[4835,[],""]
:HL["/cae-theory/_next/static/css/fd89b796fb218fbf.css","style"]
0:{"P":null,"b":"klibeS21nDp3EOmRvX-vz","p":"/cae-theory","c":["","iteration3","production"],"i":false,"f":[[["",{"children":[["slug","iteration3/production","oc"],{"children":["__PAGE__",{}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/cae-theory/_next/static/css/fd89b796fb218fbf.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L2",null,{"children":["$","$L3",null,{"children":["$","html",null,{"children":[["$","head",null,{"children":[["$","title",null,{"children":"CAE Course"}],["$","link",null,{"rel":"icon","type":"image/svg+xml","href":"/cae-theory/favicon.svg"}]]}],["$","body",null,{"children":[["$","header",null,{"children":["$","$L4",null,{"siteMetaData":{"version":"","title":"CAE","description":"siteDescription","url":"siteURL","youtubeUrl":"youtubeUrl","authorEmail":"authorEmail","facebookUrl":"facebookUrl","instagramUrl":"instagramUrl","menuLinks":[{"name":"Home","link":"/"},{"name":"Intro","link":"/intro"},{"name":"Qualité","link":"","subMenu":[{"name":"Qualité générale","link":"/quality/general"},{"name":"Qualité du frontend","link":"/quality/frontend"},{"name":"Qualité de l'API","link":"/quality/api"},{"name":"Intégration Continue","link":"/quality/ci"},{"name":"Tests e2e","link":"/quality/e2e"}]},{"name":"Itération 2","link":"","subMenu":[{"name":"Gestion des environnements","link":"/iteration2/general"},{"name":"Conteneurisation","link":"/iteration2/containerization"},{"name":"Déploiement","link":"/iteration2/deployment"},{"name":"Gestion des images","link":"/iteration2/images"}]},{"name":"Itération 3","link":"","subMenu":[{"name":"Gestion de la production","link":"/iteration3/production"},{"name":"Gestion des logs & exceptions","link":"/iteration3/logs"},{"name":"Gestion de la concurrence","link":"/iteration3/concurrency"}]},{"name":"About","link":"/about"}]}}]}],["$","$L5",null,{"sx":{"padding":"1rem","wordWrap":"break-word"},"children":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}]}],["$","$L8",null,{}]]}]]}]}]}]]}],{"children":[["slug","iteration3/production","oc"],["$","$1","c",{"children":[null,["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children","$0:f:0:1:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L9",null,["$","$La",null,{"children":"$Lb"}]]}],{},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","a0mkIOJlF0LFEUnuWV7JW",{"children":[["$","$Lc",null,{"children":"$Ld"}],["$","$Le",null,{"children":"$Lf"}],null]}]]}],false]],"m":"$undefined","G":["$10","$undefined"],"s":false,"S":true}
11:I[3508,["144","static/chunks/144-6ef9499ac178c5dc.js","830","static/chunks/830-d07b37352b41f989.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js"],"default"]
12:I[283,["144","static/chunks/144-6ef9499ac178c5dc.js","830","static/chunks/830-d07b37352b41f989.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js"],"default"]
13:I[6656,["144","static/chunks/144-6ef9499ac178c5dc.js","830","static/chunks/830-d07b37352b41f989.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js"],"default"]
14:I[8173,["144","static/chunks/144-6ef9499ac178c5dc.js","830","static/chunks/830-d07b37352b41f989.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js"],""]
15:I[4754,["144","static/chunks/144-6ef9499ac178c5dc.js","830","static/chunks/830-d07b37352b41f989.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js"],"default"]
16:I[2738,["144","static/chunks/144-6ef9499ac178c5dc.js","830","static/chunks/830-d07b37352b41f989.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js"],"default"]
17:I[4036,["144","static/chunks/144-6ef9499ac178c5dc.js","830","static/chunks/830-d07b37352b41f989.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js"],"default"]
9:[["$","$L11",null,{"children":[["$","$L12",null,{"aria-label":"breadcrumb","children":[["$","$L13",null,{"href":"/","underline":"hover","color":"inherit","component":"$14","children":" CAE "}],["$","$L13",null,{"href":"/iteration3","underline":"hover","color":"inherit","component":"$14","children":" Itération 3 "}],["$","$L13",null,{"href":"#","underline":"hover","color":"inherit","component":"$14","children":" Gestion de l'environnement de production "}]]}],["$","$L15",null,{"component":"div","sx":{"paddingTop":0,"paddingBottom":0},"children":["$","$L13",null,{"href":"#quest_ce_que_lenvironnement_de_production","underline":"hover","color":"inherit","component":"$14","children":["$","$L16",null,{"primary":" Qu'est-ce que l'environnement de production ? "}]}]}],["$","$L15",null,{"component":"div","sx":{"paddingTop":0,"paddingBottom":0},"children":["$","$L13",null,{"href":"#comment_creer_lenvironnement_de_production","underline":"hover","color":"inherit","component":"$14","children":["$","$L16",null,{"primary":" Comment créer l'environnement de production ? "}]}]}],["$","$L15",null,{"component":"div","sx":{"paddingTop":0,"paddingBottom":0},"children":["$","$L13",null,{"href":"#comment_creer_des_environnements_sous_git_lab_ci_cd","underline":"hover","color":"inherit","component":"$14","children":["$","$L16",null,{"primary":" Comment créer des environnements sous GitLab CI/CD "}]}]}],["$","$L15",null,{"component":"div","sx":{"paddingTop":0,"paddingBottom":0},"children":["$","$L13",null,{"href":"#comment_faire_du_continuous_delivery","underline":"hover","color":"inherit","component":"$14","children":["$","$L16",null,{"primary":" Comment faire du Continuous Delivery ? "}]}]}]]}],"\n",["$","h1",null,{"children":["$","a",null,{"id":"quest_ce_que_lenvironnement_de_production","children":" Qu'est-ce que l'environnement de production ? "}]}],"\n",["$","p",null,{"children":"Nous l'avons déjà vu dans l'introduction sur les environnements, l'environnement de production est un environnement dans lequel l'application est déployée pour être utilisée par les utilisateurs finaux."}],"\n",["$","p",null,{"children":"Dans la partie sur le déploiement, nous avons vu comment déployer une application dans l'environnement de staging, que l'on peut considérer comme la pré-production. Dans cette partie, nous allons voir comment déployer une application dans l'environnement de production."}],"\n",["$","p",null,{"children":"Dans un premier temps, nous souhaitons faire du déploiement continu, c'est-à-dire que chaque commit sur la branche principale doit déclencher un déploiement sur l'environnement de production, et cela seulement bien sûr si tous les tests passent, y compris les tests e2e à réaliser sur l'environnement de staging (ou de pré-production)."}],"\n",["$","p",null,{"children":"Voici le workflow que nous souhaitons mettre en place :"}],"\n",["$","$L17",null,{"src":"/diagrams/deployment-workflow-cd1.puml"}],"\n",["$","h1",null,{"children":["$","a",null,{"id":"comment_creer_lenvironnement_de_production","children":" Comment créer l'environnement de production ? "}]}],"\n",["$","h2",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"Pour mettre en place l'environnement de production, nous allons utiliser les mêmes services que pour l'environnement de staging, à savoir :"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Azure Web App pour déployer les services frontend, backend et le reverse proxy"}],"\n",["$","li",null,{"children":"Pour les étudiants Vinci, une base de données offerte par Vinci ; pour les autres, Azure Database for PostgreSQL pour la base de données"}],"\n",["$","li",null,{"children":"Un service de stockage Azure Blob pour stocker les fichiers statiques (principalement les images dans nos tutoriels)"}],"\n",["$","li",null,{"children":"GitLab CI/CD pour automatiser le déploiement."}],"\n"]}],"\n",["$","h2",null,{"children":"Création de l'environnement de production sur Azure Web App"}],"\n",["$","p",null,{"children":["Veuillez refaire les étapes de la partie sur le déploiement pour créer un nouvelle Azure Web App : ",["$","a",null,{"href":"../iteration2/deployment#comment_creer_une_application_sur_azure_web_app_service","children":"Déploiement : Comment créer une app sur Azure Web App Service"}],"."]}],"\n",["$","p",null,{"children":["Donnez un nom à votre application, par exemple ",["$","strong",null,{"children":["$","code",null,{"children":"cae-groupxy-production-app"}]}],"."]}],"\n",["$","p",null,{"children":["Ensuite, veuillez faire la partie pour donner accès à votre nouvelle Azure Web App via GitLab CI/CD : ",["$","a",null,{"href":"../iteration2/deployment#comment_creer_une_application_sur_azure_web_app_service","children":"Déploiement : Comment donner accès à d'autres applications à une Azure Web App ?"}],". Veuillez créer donc un nouveau service principal et bien noter les informations de connexion. Voici un exemple de ce que vous devriez avoir à la fin de cette étape :"]}],"\n",["$","pre",null,{"className":"language-properties","children":["$","code",null,{"className":"language-properties code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"AZURE_CLIENT_SECRET"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"am45Q~jpcc2G64r3GumcGdYRE99cwxddfsqWeD8DcW1"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"AZURE_TENANT_ID"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"f7a15dq7-57cb-5855-8d36-0545f95aada17"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"AZURE_CLIENT_ID"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"fs8f6ea8-8807-4764-a394-f0bessqf7e8cbe"}],"\n"]}]]}]}],"\n",["$","h2",null,{"children":"Création de l'environnement pour le stockage des images sur Azure Blob Storage"}],"\n",["$","h3",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"Pour stocker les images, nous allons utiliser le service de stockage que nous avons créé lors du déploiement. Sur ce service de stockage, nous allons créer un nouveau blob container pour l'environnement de production."}],"\n",["$","h3",null,{"children":"Création du blob container pour l'environnement de production"}],"\n",["$","p",null,{"children":"Pour créer un blob container pour l'environnement de production, veuillez suivre les étapes suivantes :"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Dans le portail Azure, cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Storage accounts"}]}]," dans le menu de gauche."]}],"\n",["$","li",null,{"children":["Cliquez sur le ",["$","strong",null,{"children":["$","code",null,{"children":"Storage account"}]}]," que vous avez créé précédemment (",["$","strong",null,{"children":["$","code",null,{"children":"imagestorage007"}]}]," par exemple)."]}],"\n",["$","li",null,{"children":["Dans le menu de gauche, sous ",["$","strong",null,{"children":["$","code",null,{"children":"Data storage"}]}],", cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Containers"}]}],"."]}],"\n",["$","li",null,{"children":["Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"+ Container"}]}],"."]}],"\n",["$","li",null,{"children":["Entrez un nom pour le container. Par exemple : ",["$","strong",null,{"children":["$","code",null,{"children":"prod"}]}],"."]}],"\n",["$","li",null,{"children":["Pour ",["$","strong",null,{"children":["$","code",null,{"children":"Anonymous access level"}]}],", sélectionnez ",["$","strong",null,{"children":["$","code",null,{"children":"Blob (anonymous read access for blobs only)"}]}],". Grâce à cela, les blobs peuvent être lus par n'importe qui, mais sans avoir le droit de lister les blobs."]}],"\n",["$","li",null,{"children":"Laissez les autres paramètres par défaut."}],"\n",["$","li",null,{"children":["Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Create"}]}],"."]}],"\n"]}],"\n",["$","h2",null,{"children":"Création de l'environnement pour la base de données"}],"\n",["$","h3",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"Comme nous l'avons vu dans la partie sur le déploiement, nous allons utiliser une base de données externe. Pour les étudiants Vinci, vous avez une base de données offerte par Vinci. Pour les autres, vous pouvez utiliser Azure Database for PostgreSQL."}],"\n",["$","p",null,{"children":"Pour votre environnement de production, veuillez utiliser une base de données différente de celle de l'environnement de staging. Vous pouvez par exemple créer une nouvelle base de données sur Azure Database for PostgreSQL. Pour les étudiants Vinci, chaque groupe possède plusieurs bases de données, vous pouvez donc en choisir une autre."}],"\n",["$","h3",null,{"children":"Configuration de l'API Spring Boot pour utiliser la nouvelle base de données et le nouveau blob container"}],"\n",["$","p",null,{"children":"Veuillez repartir de votre projet GitLab pour ce nouveau tutoriel. Pensez à créer une nouvelle branche pour ce tutoriel."}],"\n",["$","p",null,{"children":["Veuillez au niveau de votre application Spring Boot, changer la configuration pour utiliser la nouvelle base de données. Veuillez créer le fichier ",["$","strong",null,{"children":["$","code",null,{"children":"application-production.properties"}]}]," pour qu'il ressemble à ceci :"]}],"\n",["$","pre",null,{"className":"language-properties","children":["$","code",null,{"className":"language-properties code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"spring.application.name"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"production"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"server.port"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"3000"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"spring.datasource.url"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"$${SPRING_DATASOURCE_URL}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"spring.datasource.username"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"$${SPRING_DATASOURCE_USERNAME}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"spring.datasource.password"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"$${SPRING_DATASOURCE_PASSWORD}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"spring.jpa.generate-ddl"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"true"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"spring.sql.init.mode"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"never"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"azure.blob.service-endpoint"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"https://imagestorage007.blob.core.windows.net/"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"azure.blob.sas-token"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"$${AZURE_BLOB_SAS_TOKEN}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"azure.blob.container-name"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"production"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"spring.servlet.multipart.enabled"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"true"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"spring.servlet.multipart.max-file-size"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"10MB"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"spring.servlet.multipart.max-request-size"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"10MB"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["Nous avons donc créé un nouveau profil pour Spring Boot, ",["$","strong",null,{"children":["$","code",null,{"children":"production"}]}],", qui utilise les variables d'environnement pour la connexion à la base de données et au blob container."]}],"\n",["$","p",null,{"children":"Veuillez noter vos nouvelles informations de connexion à la base de données, par exemple :"}],"\n",["$","pre",null,{"className":"language-properties","children":["$","code",null,{"className":"language-properties code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"SPRING_DATASOURCE_URL"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"jdbc:postgresql://cae-groupxy-production-db.postgres.database.azure.com:5432/cae_groupxy_production_db"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"SPRING_DATASOURCE_USERNAME"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"cae_groupxy_production_user@cae-groupxy-production-db"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token key attr-name","children":"SPRING_DATASOURCE_PASSWORD"}],["$","span",null,{"className":"token punctuation","children":"="}],["$","span",null,{"className":"token value attr-value","children":"MySuperPassword"}],"\n"]}]]}]}],"\n",["$","h2",null,{"children":"Configuration de GitLab CI/CD pour le déploiement continu"}],"\n",["$","p",null,{"children":"Si nous souhaitons configurer notre pipeline, nous devons ajouter une nouvelle étape pour le déploiement sur l'environnement de production."}],"\n",["$","p",null,{"children":"De plus, nous avons des secrets à ajouter pour la connexion à la base de données et au blob container.\nC'est pourquoi nous allons voir la gestion des environnements dans GitLab CI/CD, principalement afin d'éviter d'avoir à donner des noms de variables d'environnement différents pour chaque environnement."}],"\n",["$","h1",null,{"children":["$","a",null,{"id":"comment_creer_des_environnements_sous_git_lab_ci_cd","children":" Comment créer des environnements sous GitLab CI/CD "}]}],"\n",["$","h2",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"GitLab CI/CD permet de gérer des environnements pour les pipelines. Cela permet de définir des variables d'environnement pour chaque environnement, et de les utiliser dans les jobs du pipeline."}],"\n",["$","p",null,{"children":"Sans utiliser d'environnement, nous devrions donner des noms de variables d'environnement différents pour chaque environnement, ce qui peut être source d'erreur."}],"\n",["$","p",null,{"children":"Par exemple, pour la connexion à la base de données, nous devrions donner :"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"SPRING_DATASOURCE_URL_PROD"}]," pour l'environnement de production"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"SPRING_DATASOURCE_URL_STAGING"}]," pour l'environnement de staging"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"SPRING_DATASOURCE_USERNAME_PROD"}]," pour l'environnement de production"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"SPRING_DATASOURCE_USERNAME_STAGING"}]," pour l'environnement de staging"]}],"\n",["$","li",null,{"children":"..."}],"\n"]}],"\n",["$","p",null,{"children":["Avec les environnements sous GitLab, nous pouvons donner simplement des valeurs pour les variables ",["$","code",null,{"children":"SPRING_DATASOURCE_URL"}]," et ",["$","code",null,{"children":"SPRING_DATASOURCE_USERNAME"}],", et GitLab se chargera de donner les bonnes valeurs en fonction de l'environnement."]}],"\n",["$","h2",null,{"children":"Création des environnements sous GitLab CI/CD"}],"\n",["$","p",null,{"children":"Pour créer des environnements sous GitLab CI/CD, veuillez suivre les étapes suivantes :"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Dans votre projet GitLab, cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Operate"}]}],"."]}],"\n",["$","li",null,{"children":["Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Environments"}]}],"."]}],"\n",["$","li",null,{"children":["Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"New environment"}]}],"."]}],"\n",["$","li",null,{"children":["Entrez un nom pour l'environnement. Par exemple : ",["$","strong",null,{"children":["$","code",null,{"children":"staging"}]}],"."]}],"\n",["$","li",null,{"children":["Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Save"}]}],"."]}],"\n"]}],"\n",["$","p",null,{"children":"Veuillez recommencer l'opération pour créer un environnement pour la production."}],"\n",["$","h2",null,{"children":"Configuration des variables d'environnement pour les environnements GitLab"}],"\n",["$","h3",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"Nous souhaitons maintenant donner des valeurs pour les variables d'environnement pour chaque environnement."}],"\n",["$","p",null,{"children":"La valeur actuelle des variables d'environnement correspond à l'environnement de staging uniquement, ou aux deux environnements (staging et production)."}],"\n",["$","p",null,{"children":"Voici les variables d'environnement à configurer, et pour quel environnement :"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"AZURE_CLIENT_ID"}]," : deux valeurs, une pour l'environnement de staging et une pour l'environnement de production"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"AZURE_CLIENT_SECRET"}]," : deux valeurs, une pour l'environnement de staging et une pour l'environnement de production"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"AZURE_TENANT_ID"}]," : deux valeurs, une pour l'environnement de staging et une pour l'environnement de production"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"PULL_IMAGE_TOKEN_PASSWORD"}]," : une même valeur pour l'environnement de staging et de production"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"PULL_IMAGE_TOKEN_USERNAME"}]," : une même valeur pour l'environnement de staging et de production"]}],"\n"]}],"\n",["$","h3",null,{"children":"Configuration des variables d'environnement pour l'environnement de staging"}],"\n",["$","p",null,{"children":"Ces variables d'environnement ont déjà les valeurs pour l'environnement de staging. Il faut néanmoins les configurer pour que ces valeurs ne s'appliquent que pour l'environnement de staging."}],"\n",["$","p",null,{"children":"Pour configurer les variables d'environnement pour l'environnement de staging, veuillez suivre les étapes suivantes :"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Dans votre projet GitLab, cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Settings"}]}],"."]}],"\n",["$","li",null,{"children":["Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"CI/CD"}]}],"."]}],"\n",["$","li",null,{"children":["Cliquez sur l'icône ",["$","strong",null,{"children":["$","code",null,{"children":"Edit"}]}]," pour ",["$","strong",null,{"children":["$","code",null,{"children":"AZURE_CLIENT_ID"}]}],"."]}],"\n",["$","li",null,{"children":["Dans ",["$","strong",null,{"children":["$","code",null,{"children":"Environment"}]}],", sélectionnez ",["$","strong",null,{"children":["$","code",null,{"children":"staging"}]}],"."]}],"\n",["$","li",null,{"children":["Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Save changes"}]}],"."]}],"\n",["$","li",null,{"children":["Répétez l'opération pour les autres variables d'environnement : ",["$","strong",null,{"children":["$","code",null,{"children":"AZURE_CLIENT_SECRET"}]}]," et ",["$","strong",null,{"children":["$","code",null,{"children":"AZURE_TENANT_ID"}]}],"."]}],"\n"]}],"\n",["$","h3",null,{"children":"Configuration des variables d'environnement dont la valeur est la même pour les environnements de staging et de production"}],"\n",["$","p",null,{"children":"Par défaut, tant qu'un environnement n'a pas de valeur pour une variable d'environnement, la valeur par défaut est utilisée, c'est-à-dire que la valeur de la variable d'environnement est utilisée pour tous les environnements."}],"\n",["$","p",null,{"children":"Ainsi, nous n'avons plus rien à faire pour les variables d'environnement dont la valeur est la même pour les environnements de staging et de production, c'est-à-dire :"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","strong",null,{"children":["$","code",null,{"children":"PULL_IMAGE_TOKEN_PASSWORD"}]}]}],"\n",["$","li",null,{"children":["$","strong",null,{"children":["$","code",null,{"children":"PULL_IMAGE_TOKEN_USERNAME"}]}]}],"\n"]}],"\n",["$","h3",null,{"children":"Configuration des variables d'environnement pour l'environnement de production"}],"\n",["$","p",null,{"children":"Pour configurer les variables d'environnement pour l'environnement de production, veuillez suivre les étapes suivantes :"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Dans votre projet GitLab, cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Settings"}]}],"."]}],"\n",["$","li",null,{"children":["Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"CI/CD"}]}],"."]}],"\n",["$","li",null,{"children":["Cliquez sur l'icône ",["$","strong",null,{"children":["$","code",null,{"children":"Add variable"}]}]]}],"\n",["$","li",null,{"children":["Dans ",["$","strong",null,{"children":["$","code",null,{"children":"Environment"}]}],", sélectionnez ",["$","strong",null,{"children":["$","code",null,{"children":"production"}]}],"."]}],"\n",["$","li",null,{"children":["Dans ",["$","strong",null,{"children":["$","code",null,{"children":"Visibility"}]}],", sélectionnez ",["$","strong",null,{"children":["$","code",null,{"children":"Masked"}]}],"."]}],"\n",["$","li",null,{"children":["Désactivez ",["$","strong",null,{"children":["$","code",null,{"children":"Protect variable"}]}],"."]}],"\n",["$","li",null,{"children":["Dans ",["$","strong",null,{"children":["$","code",null,{"children":"Key"}]}],", entrez ",["$","strong",null,{"children":["$","code",null,{"children":"AZURE_CLIENT_ID"}]}],"."]}],"\n",["$","li",null,{"children":["Dans ",["$","strong",null,{"children":["$","code",null,{"children":"Value"}]}],", donnez la valeur pour l'environnement de production."]}],"\n",["$","li",null,{"children":["Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Save changes"}]}],"."]}],"\n",["$","li",null,{"children":["Répétez l'opération pour les autres variables d'environnement : ",["$","strong",null,{"children":["$","code",null,{"children":"AZURE_CLIENT_SECRET"}]}]," et ",["$","strong",null,{"children":["$","code",null,{"children":"AZURE_TENANT_ID"}]}],"."]}],"\n"]}],"\n",["$","h2",null,{"children":"Configuration des variables d'environnement pour l'Azure Web App de production"}],"\n",["$","p",null,{"children":["Au niveau de votre Azure Web App (",["$","strong",null,{"children":["$","code",null,{"children":"cae-groupxy-production-app"}]}]," par exemple) via le portail Azure, veuillez :"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Cliquer sur ",["$","strong",null,{"children":["$","code",null,{"children":"Settings"}]}],"."]}],"\n",["$","li",null,{"children":["Cliquer sur ",["$","strong",null,{"children":["$","code",null,{"children":"Environment variables"}]}],"."]}],"\n",["$","li",null,{"children":["Ajouter les variables d'environnement suivantes en cliquant sur ",["$","strong",null,{"children":["$","code",null,{"children":"Add"}]}]," :","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":["$","code",null,{"children":"SPRING_DATASOURCE_URL"}]}]," (",["$","strong",null,{"children":["$","code",null,{"children":"Name"}]}],"): l'URL de connexion à votre DB de production (",["$","strong",null,{"children":["$","code",null,{"children":"Value"}]}],"). Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Apply"}]}],"."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":["$","code",null,{"children":"SPRING_DATASOURCE_USERNAME"}]}]," (",["$","strong",null,{"children":["$","code",null,{"children":"Name"}]}],"): le nom d'utilisateur de votre DB de production (",["$","strong",null,{"children":["$","code",null,{"children":"Value"}]}],"). Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Apply"}]}],"."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":["$","code",null,{"children":"SPRING_DATASOURCE_PASSWORD"}]}]," (",["$","strong",null,{"children":["$","code",null,{"children":"Name"}]}],"): le mot de passe de votre DB de production (",["$","strong",null,{"children":["$","code",null,{"children":"Value"}]}],"). Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Apply"}]}],"."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":["$","code",null,{"children":"AZURE_BLOB_SAS_TOKEN"}]}]," (",["$","strong",null,{"children":["$","code",null,{"children":"Name"}]}],"): le token SAS pour le blob container de production (",["$","strong",null,{"children":["$","code",null,{"children":"Value"}]}],"). Cliquez sur ",["$","strong",null,{"children":["$","code",null,{"children":"Apply"}]}],"."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":["$","code",null,{"children":"SPRING_PROFILES_ACTIVE"}]}]," (",["$","strong",null,{"children":["$","code",null,{"children":"Name"}]}],"): le profil Spring Boot à utiliser pour l'environnement de production (",["$","strong",null,{"children":["$","code",null,{"children":"Value"}]}],"), c'est-à-dire ",["$","strong",null,{"children":["$","code",null,{"children":"production"}]}],"."]}],"\n",["$","li",null,{"children":["N'oubliez pas de cliquer sur ",["$","strong",null,{"children":["$","code",null,{"children":"Apply"}]}]," pour sauvegarder l'ajout des 5 variables, puis ",["$","strong",null,{"children":["$","code",null,{"children":"Confirm"}]}],"."]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","h2",null,{"children":"Comment utiliser les environnements dans les jobs du pipeline"}],"\n",["$","h3",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"Maintenant que nous avons créé des environnements sous GitLab CI/CD, nous pouvons les utiliser dans les jobs du pipeline."}],"\n",["$","p",null,{"children":"Pour cela, il suffit de donner le nom de l'environnement dans le job, et GitLab se chargera de donner les bonnes valeurs pour les variables d'environnement."}],"\n",["$","h3",null,{"children":"Utilisation des environnements dans les jobs du pipeline"}],"\n",["$","p",null,{"children":"Nous allons maintenant mettre à jour notre pipeline pour qu'il déploie sur l'environnement de production."}],"\n",["$","p",null,{"children":["Veuillez mettre à jour votre fichier ",["$","strong",null,{"children":["$","code",null,{"children":".gitlab-ci.yml"}]}]," pour qu'il ressemble à ceci :"]}],"\n",["$","pre",null,{"className":"language-yaml","children":["$","code",null,{"className":"language-yaml code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token key atrule","children":"stages"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," test\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," build\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," e2e\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"6","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," production\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"8","children":[["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"9","children":["  ",["$","span",null,{"className":"token key atrule","children":"MAVEN_OPTS"}],["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository\""}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"10","children":["  ",["$","span",null,{"className":"token key atrule","children":"VERSION"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_IID\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"11","children":["  ",["$","span",null,{"className":"token key atrule","children":"REGISTRY"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_REGISTRY\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"12","children":["  ",["$","span",null,{"className":"token key atrule","children":"REGISTRY_IMAGE_BASE_PATH"}],["$","span",null,{"className":"token punctuation","children":":"}]," $REGISTRY/$CI_PROJECT_PATH\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"13","children":["  ",["$","span",null,{"className":"token key atrule","children":"AZURE_WEBAPP_RESOURCE_GROUP"}],["$","span",null,{"className":"token punctuation","children":":"}]," caeGroup\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"15","children":[["$","span",null,{"className":"token key atrule","children":"api test"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," test\n"]}],["$","span",null,{"className":"code-line line-number","line":"17","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," maven",["$","span",null,{"className":"token punctuation","children":":"}],"3.9.9",["$","span",null,{"className":"token punctuation","children":"-"}],"amazoncorretto",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token number","children":"21"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"18","children":["  ",["$","span",null,{"className":"token key atrule","children":"cache"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"19","children":["    ",["$","span",null,{"className":"token key atrule","children":"key"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"20","children":["      ",["$","span",null,{"className":"token key atrule","children":"files"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"21","children":["        ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/pom.xml\n"]}],["$","span",null,{"className":"code-line line-number","line":"22","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"23","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," $CI_PROJECT_DIR/.m2/repository\n"]}],["$","span",null,{"className":"code-line line-number","line":"24","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"25","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," cd api\n"]}],["$","span",null,{"className":"code-line line-number","line":"26","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," mvn clean test\n"]}],["$","span",null,{"className":"code-line line-number","line":"27","children":["  ",["$","span",null,{"className":"token key atrule","children":"artifacts"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"28","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"29","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/target/reports/\n"]}],["$","span",null,{"className":"code-line line-number","line":"30","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/target/site/\n"]}],["$","span",null,{"className":"code-line line-number","line":"31","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/target/surefire",["$","span",null,{"className":"token punctuation","children":"-"}],"reports/\n"]}],["$","span",null,{"className":"code-line line-number","line":"32","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"33","children":[["$","span",null,{"className":"token key atrule","children":"frontend test"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"34","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," test\n"]}],["$","span",null,{"className":"code-line line-number","line":"35","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," node",["$","span",null,{"className":"token punctuation","children":":"}],"20",["$","span",null,{"className":"token punctuation","children":"-"}],"alpine\n"]}],["$","span",null,{"className":"code-line line-number","line":"36","children":["  ",["$","span",null,{"className":"token key atrule","children":"cache"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"37","children":["    ",["$","span",null,{"className":"token key atrule","children":"key"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"38","children":["      ",["$","span",null,{"className":"token key atrule","children":"files"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"39","children":["        ",["$","span",null,{"className":"token punctuation","children":"-"}]," frontend/package",["$","span",null,{"className":"token punctuation","children":"-"}],"lock.json\n"]}],["$","span",null,{"className":"code-line line-number","line":"40","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"41","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," frontend/node_modules\n"]}],["$","span",null,{"className":"code-line line-number","line":"42","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"43","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," cd frontend\n"]}],["$","span",null,{"className":"code-line line-number","line":"44","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm ci\n"]}],["$","span",null,{"className":"code-line line-number","line":"45","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm run lint\n"]}],["$","span",null,{"className":"code-line line-number","line":"46","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm run coverage\n"]}],["$","span",null,{"className":"code-line line-number","line":"47","children":["  ",["$","span",null,{"className":"token key atrule","children":"artifacts"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"48","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"49","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," frontend/coverage/\n"]}],["$","span",null,{"className":"code-line line-number","line":"50","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"51","children":[["$","span",null,{"className":"token key atrule","children":"build"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"52","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," build\n"]}],["$","span",null,{"className":"code-line line-number","line":"53","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," docker",["$","span",null,{"className":"token punctuation","children":":"}],"latest\n"]}],["$","span",null,{"className":"code-line line-number","line":"54","children":["  ",["$","span",null,{"className":"token key atrule","children":"services"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"55","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," docker",["$","span",null,{"className":"token punctuation","children":":"}],"20",["$","span",null,{"className":"token punctuation","children":"-"}],"dind\n"]}],["$","span",null,{"className":"code-line line-number","line":"56","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"57","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," echo $CI_REGISTRY_PASSWORD ",["$","span",null,{"className":"token punctuation","children":"|"}]," docker login ",["$","span",null,{"className":"token punctuation","children":"-"}],"u $CI_REGISTRY_USER $CI_REGISTRY ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"password",["$","span",null,{"className":"token punctuation","children":"-"}],"stdin\n"]}],["$","span",null,{"className":"code-line line-number","line":"58","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," docker",["$","span",null,{"className":"token punctuation","children":"-"}],"compose ",["$","span",null,{"className":"token punctuation","children":"-"}],"f docker",["$","span",null,{"className":"token punctuation","children":"-"}],"compose.staging.yml build\n"]}],["$","span",null,{"className":"code-line line-number","line":"59","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," for service in frontend",["$","span",null,{"className":"token punctuation","children":"-"}],"prod api",["$","span",null,{"className":"token punctuation","children":"-"}],"prod reverse",["$","span",null,{"className":"token punctuation","children":"-"}],"proxy",["$","span",null,{"className":"token punctuation","children":"-"}],"prod; do\n"]}],["$","span",null,{"className":"code-line line-number","line":"60","children":["      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"latest;\n"]}],["$","span",null,{"className":"code-line line-number","line":"61","children":["      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"$$VERSION;\n"]}],["$","span",null,{"className":"code-line line-number","line":"62","children":["      docker push $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"latest;\n"]}],["$","span",null,{"className":"code-line line-number","line":"63","children":["      docker push $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"$$VERSION;\n"]}],["$","span",null,{"className":"code-line line-number","line":"64","children":"      done\n"}],["$","span",null,{"className":"code-line line-number","line":"65","children":["  ",["$","span",null,{"className":"token key atrule","children":"rules"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"66","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token key atrule","children":"if"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_SOURCE == \"merge_request_event\" ",["$","span",null,{"className":"token important","children":"&&"}]," $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\n"]}],["$","span",null,{"className":"code-line line-number","line":"67","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"68","children":[["$","span",null,{"className":"token key atrule","children":"deploy to staging"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"69","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"70","children":["  ",["$","span",null,{"className":"token key atrule","children":"environment"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"71","children":["  ",["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"72","children":["    ",["$","span",null,{"className":"token key atrule","children":"AZURE_WEBAPP_NAME"}],["$","span",null,{"className":"token punctuation","children":":"}]," cae",["$","span",null,{"className":"token punctuation","children":"-"}],"groupxy",["$","span",null,{"className":"token punctuation","children":"-"}],"staging",["$","span",null,{"className":"token punctuation","children":"-"}],"app\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"73","children":["    ",["$","span",null,{"className":"token key atrule","children":"BASE_URL"}],["$","span",null,{"className":"token punctuation","children":":"}]," https",["$","span",null,{"className":"token punctuation","children":":"}],"//cae",["$","span",null,{"className":"token punctuation","children":"-"}],"groupxy",["$","span",null,{"className":"token punctuation","children":"-"}],"staging",["$","span",null,{"className":"token punctuation","children":"-"}],"app",["$","span",null,{"className":"token punctuation","children":"-"}],"fza6c0ebghahfufh.centralus",["$","span",null,{"className":"token punctuation","children":"-"}],"01.azurewebsites.net/\n"]}],["$","span",null,{"className":"code-line line-number","line":"74","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," mcr.microsoft.com/azure",["$","span",null,{"className":"token punctuation","children":"-"}],"cli\n"]}],["$","span",null,{"className":"code-line line-number","line":"75","children":["  ",["$","span",null,{"className":"token key atrule","children":"rules"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"76","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token key atrule","children":"if"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_SOURCE == \"merge_request_event\" ",["$","span",null,{"className":"token important","children":"&&"}]," $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\n"]}],["$","span",null,{"className":"code-line line-number","line":"77","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"78","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az login ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"service",["$","span",null,{"className":"token punctuation","children":"-"}],"principal ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"username $AZURE_CLIENT_ID ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"password $AZURE_CLIENT_SECRET ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"tenant $AZURE_TENANT_ID\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"79","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp stop ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP\n"]}],["$","span",null,{"className":"code-line line-number","line":"80","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp config container set ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"multicontainer",["$","span",null,{"className":"token punctuation","children":"-"}],"config",["$","span",null,{"className":"token punctuation","children":"-"}],"type compose ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"multicontainer",["$","span",null,{"className":"token punctuation","children":"-"}],"config",["$","span",null,{"className":"token punctuation","children":"-"}],"file docker",["$","span",null,{"className":"token punctuation","children":"-"}],"compose.deploy.yml ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"container",["$","span",null,{"className":"token punctuation","children":"-"}],"registry",["$","span",null,{"className":"token punctuation","children":"-"}],"user $PULL_IMAGE_TOKEN_USERNAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"container",["$","span",null,{"className":"token punctuation","children":"-"}],"registry",["$","span",null,{"className":"token punctuation","children":"-"}],"password $PULL_IMAGE_TOKEN_PASSWORD\n"]}],["$","span",null,{"className":"code-line line-number","line":"81","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp start ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP\n"]}],["$","span",null,{"className":"code-line line-number","line":"82","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token punctuation","children":"|"}],["$","span",null,{"className":"token scalar string","children":"\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"83","children":["$","span",null,{"className":"token scalar string","children":"      for i in {1..30}; do\n"}]}],["$","span",null,{"className":"code-line line-number","line":"84","children":["$","span",null,{"className":"token scalar string","children":"        HTTP_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" $BASE_URL/api/pizzas);\n"}]}],["$","span",null,{"className":"code-line line-number","line":"85","children":["$","span",null,{"className":"token scalar string","children":"        if [ \"$HTTP_STATUS\" -eq 200 ]; then\n"}]}],["$","span",null,{"className":"code-line line-number","line":"86","children":["$","span",null,{"className":"token scalar string","children":"          echo \"Azure Web App is functional.\"\n"}]}],["$","span",null,{"className":"code-line line-number","line":"87","children":["$","span",null,{"className":"token scalar string","children":"          break\n"}]}],["$","span",null,{"className":"code-line line-number","line":"88","children":["$","span",null,{"className":"token scalar string","children":"        fi\n"}]}],["$","span",null,{"className":"code-line line-number","line":"89","children":["$","span",null,{"className":"token scalar string","children":"        echo \"Azure Web App is not ready yet. Waiting for 10 seconds...\"\n"}]}],["$","span",null,{"className":"code-line line-number","line":"90","children":["$","span",null,{"className":"token scalar string","children":"        sleep 10\n"}]}],["$","span",null,{"className":"code-line line-number","line":"91","children":["$","span",null,{"className":"token scalar string","children":"      done\n"}]}],["$","span",null,{"className":"code-line line-number","line":"92","children":["$","span",null,{"className":"token scalar string","children":"      if [ \"$HTTP_STATUS\" -ne 200 ]; then\n"}]}],["$","span",null,{"className":"code-line line-number","line":"93","children":["$","span",null,{"className":"token scalar string","children":"        echo \"Azure Web App failed to become functional.\"\n"}]}],["$","span",null,{"className":"code-line line-number","line":"94","children":["$","span",null,{"className":"token scalar string","children":"        exit 1\n"}]}],["$","span",null,{"className":"code-line line-number","line":"95","children":[["$","span",null,{"className":"token scalar string","children":"      fi"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"96","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"97","children":[["$","span",null,{"className":"token key atrule","children":"e2e tests"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"98","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," e2e\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"99","children":["  ",["$","span",null,{"className":"token key atrule","children":"environment"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"100","children":["  ",["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"101","children":["    ",["$","span",null,{"className":"token key atrule","children":"BASE_URL"}],["$","span",null,{"className":"token punctuation","children":":"}]," https",["$","span",null,{"className":"token punctuation","children":":"}],"//cae",["$","span",null,{"className":"token punctuation","children":"-"}],"groupxy",["$","span",null,{"className":"token punctuation","children":"-"}],"staging",["$","span",null,{"className":"token punctuation","children":"-"}],"app",["$","span",null,{"className":"token punctuation","children":"-"}],"fza6c0ebghahfufh.centralus",["$","span",null,{"className":"token punctuation","children":"-"}],"01.azurewebsites.net/\n"]}],["$","span",null,{"className":"code-line line-number","line":"102","children":["    ",["$","span",null,{"className":"token key atrule","children":"NODE_ENV"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"103","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," mcr.microsoft.com/playwright",["$","span",null,{"className":"token punctuation","children":":"}],"v1.50.1",["$","span",null,{"className":"token punctuation","children":"-"}],"jammy\n"]}],["$","span",null,{"className":"code-line line-number","line":"104","children":["  ",["$","span",null,{"className":"token key atrule","children":"rules"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"105","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token key atrule","children":"if"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_SOURCE == \"merge_request_event\" ",["$","span",null,{"className":"token important","children":"&&"}]," $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\n"]}],["$","span",null,{"className":"code-line line-number","line":"106","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"107","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," cd ./e2e\n"]}],["$","span",null,{"className":"code-line line-number","line":"108","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm ci\n"]}],["$","span",null,{"className":"code-line line-number","line":"109","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npx playwright test\n"]}],["$","span",null,{"className":"code-line line-number","line":"110","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," if ",["$","span",null,{"className":"token punctuation","children":"["}]," $",["$","span",null,{"className":"token punctuation","children":"?"}]," ",["$","span",null,{"className":"token punctuation","children":"-"}],"ne 0 ",["$","span",null,{"className":"token punctuation","children":"]"}],"; then echo \"E2E tests failed\"; exit 1; fi\n"]}],["$","span",null,{"className":"code-line line-number","line":"111","children":["  ",["$","span",null,{"className":"token key atrule","children":"artifacts"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"112","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"113","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," e2e/playwright",["$","span",null,{"className":"token punctuation","children":"-"}],"report/\n"]}],["$","span",null,{"className":"code-line line-number","line":"114","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," e2e/test",["$","span",null,{"className":"token punctuation","children":"-"}],"results/\n"]}],["$","span",null,{"className":"code-line line-number","line":"115","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"116","children":[["$","span",null,{"className":"token key atrule","children":"deploy to production"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"117","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," production\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"118","children":["  ",["$","span",null,{"className":"token key atrule","children":"environment"}],["$","span",null,{"className":"token punctuation","children":":"}]," production\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"119","children":["  ",["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"120","children":["    ",["$","span",null,{"className":"token key atrule","children":"AZURE_WEBAPP_NAME"}],["$","span",null,{"className":"token punctuation","children":":"}]," production",["$","span",null,{"className":"token punctuation","children":"-"}],"pizzeria\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"121","children":["    ",["$","span",null,{"className":"token key atrule","children":"BASE_URL"}],["$","span",null,{"className":"token punctuation","children":":"}]," https",["$","span",null,{"className":"token punctuation","children":":"}],"//production",["$","span",null,{"className":"token punctuation","children":"-"}],"pizzeria",["$","span",null,{"className":"token punctuation","children":"-"}],"frd5dugfffgtarf6.centralus",["$","span",null,{"className":"token punctuation","children":"-"}],"01.azurewebsites.net/\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"122","children":["    ",["$","span",null,{"className":"token key atrule","children":"NODE_ENV"}],["$","span",null,{"className":"token punctuation","children":":"}]," production\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"123","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," mcr.microsoft.com/azure",["$","span",null,{"className":"token punctuation","children":"-"}],"cli\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"124","children":["  ",["$","span",null,{"className":"token key atrule","children":"rules"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"125","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token key atrule","children":"if"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_SOURCE == \"merge_request_event\" ",["$","span",null,{"className":"token important","children":"&&"}]," $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"126","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"127","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az login ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"service",["$","span",null,{"className":"token punctuation","children":"-"}],"principal ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"username $AZURE_CLIENT_ID ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"password $AZURE_CLIENT_SECRET ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"tenant $AZURE_TENANT_ID\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"128","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp stop ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"129","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp config container set ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"multicontainer",["$","span",null,{"className":"token punctuation","children":"-"}],"config",["$","span",null,{"className":"token punctuation","children":"-"}],"type compose ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"multicontainer",["$","span",null,{"className":"token punctuation","children":"-"}],"config",["$","span",null,{"className":"token punctuation","children":"-"}],"file docker",["$","span",null,{"className":"token punctuation","children":"-"}],"compose.deploy.yml ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"container",["$","span",null,{"className":"token punctuation","children":"-"}],"registry",["$","span",null,{"className":"token punctuation","children":"-"}],"user $PULL_IMAGE_TOKEN_USERNAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"container",["$","span",null,{"className":"token punctuation","children":"-"}],"registry",["$","span",null,{"className":"token punctuation","children":"-"}],"password $PULL_IMAGE_TOKEN_PASSWORD\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"130","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp start ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"131","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token punctuation","children":"|"}],["$","span",null,{"className":"token scalar string","children":"\n"}]]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"132","children":["$","span",null,{"className":"token scalar string","children":"      for i in {1..30}; do\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"133","children":["$","span",null,{"className":"token scalar string","children":"        HTTP_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" $BASE_URL/api/pizzas);\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"134","children":["$","span",null,{"className":"token scalar string","children":"        if [ \"$HTTP_STATUS\" -eq 200 ]; then\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"135","children":["$","span",null,{"className":"token scalar string","children":"          echo \"Azure Web App is functional.\"\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"136","children":["$","span",null,{"className":"token scalar string","children":"          break\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"137","children":["$","span",null,{"className":"token scalar string","children":"        fi\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"138","children":["$","span",null,{"className":"token scalar string","children":"        echo \"Azure Web App is not ready yet. Waiting for 10 seconds...\"\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"139","children":["$","span",null,{"className":"token scalar string","children":"        sleep 10\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"140","children":["$","span",null,{"className":"token scalar string","children":"      done\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"141","children":["$","span",null,{"className":"token scalar string","children":"      if [ \"$HTTP_STATUS\" -ne 200 ]; then\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"142","children":["$","span",null,{"className":"token scalar string","children":"        echo \"Azure Web App failed to become functional.\"\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"143","children":["$","span",null,{"className":"token scalar string","children":"        exit 1\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"144","children":[["$","span",null,{"className":"token scalar string","children":"      fi"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"Nous avons donc ajouté un nouveau job pour le déploiement sur l'environnement de production."}],"\n",["$","p",null,{"children":"Voici quelques explications sur le pipeline :"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Les variables ",["$","strong",null,{"children":["$","code",null,{"children":"AZURE_WEBAPP_NAME"}]}]," et ",["$","strong",null,{"children":["$","code",null,{"children":"BASE_URL"}]}]," sont différentes pour chaque environnement. Elle ne sont donc plus reprises au niveau de la section ",["$","strong",null,{"children":["$","code",null,{"children":"variables"}]}]," mais directement dans les jobs."]}],"\n",["$","li",null,{"children":["Le fait de préciser ",["$","strong",null,{"children":["$","code",null,{"children":"environment: staging"}]}]," ou ",["$","strong",null,{"children":["$","code",null,{"children":"environment: production"}]}]," permet à GitLab de donner les bonnes valeurs pour les variables d'environnement en fonction de l'environnement."]}],"\n",["$","li",null,{"children":["Les règles ",["$","strong",null,{"children":["$","code",null,{"children":"rules"}]}]," permettent de dire que le job ne doit être exécuté que si la source du pipeline est un ",["$","strong",null,{"children":["$","code",null,{"children":"merge_request_event"}]}]," et que la branche de la merge request est la branche par défaut."]}],"\n",["$","li",null,{"children":["Nous avons ajouté ",["$","strong",null,{"children":["$","code",null,{"children":"azure webapp stop"}]}]," pour être sûr que l'application est bien arrêtée avant de la redéployer.",["$","br",null,{}],"\n","NB : Cela n'est peut-être pas nécessaire, mais cela semble régler certains problèmes potentiels de non réinitialisation de la DB au redémarrage de l'API dans l'environnement de staging."]}],"\n"]}],"\n",["$","p",null,{"children":"Veuillez donc faire un commit et un push pour déclencher le pipeline. Vérifiez que le déploiement sur l'environnement de production se passe bien."}],"\n",["$","h2",null,{"children":"Amélioration du pipeline"}],"\n",["$","h3",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":["Notre pipeline actuel contient des duplications de code. En effet, les jobs ",["$","strong",null,{"children":["$","code",null,{"children":"deploy to staging"}]}]," et ",["$","strong",null,{"children":["$","code",null,{"children":"deploy to production"}]}]," sont presque identiques."]}],"\n",["$","p",null,{"children":"Nous allons donc voir comment améliorer notre pipeline en factorisant le code commun dans un template."}],"\n",["$","h3",null,{"children":"Création d'un template pour le déploiement"}],"\n",["$","p",null,{"children":["Veuillez mettre à jour votre fichier ",["$","strong",null,{"children":["$","code",null,{"children":".gitlab-ci.yml"}]}]," pour qu'il ressemble à ceci :"]}],"\n",["$","pre",null,{"className":"language-yaml","children":["$","code",null,{"className":"language-yaml code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token key atrule","children":"stages"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," test\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," build\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," e2e\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," production\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"8","children":[["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":["  ",["$","span",null,{"className":"token key atrule","children":"MAVEN_OPTS"}],["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository\""}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":["  ",["$","span",null,{"className":"token key atrule","children":"VERSION"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_IID\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":["  ",["$","span",null,{"className":"token key atrule","children":"REGISTRY"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_REGISTRY\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":["  ",["$","span",null,{"className":"token key atrule","children":"REGISTRY_IMAGE_BASE_PATH"}],["$","span",null,{"className":"token punctuation","children":":"}]," $REGISTRY/$CI_PROJECT_PATH\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":["  ",["$","span",null,{"className":"token key atrule","children":"AZURE_WEBAPP_RESOURCE_GROUP"}],["$","span",null,{"className":"token punctuation","children":":"}]," caeGroup\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"15","children":[["$","span",null,{"className":"token key atrule","children":"api test"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," test\n"]}],["$","span",null,{"className":"code-line line-number","line":"17","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," maven",["$","span",null,{"className":"token punctuation","children":":"}],"3.9.9",["$","span",null,{"className":"token punctuation","children":"-"}],"amazoncorretto",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token number","children":"21"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"18","children":["  ",["$","span",null,{"className":"token key atrule","children":"cache"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"19","children":["    ",["$","span",null,{"className":"token key atrule","children":"key"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"20","children":["      ",["$","span",null,{"className":"token key atrule","children":"files"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"21","children":["        ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/pom.xml\n"]}],["$","span",null,{"className":"code-line line-number","line":"22","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"23","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," $CI_PROJECT_DIR/.m2/repository\n"]}],["$","span",null,{"className":"code-line line-number","line":"24","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"25","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," cd api\n"]}],["$","span",null,{"className":"code-line line-number","line":"26","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," mvn clean test\n"]}],["$","span",null,{"className":"code-line line-number","line":"27","children":["  ",["$","span",null,{"className":"token key atrule","children":"artifacts"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"28","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"29","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/target/reports/\n"]}],["$","span",null,{"className":"code-line line-number","line":"30","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/target/site/\n"]}],["$","span",null,{"className":"code-line line-number","line":"31","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/target/surefire",["$","span",null,{"className":"token punctuation","children":"-"}],"reports/\n"]}],["$","span",null,{"className":"code-line line-number","line":"32","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"33","children":[["$","span",null,{"className":"token key atrule","children":"frontend test"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"34","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," test\n"]}],["$","span",null,{"className":"code-line line-number","line":"35","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," node",["$","span",null,{"className":"token punctuation","children":":"}],"20",["$","span",null,{"className":"token punctuation","children":"-"}],"alpine\n"]}],["$","span",null,{"className":"code-line line-number","line":"36","children":["  ",["$","span",null,{"className":"token key atrule","children":"cache"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"37","children":["    ",["$","span",null,{"className":"token key atrule","children":"key"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"38","children":["      ",["$","span",null,{"className":"token key atrule","children":"files"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"39","children":["        ",["$","span",null,{"className":"token punctuation","children":"-"}]," frontend/package",["$","span",null,{"className":"token punctuation","children":"-"}],"lock.json\n"]}],["$","span",null,{"className":"code-line line-number","line":"40","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"41","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," frontend/node_modules\n"]}],["$","span",null,{"className":"code-line line-number","line":"42","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"43","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," cd frontend\n"]}],["$","span",null,{"className":"code-line line-number","line":"44","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm ci\n"]}],["$","span",null,{"className":"code-line line-number","line":"45","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm run lint\n"]}],["$","span",null,{"className":"code-line line-number","line":"46","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm run coverage\n"]}],["$","span",null,{"className":"code-line line-number","line":"47","children":["  ",["$","span",null,{"className":"token key atrule","children":"artifacts"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"48","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"49","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," frontend/coverage/\n"]}],["$","span",null,{"className":"code-line line-number","line":"50","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"51","children":[["$","span",null,{"className":"token key atrule","children":"build"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"52","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," build\n"]}],["$","span",null,{"className":"code-line line-number","line":"53","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," docker",["$","span",null,{"className":"token punctuation","children":":"}],"latest\n"]}],["$","span",null,{"className":"code-line line-number","line":"54","children":["  ",["$","span",null,{"className":"token key atrule","children":"services"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"55","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," docker",["$","span",null,{"className":"token punctuation","children":":"}],"20",["$","span",null,{"className":"token punctuation","children":"-"}],"dind\n"]}],["$","span",null,{"className":"code-line line-number","line":"56","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"57","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," echo $CI_REGISTRY_PASSWORD ",["$","span",null,{"className":"token punctuation","children":"|"}]," docker login ",["$","span",null,{"className":"token punctuation","children":"-"}],"u $CI_REGISTRY_USER $CI_REGISTRY ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"password",["$","span",null,{"className":"token punctuation","children":"-"}],"stdin\n"]}],["$","span",null,{"className":"code-line line-number","line":"58","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," docker",["$","span",null,{"className":"token punctuation","children":"-"}],"compose ",["$","span",null,{"className":"token punctuation","children":"-"}],"f docker",["$","span",null,{"className":"token punctuation","children":"-"}],"compose.staging.yml build\n"]}],["$","span",null,{"className":"code-line line-number","line":"59","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," for service in frontend",["$","span",null,{"className":"token punctuation","children":"-"}],"prod api",["$","span",null,{"className":"token punctuation","children":"-"}],"prod reverse",["$","span",null,{"className":"token punctuation","children":"-"}],"proxy",["$","span",null,{"className":"token punctuation","children":"-"}],"prod; do\n"]}],["$","span",null,{"className":"code-line line-number","line":"60","children":["      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"latest;\n"]}],["$","span",null,{"className":"code-line line-number","line":"61","children":["      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"$$VERSION;\n"]}],["$","span",null,{"className":"code-line line-number","line":"62","children":["      docker push $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"latest;\n"]}],["$","span",null,{"className":"code-line line-number","line":"63","children":["      docker push $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"$$VERSION;\n"]}],["$","span",null,{"className":"code-line line-number","line":"64","children":"      done\n"}],["$","span",null,{"className":"code-line line-number","line":"65","children":["  ",["$","span",null,{"className":"token key atrule","children":"rules"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"66","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token key atrule","children":"if"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_SOURCE == \"merge_request_event\" ",["$","span",null,{"className":"token important","children":"&&"}]," $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\n"]}],["$","span",null,{"className":"code-line line-number","line":"67","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"68","children":[["$","span",null,{"className":"token key atrule","children":".deploy"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"69","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," mcr.microsoft.com/azure",["$","span",null,{"className":"token punctuation","children":"-"}],"cli\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"70","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"71","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az login ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"service",["$","span",null,{"className":"token punctuation","children":"-"}],"principal ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"username $AZURE_CLIENT_ID ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"password $AZURE_CLIENT_SECRET ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"tenant $AZURE_TENANT_ID\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"72","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp stop ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"73","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp config container set ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"multicontainer",["$","span",null,{"className":"token punctuation","children":"-"}],"config",["$","span",null,{"className":"token punctuation","children":"-"}],"type compose ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"multicontainer",["$","span",null,{"className":"token punctuation","children":"-"}],"config",["$","span",null,{"className":"token punctuation","children":"-"}],"file docker",["$","span",null,{"className":"token punctuation","children":"-"}],"compose.deploy.yml ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"container",["$","span",null,{"className":"token punctuation","children":"-"}],"registry",["$","span",null,{"className":"token punctuation","children":"-"}],"user $PULL_IMAGE_TOKEN_USERNAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"container",["$","span",null,{"className":"token punctuation","children":"-"}],"registry",["$","span",null,{"className":"token punctuation","children":"-"}],"password $PULL_IMAGE_TOKEN_PASSWORD\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"74","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp start ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"75","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token punctuation","children":"|"}],["$","span",null,{"className":"token scalar string","children":"\n"}]]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"76","children":["$","span",null,{"className":"token scalar string","children":"      for i in {1..30}; do\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"77","children":["$","span",null,{"className":"token scalar string","children":"        HTTP_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" $BASE_URL/api/pizzas);\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"78","children":["$","span",null,{"className":"token scalar string","children":"        if [ \"$HTTP_STATUS\" -eq 200 ]; then\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"79","children":["$","span",null,{"className":"token scalar string","children":"          echo \"Azure Web App is functional.\"\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"80","children":["$","span",null,{"className":"token scalar string","children":"          break\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"81","children":["$","span",null,{"className":"token scalar string","children":"        fi\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"82","children":["$","span",null,{"className":"token scalar string","children":"        echo \"Azure Web App is not ready yet. Waiting for 10 seconds...\"\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"83","children":["$","span",null,{"className":"token scalar string","children":"        sleep 10\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"84","children":["$","span",null,{"className":"token scalar string","children":"      done\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"85","children":["$","span",null,{"className":"token scalar string","children":"      if [ \"$HTTP_STATUS\" -ne 200 ]; then\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"86","children":["$","span",null,{"className":"token scalar string","children":"        echo \"Azure Web App failed to become functional.\"\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"87","children":["$","span",null,{"className":"token scalar string","children":"        exit 1\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"88","children":[["$","span",null,{"className":"token scalar string","children":"      fi"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"89","children":["  ",["$","span",null,{"className":"token key atrule","children":"rules"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"90","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token key atrule","children":"if"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_SOURCE == \"merge_request_event\" ",["$","span",null,{"className":"token important","children":"&&"}]," $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\n"]}],["$","span",null,{"className":"code-line line-number","line":"91","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"92","children":[["$","span",null,{"className":"token key atrule","children":"deploy to staging"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"93","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"94","children":["  ",["$","span",null,{"className":"token key atrule","children":"environment"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"95","children":["  ",["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"96","children":["    ",["$","span",null,{"className":"token key atrule","children":"AZURE_WEBAPP_NAME"}],["$","span",null,{"className":"token punctuation","children":":"}]," cae",["$","span",null,{"className":"token punctuation","children":"-"}],"groupxy",["$","span",null,{"className":"token punctuation","children":"-"}],"staging",["$","span",null,{"className":"token punctuation","children":"-"}],"app\n"]}],["$","span",null,{"className":"code-line line-number","line":"97","children":["    ",["$","span",null,{"className":"token key atrule","children":"BASE_URL"}],["$","span",null,{"className":"token punctuation","children":":"}]," https",["$","span",null,{"className":"token punctuation","children":":"}],"//cae",["$","span",null,{"className":"token punctuation","children":"-"}],"groupxy",["$","span",null,{"className":"token punctuation","children":"-"}],"staging",["$","span",null,{"className":"token punctuation","children":"-"}],"app",["$","span",null,{"className":"token punctuation","children":"-"}],"fza6c0ebghahfufh.centralus",["$","span",null,{"className":"token punctuation","children":"-"}],"01.azurewebsites.net/\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"98","children":["  ",["$","span",null,{"className":"token key atrule","children":"extends"}],["$","span",null,{"className":"token punctuation","children":":"}]," .deploy\n"]}],["$","span",null,{"className":"code-line line-number","line":"99","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"100","children":[["$","span",null,{"className":"token key atrule","children":"e2e tests"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"101","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," e2e\n"]}],["$","span",null,{"className":"code-line line-number","line":"102","children":["  ",["$","span",null,{"className":"token key atrule","children":"environment"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"103","children":["  ",["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"104","children":["    ",["$","span",null,{"className":"token key atrule","children":"BASE_URL"}],["$","span",null,{"className":"token punctuation","children":":"}]," https",["$","span",null,{"className":"token punctuation","children":":"}],"//cae",["$","span",null,{"className":"token punctuation","children":"-"}],"groupxy",["$","span",null,{"className":"token punctuation","children":"-"}],"staging",["$","span",null,{"className":"token punctuation","children":"-"}],"app",["$","span",null,{"className":"token punctuation","children":"-"}],"fza6c0ebghahfufh.centralus",["$","span",null,{"className":"token punctuation","children":"-"}],"01.azurewebsites.net/\n"]}],["$","span",null,{"className":"code-line line-number","line":"105","children":["    ",["$","span",null,{"className":"token key atrule","children":"NODE_ENV"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"106","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," mcr.microsoft.com/playwright",["$","span",null,{"className":"token punctuation","children":":"}],"v1.50.1",["$","span",null,{"className":"token punctuation","children":"-"}],"jammy\n"]}],["$","span",null,{"className":"code-line line-number","line":"107","children":["  ",["$","span",null,{"className":"token key atrule","children":"rules"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"108","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token key atrule","children":"if"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_SOURCE == \"merge_request_event\" ",["$","span",null,{"className":"token important","children":"&&"}]," $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\n"]}],["$","span",null,{"className":"code-line line-number","line":"109","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"110","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," cd ./e2e\n"]}],["$","span",null,{"className":"code-line line-number","line":"111","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm ci\n"]}],["$","span",null,{"className":"code-line line-number","line":"112","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npx playwright test\n"]}],["$","span",null,{"className":"code-line line-number","line":"113","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," if ",["$","span",null,{"className":"token punctuation","children":"["}]," $",["$","span",null,{"className":"token punctuation","children":"?"}]," ",["$","span",null,{"className":"token punctuation","children":"-"}],"ne 0 ",["$","span",null,{"className":"token punctuation","children":"]"}],"; then echo \"E2E tests failed\"; exit 1; fi\n"]}],["$","span",null,{"className":"code-line line-number","line":"114","children":["  ",["$","span",null,{"className":"token key atrule","children":"artifacts"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"115","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"116","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," e2e/playwright",["$","span",null,{"className":"token punctuation","children":"-"}],"report/\n"]}],["$","span",null,{"className":"code-line line-number","line":"117","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," e2e/test",["$","span",null,{"className":"token punctuation","children":"-"}],"results/\n"]}],["$","span",null,{"className":"code-line line-number","line":"118","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"119","children":[["$","span",null,{"className":"token key atrule","children":"deploy to production"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"120","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," production\n"]}],["$","span",null,{"className":"code-line line-number","line":"121","children":["  ",["$","span",null,{"className":"token key atrule","children":"environment"}],["$","span",null,{"className":"token punctuation","children":":"}]," production\n"]}],["$","span",null,{"className":"code-line line-number","line":"122","children":["  ",["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"123","children":["    ",["$","span",null,{"className":"token key atrule","children":"AZURE_WEBAPP_NAME"}],["$","span",null,{"className":"token punctuation","children":":"}]," production",["$","span",null,{"className":"token punctuation","children":"-"}],"pizzeria\n"]}],["$","span",null,{"className":"code-line line-number","line":"124","children":["    ",["$","span",null,{"className":"token key atrule","children":"BASE_URL"}],["$","span",null,{"className":"token punctuation","children":":"}]," https",["$","span",null,{"className":"token punctuation","children":":"}],"//production",["$","span",null,{"className":"token punctuation","children":"-"}],"pizzeria",["$","span",null,{"className":"token punctuation","children":"-"}],"frd5dugfffgtarf6.centralus",["$","span",null,{"className":"token punctuation","children":"-"}],"01.azurewebsites.net/\n"]}],["$","span",null,{"className":"code-line line-number","line":"125","children":["    ",["$","span",null,{"className":"token key atrule","children":"NODE_ENV"}],["$","span",null,{"className":"token punctuation","children":":"}]," production\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"126","children":["  ",["$","span",null,{"className":"token key atrule","children":"extends"}],["$","span",null,{"className":"token punctuation","children":":"}]," .deploy\n"]}]]}]}],"\n",["$","p",null,{"children":["Nous avons donc créé un template ",["$","strong",null,{"children":["$","code",null,{"children":".deploy"}]}]," pour le déploiement. Ce template contient le code commun pour le déploiement sur l'environnement de staging et de production."]}],"\n",["$","p",null,{"children":["Nous avons ensuite utilisé ce template dans les jobs ",["$","strong",null,{"children":["$","code",null,{"children":"deploy to staging"}]}]," et ",["$","strong",null,{"children":["$","code",null,{"children":"deploy to production"}]}]," en utilisant la directive ",["$","strong",null,{"children":["$","code",null,{"children":"extends: .deploy"}]}],"."]}],"\n",["$","p",null,{"children":"Veuillez donc faire un commit et un push pour déclencher le pipeline. Vérifiez que le déploiement sur l'environnement de production se passe bien."}],"\n",["$","h2",null,{"children":"Conclusion sur la création de l'environnement de production"}],"\n",["$","p",null,{"children":"Nous avons maintenant une pipeline qui déploie automatiquement sur l'environnement de production seulement si l'environnement de staging, très proche de la production, réussi les tests e2e."}],"\n",["$","p",null,{"children":"Nous avons maintenant un nouvel environnement de production que nous pouvons visualiser ainsi, si l'on prend en compte l'environnement de staging nécessaire à sa mise en place :"}],"\n",["$","$L17",null,{"src":"/diagrams/prod-deployment1.puml","alt":"Environnement de production"}],"\n",["$","p",null,{"children":"Nous faisons ce que nous appelons du déploiement continu (CD en anglais), c'est-à-dire que chaque commit sur la branche principale déclenche un déploiement sur l'environnement de production."}],"\n",["$","p",null,{"children":"Nous allons voir maintenant comment faire du Continous Delivery au lieu du Continuous Deployment."}],"\n",["$","h1",null,{"children":["$","a",null,{"id":"comment_faire_du_continuous_delivery","children":" Comment faire du Continuous Delivery ? "}]}],"\n",["$","h2",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"Nous avons jusque là fait du Continuous Deployment, c'est-à-dire que chaque commit sur la branche principale déclenche un déploiement sur l'environnement de production."}],"\n",["$","p",null,{"children":"Nous allons maintenant voir comment faire du Continuous Delivery, c'est-à-dire que chaque commit sur la branche principale déclenche un déploiement sur l'environnement de staging, et que l'on peut déclencher manuellement un déploiement sur l'environnement de production."}],"\n",["$","p",null,{"children":"En effet, il peut être intéressant de pouvoir vérifier, via des humains proches des utilisateurs finaux, que tout fonctionne bien sur l'environnement de staging avant de déployer sur l'environnement de production."}],"\n",["$","h2",null,{"children":"Mise en place du Continuous Delivery"}],"\n",["$","p",null,{"children":"Pour mettre en place du Continuous Delivery, nous allons simplement changer le déclenchement du déploiement sur l'environnement de production."}],"\n",["$","p",null,{"children":["Pour cela il suffit de changer la règle pour le job ",["$","strong",null,{"children":["$","code",null,{"children":"deploy to production"}]}]," en indiquant que le job ne doit être exécuté que si le pipeline est déclenché manuellement."]}],"\n",["$","p",null,{"children":["Veuillez mettre à jour votre fichier ",["$","strong",null,{"children":["$","code",null,{"children":".gitlab-ci.yml"}]}]," pour qu'il ressemble à ceci :"]}],"\n",["$","pre",null,{"className":"language-yaml","children":["$","code",null,{"className":"language-yaml code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token key atrule","children":"stages"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," test\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," build\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," e2e\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," production\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"8","children":[["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":["  ",["$","span",null,{"className":"token key atrule","children":"MAVEN_OPTS"}],["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository\""}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":["  ",["$","span",null,{"className":"token key atrule","children":"VERSION"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_IID\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":["  ",["$","span",null,{"className":"token key atrule","children":"REGISTRY"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_REGISTRY\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":["  ",["$","span",null,{"className":"token key atrule","children":"REGISTRY_IMAGE_BASE_PATH"}],["$","span",null,{"className":"token punctuation","children":":"}]," $REGISTRY/$CI_PROJECT_PATH\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":["  ",["$","span",null,{"className":"token key atrule","children":"AZURE_WEBAPP_RESOURCE_GROUP"}],["$","span",null,{"className":"token punctuation","children":":"}]," caeGroup\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"15","children":[["$","span",null,{"className":"token key atrule","children":"api test"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," test\n"]}],["$","span",null,{"className":"code-line line-number","line":"17","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," maven",["$","span",null,{"className":"token punctuation","children":":"}],"3.9.9",["$","span",null,{"className":"token punctuation","children":"-"}],"amazoncorretto",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token number","children":"21"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"18","children":["  ",["$","span",null,{"className":"token key atrule","children":"cache"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"19","children":["    ",["$","span",null,{"className":"token key atrule","children":"key"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"20","children":["      ",["$","span",null,{"className":"token key atrule","children":"files"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"21","children":["        ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/pom.xml\n"]}],["$","span",null,{"className":"code-line line-number","line":"22","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"23","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," $CI_PROJECT_DIR/.m2/repository\n"]}],["$","span",null,{"className":"code-line line-number","line":"24","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"25","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," cd api\n"]}],["$","span",null,{"className":"code-line line-number","line":"26","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," mvn clean test\n"]}],["$","span",null,{"className":"code-line line-number","line":"27","children":["  ",["$","span",null,{"className":"token key atrule","children":"artifacts"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"28","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"29","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/target/reports/\n"]}],["$","span",null,{"className":"code-line line-number","line":"30","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/target/site/\n"]}],["$","span",null,{"className":"code-line line-number","line":"31","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," api/target/surefire",["$","span",null,{"className":"token punctuation","children":"-"}],"reports/\n"]}],["$","span",null,{"className":"code-line line-number","line":"32","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"33","children":[["$","span",null,{"className":"token key atrule","children":"frontend test"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"34","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," test\n"]}],["$","span",null,{"className":"code-line line-number","line":"35","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," node",["$","span",null,{"className":"token punctuation","children":":"}],"20",["$","span",null,{"className":"token punctuation","children":"-"}],"alpine\n"]}],["$","span",null,{"className":"code-line line-number","line":"36","children":["  ",["$","span",null,{"className":"token key atrule","children":"cache"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"37","children":["    ",["$","span",null,{"className":"token key atrule","children":"key"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"38","children":["      ",["$","span",null,{"className":"token key atrule","children":"files"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"39","children":["        ",["$","span",null,{"className":"token punctuation","children":"-"}]," frontend/package",["$","span",null,{"className":"token punctuation","children":"-"}],"lock.json\n"]}],["$","span",null,{"className":"code-line line-number","line":"40","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"41","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," frontend/node_modules\n"]}],["$","span",null,{"className":"code-line line-number","line":"42","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"43","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," cd frontend\n"]}],["$","span",null,{"className":"code-line line-number","line":"44","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm ci\n"]}],["$","span",null,{"className":"code-line line-number","line":"45","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm run lint\n"]}],["$","span",null,{"className":"code-line line-number","line":"46","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm run coverage\n"]}],["$","span",null,{"className":"code-line line-number","line":"47","children":["  ",["$","span",null,{"className":"token key atrule","children":"artifacts"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"48","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"49","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," frontend/coverage/\n"]}],["$","span",null,{"className":"code-line line-number","line":"50","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"51","children":[["$","span",null,{"className":"token key atrule","children":"build"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"52","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," build\n"]}],["$","span",null,{"className":"code-line line-number","line":"53","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," docker",["$","span",null,{"className":"token punctuation","children":":"}],"latest\n"]}],["$","span",null,{"className":"code-line line-number","line":"54","children":["  ",["$","span",null,{"className":"token key atrule","children":"services"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"55","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," docker",["$","span",null,{"className":"token punctuation","children":":"}],"20",["$","span",null,{"className":"token punctuation","children":"-"}],"dind\n"]}],["$","span",null,{"className":"code-line line-number","line":"56","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"57","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," echo $CI_REGISTRY_PASSWORD ",["$","span",null,{"className":"token punctuation","children":"|"}]," docker login ",["$","span",null,{"className":"token punctuation","children":"-"}],"u $CI_REGISTRY_USER $CI_REGISTRY ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"password",["$","span",null,{"className":"token punctuation","children":"-"}],"stdin\n"]}],["$","span",null,{"className":"code-line line-number","line":"58","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," docker",["$","span",null,{"className":"token punctuation","children":"-"}],"compose ",["$","span",null,{"className":"token punctuation","children":"-"}],"f docker",["$","span",null,{"className":"token punctuation","children":"-"}],"compose.staging.yml build\n"]}],["$","span",null,{"className":"code-line line-number","line":"59","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," for service in frontend",["$","span",null,{"className":"token punctuation","children":"-"}],"prod api",["$","span",null,{"className":"token punctuation","children":"-"}],"prod reverse",["$","span",null,{"className":"token punctuation","children":"-"}],"proxy",["$","span",null,{"className":"token punctuation","children":"-"}],"prod; do\n"]}],["$","span",null,{"className":"code-line line-number","line":"60","children":["      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"latest;\n"]}],["$","span",null,{"className":"code-line line-number","line":"61","children":["      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"$$VERSION;\n"]}],["$","span",null,{"className":"code-line line-number","line":"62","children":["      docker push $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"latest;\n"]}],["$","span",null,{"className":"code-line line-number","line":"63","children":["      docker push $REGISTRY_IMAGE_BASE_PATH/$service",["$","span",null,{"className":"token punctuation","children":":"}],"$$VERSION;\n"]}],["$","span",null,{"className":"code-line line-number","line":"64","children":"      done\n"}],["$","span",null,{"className":"code-line line-number","line":"65","children":["  ",["$","span",null,{"className":"token key atrule","children":"rules"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"66","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token key atrule","children":"if"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_SOURCE == \"merge_request_event\" ",["$","span",null,{"className":"token important","children":"&&"}]," $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\n"]}],["$","span",null,{"className":"code-line line-number","line":"67","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"68","children":[["$","span",null,{"className":"token key atrule","children":".deploy"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"69","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," mcr.microsoft.com/azure",["$","span",null,{"className":"token punctuation","children":"-"}],"cli\n"]}],["$","span",null,{"className":"code-line line-number","line":"70","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"71","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az login ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"service",["$","span",null,{"className":"token punctuation","children":"-"}],"principal ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"username $AZURE_CLIENT_ID ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"password $AZURE_CLIENT_SECRET ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"tenant $AZURE_TENANT_ID\n"]}],["$","span",null,{"className":"code-line line-number","line":"72","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp stop ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP\n"]}],["$","span",null,{"className":"code-line line-number","line":"73","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp config container set ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"multicontainer",["$","span",null,{"className":"token punctuation","children":"-"}],"config",["$","span",null,{"className":"token punctuation","children":"-"}],"type compose ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"multicontainer",["$","span",null,{"className":"token punctuation","children":"-"}],"config",["$","span",null,{"className":"token punctuation","children":"-"}],"file docker",["$","span",null,{"className":"token punctuation","children":"-"}],"compose.deploy.yml ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"container",["$","span",null,{"className":"token punctuation","children":"-"}],"registry",["$","span",null,{"className":"token punctuation","children":"-"}],"user $PULL_IMAGE_TOKEN_USERNAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"container",["$","span",null,{"className":"token punctuation","children":"-"}],"registry",["$","span",null,{"className":"token punctuation","children":"-"}],"password $PULL_IMAGE_TOKEN_PASSWORD\n"]}],["$","span",null,{"className":"code-line line-number","line":"74","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," az webapp start ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"name $AZURE_WEBAPP_NAME ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"resource",["$","span",null,{"className":"token punctuation","children":"-"}],"group $AZURE_WEBAPP_RESOURCE_GROUP\n"]}],["$","span",null,{"className":"code-line line-number","line":"75","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token punctuation","children":"|"}],["$","span",null,{"className":"token scalar string","children":"\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"76","children":["$","span",null,{"className":"token scalar string","children":"      for i in {1..30}; do\n"}]}],["$","span",null,{"className":"code-line line-number","line":"77","children":["$","span",null,{"className":"token scalar string","children":"        HTTP_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" $BASE_URL/api/pizzas);\n"}]}],["$","span",null,{"className":"code-line line-number","line":"78","children":["$","span",null,{"className":"token scalar string","children":"        if [ \"$HTTP_STATUS\" -eq 200 ]; then\n"}]}],["$","span",null,{"className":"code-line line-number","line":"79","children":["$","span",null,{"className":"token scalar string","children":"          echo \"Azure Web App is functional.\"\n"}]}],["$","span",null,{"className":"code-line line-number","line":"80","children":["$","span",null,{"className":"token scalar string","children":"          break\n"}]}],["$","span",null,{"className":"code-line line-number","line":"81","children":["$","span",null,{"className":"token scalar string","children":"        fi\n"}]}],["$","span",null,{"className":"code-line line-number","line":"82","children":["$","span",null,{"className":"token scalar string","children":"        echo \"Azure Web App is not ready yet. Waiting for 10 seconds...\"\n"}]}],["$","span",null,{"className":"code-line line-number","line":"83","children":["$","span",null,{"className":"token scalar string","children":"        sleep 10\n"}]}],["$","span",null,{"className":"code-line line-number","line":"84","children":["$","span",null,{"className":"token scalar string","children":"      done\n"}]}],["$","span",null,{"className":"code-line line-number","line":"85","children":["$","span",null,{"className":"token scalar string","children":"      if [ \"$HTTP_STATUS\" -ne 200 ]; then\n"}]}],["$","span",null,{"className":"code-line line-number","line":"86","children":["$","span",null,{"className":"token scalar string","children":"        echo \"Azure Web App failed to become functional.\"\n"}]}],["$","span",null,{"className":"code-line line-number","line":"87","children":["$","span",null,{"className":"token scalar string","children":"        exit 1\n"}]}],["$","span",null,{"className":"code-line line-number","line":"88","children":[["$","span",null,{"className":"token scalar string","children":"      fi"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"89","children":["  ",["$","span",null,{"className":"token key atrule","children":"rules"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"90","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token key atrule","children":"if"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_SOURCE == \"merge_request_event\" ",["$","span",null,{"className":"token important","children":"&&"}]," $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\n"]}],["$","span",null,{"className":"code-line line-number","line":"91","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"92","children":[["$","span",null,{"className":"token key atrule","children":"deploy to staging"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"93","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"94","children":["  ",["$","span",null,{"className":"token key atrule","children":"environment"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"95","children":["  ",["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"96","children":["    ",["$","span",null,{"className":"token key atrule","children":"AZURE_WEBAPP_NAME"}],["$","span",null,{"className":"token punctuation","children":":"}]," cae",["$","span",null,{"className":"token punctuation","children":"-"}],"groupxy",["$","span",null,{"className":"token punctuation","children":"-"}],"staging",["$","span",null,{"className":"token punctuation","children":"-"}],"app\n"]}],["$","span",null,{"className":"code-line line-number","line":"97","children":["    ",["$","span",null,{"className":"token key atrule","children":"BASE_URL"}],["$","span",null,{"className":"token punctuation","children":":"}]," https",["$","span",null,{"className":"token punctuation","children":":"}],"//cae",["$","span",null,{"className":"token punctuation","children":"-"}],"groupxy",["$","span",null,{"className":"token punctuation","children":"-"}],"staging",["$","span",null,{"className":"token punctuation","children":"-"}],"app",["$","span",null,{"className":"token punctuation","children":"-"}],"fza6c0ebghahfufh.centralus",["$","span",null,{"className":"token punctuation","children":"-"}],"01.azurewebsites.net/\n"]}],["$","span",null,{"className":"code-line line-number","line":"98","children":["  ",["$","span",null,{"className":"token key atrule","children":"extends"}],["$","span",null,{"className":"token punctuation","children":":"}]," .deploy\n"]}],["$","span",null,{"className":"code-line line-number","line":"99","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"100","children":[["$","span",null,{"className":"token key atrule","children":"e2e tests"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"101","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," e2e\n"]}],["$","span",null,{"className":"code-line line-number","line":"102","children":["  ",["$","span",null,{"className":"token key atrule","children":"environment"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"103","children":["  ",["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"104","children":["    ",["$","span",null,{"className":"token key atrule","children":"BASE_URL"}],["$","span",null,{"className":"token punctuation","children":":"}]," https",["$","span",null,{"className":"token punctuation","children":":"}],"//cae",["$","span",null,{"className":"token punctuation","children":"-"}],"groupxy",["$","span",null,{"className":"token punctuation","children":"-"}],"staging",["$","span",null,{"className":"token punctuation","children":"-"}],"app",["$","span",null,{"className":"token punctuation","children":"-"}],"fza6c0ebghahfufh.centralus",["$","span",null,{"className":"token punctuation","children":"-"}],"01.azurewebsites.net/\n"]}],["$","span",null,{"className":"code-line line-number","line":"105","children":["    ",["$","span",null,{"className":"token key atrule","children":"NODE_ENV"}],["$","span",null,{"className":"token punctuation","children":":"}]," staging\n"]}],["$","span",null,{"className":"code-line line-number","line":"106","children":["  ",["$","span",null,{"className":"token key atrule","children":"image"}],["$","span",null,{"className":"token punctuation","children":":"}]," mcr.microsoft.com/playwright",["$","span",null,{"className":"token punctuation","children":":"}],"v1.50.1",["$","span",null,{"className":"token punctuation","children":"-"}],"jammy\n"]}],["$","span",null,{"className":"code-line line-number","line":"107","children":["  ",["$","span",null,{"className":"token key atrule","children":"rules"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"108","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token key atrule","children":"if"}],["$","span",null,{"className":"token punctuation","children":":"}]," $CI_PIPELINE_SOURCE == \"merge_request_event\" ",["$","span",null,{"className":"token important","children":"&&"}]," $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\n"]}],["$","span",null,{"className":"code-line line-number","line":"109","children":["  ",["$","span",null,{"className":"token key atrule","children":"script"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"110","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," cd ./e2e\n"]}],["$","span",null,{"className":"code-line line-number","line":"111","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npm ci\n"]}],["$","span",null,{"className":"code-line line-number","line":"112","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," npx playwright test\n"]}],["$","span",null,{"className":"code-line line-number","line":"113","children":["    ",["$","span",null,{"className":"token punctuation","children":"-"}]," if ",["$","span",null,{"className":"token punctuation","children":"["}]," $",["$","span",null,{"className":"token punctuation","children":"?"}]," ",["$","span",null,{"className":"token punctuation","children":"-"}],"ne 0 ",["$","span",null,{"className":"token punctuation","children":"]"}],"; then echo \"E2E tests failed\"; exit 1; fi\n"]}],["$","span",null,{"className":"code-line line-number","line":"114","children":["  ",["$","span",null,{"className":"token key atrule","children":"artifacts"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"115","children":["    ",["$","span",null,{"className":"token key atrule","children":"paths"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"116","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," e2e/playwright",["$","span",null,{"className":"token punctuation","children":"-"}],"report/\n"]}],["$","span",null,{"className":"code-line line-number","line":"117","children":["      ",["$","span",null,{"className":"token punctuation","children":"-"}]," e2e/test",["$","span",null,{"className":"token punctuation","children":"-"}],"results/\n"]}],["$","span",null,{"className":"code-line line-number","line":"118","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"119","children":[["$","span",null,{"className":"token key atrule","children":"deploy to production"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"120","children":["  ",["$","span",null,{"className":"token key atrule","children":"stage"}],["$","span",null,{"className":"token punctuation","children":":"}]," production\n"]}],["$","span",null,{"className":"code-line line-number","line":"121","children":["  ",["$","span",null,{"className":"token key atrule","children":"environment"}],["$","span",null,{"className":"token punctuation","children":":"}]," production\n"]}],["$","span",null,{"className":"code-line line-number","line":"122","children":["  ",["$","span",null,{"className":"token key atrule","children":"variables"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"123","children":["    ",["$","span",null,{"className":"token key atrule","children":"AZURE_WEBAPP_NAME"}],["$","span",null,{"className":"token punctuation","children":":"}]," production",["$","span",null,{"className":"token punctuation","children":"-"}],"pizzeria\n"]}],["$","span",null,{"className":"code-line line-number","line":"124","children":["    ",["$","span",null,{"className":"token key atrule","children":"BASE_URL"}],["$","span",null,{"className":"token punctuation","children":":"}]," https",["$","span",null,{"className":"token punctuation","children":":"}],"//production",["$","span",null,{"className":"token punctuation","children":"-"}],"pizzeria",["$","span",null,{"className":"token punctuation","children":"-"}],"frd5dugfffgtarf6.centralus",["$","span",null,{"className":"token punctuation","children":"-"}],"01.azurewebsites.net/\n"]}],["$","span",null,{"className":"code-line line-number","line":"125","children":["    ",["$","span",null,{"className":"token key atrule","children":"NODE_ENV"}],["$","span",null,{"className":"token punctuation","children":":"}]," production\n"]}],["$","span",null,{"className":"code-line line-number","line":"126","children":["  ",["$","span",null,{"className":"token key atrule","children":"extends"}],["$","span",null,{"className":"token punctuation","children":":"}]," .deploy\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"127","children":["  ",["$","span",null,{"className":"token key atrule","children":"when"}],["$","span",null,{"className":"token punctuation","children":":"}]," manual\n"]}]]}]}],"\n",["$","p",null,{"children":["Nous avons donc ajouté la directive ",["$","strong",null,{"children":["$","code",null,{"children":"when: manual"}]}]," pour le job ",["$","strong",null,{"children":["$","code",null,{"children":"deploy to production"}]}],". Cela signifie que le job ne sera exécuté que si le pipeline est déclenché manuellement."]}],"\n",["$","p",null,{"children":["Veuillez donc faire un commit et un push pour déclencher le pipeline.\nUne fois que le déploiement sur l'environnement de staging est terminé, au niveau de la visualisation de la pipeline, dans le job nommé ",["$","strong",null,{"children":["$","code",null,{"children":"production"}]}],", vous pouvez cliquer sur le bouton ",["$","strong",null,{"children":["$","code",null,{"children":"Play"}]}]," pour déclencher le déploiement sur l'environnement de production."]}],"\n",["$","h2",null,{"children":"Conclusion sur le Continuous Delivery"}],"\n",["$","p",null,{"children":"Nous avons maintenant un pipeline qui déploie automatiquement sur l'environnement de staging, et qui permet de déclencher manuellement un déploiement sur l'environnement de production."}],"\n",["$","p",null,{"children":"Si nous avons eu des soucis avec le démarrage de l'API sur l'environnement de staging, nous avons déjà pu nous rendre compte de l'importance des logs pour le débogage. Nous allons donc voir comment améliorer les logs de notre application."}],"\n",["$","p",null,{"children":["Si nécessaire, vous pouvez trouver le code associé au déploiement de l'environnement de production ici : ",["$","a",null,{"href":"https://github.com/e-vinci/cae-theory-demos/tree/main/production","children":"production"}],"."]}]]
f:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
d:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Production"}]]
b:null
