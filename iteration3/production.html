<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/cae-theory/_next/static/css/fd89b796fb218fbf.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/cae-theory/_next/static/chunks/webpack-0335b56ac768253e.js"/><script src="/cae-theory/_next/static/chunks/4bd1b696-1c20c52a7d48565d.js" async=""></script><script src="/cae-theory/_next/static/chunks/517-35a1bc7953f03a32.js" async=""></script><script src="/cae-theory/_next/static/chunks/main-app-058efed246406231.js" async=""></script><script src="/cae-theory/_next/static/chunks/144-6ef9499ac178c5dc.js" async=""></script><script src="/cae-theory/_next/static/chunks/245-30e455921c0f8f22.js" async=""></script><script src="/cae-theory/_next/static/chunks/app/layout-a6c5d823159daef4.js" async=""></script><script src="/cae-theory/_next/static/chunks/830-d07b37352b41f989.js" async=""></script><script src="/cae-theory/_next/static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js" async=""></script><title>CAE Course</title><link rel="icon" type="image/svg+xml" href="/cae-theory/favicon.svg"/><title>Production</title><script src="/cae-theory/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script><style data-emotion="mui-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-global 1o1x9wj">blockquote{border-left:5px solid #1976d2;background-color:rgba(0, 0, 0, 0.04);padding:0.5em;margin:1em 0;}table{width:100%;border-collapse:collapse;overflow-x:auto;display:block;}th{border:1px solid rgba(0, 0, 0, 0.12);padding:8px;background-color:#1976d2;color:#fff;font-weight:bold;}td{border:1px solid rgba(0, 0, 0, 0.12);padding:8px;}tr:nth-of-type(even){background-color:rgba(0, 0, 0, 0.04);}tr:hover{background-color:rgba(0, 0, 0, 0.08);}</style><style data-emotion="mui ljfsoa w6pz14 awgou1 tdg6lc 1mm3lge 1dya3jy q7mezt 1myx5lw 130f8nx 6n7j50 mcfrop o34szc 1xdhyk6 13wylk3 1oz5b8u 1gychr7 kxijxt wfm2y7 51eq8m 1ttcndq ub0mep 1nd5pgh ihsi0z 14rdsw0 fyswvn">.mui-ljfsoa{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;--AppBar-background:#1976d2;--AppBar-color:#fff;background-color:var(--AppBar-background);color:var(--AppBar-color);color:#fff;}.mui-w6pz14{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:var(--Paper-shadow);background-image:var(--Paper-overlay);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;--AppBar-background:#1976d2;--AppBar-color:#fff;background-color:var(--AppBar-background);color:var(--AppBar-color);color:#fff;}.mui-awgou1{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.mui-awgou1{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.mui-awgou1{min-height:48px;}}}@media (min-width:600px){.mui-awgou1{min-height:64px;}}.mui-tdg6lc{text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);margin-left:-12px;color:inherit;margin-right:16px;}.mui-tdg6lc:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.mui-tdg6lc:hover{background-color:transparent;}}.mui-tdg6lc.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.mui-tdg6lc.MuiIconButton-loading{color:transparent;}.mui-1mm3lge{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);margin-left:-12px;color:inherit;margin-right:16px;}.mui-1mm3lge::-moz-focus-inner{border-style:none;}.mui-1mm3lge.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-1mm3lge{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-1mm3lge:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.mui-1mm3lge:hover{background-color:transparent;}}.mui-1mm3lge.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.mui-1mm3lge.MuiIconButton-loading{color:transparent;}.mui-1dya3jy{display:none;position:absolute;visibility:visible;top:50%;left:50%;-webkit-transform:translate(-50%, -50%);-moz-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%);color:rgba(0, 0, 0, 0.26);}.mui-q7mezt{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;}.mui-1myx5lw{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:1.25rem;line-height:1.6;letter-spacing:0.0075em;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}@media (min-width:600px){.mui-1myx5lw{display:block;}}@media (min-width:0px){.mui-130f8nx{display:none;}}@media (min-width:600px){.mui-130f8nx{display:block;}}.mui-6n7j50{display:inline;}.mui-mcfrop{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 16px;border:0;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;padding:6px 8px;color:var(--variant-textColor);background-color:var(--variant-textBg);color:inherit;border-color:currentColor;--variant-containedBg:#e0e0e0;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#fff;}.mui-mcfrop:hover{-webkit-text-decoration:none;text-decoration:none;}.mui-mcfrop.Mui-disabled{color:rgba(0, 0, 0, 0.26);}@media (hover: hover){.mui-mcfrop:hover{--variant-containedBg:#f5f5f5;--variant-textBg:rgba(0, 0, 0, 0.04);--variant-outlinedBg:rgba(0, 0, 0, 0.04);}}.mui-mcfrop.MuiButton-loading{color:transparent;}.mui-o34szc{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 16px;border:0;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;padding:6px 8px;color:var(--variant-textColor);background-color:var(--variant-textBg);color:inherit;border-color:currentColor;--variant-containedBg:#e0e0e0;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#fff;}.mui-o34szc::-moz-focus-inner{border-style:none;}.mui-o34szc.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-o34szc{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-o34szc:hover{-webkit-text-decoration:none;text-decoration:none;}.mui-o34szc.Mui-disabled{color:rgba(0, 0, 0, 0.26);}@media (hover: hover){.mui-o34szc:hover{--variant-containedBg:#f5f5f5;--variant-textBg:rgba(0, 0, 0, 0.04);--variant-outlinedBg:rgba(0, 0, 0, 0.04);}}.mui-o34szc.MuiButton-loading{color:transparent;}.mui-1oz5b8u{z-index:1200;}@media (min-width:0px){.mui-1oz5b8u{display:block;}}@media (min-width:600px){.mui-1oz5b8u{display:none;}}.mui-1oz5b8u .MuiDrawer-paper{box-sizing:border-box;width:240px;color:#fff;background-color:#1976d2;}.mui-1gychr7{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;padding-left:16px;padding-right:16px;padding:1rem;word-wrap:break-word;}@media (min-width:600px){.mui-1gychr7{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.mui-1gychr7{max-width:1200px;}}.mui-kxijxt{list-style:none;margin:0;padding:0;position:relative;padding-top:8px;padding-bottom:8px;width:100%;border-radius:8px;border:1px solid;border-color:rgba(0, 0, 0, 0.12);padding:0.5rem;}.mui-wfm2y7{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:rgba(0, 0, 0, 0.6);}.mui-51eq8m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0;margin:0;list-style:none;}.mui-1ttcndq{-webkit-text-decoration:none;text-decoration:none;color:inherit;}.mui-1ttcndq:hover{-webkit-text-decoration:underline;text-decoration:underline;}.mui-ub0mep{margin:0;font:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;-webkit-text-decoration:none;text-decoration:none;color:inherit;}.mui-ub0mep:hover{-webkit-text-decoration:underline;text-decoration:underline;}.mui-1nd5pgh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin-left:8px;margin-right:8px;}.mui-ihsi0z{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;-webkit-text-decoration:none;text-decoration:none;width:100%;box-sizing:border-box;text-align:left;padding-top:8px;padding-bottom:8px;padding-left:16px;padding-right:16px;padding-top:0px;padding-bottom:0px;}.mui-14rdsw0{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;min-width:0;margin-top:4px;margin-bottom:4px;}.MuiTypography-root:where(.mui-14rdsw0 .MuiListItemText-primary){display:block;}.MuiTypography-root:where(.mui-14rdsw0 .MuiListItemText-secondary){display:block;}.mui-fyswvn{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}</style></head><body><header><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic mui-w6pz14" style="--Paper-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12)"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular mui-awgou1"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-edgeStart MuiIconButton-sizeMedium mui-1mm3lge" tabindex="0" type="button" id=":R1l5nb:" aria-label="open drawer"><span class="MuiIconButton-loadingIndicator mui-1dya3jy"></span><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuIcon"><path d="M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"></path></svg></button><div class="MuiTypography-root MuiTypography-h6 mui-1myx5lw">CAE</div><div class="MuiBox-root mui-130f8nx"><div class="MuiBox-root mui-6n7j50"><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" id=":R8rl5nb:" href="/cae-theory">Home</a></div><div class="MuiBox-root mui-6n7j50"><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" id=":R9bl5nb:" href="/cae-theory/intro">Intro</a></div><div class="MuiBox-root mui-6n7j50"><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" type="button" id=":Rprl5nb:">Qualité</button></div><div class="MuiBox-root mui-6n7j50"><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" type="button" id=":Rqbl5nb:">Itération 2</button></div><div class="MuiBox-root mui-6n7j50"><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" type="button" id=":Rqrl5nb:">Itération 3</button></div><div class="MuiBox-root mui-6n7j50"><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" id=":Rbbl5nb:" href="/cae-theory/about">About</a></div></div></div></header><nav></nav></header><div class="MuiContainer-root MuiContainer-maxWidthLg mui-1gychr7"><ul class="MuiList-root MuiList-padding mui-kxijxt"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="HighlightOffIcon"><path d="M14.59 8 12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41zM12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"></path></svg><nav class="MuiTypography-root MuiTypography-body1 MuiBreadcrumbs-root mui-wfm2y7" aria-label="breadcrumb"><ol class="MuiBreadcrumbs-ol mui-51eq8m"><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="/cae-theory"> CAE </a></li><li aria-hidden="true" class="MuiBreadcrumbs-separator mui-1nd5pgh">/</li><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="/cae-theory/iteration3"> Itération 3 </a></li><li aria-hidden="true" class="MuiBreadcrumbs-separator mui-1nd5pgh">/</li><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#"> Gestion de l&#x27;environnement de production </a></li></ol></nav><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#quest_ce_que_lenvironnement_de_production"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Qu&#x27;est-ce que l&#x27;environnement de production ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_creer_lenvironnement_de_production"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment créer l&#x27;environnement de production ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_creer_des_environnements_sous_git_lab_ci_cd"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment créer des environnements sous GitLab CI/CD </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_faire_du_continuous_delivery"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment faire du Continuous Delivery ? </span></div></a></div></ul>
<h1><a id="quest_ce_que_lenvironnement_de_production"> Qu&#x27;est-ce que l&#x27;environnement de production ? </a></h1>
<p>Nous l&#x27;avons déjà vu dans l&#x27;introduction sur les environnements, l&#x27;environnement de production est un environnement dans lequel l&#x27;application est déployée pour être utilisée par les utilisateurs finaux.</p>
<p>Dans la partie sur le déploiement, nous avons vu comment déployer une application dans l&#x27;environnement de staging, que l&#x27;on peut considérer comme la pré-production. Dans cette partie, nous allons voir comment déployer une application dans l&#x27;environnement de production.</p>
<p>Dans un premier temps, nous souhaitons faire du déploiement continu, c&#x27;est-à-dire que chaque commit sur la branche principale doit déclencher un déploiement sur l&#x27;environnement de production, et cela seulement bien sûr si tous les tests passent, y compris les tests e2e à réaliser sur l&#x27;environnement de staging (ou de pré-production).</p>
<p>Voici le workflow que nous souhaitons mettre en place :</p>
<div>Loading...</div>
<h1><a id="comment_creer_lenvironnement_de_production"> Comment créer l&#x27;environnement de production ? </a></h1>
<h2>Introduction</h2>
<p>Pour mettre en place l&#x27;environnement de production, nous allons utiliser les mêmes services que pour l&#x27;environnement de staging, à savoir :</p>
<ul>
<li>Azure Web App pour déployer les services frontend, backend et le reverse proxy</li>
<li>Pour les étudiants Vinci, une base de données offerte par Vinci ; pour les autres, Azure Database for PostgreSQL pour la base de données</li>
<li>Un service de stockage Azure Blob pour stocker les fichiers statiques (principalement les images dans nos tutoriels)</li>
<li>GitLab CI/CD pour automatiser le déploiement.</li>
</ul>
<h2>Création de l&#x27;environnement de production sur Azure Web App</h2>
<p>Veuillez refaire les étapes de la partie sur le déploiement pour créer un nouvelle Azure Web App : <a href="../iteration2/deployment#comment_creer_une_application_sur_azure_web_app_service">Déploiement : Comment créer une app sur Azure Web App Service</a>.</p>
<p>Donnez un nom à votre application, par exemple <strong><code>cae-groupxy-production-app</code></strong>.</p>
<p>Ensuite, veuillez faire la partie pour donner accès à votre nouvelle Azure Web App via GitLab CI/CD : <a href="../iteration2/deployment#comment_creer_une_application_sur_azure_web_app_service">Déploiement : Comment donner accès à d&#x27;autres applications à une Azure Web App ?</a>. Veuillez créer donc un nouveau service principal et bien noter les informations de connexion. Voici un exemple de ce que vous devriez avoir à la fin de cette étape :</p>
<pre class="language-properties"><code class="language-properties code-highlight"><span class="code-line"><span class="token key attr-name">AZURE_CLIENT_SECRET</span><span class="token punctuation">=</span><span class="token value attr-value">am45Q~jpcc2G64r3GumcGdYRE99cwxddfsqWeD8DcW1</span>
</span><span class="code-line"><span class="token key attr-name">AZURE_TENANT_ID</span><span class="token punctuation">=</span><span class="token value attr-value">f7a15dq7-57cb-5855-8d36-0545f95aada17</span>
</span><span class="code-line"><span class="token key attr-name">AZURE_CLIENT_ID</span><span class="token punctuation">=</span><span class="token value attr-value">fs8f6ea8-8807-4764-a394-f0bessqf7e8cbe</span>
</span></code></pre>
<h2>Création de l&#x27;environnement pour le stockage des images sur Azure Blob Storage</h2>
<h3>Introduction</h3>
<p>Pour stocker les images, nous allons utiliser le service de stockage que nous avons créé lors du déploiement. Sur ce service de stockage, nous allons créer un nouveau blob container pour l&#x27;environnement de production.</p>
<h3>Création du blob container pour l&#x27;environnement de production</h3>
<p>Pour créer un blob container pour l&#x27;environnement de production, veuillez suivre les étapes suivantes :</p>
<ul>
<li>Dans le portail Azure, cliquez sur <strong><code>Storage accounts</code></strong> dans le menu de gauche.</li>
<li>Cliquez sur le <strong><code>Storage account</code></strong> que vous avez créé précédemment (<strong><code>imagestorage007</code></strong> par exemple).</li>
<li>Dans le menu de gauche, sous <strong><code>Data storage</code></strong>, cliquez sur <strong><code>Containers</code></strong>.</li>
<li>Cliquez sur <strong><code>+ Container</code></strong>.</li>
<li>Entrez un nom pour le container. Par exemple : <strong><code>prod</code></strong>.</li>
<li>Pour <strong><code>Anonymous access level</code></strong>, sélectionnez <strong><code>Blob (anonymous read access for blobs only)</code></strong>. Grâce à cela, les blobs peuvent être lus par n&#x27;importe qui, mais sans avoir le droit de lister les blobs.</li>
<li>Laissez les autres paramètres par défaut.</li>
<li>Cliquez sur <strong><code>Create</code></strong>.</li>
</ul>
<h2>Création de l&#x27;environnement pour la base de données</h2>
<h3>Introduction</h3>
<p>Comme nous l&#x27;avons vu dans la partie sur le déploiement, nous allons utiliser une base de données externe. Pour les étudiants Vinci, vous avez une base de données offerte par Vinci. Pour les autres, vous pouvez utiliser Azure Database for PostgreSQL.</p>
<p>Pour votre environnement de production, veuillez utiliser une base de données différente de celle de l&#x27;environnement de staging. Vous pouvez par exemple créer une nouvelle base de données sur Azure Database for PostgreSQL. Pour les étudiants Vinci, chaque groupe possède plusieurs bases de données, vous pouvez donc en choisir une autre.</p>
<h3>Configuration de l&#x27;API Spring Boot pour utiliser la nouvelle base de données et le nouveau blob container</h3>
<p>Veuillez repartir de votre projet GitLab pour ce nouveau tutoriel. Pensez à créer une nouvelle branche pour ce tutoriel.</p>
<p>Veuillez au niveau de votre application Spring Boot, changer la configuration pour utiliser la nouvelle base de données. Veuillez créer le fichier <strong><code>application-production.properties</code></strong> pour qu&#x27;il ressemble à ceci :</p>
<pre class="language-properties"><code class="language-properties code-highlight"><span class="code-line"><span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">production</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">3000</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">${SPRING_DATASOURCE_URL}</span>
</span><span class="code-line"><span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">${SPRING_DATASOURCE_USERNAME}</span>
</span><span class="code-line"><span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">${SPRING_DATASOURCE_PASSWORD}</span>
</span><span class="code-line"><span class="token key attr-name">spring.jpa.generate-ddl</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</span><span class="code-line"><span class="token key attr-name">spring.sql.init.mode</span><span class="token punctuation">=</span><span class="token value attr-value">never</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key attr-name">azure.blob.service-endpoint</span><span class="token punctuation">=</span><span class="token value attr-value">https://imagestorage007.blob.core.windows.net/</span>
</span><span class="code-line"><span class="token key attr-name">azure.blob.sas-token</span><span class="token punctuation">=</span><span class="token value attr-value">${AZURE_BLOB_SAS_TOKEN}</span>
</span><span class="code-line"><span class="token key attr-name">azure.blob.container-name</span><span class="token punctuation">=</span><span class="token value attr-value">production</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key attr-name">spring.servlet.multipart.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</span><span class="code-line"><span class="token key attr-name">spring.servlet.multipart.max-file-size</span><span class="token punctuation">=</span><span class="token value attr-value">10MB</span>
</span><span class="code-line"><span class="token key attr-name">spring.servlet.multipart.max-request-size</span><span class="token punctuation">=</span><span class="token value attr-value">10MB</span>
</span></code></pre>
<p>Nous avons donc créé un nouveau profil pour Spring Boot, <strong><code>production</code></strong>, qui utilise les variables d&#x27;environnement pour la connexion à la base de données et au blob container.</p>
<p>Veuillez noter vos nouvelles informations de connexion à la base de données, par exemple :</p>
<pre class="language-properties"><code class="language-properties code-highlight"><span class="code-line"><span class="token key attr-name">SPRING_DATASOURCE_URL</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:postgresql://cae-groupxy-production-db.postgres.database.azure.com:5432/cae_groupxy_production_db</span>
</span><span class="code-line"><span class="token key attr-name">SPRING_DATASOURCE_USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">cae_groupxy_production_user@cae-groupxy-production-db</span>
</span><span class="code-line"><span class="token key attr-name">SPRING_DATASOURCE_PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">MySuperPassword</span>
</span></code></pre>
<h2>Configuration de GitLab CI/CD pour le déploiement continu</h2>
<p>Si nous souhaitons configurer notre pipeline, nous devons ajouter une nouvelle étape pour le déploiement sur l&#x27;environnement de production.</p>
<p>De plus, nous avons des secrets à ajouter pour la connexion à la base de données et au blob container.
C&#x27;est pourquoi nous allons voir la gestion des environnements dans GitLab CI/CD, principalement afin d&#x27;éviter d&#x27;avoir à donner des noms de variables d&#x27;environnement différents pour chaque environnement.</p>
<h1><a id="comment_creer_des_environnements_sous_git_lab_ci_cd"> Comment créer des environnements sous GitLab CI/CD </a></h1>
<h2>Introduction</h2>
<p>GitLab CI/CD permet de gérer des environnements pour les pipelines. Cela permet de définir des variables d&#x27;environnement pour chaque environnement, et de les utiliser dans les jobs du pipeline.</p>
<p>Sans utiliser d&#x27;environnement, nous devrions donner des noms de variables d&#x27;environnement différents pour chaque environnement, ce qui peut être source d&#x27;erreur.</p>
<p>Par exemple, pour la connexion à la base de données, nous devrions donner :</p>
<ul>
<li><code>SPRING_DATASOURCE_URL_PROD</code> pour l&#x27;environnement de production</li>
<li><code>SPRING_DATASOURCE_URL_STAGING</code> pour l&#x27;environnement de staging</li>
<li><code>SPRING_DATASOURCE_USERNAME_PROD</code> pour l&#x27;environnement de production</li>
<li><code>SPRING_DATASOURCE_USERNAME_STAGING</code> pour l&#x27;environnement de staging</li>
<li>...</li>
</ul>
<p>Avec les environnements sous GitLab, nous pouvons donner simplement des valeurs pour les variables <code>SPRING_DATASOURCE_URL</code> et <code>SPRING_DATASOURCE_USERNAME</code>, et GitLab se chargera de donner les bonnes valeurs en fonction de l&#x27;environnement.</p>
<h2>Création des environnements sous GitLab CI/CD</h2>
<p>Pour créer des environnements sous GitLab CI/CD, veuillez suivre les étapes suivantes :</p>
<ul>
<li>Dans votre projet GitLab, cliquez sur <strong><code>Operate</code></strong>.</li>
<li>Cliquez sur <strong><code>Environments</code></strong>.</li>
<li>Cliquez sur <strong><code>New environment</code></strong>.</li>
<li>Entrez un nom pour l&#x27;environnement. Par exemple : <strong><code>staging</code></strong>.</li>
<li>Cliquez sur <strong><code>Save</code></strong>.</li>
</ul>
<p>Veuillez recommencer l&#x27;opération pour créer un environnement pour la production.</p>
<h2>Configuration des variables d&#x27;environnement pour les environnements GitLab</h2>
<h3>Introduction</h3>
<p>Nous souhaitons maintenant donner des valeurs pour les variables d&#x27;environnement pour chaque environnement.</p>
<p>La valeur actuelle des variables d&#x27;environnement correspond à l&#x27;environnement de staging uniquement, ou aux deux environnements (staging et production).</p>
<p>Voici les variables d&#x27;environnement à configurer, et pour quel environnement :</p>
<ul>
<li><code>AZURE_CLIENT_ID</code> : deux valeurs, une pour l&#x27;environnement de staging et une pour l&#x27;environnement de production</li>
<li><code>AZURE_CLIENT_SECRET</code> : deux valeurs, une pour l&#x27;environnement de staging et une pour l&#x27;environnement de production</li>
<li><code>AZURE_TENANT_ID</code> : deux valeurs, une pour l&#x27;environnement de staging et une pour l&#x27;environnement de production</li>
<li><code>PULL_IMAGE_TOKEN_PASSWORD</code> : une même valeur pour l&#x27;environnement de staging et de production</li>
<li><code>PULL_IMAGE_TOKEN_USERNAME</code> : une même valeur pour l&#x27;environnement de staging et de production</li>
</ul>
<h3>Configuration des variables d&#x27;environnement pour l&#x27;environnement de staging</h3>
<p>Ces variables d&#x27;environnement ont déjà les valeurs pour l&#x27;environnement de staging. Il faut néanmoins les configurer pour que ces valeurs ne s&#x27;appliquent que pour l&#x27;environnement de staging.</p>
<p>Pour configurer les variables d&#x27;environnement pour l&#x27;environnement de staging, veuillez suivre les étapes suivantes :</p>
<ul>
<li>Dans votre projet GitLab, cliquez sur <strong><code>Settings</code></strong>.</li>
<li>Cliquez sur <strong><code>CI/CD</code></strong>.</li>
<li>Cliquez sur l&#x27;icône <strong><code>Edit</code></strong> pour <strong><code>AZURE_CLIENT_ID</code></strong>.</li>
<li>Dans <strong><code>Environment</code></strong>, sélectionnez <strong><code>staging</code></strong>.</li>
<li>Cliquez sur <strong><code>Save changes</code></strong>.</li>
<li>Répétez l&#x27;opération pour les autres variables d&#x27;environnement : <strong><code>AZURE_CLIENT_SECRET</code></strong> et <strong><code>AZURE_TENANT_ID</code></strong>.</li>
</ul>
<h3>Configuration des variables d&#x27;environnement dont la valeur est la même pour les environnements de staging et de production</h3>
<p>Par défaut, tant qu&#x27;un environnement n&#x27;a pas de valeur pour une variable d&#x27;environnement, la valeur par défaut est utilisée, c&#x27;est-à-dire que la valeur de la variable d&#x27;environnement est utilisée pour tous les environnements.</p>
<p>Ainsi, nous n&#x27;avons plus rien à faire pour les variables d&#x27;environnement dont la valeur est la même pour les environnements de staging et de production, c&#x27;est-à-dire :</p>
<ul>
<li><strong><code>PULL_IMAGE_TOKEN_PASSWORD</code></strong></li>
<li><strong><code>PULL_IMAGE_TOKEN_USERNAME</code></strong></li>
</ul>
<h3>Configuration des variables d&#x27;environnement pour l&#x27;environnement de production</h3>
<p>Pour configurer les variables d&#x27;environnement pour l&#x27;environnement de production, veuillez suivre les étapes suivantes :</p>
<ul>
<li>Dans votre projet GitLab, cliquez sur <strong><code>Settings</code></strong>.</li>
<li>Cliquez sur <strong><code>CI/CD</code></strong>.</li>
<li>Cliquez sur l&#x27;icône <strong><code>Add variable</code></strong></li>
<li>Dans <strong><code>Environment</code></strong>, sélectionnez <strong><code>production</code></strong>.</li>
<li>Dans <strong><code>Visibility</code></strong>, sélectionnez <strong><code>Masked</code></strong>.</li>
<li>Désactivez <strong><code>Protect variable</code></strong>.</li>
<li>Dans <strong><code>Key</code></strong>, entrez <strong><code>AZURE_CLIENT_ID</code></strong>.</li>
<li>Dans <strong><code>Value</code></strong>, donnez la valeur pour l&#x27;environnement de production.</li>
<li>Cliquez sur <strong><code>Save changes</code></strong>.</li>
<li>Répétez l&#x27;opération pour les autres variables d&#x27;environnement : <strong><code>AZURE_CLIENT_SECRET</code></strong> et <strong><code>AZURE_TENANT_ID</code></strong>.</li>
</ul>
<h2>Configuration des variables d&#x27;environnement pour l&#x27;Azure Web App de production</h2>
<p>Au niveau de votre Azure Web App (<strong><code>cae-groupxy-production-app</code></strong> par exemple) via le portail Azure, veuillez :</p>
<ul>
<li>Cliquer sur <strong><code>Settings</code></strong>.</li>
<li>Cliquer sur <strong><code>Environment variables</code></strong>.</li>
<li>Ajouter les variables d&#x27;environnement suivantes en cliquant sur <strong><code>Add</code></strong> :<!-- -->
<ul>
<li><strong><code>SPRING_DATASOURCE_URL</code></strong> (<strong><code>Name</code></strong>): l&#x27;URL de connexion à votre DB de production (<strong><code>Value</code></strong>). Cliquez sur <strong><code>Apply</code></strong>.</li>
<li><strong><code>SPRING_DATASOURCE_USERNAME</code></strong> (<strong><code>Name</code></strong>): le nom d&#x27;utilisateur de votre DB de production (<strong><code>Value</code></strong>). Cliquez sur <strong><code>Apply</code></strong>.</li>
<li><strong><code>SPRING_DATASOURCE_PASSWORD</code></strong> (<strong><code>Name</code></strong>): le mot de passe de votre DB de production (<strong><code>Value</code></strong>). Cliquez sur <strong><code>Apply</code></strong>.</li>
<li><strong><code>AZURE_BLOB_SAS_TOKEN</code></strong> (<strong><code>Name</code></strong>): le token SAS pour le blob container de production (<strong><code>Value</code></strong>). Cliquez sur <strong><code>Apply</code></strong>.</li>
<li><strong><code>SPRING_PROFILES_ACTIVE</code></strong> (<strong><code>Name</code></strong>): le profil Spring Boot à utiliser pour l&#x27;environnement de production (<strong><code>Value</code></strong>), c&#x27;est-à-dire <strong><code>production</code></strong>.</li>
<li>N&#x27;oubliez pas de cliquer sur <strong><code>Apply</code></strong> pour sauvegarder l&#x27;ajout des 5 variables, puis <strong><code>Confirm</code></strong>.</li>
</ul>
</li>
</ul>
<h2>Comment utiliser les environnements dans les jobs du pipeline</h2>
<h3>Introduction</h3>
<p>Maintenant que nous avons créé des environnements sous GitLab CI/CD, nous pouvons les utiliser dans les jobs du pipeline.</p>
<p>Pour cela, il suffit de donner le nom de l&#x27;environnement dans le job, et GitLab se chargera de donner les bonnes valeurs pour les variables d&#x27;environnement.</p>
<h3>Utilisation des environnements dans les jobs du pipeline</h3>
<p>Nous allons maintenant mettre à jour notre pipeline pour qu&#x27;il déploie sur l&#x27;environnement de production.</p>
<p>Veuillez mettre à jour votre fichier <strong><code>.gitlab-ci.yml</code></strong> pour qu&#x27;il ressemble à ceci :</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line line-number" line="1"><span class="token key atrule">stages</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">-</span> test
</span><span class="code-line line-number" line="3">  <span class="token punctuation">-</span> build
</span><span class="code-line line-number" line="4">  <span class="token punctuation">-</span> staging
</span><span class="code-line line-number" line="5">  <span class="token punctuation">-</span> e2e
</span><span class="code-line line-number highlight-line" line="6">  <span class="token punctuation">-</span> production
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number highlight-line" line="8"><span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="9">  <span class="token key atrule">MAVEN_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository&quot;</span>
</span><span class="code-line line-number highlight-line" line="10">  <span class="token key atrule">VERSION</span><span class="token punctuation">:</span> $CI_PIPELINE_IID
</span><span class="code-line line-number highlight-line" line="11">  <span class="token key atrule">REGISTRY</span><span class="token punctuation">:</span> $CI_REGISTRY
</span><span class="code-line line-number highlight-line" line="12">  <span class="token key atrule">REGISTRY_IMAGE_BASE_PATH</span><span class="token punctuation">:</span> $REGISTRY/$CI_PROJECT_PATH
</span><span class="code-line line-number highlight-line" line="13">  <span class="token key atrule">AZURE_WEBAPP_RESOURCE_GROUP</span><span class="token punctuation">:</span> caeGroup
</span><span class="code-line line-number" line="14">
</span><span class="code-line line-number" line="15"><span class="token key atrule">api test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="16">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="17">  <span class="token key atrule">image</span><span class="token punctuation">:</span> maven<span class="token punctuation">:</span>3.9.9<span class="token punctuation">-</span>amazoncorretto<span class="token punctuation">-</span><span class="token number">21</span>
</span><span class="code-line line-number" line="18">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="19">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="20">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="21">        <span class="token punctuation">-</span> api/pom.xml
</span><span class="code-line line-number" line="22">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="23">      <span class="token punctuation">-</span> $CI_PROJECT_DIR/.m2/repository
</span><span class="code-line line-number" line="24">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="25">    <span class="token punctuation">-</span> cd api
</span><span class="code-line line-number" line="26">    <span class="token punctuation">-</span> mvn clean test
</span><span class="code-line line-number" line="27">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="28">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="29">      <span class="token punctuation">-</span> api/target/reports/
</span><span class="code-line line-number" line="30">      <span class="token punctuation">-</span> api/target/site/
</span><span class="code-line line-number" line="31">      <span class="token punctuation">-</span> api/target/surefire<span class="token punctuation">-</span>reports/
</span><span class="code-line line-number" line="32">
</span><span class="code-line line-number" line="33"><span class="token key atrule">frontend test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="34">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="35">  <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>alpine
</span><span class="code-line line-number" line="36">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="37">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="38">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="39">        <span class="token punctuation">-</span> frontend/package<span class="token punctuation">-</span>lock.json
</span><span class="code-line line-number" line="40">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="41">      <span class="token punctuation">-</span> frontend/node_modules
</span><span class="code-line line-number" line="42">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="43">    <span class="token punctuation">-</span> cd frontend
</span><span class="code-line line-number" line="44">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="45">    <span class="token punctuation">-</span> npm run lint
</span><span class="code-line line-number" line="46">    <span class="token punctuation">-</span> npm run coverage
</span><span class="code-line line-number" line="47">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="48">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="49">      <span class="token punctuation">-</span> frontend/coverage/
</span><span class="code-line line-number" line="50">
</span><span class="code-line line-number" line="51"><span class="token key atrule">build</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="52">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
</span><span class="code-line line-number" line="53">  <span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>latest
</span><span class="code-line line-number" line="54">  <span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="55">    <span class="token punctuation">-</span> docker<span class="token punctuation">:</span>20<span class="token punctuation">-</span>dind
</span><span class="code-line line-number" line="56">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="57">    <span class="token punctuation">-</span> echo $CI_REGISTRY_PASSWORD <span class="token punctuation">|</span> docker login <span class="token punctuation">-</span>u $CI_REGISTRY_USER $CI_REGISTRY <span class="token punctuation">-</span><span class="token punctuation">-</span>password<span class="token punctuation">-</span>stdin
</span><span class="code-line line-number" line="58">    <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>compose <span class="token punctuation">-</span>f docker<span class="token punctuation">-</span>compose.staging.yml build
</span><span class="code-line line-number" line="59">    <span class="token punctuation">-</span> for service in frontend<span class="token punctuation">-</span>prod api<span class="token punctuation">-</span>prod reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod; do
</span><span class="code-line line-number" line="60">      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="61">      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="62">      docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="63">      docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="64">      done
</span><span class="code-line line-number" line="65">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="66">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; <span class="token important">&amp;&amp;</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="67">
</span><span class="code-line line-number" line="68"><span class="token key atrule">deploy to staging</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="69">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number highlight-line" line="70">  <span class="token key atrule">environment</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number highlight-line" line="71">  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="72">    <span class="token key atrule">AZURE_WEBAPP_NAME</span><span class="token punctuation">:</span> cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app
</span><span class="code-line line-number highlight-line" line="73">    <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app<span class="token punctuation">-</span>fza6c0ebghahfufh.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number" line="74">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/azure<span class="token punctuation">-</span>cli
</span><span class="code-line line-number" line="75">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="76">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; <span class="token important">&amp;&amp;</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="77">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="78">    <span class="token punctuation">-</span> az login <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>principal <span class="token punctuation">-</span><span class="token punctuation">-</span>username $AZURE_CLIENT_ID <span class="token punctuation">-</span><span class="token punctuation">-</span>password $AZURE_CLIENT_SECRET <span class="token punctuation">-</span><span class="token punctuation">-</span>tenant $AZURE_TENANT_ID
</span><span class="code-line line-number highlight-line" line="79">    <span class="token punctuation">-</span> az webapp stop <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span><span class="code-line line-number" line="80">    <span class="token punctuation">-</span> az webapp config container set <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>type compose <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>file docker<span class="token punctuation">-</span>compose.deploy.yml <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>user $PULL_IMAGE_TOKEN_USERNAME <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>password $PULL_IMAGE_TOKEN_PASSWORD
</span><span class="code-line line-number" line="81">    <span class="token punctuation">-</span> az webapp start <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span><span class="code-line line-number" line="82">    <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line line-number" line="83"><span class="token scalar string">      for i in {1..30}; do
</span></span><span class="code-line line-number" line="84"><span class="token scalar string">        HTTP_STATUS=$(curl -s -o /dev/null -w &quot;%{http_code}&quot; $BASE_URL/api/pizzas);
</span></span><span class="code-line line-number" line="85"><span class="token scalar string">        if [ &quot;$HTTP_STATUS&quot; -eq 200 ]; then
</span></span><span class="code-line line-number" line="86"><span class="token scalar string">          echo &quot;Azure Web App is functional.&quot;
</span></span><span class="code-line line-number" line="87"><span class="token scalar string">          break
</span></span><span class="code-line line-number" line="88"><span class="token scalar string">        fi
</span></span><span class="code-line line-number" line="89"><span class="token scalar string">        echo &quot;Azure Web App is not ready yet. Waiting for 10 seconds...&quot;
</span></span><span class="code-line line-number" line="90"><span class="token scalar string">        sleep 10
</span></span><span class="code-line line-number" line="91"><span class="token scalar string">      done
</span></span><span class="code-line line-number" line="92"><span class="token scalar string">      if [ &quot;$HTTP_STATUS&quot; -ne 200 ]; then
</span></span><span class="code-line line-number" line="93"><span class="token scalar string">        echo &quot;Azure Web App failed to become functional.&quot;
</span></span><span class="code-line line-number" line="94"><span class="token scalar string">        exit 1
</span></span><span class="code-line line-number" line="95"><span class="token scalar string">      fi</span>
</span><span class="code-line line-number" line="96">
</span><span class="code-line line-number" line="97"><span class="token key atrule">e2e tests</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="98">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> e2e
</span><span class="code-line line-number highlight-line" line="99">  <span class="token key atrule">environment</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="100">  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="101">    <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app<span class="token punctuation">-</span>fza6c0ebghahfufh.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number" line="102">    <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="103">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.50.1<span class="token punctuation">-</span>jammy
</span><span class="code-line line-number" line="104">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="105">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; <span class="token important">&amp;&amp;</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="106">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="107">    <span class="token punctuation">-</span> cd ./e2e
</span><span class="code-line line-number" line="108">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="109">    <span class="token punctuation">-</span> npx playwright test
</span><span class="code-line line-number" line="110">    <span class="token punctuation">-</span> if <span class="token punctuation">[</span> $<span class="token punctuation">?</span> <span class="token punctuation">-</span>ne 0 <span class="token punctuation">]</span>; then echo &quot;E2E tests failed&quot;; exit 1; fi
</span><span class="code-line line-number" line="111">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="112">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="113">      <span class="token punctuation">-</span> e2e/playwright<span class="token punctuation">-</span>report/
</span><span class="code-line line-number" line="114">      <span class="token punctuation">-</span> e2e/test<span class="token punctuation">-</span>results/
</span><span class="code-line line-number" line="115">
</span><span class="code-line line-number highlight-line" line="116"><span class="token key atrule">deploy to production</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="117">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> production
</span><span class="code-line line-number highlight-line" line="118">  <span class="token key atrule">environment</span><span class="token punctuation">:</span> production
</span><span class="code-line line-number highlight-line" line="119">  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="120">    <span class="token key atrule">AZURE_WEBAPP_NAME</span><span class="token punctuation">:</span> production<span class="token punctuation">-</span>pizzeria
</span><span class="code-line line-number highlight-line" line="121">    <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//production<span class="token punctuation">-</span>pizzeria<span class="token punctuation">-</span>frd5dugfffgtarf6.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number highlight-line" line="122">    <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> production
</span><span class="code-line line-number highlight-line" line="123">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/azure<span class="token punctuation">-</span>cli
</span><span class="code-line line-number highlight-line" line="124">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="125">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; <span class="token important">&amp;&amp;</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number highlight-line" line="126">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="127">    <span class="token punctuation">-</span> az login <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>principal <span class="token punctuation">-</span><span class="token punctuation">-</span>username $AZURE_CLIENT_ID <span class="token punctuation">-</span><span class="token punctuation">-</span>password $AZURE_CLIENT_SECRET <span class="token punctuation">-</span><span class="token punctuation">-</span>tenant $AZURE_TENANT_ID
</span><span class="code-line line-number highlight-line" line="128">    <span class="token punctuation">-</span> az webapp stop <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span><span class="code-line line-number highlight-line" line="129">    <span class="token punctuation">-</span> az webapp config container set <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>type compose <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>file docker<span class="token punctuation">-</span>compose.deploy.yml <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>user $PULL_IMAGE_TOKEN_USERNAME <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>password $PULL_IMAGE_TOKEN_PASSWORD
</span><span class="code-line line-number highlight-line" line="130">    <span class="token punctuation">-</span> az webapp start <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span><span class="code-line line-number highlight-line" line="131">    <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line line-number highlight-line" line="132"><span class="token scalar string">      for i in {1..30}; do
</span></span><span class="code-line line-number highlight-line" line="133"><span class="token scalar string">        HTTP_STATUS=$(curl -s -o /dev/null -w &quot;%{http_code}&quot; $BASE_URL/api/pizzas);
</span></span><span class="code-line line-number highlight-line" line="134"><span class="token scalar string">        if [ &quot;$HTTP_STATUS&quot; -eq 200 ]; then
</span></span><span class="code-line line-number highlight-line" line="135"><span class="token scalar string">          echo &quot;Azure Web App is functional.&quot;
</span></span><span class="code-line line-number highlight-line" line="136"><span class="token scalar string">          break
</span></span><span class="code-line line-number highlight-line" line="137"><span class="token scalar string">        fi
</span></span><span class="code-line line-number highlight-line" line="138"><span class="token scalar string">        echo &quot;Azure Web App is not ready yet. Waiting for 10 seconds...&quot;
</span></span><span class="code-line line-number highlight-line" line="139"><span class="token scalar string">        sleep 10
</span></span><span class="code-line line-number highlight-line" line="140"><span class="token scalar string">      done
</span></span><span class="code-line line-number highlight-line" line="141"><span class="token scalar string">      if [ &quot;$HTTP_STATUS&quot; -ne 200 ]; then
</span></span><span class="code-line line-number highlight-line" line="142"><span class="token scalar string">        echo &quot;Azure Web App failed to become functional.&quot;
</span></span><span class="code-line line-number highlight-line" line="143"><span class="token scalar string">        exit 1
</span></span><span class="code-line line-number highlight-line" line="144"><span class="token scalar string">      fi</span>
</span></code></pre>
<p>Nous avons donc ajouté un nouveau job pour le déploiement sur l&#x27;environnement de production.</p>
<p>Voici quelques explications sur le pipeline :</p>
<ul>
<li>Les variables <strong><code>AZURE_WEBAPP_NAME</code></strong> et <strong><code>BASE_URL</code></strong> sont différentes pour chaque environnement. Elle ne sont donc plus reprises au niveau de la section <strong><code>variables</code></strong> mais directement dans les jobs.</li>
<li>Le fait de préciser <strong><code>environment: staging</code></strong> ou <strong><code>environment: production</code></strong> permet à GitLab de donner les bonnes valeurs pour les variables d&#x27;environnement en fonction de l&#x27;environnement.</li>
<li>Les règles <strong><code>rules</code></strong> permettent de dire que le job ne doit être exécuté que si la source du pipeline est un <strong><code>merge_request_event</code></strong> et que la branche de la merge request est la branche par défaut.</li>
<li>Nous avons ajouté <strong><code>azure webapp stop</code></strong> pour être sûr que l&#x27;application est bien arrêtée avant de la redéployer.<br/>
<!-- -->NB : Cela n&#x27;est peut-être pas nécessaire, mais cela semble régler certains problèmes potentiels de non réinitialisation de la DB au redémarrage de l&#x27;API dans l&#x27;environnement de staging.</li>
</ul>
<p>Veuillez donc faire un commit et un push pour déclencher le pipeline. Vérifiez que le déploiement sur l&#x27;environnement de production se passe bien.</p>
<h2>Amélioration du pipeline</h2>
<h3>Introduction</h3>
<p>Notre pipeline actuel contient des duplications de code. En effet, les jobs <strong><code>deploy to staging</code></strong> et <strong><code>deploy to production</code></strong> sont presque identiques.</p>
<p>Nous allons donc voir comment améliorer notre pipeline en factorisant le code commun dans un template.</p>
<h3>Création d&#x27;un template pour le déploiement</h3>
<p>Veuillez mettre à jour votre fichier <strong><code>.gitlab-ci.yml</code></strong> pour qu&#x27;il ressemble à ceci :</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line line-number" line="1"><span class="token key atrule">stages</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">-</span> test
</span><span class="code-line line-number" line="3">  <span class="token punctuation">-</span> build
</span><span class="code-line line-number" line="4">  <span class="token punctuation">-</span> staging
</span><span class="code-line line-number" line="5">  <span class="token punctuation">-</span> e2e
</span><span class="code-line line-number" line="6">  <span class="token punctuation">-</span> production
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="9">  <span class="token key atrule">MAVEN_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository&quot;</span>
</span><span class="code-line line-number" line="10">  <span class="token key atrule">VERSION</span><span class="token punctuation">:</span> $CI_PIPELINE_IID
</span><span class="code-line line-number" line="11">  <span class="token key atrule">REGISTRY</span><span class="token punctuation">:</span> $CI_REGISTRY
</span><span class="code-line line-number" line="12">  <span class="token key atrule">REGISTRY_IMAGE_BASE_PATH</span><span class="token punctuation">:</span> $REGISTRY/$CI_PROJECT_PATH
</span><span class="code-line line-number" line="13">  <span class="token key atrule">AZURE_WEBAPP_RESOURCE_GROUP</span><span class="token punctuation">:</span> caeGroup
</span><span class="code-line line-number" line="14">
</span><span class="code-line line-number" line="15"><span class="token key atrule">api test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="16">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="17">  <span class="token key atrule">image</span><span class="token punctuation">:</span> maven<span class="token punctuation">:</span>3.9.9<span class="token punctuation">-</span>amazoncorretto<span class="token punctuation">-</span><span class="token number">21</span>
</span><span class="code-line line-number" line="18">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="19">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="20">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="21">        <span class="token punctuation">-</span> api/pom.xml
</span><span class="code-line line-number" line="22">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="23">      <span class="token punctuation">-</span> $CI_PROJECT_DIR/.m2/repository
</span><span class="code-line line-number" line="24">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="25">    <span class="token punctuation">-</span> cd api
</span><span class="code-line line-number" line="26">    <span class="token punctuation">-</span> mvn clean test
</span><span class="code-line line-number" line="27">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="28">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="29">      <span class="token punctuation">-</span> api/target/reports/
</span><span class="code-line line-number" line="30">      <span class="token punctuation">-</span> api/target/site/
</span><span class="code-line line-number" line="31">      <span class="token punctuation">-</span> api/target/surefire<span class="token punctuation">-</span>reports/
</span><span class="code-line line-number" line="32">
</span><span class="code-line line-number" line="33"><span class="token key atrule">frontend test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="34">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="35">  <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>alpine
</span><span class="code-line line-number" line="36">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="37">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="38">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="39">        <span class="token punctuation">-</span> frontend/package<span class="token punctuation">-</span>lock.json
</span><span class="code-line line-number" line="40">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="41">      <span class="token punctuation">-</span> frontend/node_modules
</span><span class="code-line line-number" line="42">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="43">    <span class="token punctuation">-</span> cd frontend
</span><span class="code-line line-number" line="44">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="45">    <span class="token punctuation">-</span> npm run lint
</span><span class="code-line line-number" line="46">    <span class="token punctuation">-</span> npm run coverage
</span><span class="code-line line-number" line="47">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="48">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="49">      <span class="token punctuation">-</span> frontend/coverage/
</span><span class="code-line line-number" line="50">
</span><span class="code-line line-number" line="51"><span class="token key atrule">build</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="52">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
</span><span class="code-line line-number" line="53">  <span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>latest
</span><span class="code-line line-number" line="54">  <span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="55">    <span class="token punctuation">-</span> docker<span class="token punctuation">:</span>20<span class="token punctuation">-</span>dind
</span><span class="code-line line-number" line="56">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="57">    <span class="token punctuation">-</span> echo $CI_REGISTRY_PASSWORD <span class="token punctuation">|</span> docker login <span class="token punctuation">-</span>u $CI_REGISTRY_USER $CI_REGISTRY <span class="token punctuation">-</span><span class="token punctuation">-</span>password<span class="token punctuation">-</span>stdin
</span><span class="code-line line-number" line="58">    <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>compose <span class="token punctuation">-</span>f docker<span class="token punctuation">-</span>compose.staging.yml build
</span><span class="code-line line-number" line="59">    <span class="token punctuation">-</span> for service in frontend<span class="token punctuation">-</span>prod api<span class="token punctuation">-</span>prod reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod; do
</span><span class="code-line line-number" line="60">      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="61">      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="62">      docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="63">      docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="64">      done
</span><span class="code-line line-number" line="65">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="66">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; <span class="token important">&amp;&amp;</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="67">
</span><span class="code-line line-number highlight-line" line="68"><span class="token key atrule">.deploy</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="69">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/azure<span class="token punctuation">-</span>cli
</span><span class="code-line line-number highlight-line" line="70">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="71">    <span class="token punctuation">-</span> az login <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>principal <span class="token punctuation">-</span><span class="token punctuation">-</span>username $AZURE_CLIENT_ID <span class="token punctuation">-</span><span class="token punctuation">-</span>password $AZURE_CLIENT_SECRET <span class="token punctuation">-</span><span class="token punctuation">-</span>tenant $AZURE_TENANT_ID
</span><span class="code-line line-number highlight-line" line="72">    <span class="token punctuation">-</span> az webapp stop <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span><span class="code-line line-number highlight-line" line="73">    <span class="token punctuation">-</span> az webapp config container set <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>type compose <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>file docker<span class="token punctuation">-</span>compose.deploy.yml <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>user $PULL_IMAGE_TOKEN_USERNAME <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>password $PULL_IMAGE_TOKEN_PASSWORD
</span><span class="code-line line-number highlight-line" line="74">    <span class="token punctuation">-</span> az webapp start <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span><span class="code-line line-number highlight-line" line="75">    <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line line-number highlight-line" line="76"><span class="token scalar string">      for i in {1..30}; do
</span></span><span class="code-line line-number highlight-line" line="77"><span class="token scalar string">        HTTP_STATUS=$(curl -s -o /dev/null -w &quot;%{http_code}&quot; $BASE_URL/api/pizzas);
</span></span><span class="code-line line-number highlight-line" line="78"><span class="token scalar string">        if [ &quot;$HTTP_STATUS&quot; -eq 200 ]; then
</span></span><span class="code-line line-number highlight-line" line="79"><span class="token scalar string">          echo &quot;Azure Web App is functional.&quot;
</span></span><span class="code-line line-number highlight-line" line="80"><span class="token scalar string">          break
</span></span><span class="code-line line-number highlight-line" line="81"><span class="token scalar string">        fi
</span></span><span class="code-line line-number highlight-line" line="82"><span class="token scalar string">        echo &quot;Azure Web App is not ready yet. Waiting for 10 seconds...&quot;
</span></span><span class="code-line line-number highlight-line" line="83"><span class="token scalar string">        sleep 10
</span></span><span class="code-line line-number highlight-line" line="84"><span class="token scalar string">      done
</span></span><span class="code-line line-number highlight-line" line="85"><span class="token scalar string">      if [ &quot;$HTTP_STATUS&quot; -ne 200 ]; then
</span></span><span class="code-line line-number highlight-line" line="86"><span class="token scalar string">        echo &quot;Azure Web App failed to become functional.&quot;
</span></span><span class="code-line line-number highlight-line" line="87"><span class="token scalar string">        exit 1
</span></span><span class="code-line line-number highlight-line" line="88"><span class="token scalar string">      fi</span>
</span><span class="code-line line-number highlight-line" line="89">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="90">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; <span class="token important">&amp;&amp;</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="91">
</span><span class="code-line line-number" line="92"><span class="token key atrule">deploy to staging</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="93">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="94">  <span class="token key atrule">environment</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="95">  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="96">    <span class="token key atrule">AZURE_WEBAPP_NAME</span><span class="token punctuation">:</span> cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app
</span><span class="code-line line-number" line="97">    <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app<span class="token punctuation">-</span>fza6c0ebghahfufh.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number highlight-line" line="98">  <span class="token key atrule">extends</span><span class="token punctuation">:</span> .deploy
</span><span class="code-line line-number" line="99">
</span><span class="code-line line-number" line="100"><span class="token key atrule">e2e tests</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="101">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> e2e
</span><span class="code-line line-number" line="102">  <span class="token key atrule">environment</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="103">  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="104">    <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app<span class="token punctuation">-</span>fza6c0ebghahfufh.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number" line="105">    <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="106">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.50.1<span class="token punctuation">-</span>jammy
</span><span class="code-line line-number" line="107">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="108">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; <span class="token important">&amp;&amp;</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="109">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="110">    <span class="token punctuation">-</span> cd ./e2e
</span><span class="code-line line-number" line="111">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="112">    <span class="token punctuation">-</span> npx playwright test
</span><span class="code-line line-number" line="113">    <span class="token punctuation">-</span> if <span class="token punctuation">[</span> $<span class="token punctuation">?</span> <span class="token punctuation">-</span>ne 0 <span class="token punctuation">]</span>; then echo &quot;E2E tests failed&quot;; exit 1; fi
</span><span class="code-line line-number" line="114">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="115">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="116">      <span class="token punctuation">-</span> e2e/playwright<span class="token punctuation">-</span>report/
</span><span class="code-line line-number" line="117">      <span class="token punctuation">-</span> e2e/test<span class="token punctuation">-</span>results/
</span><span class="code-line line-number" line="118">
</span><span class="code-line line-number" line="119"><span class="token key atrule">deploy to production</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="120">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> production
</span><span class="code-line line-number" line="121">  <span class="token key atrule">environment</span><span class="token punctuation">:</span> production
</span><span class="code-line line-number" line="122">  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="123">    <span class="token key atrule">AZURE_WEBAPP_NAME</span><span class="token punctuation">:</span> production<span class="token punctuation">-</span>pizzeria
</span><span class="code-line line-number" line="124">    <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//production<span class="token punctuation">-</span>pizzeria<span class="token punctuation">-</span>frd5dugfffgtarf6.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number" line="125">    <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> production
</span><span class="code-line line-number highlight-line" line="126">  <span class="token key atrule">extends</span><span class="token punctuation">:</span> .deploy
</span></code></pre>
<p>Nous avons donc créé un template <strong><code>.deploy</code></strong> pour le déploiement. Ce template contient le code commun pour le déploiement sur l&#x27;environnement de staging et de production.</p>
<p>Nous avons ensuite utilisé ce template dans les jobs <strong><code>deploy to staging</code></strong> et <strong><code>deploy to production</code></strong> en utilisant la directive <strong><code>extends: .deploy</code></strong>.</p>
<p>Veuillez donc faire un commit et un push pour déclencher le pipeline. Vérifiez que le déploiement sur l&#x27;environnement de production se passe bien.</p>
<h2>Conclusion sur la création de l&#x27;environnement de production</h2>
<p>Nous avons maintenant une pipeline qui déploie automatiquement sur l&#x27;environnement de production seulement si l&#x27;environnement de staging, très proche de la production, réussi les tests e2e.</p>
<p>Nous avons maintenant un nouvel environnement de production que nous pouvons visualiser ainsi, si l&#x27;on prend en compte l&#x27;environnement de staging nécessaire à sa mise en place :</p>
<div>Loading...</div>
<p>Nous faisons ce que nous appelons du déploiement continu (CD en anglais), c&#x27;est-à-dire que chaque commit sur la branche principale déclenche un déploiement sur l&#x27;environnement de production.</p>
<p>Nous allons voir maintenant comment faire du Continous Delivery au lieu du Continuous Deployment.</p>
<h1><a id="comment_faire_du_continuous_delivery"> Comment faire du Continuous Delivery ? </a></h1>
<h2>Introduction</h2>
<p>Nous avons jusque là fait du Continuous Deployment, c&#x27;est-à-dire que chaque commit sur la branche principale déclenche un déploiement sur l&#x27;environnement de production.</p>
<p>Nous allons maintenant voir comment faire du Continuous Delivery, c&#x27;est-à-dire que chaque commit sur la branche principale déclenche un déploiement sur l&#x27;environnement de staging, et que l&#x27;on peut déclencher manuellement un déploiement sur l&#x27;environnement de production.</p>
<p>En effet, il peut être intéressant de pouvoir vérifier, via des humains proches des utilisateurs finaux, que tout fonctionne bien sur l&#x27;environnement de staging avant de déployer sur l&#x27;environnement de production.</p>
<h2>Mise en place du Continuous Delivery</h2>
<p>Pour mettre en place du Continuous Delivery, nous allons simplement changer le déclenchement du déploiement sur l&#x27;environnement de production.</p>
<p>Pour cela il suffit de changer la règle pour le job <strong><code>deploy to production</code></strong> en indiquant que le job ne doit être exécuté que si le pipeline est déclenché manuellement.</p>
<p>Veuillez mettre à jour votre fichier <strong><code>.gitlab-ci.yml</code></strong> pour qu&#x27;il ressemble à ceci :</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line line-number" line="1"><span class="token key atrule">stages</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">-</span> test
</span><span class="code-line line-number" line="3">  <span class="token punctuation">-</span> build
</span><span class="code-line line-number" line="4">  <span class="token punctuation">-</span> staging
</span><span class="code-line line-number" line="5">  <span class="token punctuation">-</span> e2e
</span><span class="code-line line-number" line="6">  <span class="token punctuation">-</span> production
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="9">  <span class="token key atrule">MAVEN_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository&quot;</span>
</span><span class="code-line line-number" line="10">  <span class="token key atrule">VERSION</span><span class="token punctuation">:</span> $CI_PIPELINE_IID
</span><span class="code-line line-number" line="11">  <span class="token key atrule">REGISTRY</span><span class="token punctuation">:</span> $CI_REGISTRY
</span><span class="code-line line-number" line="12">  <span class="token key atrule">REGISTRY_IMAGE_BASE_PATH</span><span class="token punctuation">:</span> $REGISTRY/$CI_PROJECT_PATH
</span><span class="code-line line-number" line="13">  <span class="token key atrule">AZURE_WEBAPP_RESOURCE_GROUP</span><span class="token punctuation">:</span> caeGroup
</span><span class="code-line line-number" line="14">
</span><span class="code-line line-number" line="15"><span class="token key atrule">api test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="16">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="17">  <span class="token key atrule">image</span><span class="token punctuation">:</span> maven<span class="token punctuation">:</span>3.9.9<span class="token punctuation">-</span>amazoncorretto<span class="token punctuation">-</span><span class="token number">21</span>
</span><span class="code-line line-number" line="18">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="19">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="20">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="21">        <span class="token punctuation">-</span> api/pom.xml
</span><span class="code-line line-number" line="22">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="23">      <span class="token punctuation">-</span> $CI_PROJECT_DIR/.m2/repository
</span><span class="code-line line-number" line="24">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="25">    <span class="token punctuation">-</span> cd api
</span><span class="code-line line-number" line="26">    <span class="token punctuation">-</span> mvn clean test
</span><span class="code-line line-number" line="27">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="28">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="29">      <span class="token punctuation">-</span> api/target/reports/
</span><span class="code-line line-number" line="30">      <span class="token punctuation">-</span> api/target/site/
</span><span class="code-line line-number" line="31">      <span class="token punctuation">-</span> api/target/surefire<span class="token punctuation">-</span>reports/
</span><span class="code-line line-number" line="32">
</span><span class="code-line line-number" line="33"><span class="token key atrule">frontend test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="34">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="35">  <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>alpine
</span><span class="code-line line-number" line="36">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="37">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="38">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="39">        <span class="token punctuation">-</span> frontend/package<span class="token punctuation">-</span>lock.json
</span><span class="code-line line-number" line="40">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="41">      <span class="token punctuation">-</span> frontend/node_modules
</span><span class="code-line line-number" line="42">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="43">    <span class="token punctuation">-</span> cd frontend
</span><span class="code-line line-number" line="44">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="45">    <span class="token punctuation">-</span> npm run lint
</span><span class="code-line line-number" line="46">    <span class="token punctuation">-</span> npm run coverage
</span><span class="code-line line-number" line="47">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="48">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="49">      <span class="token punctuation">-</span> frontend/coverage/
</span><span class="code-line line-number" line="50">
</span><span class="code-line line-number" line="51"><span class="token key atrule">build</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="52">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
</span><span class="code-line line-number" line="53">  <span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>latest
</span><span class="code-line line-number" line="54">  <span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="55">    <span class="token punctuation">-</span> docker<span class="token punctuation">:</span>20<span class="token punctuation">-</span>dind
</span><span class="code-line line-number" line="56">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="57">    <span class="token punctuation">-</span> echo $CI_REGISTRY_PASSWORD <span class="token punctuation">|</span> docker login <span class="token punctuation">-</span>u $CI_REGISTRY_USER $CI_REGISTRY <span class="token punctuation">-</span><span class="token punctuation">-</span>password<span class="token punctuation">-</span>stdin
</span><span class="code-line line-number" line="58">    <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>compose <span class="token punctuation">-</span>f docker<span class="token punctuation">-</span>compose.staging.yml build
</span><span class="code-line line-number" line="59">    <span class="token punctuation">-</span> for service in frontend<span class="token punctuation">-</span>prod api<span class="token punctuation">-</span>prod reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod; do
</span><span class="code-line line-number" line="60">      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="61">      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="62">      docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="63">      docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="64">      done
</span><span class="code-line line-number" line="65">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="66">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; <span class="token important">&amp;&amp;</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="67">
</span><span class="code-line line-number" line="68"><span class="token key atrule">.deploy</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="69">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/azure<span class="token punctuation">-</span>cli
</span><span class="code-line line-number" line="70">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="71">    <span class="token punctuation">-</span> az login <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>principal <span class="token punctuation">-</span><span class="token punctuation">-</span>username $AZURE_CLIENT_ID <span class="token punctuation">-</span><span class="token punctuation">-</span>password $AZURE_CLIENT_SECRET <span class="token punctuation">-</span><span class="token punctuation">-</span>tenant $AZURE_TENANT_ID
</span><span class="code-line line-number" line="72">    <span class="token punctuation">-</span> az webapp stop <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span><span class="code-line line-number" line="73">    <span class="token punctuation">-</span> az webapp config container set <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>type compose <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>file docker<span class="token punctuation">-</span>compose.deploy.yml <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>user $PULL_IMAGE_TOKEN_USERNAME <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>password $PULL_IMAGE_TOKEN_PASSWORD
</span><span class="code-line line-number" line="74">    <span class="token punctuation">-</span> az webapp start <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span><span class="code-line line-number" line="75">    <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line line-number" line="76"><span class="token scalar string">      for i in {1..30}; do
</span></span><span class="code-line line-number" line="77"><span class="token scalar string">        HTTP_STATUS=$(curl -s -o /dev/null -w &quot;%{http_code}&quot; $BASE_URL/api/pizzas);
</span></span><span class="code-line line-number" line="78"><span class="token scalar string">        if [ &quot;$HTTP_STATUS&quot; -eq 200 ]; then
</span></span><span class="code-line line-number" line="79"><span class="token scalar string">          echo &quot;Azure Web App is functional.&quot;
</span></span><span class="code-line line-number" line="80"><span class="token scalar string">          break
</span></span><span class="code-line line-number" line="81"><span class="token scalar string">        fi
</span></span><span class="code-line line-number" line="82"><span class="token scalar string">        echo &quot;Azure Web App is not ready yet. Waiting for 10 seconds...&quot;
</span></span><span class="code-line line-number" line="83"><span class="token scalar string">        sleep 10
</span></span><span class="code-line line-number" line="84"><span class="token scalar string">      done
</span></span><span class="code-line line-number" line="85"><span class="token scalar string">      if [ &quot;$HTTP_STATUS&quot; -ne 200 ]; then
</span></span><span class="code-line line-number" line="86"><span class="token scalar string">        echo &quot;Azure Web App failed to become functional.&quot;
</span></span><span class="code-line line-number" line="87"><span class="token scalar string">        exit 1
</span></span><span class="code-line line-number" line="88"><span class="token scalar string">      fi</span>
</span><span class="code-line line-number" line="89">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="90">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; <span class="token important">&amp;&amp;</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="91">
</span><span class="code-line line-number" line="92"><span class="token key atrule">deploy to staging</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="93">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="94">  <span class="token key atrule">environment</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="95">  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="96">    <span class="token key atrule">AZURE_WEBAPP_NAME</span><span class="token punctuation">:</span> cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app
</span><span class="code-line line-number" line="97">    <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app<span class="token punctuation">-</span>fza6c0ebghahfufh.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number" line="98">  <span class="token key atrule">extends</span><span class="token punctuation">:</span> .deploy
</span><span class="code-line line-number" line="99">
</span><span class="code-line line-number" line="100"><span class="token key atrule">e2e tests</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="101">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> e2e
</span><span class="code-line line-number" line="102">  <span class="token key atrule">environment</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="103">  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="104">    <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app<span class="token punctuation">-</span>fza6c0ebghahfufh.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number" line="105">    <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="106">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.50.1<span class="token punctuation">-</span>jammy
</span><span class="code-line line-number" line="107">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="108">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; <span class="token important">&amp;&amp;</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="109">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="110">    <span class="token punctuation">-</span> cd ./e2e
</span><span class="code-line line-number" line="111">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="112">    <span class="token punctuation">-</span> npx playwright test
</span><span class="code-line line-number" line="113">    <span class="token punctuation">-</span> if <span class="token punctuation">[</span> $<span class="token punctuation">?</span> <span class="token punctuation">-</span>ne 0 <span class="token punctuation">]</span>; then echo &quot;E2E tests failed&quot;; exit 1; fi
</span><span class="code-line line-number" line="114">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="115">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="116">      <span class="token punctuation">-</span> e2e/playwright<span class="token punctuation">-</span>report/
</span><span class="code-line line-number" line="117">      <span class="token punctuation">-</span> e2e/test<span class="token punctuation">-</span>results/
</span><span class="code-line line-number" line="118">
</span><span class="code-line line-number" line="119"><span class="token key atrule">deploy to production</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="120">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> production
</span><span class="code-line line-number" line="121">  <span class="token key atrule">environment</span><span class="token punctuation">:</span> production
</span><span class="code-line line-number" line="122">  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="123">    <span class="token key atrule">AZURE_WEBAPP_NAME</span><span class="token punctuation">:</span> production<span class="token punctuation">-</span>pizzeria
</span><span class="code-line line-number" line="124">    <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//production<span class="token punctuation">-</span>pizzeria<span class="token punctuation">-</span>frd5dugfffgtarf6.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number" line="125">    <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> production
</span><span class="code-line line-number" line="126">  <span class="token key atrule">extends</span><span class="token punctuation">:</span> .deploy
</span><span class="code-line line-number highlight-line" line="127">  <span class="token key atrule">when</span><span class="token punctuation">:</span> manual
</span></code></pre>
<p>Nous avons donc ajouté la directive <strong><code>when: manual</code></strong> pour le job <strong><code>deploy to production</code></strong>. Cela signifie que le job ne sera exécuté que si le pipeline est déclenché manuellement.</p>
<p>Veuillez donc faire un commit et un push pour déclencher le pipeline.
Une fois que le déploiement sur l&#x27;environnement de staging est terminé, au niveau de la visualisation de la pipeline, dans le job nommé <strong><code>production</code></strong>, vous pouvez cliquer sur le bouton <strong><code>Play</code></strong> pour déclencher le déploiement sur l&#x27;environnement de production.</p>
<h2>Conclusion sur le Continuous Delivery</h2>
<p>Nous avons maintenant un pipeline qui déploie automatiquement sur l&#x27;environnement de staging, et qui permet de déclencher manuellement un déploiement sur l&#x27;environnement de production.</p>
<p>Si nous avons eu des soucis avec le démarrage de l&#x27;API sur l&#x27;environnement de staging, nous avons déjà pu nous rendre compte de l&#x27;importance des logs pour le débogage. Nous allons donc voir comment améliorer les logs de notre application.</p>
<p>Si nécessaire, vous pouvez trouver le code associé au déploiement de l&#x27;environnement de production ici : <a href="https://github.com/e-vinci/cae-theory-demos/tree/main/production">production</a>.</p></div><div></div><script src="/cae-theory/_next/static/chunks/webpack-0335b56ac768253e.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[909,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"245\",\"static/chunks/245-30e455921c0f8f22.js\",\"177\",\"static/chunks/app/layout-a6c5d823159daef4.js\"],\"default\"]\n3:I[7468,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"245\",\"static/chunks/245-30e455921c0f8f22.js\",\"177\",\"static/chunks/app/layout-a6c5d823159daef4.js\"],\"ClientThemeProvider\"]\n4:I[1886,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"245\",\"static/chunks/245-30e455921c0f8f22.js\",\"177\",\"static/chunks/app/layout-a6c5d823159daef4.js\"],\"default\"]\n5:I[8412,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"245\",\"static/chunks/245-30e455921c0f8f22.js\",\"177\",\"static/chunks/app/layout-a6c5d823159daef4.js\"],\"default\"]\n6:I[5244,[],\"\"]\n7:I[3866,[],\"\"]\n8:I[3620,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"245\",\"static/chunks/245-30e455921c0f8f22.js\",\"177\",\"static/chunks/app/layout-a6c5d823159daef4.js\"],\"default\"]\na:I[6213,[],\"OutletBoundary\"]\nc:I[6213,[],\"MetadataBoundary\"]\ne:I[6213,[],\"ViewportBoundary\"]\n10:I[4835,[],\"\"]\n:HL[\"/cae-theory/_next/static/css/fd89b796fb218fbf.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"klibeS21nDp3EOmRvX-vz\",\"p\":\"/cae-theory\",\"c\":[\"\",\"iteration3\",\"production\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"slug\",\"iteration3/production\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/cae-theory/_next/static/css/fd89b796fb218fbf.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"children\":[\"$\",\"html\",null,{\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"title\",null,{\"children\":\"CAE Course\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/svg+xml\",\"href\":\"/cae-theory/favicon.svg\"}]]}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"$L4\",null,{\"siteMetaData\":{\"version\":\"\",\"title\":\"CAE\",\"description\":\"siteDescription\",\"url\":\"siteURL\",\"youtubeUrl\":\"youtubeUrl\",\"authorEmail\":\"authorEmail\",\"facebookUrl\":\"facebookUrl\",\"instagramUrl\":\"instagramUrl\",\"menuLinks\":[{\"name\":\"Home\",\"link\":\"/\"},{\"name\":\"Intro\",\"link\":\"/intro\"},{\"name\":\"Qualité\",\"link\":\"\",\"subMenu\":[{\"name\":\"Qualité générale\",\"link\":\"/quality/general\"},{\"name\":\"Qualité du frontend\",\"link\":\"/quality/frontend\"},{\"name\":\"Qualité de l'API\",\"link\":\"/quality/api\"},{\"name\":\"Intégration Continue\",\"link\":\"/quality/ci\"},{\"name\":\"Tests e2e\",\"link\":\"/quality/e2e\"}]},{\"name\":\"Itération 2\",\"link\":\"\",\"subMenu\":[{\"name\":\"Gestion des environnements\",\"link\":\"/iteration2/general\"},{\"name\":\"Conteneurisation\",\"link\":\"/iteration2/containerization\"},{\"name\":\"Déploiement\",\"link\":\"/iteration2/deployment\"},{\"name\":\"Gestion des images\",\"link\":\"/iteration2/images\"}]},{\"name\":\"Itération 3\",\"link\":\"\",\"subMenu\":[{\"name\":\"Gestion de la production\",\"link\":\"/iteration3/production\"},{\"name\":\"Gestion des logs \u0026 exceptions\",\"link\":\"/iteration3/logs\"},{\"name\":\"Gestion de la concurrence\",\"link\":\"/iteration3/concurrency\"}]},{\"name\":\"About\",\"link\":\"/about\"}]}}]}],[\"$\",\"$L5\",null,{\"sx\":{\"padding\":\"1rem\",\"wordWrap\":\"break-word\"},\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L8\",null,{}]]}]]}]}]}]]}],{\"children\":[[\"slug\",\"iteration3/production\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$0:f:0:1:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L9\",null,[\"$\",\"$La\",null,{\"children\":\"$Lb\"}]]}],{},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"a0mkIOJlF0LFEUnuWV7JW\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$10\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"11:I[3508,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n12:I[283,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n13:I[6656,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n14:I[8173,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"\"]\n15:I[4754,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n16:I[2738,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n17:I[4036,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"9:[[\"$\",\"$L11\",null,{\"children\":[[\"$\",\"$L12\",null,{\"aria-label\":\"breadcrumb\",\"children\":[[\"$\",\"$L13\",null,{\"href\":\"/\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":\" CAE \"}],[\"$\",\"$L13\",null,{\"href\":\"/iteration3\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":\" Itération 3 \"}],[\"$\",\"$L13\",null,{\"href\":\"#\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":\" Gestion de l'environnement de production \"}]]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#quest_ce_que_lenvironnement_de_production\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Qu'est-ce que l'environnement de production ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_creer_lenvironnement_de_production\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment créer l'environnement de production ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_creer_des_environnements_sous_git_lab_ci_cd\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment créer des environnements sous GitLab CI/CD \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_faire_du_continuous_delivery\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment faire du Continuous Delivery ? \"}]}]}]]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"quest_ce_que_lenvironnement_de_production\",\"children\":\" Qu'est-ce que l'environnement de production ? \"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous l'avons déjà vu dans l'introduction sur les environnements, l'environnement de production est un environnement dans lequel l'application est déployée pour être utilisée par les utilisateurs finaux.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Dans la partie sur le déploiement, nous avons vu comment déployer une application dans l'environnement de staging, que l'on peut considérer comme la pré-production. Dans cette partie, nous allons voir comment déployer une application dans l'environnement de production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Dans un premier temps, nous souhaitons faire du déploiement continu, c'est-à-dire que chaque commit sur la branche principale doit déclencher un déploiement sur l'environnement de production, et cela seulement bien sûr si tous les tests passent, y compris les tests e2e à réaliser sur l'environnement de staging (ou de pré-production).\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici le workflow que nous souhaitons mettre en place :\"}],\"\\n\",[\"$\",\"$L17\",null,{\"src\":\"/diagrams/deployment-workflow-cd1.puml\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_creer_lenvironnement_de_production\",\"children\":\" Comment créer l'environnement de production ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour mettre en place l'environnement de production, nous allons utiliser les mêmes services que pour l'environnement de staging, à savoir :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Azure Web App pour déployer les services frontend, backend et le reverse proxy\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Pour les étudiants Vinci, une base de données offerte par Vinci ; pour les autres, Azure Database for PostgreSQL pour la base de données\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Un service de stockage Azure Blob pour stocker les fichiers statiques (principalement les images dans nos tutoriels)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"GitLab CI/CD pour automatiser le déploiement.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Création de l'environnement de production sur Azure Web App\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez refaire les étapes de la partie sur le déploiement pour créer un nouvelle Azure Web App : \",[\"$\",\"a\",null,{\"href\":\"../iteration2/deployment#comment_creer_une_application_sur_azure_web_app_service\",\"children\":\"Déploiement : Comment créer une app sur Azure Web App Service\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Donnez un nom à votre application, par exemple \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"cae-groupxy-production-app\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Ensuite, veuillez faire la partie pour donner accès à votre nouvelle Azure Web App via GitLab CI/CD : \",[\"$\",\"a\",null,{\"href\":\"../iteration2/deployment#comment_creer_une_application_sur_azure_web_app_service\",\"children\":\"Déploiement : Comment donner accès à d'autres applications à une Azure Web App ?\"}],\". Veuillez créer donc un nouveau service principal et bien noter les informations de connexion. Voici un exemple de ce que vous devriez avoir à la fin de cette étape :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-properties\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-properties code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"AZURE_CLIENT_SECRET\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"am45Q~jpcc2G64r3GumcGdYRE99cwxddfsqWeD8DcW1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"AZURE_TENANT_ID\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"f7a15dq7-57cb-5855-8d36-0545f95aada17\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"AZURE_CLIENT_ID\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"fs8f6ea8-8807-4764-a394-f0bessqf7e8cbe\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Création de l'environnement pour le stockage des images sur Azure Blob Storage\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour stocker les images, nous allons utiliser le service de stockage que nous avons créé lors du déploiement. Sur ce service de stockage, nous allons créer un nouveau blob container pour l'environnement de production.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Création du blob container pour l'environnement de production\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour créer un blob container pour l'environnement de production, veuillez suivre les étapes suivantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans le portail Azure, cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Storage accounts\"}]}],\" dans le menu de gauche.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur le \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Storage account\"}]}],\" que vous avez créé précédemment (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"imagestorage007\"}]}],\" par exemple).\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans le menu de gauche, sous \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Data storage\"}]}],\", cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Containers\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"+ Container\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Entrez un nom pour le container. Par exemple : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"prod\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Pour \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Anonymous access level\"}]}],\", sélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Blob (anonymous read access for blobs only)\"}]}],\". Grâce à cela, les blobs peuvent être lus par n'importe qui, mais sans avoir le droit de lister les blobs.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Laissez les autres paramètres par défaut.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Create\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Création de l'environnement pour la base de données\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Comme nous l'avons vu dans la partie sur le déploiement, nous allons utiliser une base de données externe. Pour les étudiants Vinci, vous avez une base de données offerte par Vinci. Pour les autres, vous pouvez utiliser Azure Database for PostgreSQL.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour votre environnement de production, veuillez utiliser une base de données différente de celle de l'environnement de staging. Vous pouvez par exemple créer une nouvelle base de données sur Azure Database for PostgreSQL. Pour les étudiants Vinci, chaque groupe possède plusieurs bases de données, vous pouvez donc en choisir une autre.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Configuration de l'API Spring Boot pour utiliser la nouvelle base de données et le nouveau blob container\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez repartir de votre projet GitLab pour ce nouveau tutoriel. Pensez à créer une nouvelle branche pour ce tutoriel.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez au niveau de votre application Spring Boot, changer la configuration pour utiliser la nouvelle base de données. Veuillez créer le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-production.properties\"}]}],\" pour qu'il ressemble à ceci :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-properties\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-properties code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.application.name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"production\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"server.port\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"3000\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.url\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"$${SPRING_DATASOURCE_URL}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.username\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"$${SPRING_DATASOURCE_USERNAME}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.password\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"$${SPRING_DATASOURCE_PASSWORD}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.jpa.generate-ddl\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"true\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.sql.init.mode\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"never\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"azure.blob.service-endpoint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"https://imagestorage007.blob.core.windows.net/\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"azure.blob.sas-token\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"$${AZURE_BLOB_SAS_TOKEN}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"azure.blob.container-name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"production\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.servlet.multipart.enabled\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"true\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.servlet.multipart.max-file-size\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"10MB\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.servlet.multipart.max-request-size\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"10MB\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous avons donc créé un nouveau profil pour Spring Boot, \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"production\"}]}],\", qui utilise les variables d'environnement pour la connexion à la base de données et au blob container.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez noter vos nouvelles informations de connexion à la base de données, par exemple :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-properties\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-properties code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"SPRING_DATASOURCE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"jdbc:postgresql://cae-groupxy-production-db.postgres.database.azure.com:5432/cae_groupxy_production_db\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"SPRING_DATASOURCE_USERNAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"cae_groupxy_production_user@cae-groupxy-production-db\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"SPRING_DATASOURCE_PASSWORD\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"MySuperPassword\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Configuration de GitLab CI/CD pour le déploiement continu\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Si nous souhaitons configurer notre pipeline, nous devons ajouter une nouvelle étape pour le déploiement sur l'environnement de production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"De plus, nous avons des secrets à ajouter pour la connexion à la base de données et au blob container.\\nC'est pourquoi nous allons voir la gestion des environnements dans GitLab CI/CD, principalement afin d'éviter d'avoir à donner des noms de variables d'environnement différents pour chaque environnement.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_creer_des_environnements_sous_git_lab_ci_cd\",\"children\":\" Comment créer des environnements sous GitLab CI/CD \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"GitLab CI/CD permet de gérer des environnements pour les pipelines. Cela permet de définir des variables d'environnement pour chaque environnement, et de les utiliser dans les jobs du pipeline.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Sans utiliser d'environnement, nous devrions donner des noms de variables d'environnement différents pour chaque environnement, ce qui peut être source d'erreur.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Par exemple, pour la connexion à la base de données, nous devrions donner :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL_PROD\"}],\" pour l'environnement de production\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL_STAGING\"}],\" pour l'environnement de staging\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_USERNAME_PROD\"}],\" pour l'environnement de production\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_USERNAME_STAGING\"}],\" pour l'environnement de staging\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"...\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Avec les environnements sous GitLab, nous pouvons donner simplement des valeurs pour les variables \",[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL\"}],\" et \",[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_USERNAME\"}],\", et GitLab se chargera de donner les bonnes valeurs en fonction de l'environnement.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Création des environnements sous GitLab CI/CD\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour créer des environnements sous GitLab CI/CD, veuillez suivre les étapes suivantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans votre projet GitLab, cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Operate\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Environments\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"New environment\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Entrez un nom pour l'environnement. Par exemple : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Save\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez recommencer l'opération pour créer un environnement pour la production.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Configuration des variables d'environnement pour les environnements GitLab\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous souhaitons maintenant donner des valeurs pour les variables d'environnement pour chaque environnement.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"La valeur actuelle des variables d'environnement correspond à l'environnement de staging uniquement, ou aux deux environnements (staging et production).\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici les variables d'environnement à configurer, et pour quel environnement :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_ID\"}],\" : deux valeurs, une pour l'environnement de staging et une pour l'environnement de production\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_SECRET\"}],\" : deux valeurs, une pour l'environnement de staging et une pour l'environnement de production\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"AZURE_TENANT_ID\"}],\" : deux valeurs, une pour l'environnement de staging et une pour l'environnement de production\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"PULL_IMAGE_TOKEN_PASSWORD\"}],\" : une même valeur pour l'environnement de staging et de production\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"PULL_IMAGE_TOKEN_USERNAME\"}],\" : une même valeur pour l'environnement de staging et de production\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Configuration des variables d'environnement pour l'environnement de staging\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Ces variables d'environnement ont déjà les valeurs pour l'environnement de staging. Il faut néanmoins les configurer pour que ces valeurs ne s'appliquent que pour l'environnement de staging.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour configurer les variables d'environnement pour l'environnement de staging, veuillez suivre les étapes suivantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans votre projet GitLab, cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Settings\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CI/CD\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur l'icône \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Edit\"}]}],\" pour \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_ID\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Environment\"}]}],\", sélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Save changes\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Répétez l'opération pour les autres variables d'environnement : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_SECRET\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_TENANT_ID\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Configuration des variables d'environnement dont la valeur est la même pour les environnements de staging et de production\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Par défaut, tant qu'un environnement n'a pas de valeur pour une variable d'environnement, la valeur par défaut est utilisée, c'est-à-dire que la valeur de la variable d'environnement est utilisée pour tous les environnements.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Ainsi, nous n'avons plus rien à faire pour les variables d'environnement dont la valeur est la même pour les environnements de staging et de production, c'est-à-dire :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PULL_IMAGE_TOKEN_PASSWORD\"}]}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PULL_IMAGE_TOKEN_USERNAME\"}]}]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Configuration des variables d'environnement pour l'environnement de production\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour configurer les variables d'environnement pour l'environnement de production, veuillez suivre les étapes suivantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans votre projet GitLab, cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Settings\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CI/CD\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur l'icône \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add variable\"}]}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Environment\"}]}],\", sélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"production\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Visibility\"}]}],\", sélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Masked\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Désactivez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Protect variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Key\"}]}],\", entrez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_ID\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\", donnez la valeur pour l'environnement de production.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Save changes\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Répétez l'opération pour les autres variables d'environnement : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_SECRET\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_TENANT_ID\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Configuration des variables d'environnement pour l'Azure Web App de production\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Au niveau de votre Azure Web App (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"cae-groupxy-production-app\"}]}],\" par exemple) via le portail Azure, veuillez :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Settings\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Environment variables\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Ajouter les variables d'environnement suivantes en cliquant sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add\"}]}],\" :\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\"): l'URL de connexion à votre DB de production (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\"). Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_USERNAME\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\"): le nom d'utilisateur de votre DB de production (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\"). Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_PASSWORD\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\"): le mot de passe de votre DB de production (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\"). Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_BLOB_SAS_TOKEN\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\"): le token SAS pour le blob container de production (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\"). Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_PROFILES_ACTIVE\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\"): le profil Spring Boot à utiliser pour l'environnement de production (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\"), c'est-à-dire \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"production\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"N'oubliez pas de cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\" pour sauvegarder l'ajout des 5 variables, puis \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Confirm\"}]}],\".\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Comment utiliser les environnements dans les jobs du pipeline\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Maintenant que nous avons créé des environnements sous GitLab CI/CD, nous pouvons les utiliser dans les jobs du pipeline.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour cela, il suffit de donner le nom de l'environnement dans le job, et GitLab se chargera de donner les bonnes valeurs pour les variables d'environnement.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Utilisation des environnements dans les jobs du pipeline\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous allons maintenant mettre à jour notre pipeline pour qu'il déploie sur l'environnement de production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez mettre à jour votre fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".gitlab-ci.yml\"}]}],\" pour qu'il ressemble à ceci :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stages\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"6\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"8\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"9\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"MAVEN_OPTS\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"10\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"VERSION\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_IID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"11\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_REGISTRY\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"12\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY_IMAGE_BASE_PATH\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $REGISTRY/$CI_PROJECT_PATH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"13\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_RESOURCE_GROUP\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" caeGroup\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"api test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" maven\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"3.9.9\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"amazoncorretto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/pom.xml\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" $CI_PROJECT_DIR/.m2/repository\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" mvn clean test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/site/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/surefire\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"frontend test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"34\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"35\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"alpine\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"36\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"37\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"38\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"39\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/package\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"lock.json\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"40\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"41\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/node_modules\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"42\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"43\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd frontend\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"44\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"45\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run lint\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"46\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run coverage\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"47\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"48\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"49\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/coverage/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"50\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"51\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"52\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"53\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"54\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"services\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"55\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"dind\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"56\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"57\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" echo $CI_REGISTRY_PASSWORD \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],\" docker login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"u $CI_REGISTRY_USER $CI_REGISTRY \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"stdin\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"58\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"f docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.staging.yml build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"59\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" for service in frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod; do\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"60\",\"children\":[\"      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"61\",\"children\":[\"      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"62\",\"children\":[\"      docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"63\",\"children\":[\"      docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"64\",\"children\":\"      done\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"65\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"66\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_SOURCE == \\\"merge_request_event\\\" \",[\"$\",\"span\",null,{\"className\":\"token important\",\"children\":\"\u0026\u0026\"}],\" $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"67\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"68\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"deploy to staging\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"69\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"70\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"71\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"72\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"73\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"fza6c0ebghahfufh.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"74\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/azure\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cli\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"75\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"76\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_SOURCE == \\\"merge_request_event\\\" \",[\"$\",\"span\",null,{\"className\":\"token important\",\"children\":\"\u0026\u0026\"}],\" $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"77\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"78\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"principal \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"username $AZURE_CLIENT_ID \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $AZURE_CLIENT_SECRET \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"tenant $AZURE_TENANT_ID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"79\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp stop \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"80\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp config container set \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"type compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"file docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.deploy.yml \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"user $PULL_IMAGE_TOKEN_USERNAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $PULL_IMAGE_TOKEN_PASSWORD\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"81\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp start \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"82\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"83\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      for i in {1..30}; do\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"84\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        HTTP_STATUS=$(curl -s -o /dev/null -w \\\"%{http_code}\\\" $BASE_URL/api/pizzas);\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"85\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        if [ \\\"$HTTP_STATUS\\\" -eq 200 ]; then\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"86\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"          echo \\\"Azure Web App is functional.\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"87\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"          break\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"88\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        fi\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"89\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        echo \\\"Azure Web App is not ready yet. Waiting for 10 seconds...\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"90\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        sleep 10\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"91\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      done\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"92\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      if [ \\\"$HTTP_STATUS\\\" -ne 200 ]; then\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"93\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        echo \\\"Azure Web App failed to become functional.\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"94\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        exit 1\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"95\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      fi\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"96\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"97\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"e2e tests\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"98\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"99\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"100\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"101\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"fza6c0ebghahfufh.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"102\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"NODE_ENV\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"103\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/playwright\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"v1.50.1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"jammy\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"104\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"105\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_SOURCE == \\\"merge_request_event\\\" \",[\"$\",\"span\",null,{\"className\":\"token important\",\"children\":\"\u0026\u0026\"}],\" $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"106\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"107\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd ./e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"108\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"109\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npx playwright test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"110\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" if \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\" $\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"?\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"ne 0 \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"; then echo \\\"E2E tests failed\\\"; exit 1; fi\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"111\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"112\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"113\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e/playwright\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"report/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"114\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e/test\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"results/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"115\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"116\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"deploy to production\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"117\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"118\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"119\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"120\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"pizzeria\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"121\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//production\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"pizzeria\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"frd5dugfffgtarf6.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"122\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"NODE_ENV\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"123\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/azure\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cli\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"124\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"125\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_SOURCE == \\\"merge_request_event\\\" \",[\"$\",\"span\",null,{\"className\":\"token important\",\"children\":\"\u0026\u0026\"}],\" $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"126\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"127\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"principal \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"username $AZURE_CLIENT_ID \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $AZURE_CLIENT_SECRET \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"tenant $AZURE_TENANT_ID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"128\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp stop \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"129\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp config container set \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"type compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"file docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.deploy.yml \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"user $PULL_IMAGE_TOKEN_USERNAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $PULL_IMAGE_TOKEN_PASSWORD\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"130\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp start \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"131\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"132\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      for i in {1..30}; do\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"133\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        HTTP_STATUS=$(curl -s -o /dev/null -w \\\"%{http_code}\\\" $BASE_URL/api/pizzas);\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"134\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        if [ \\\"$HTTP_STATUS\\\" -eq 200 ]; then\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"135\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"          echo \\\"Azure Web App is functional.\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"136\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"          break\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"137\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        fi\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"138\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        echo \\\"Azure Web App is not ready yet. Waiting for 10 seconds...\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"139\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        sleep 10\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"140\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      done\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"141\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      if [ \\\"$HTTP_STATUS\\\" -ne 200 ]; then\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"142\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        echo \\\"Azure Web App failed to become functional.\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"143\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        exit 1\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"144\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      fi\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous avons donc ajouté un nouveau job pour le déploiement sur l'environnement de production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici quelques explications sur le pipeline :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Les variables \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_WEBAPP_NAME\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"BASE_URL\"}]}],\" sont différentes pour chaque environnement. Elle ne sont donc plus reprises au niveau de la section \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"variables\"}]}],\" mais directement dans les jobs.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Le fait de préciser \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"environment: staging\"}]}],\" ou \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"environment: production\"}]}],\" permet à GitLab de donner les bonnes valeurs pour les variables d'environnement en fonction de l'environnement.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Les règles \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"rules\"}]}],\" permettent de dire que le job ne doit être exécuté que si la source du pipeline est un \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"merge_request_event\"}]}],\" et que la branche de la merge request est la branche par défaut.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Nous avons ajouté \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"azure webapp stop\"}]}],\" pour être sûr que l'application est bien arrêtée avant de la redéployer.\",[\"$\",\"br\",null,{}],\"\\n\",\"NB : Cela n'est peut-être pas nécessaire, mais cela semble régler certains problèmes potentiels de non réinitialisation de la DB au redémarrage de l'API dans l'environnement de staging.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez donc faire un commit et un push pour déclencher le pipeline. Vérifiez que le déploiement sur l'environnement de production se passe bien.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Amélioration du pipeline\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Notre pipeline actuel contient des duplications de code. En effet, les jobs \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy to staging\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy to production\"}]}],\" sont presque identiques.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous allons donc voir comment améliorer notre pipeline en factorisant le code commun dans un template.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Création d'un template pour le déploiement\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez mettre à jour votre fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".gitlab-ci.yml\"}]}],\" pour qu'il ressemble à ceci :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stages\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"MAVEN_OPTS\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"VERSION\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_IID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_REGISTRY\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY_IMAGE_BASE_PATH\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $REGISTRY/$CI_PROJECT_PATH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_RESOURCE_GROUP\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" caeGroup\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"api test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" maven\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"3.9.9\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"amazoncorretto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/pom.xml\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" $CI_PROJECT_DIR/.m2/repository\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" mvn clean test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/site/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/surefire\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"frontend test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"34\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"35\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"alpine\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"36\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"37\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"38\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"39\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/package\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"lock.json\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"40\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"41\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/node_modules\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"42\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"43\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd frontend\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"44\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"45\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run lint\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"46\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run coverage\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"47\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"48\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"49\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/coverage/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"50\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"51\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"52\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"53\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"54\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"services\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"55\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"dind\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"56\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"57\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" echo $CI_REGISTRY_PASSWORD \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],\" docker login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"u $CI_REGISTRY_USER $CI_REGISTRY \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"stdin\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"58\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"f docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.staging.yml build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"59\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" for service in frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod; do\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"60\",\"children\":[\"      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"61\",\"children\":[\"      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"62\",\"children\":[\"      docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"63\",\"children\":[\"      docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"64\",\"children\":\"      done\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"65\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"66\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_SOURCE == \\\"merge_request_event\\\" \",[\"$\",\"span\",null,{\"className\":\"token important\",\"children\":\"\u0026\u0026\"}],\" $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"67\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"68\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\".deploy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"69\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/azure\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cli\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"70\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"71\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"principal \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"username $AZURE_CLIENT_ID \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $AZURE_CLIENT_SECRET \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"tenant $AZURE_TENANT_ID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"72\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp stop \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"73\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp config container set \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"type compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"file docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.deploy.yml \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"user $PULL_IMAGE_TOKEN_USERNAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $PULL_IMAGE_TOKEN_PASSWORD\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"74\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp start \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"75\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"76\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      for i in {1..30}; do\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"77\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        HTTP_STATUS=$(curl -s -o /dev/null -w \\\"%{http_code}\\\" $BASE_URL/api/pizzas);\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"78\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        if [ \\\"$HTTP_STATUS\\\" -eq 200 ]; then\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"79\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"          echo \\\"Azure Web App is functional.\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"80\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"          break\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"81\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        fi\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"82\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        echo \\\"Azure Web App is not ready yet. Waiting for 10 seconds...\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"83\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        sleep 10\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"84\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      done\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"85\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      if [ \\\"$HTTP_STATUS\\\" -ne 200 ]; then\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"86\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        echo \\\"Azure Web App failed to become functional.\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"87\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        exit 1\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"88\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      fi\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"89\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"90\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_SOURCE == \\\"merge_request_event\\\" \",[\"$\",\"span\",null,{\"className\":\"token important\",\"children\":\"\u0026\u0026\"}],\" $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"91\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"92\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"deploy to staging\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"93\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"94\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"95\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"96\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"97\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"fza6c0ebghahfufh.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"98\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"extends\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" .deploy\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"99\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"100\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"e2e tests\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"101\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"102\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"103\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"104\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"fza6c0ebghahfufh.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"105\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"NODE_ENV\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"106\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/playwright\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"v1.50.1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"jammy\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"107\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"108\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_SOURCE == \\\"merge_request_event\\\" \",[\"$\",\"span\",null,{\"className\":\"token important\",\"children\":\"\u0026\u0026\"}],\" $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"109\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"110\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd ./e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"111\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"112\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npx playwright test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"113\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" if \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\" $\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"?\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"ne 0 \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"; then echo \\\"E2E tests failed\\\"; exit 1; fi\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"114\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"115\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"116\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e/playwright\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"report/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"117\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e/test\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"results/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"118\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"119\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"deploy to production\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"120\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"121\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"122\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"123\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"pizzeria\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"124\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//production\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"pizzeria\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"frd5dugfffgtarf6.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"125\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"NODE_ENV\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"126\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"extends\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" .deploy\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous avons donc créé un template \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".deploy\"}]}],\" pour le déploiement. Ce template contient le code commun pour le déploiement sur l'environnement de staging et de production.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous avons ensuite utilisé ce template dans les jobs \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy to staging\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy to production\"}]}],\" en utilisant la directive \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"extends: .deploy\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez donc faire un commit et un push pour déclencher le pipeline. Vérifiez que le déploiement sur l'environnement de production se passe bien.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Conclusion sur la création de l'environnement de production\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous avons maintenant une pipeline qui déploie automatiquement sur l'environnement de production seulement si l'environnement de staging, très proche de la production, réussi les tests e2e.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous avons maintenant un nouvel environnement de production que nous pouvons visualiser ainsi, si l'on prend en compte l'environnement de staging nécessaire à sa mise en place :\"}],\"\\n\",[\"$\",\"$L17\",null,{\"src\":\"/diagrams/prod-deployment1.puml\",\"alt\":\"Environnement de production\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous faisons ce que nous appelons du déploiement continu (CD en anglais), c'est-à-dire que chaque commit sur la branche principale déclenche un déploiement sur l'environnement de production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous allons voir maintenant comment faire du Continous Delivery au lieu du Continuous Deployment.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_faire_du_continuous_delivery\",\"children\":\" Comment faire du Continuous Delivery ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous avons jusque là fait du Continuous Deployment, c'est-à-dire que chaque commit sur la branche principale déclenche un déploiement sur l'environnement de production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous allons maintenant voir comment faire du Continuous Delivery, c'est-à-dire que chaque commit sur la branche principale déclenche un déploiement sur l'environnement de staging, et que l'on peut déclencher manuellement un déploiement sur l'environnement de production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"En effet, il peut être intéressant de pouvoir vérifier, via des humains proches des utilisateurs finaux, que tout fonctionne bien sur l'environnement de staging avant de déployer sur l'environnement de production.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Mise en place du Continuous Delivery\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour mettre en place du Continuous Delivery, nous allons simplement changer le déclenchement du déploiement sur l'environnement de production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour cela il suffit de changer la règle pour le job \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy to production\"}]}],\" en indiquant que le job ne doit être exécuté que si le pipeline est déclenché manuellement.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez mettre à jour votre fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".gitlab-ci.yml\"}]}],\" pour qu'il ressemble à ceci :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stages\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"MAVEN_OPTS\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"VERSION\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_IID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_REGISTRY\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY_IMAGE_BASE_PATH\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $REGISTRY/$CI_PROJECT_PATH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_RESOURCE_GROUP\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" caeGroup\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"api test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" maven\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"3.9.9\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"amazoncorretto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/pom.xml\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" $CI_PROJECT_DIR/.m2/repository\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" mvn clean test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/site/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/surefire\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"frontend test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"34\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"35\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"alpine\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"36\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"37\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"38\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"39\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/package\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"lock.json\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"40\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"41\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/node_modules\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"42\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"43\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd frontend\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"44\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"45\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run lint\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"46\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run coverage\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"47\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"48\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"49\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/coverage/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"50\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"51\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"52\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"53\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"54\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"services\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"55\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"dind\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"56\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"57\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" echo $CI_REGISTRY_PASSWORD \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],\" docker login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"u $CI_REGISTRY_USER $CI_REGISTRY \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"stdin\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"58\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"f docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.staging.yml build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"59\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" for service in frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod; do\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"60\",\"children\":[\"      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"61\",\"children\":[\"      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"62\",\"children\":[\"      docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"63\",\"children\":[\"      docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"64\",\"children\":\"      done\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"65\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"66\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_SOURCE == \\\"merge_request_event\\\" \",[\"$\",\"span\",null,{\"className\":\"token important\",\"children\":\"\u0026\u0026\"}],\" $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"67\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"68\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\".deploy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"69\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/azure\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cli\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"70\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"71\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"principal \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"username $AZURE_CLIENT_ID \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $AZURE_CLIENT_SECRET \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"tenant $AZURE_TENANT_ID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"72\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp stop \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"73\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp config container set \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"type compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"file docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.deploy.yml \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"user $PULL_IMAGE_TOKEN_USERNAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $PULL_IMAGE_TOKEN_PASSWORD\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"74\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp start \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"75\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"76\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      for i in {1..30}; do\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"77\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        HTTP_STATUS=$(curl -s -o /dev/null -w \\\"%{http_code}\\\" $BASE_URL/api/pizzas);\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"78\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        if [ \\\"$HTTP_STATUS\\\" -eq 200 ]; then\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"79\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"          echo \\\"Azure Web App is functional.\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"80\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"          break\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"81\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        fi\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"82\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        echo \\\"Azure Web App is not ready yet. Waiting for 10 seconds...\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"83\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        sleep 10\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"84\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      done\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"85\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      if [ \\\"$HTTP_STATUS\\\" -ne 200 ]; then\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"86\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        echo \\\"Azure Web App failed to become functional.\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"87\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        exit 1\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"88\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      fi\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"89\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"90\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_SOURCE == \\\"merge_request_event\\\" \",[\"$\",\"span\",null,{\"className\":\"token important\",\"children\":\"\u0026\u0026\"}],\" $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"91\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"92\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"deploy to staging\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"93\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"94\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"95\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"96\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"97\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"fza6c0ebghahfufh.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"98\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"extends\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" .deploy\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"99\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"100\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"e2e tests\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"101\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"102\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"103\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"104\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"fza6c0ebghahfufh.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"105\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"NODE_ENV\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"106\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/playwright\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"v1.50.1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"jammy\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"107\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"108\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_SOURCE == \\\"merge_request_event\\\" \",[\"$\",\"span\",null,{\"className\":\"token important\",\"children\":\"\u0026\u0026\"}],\" $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"109\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"110\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd ./e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"111\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"112\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npx playwright test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"113\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" if \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\" $\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"?\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"ne 0 \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"; then echo \\\"E2E tests failed\\\"; exit 1; fi\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"114\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"115\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"116\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e/playwright\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"report/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"117\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e/test\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"results/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"118\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"119\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"deploy to production\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"120\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"121\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"122\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"123\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"pizzeria\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"124\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//production\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"pizzeria\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"frd5dugfffgtarf6.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"125\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"NODE_ENV\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" production\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"126\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"extends\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" .deploy\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"127\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"when\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" manual\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous avons donc ajouté la directive \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"when: manual\"}]}],\" pour le job \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy to production\"}]}],\". Cela signifie que le job ne sera exécuté que si le pipeline est déclenché manuellement.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez donc faire un commit et un push pour déclencher le pipeline.\\nUne fois que le déploiement sur l'environnement de staging est terminé, au niveau de la visualisation de la pipeline, dans le job nommé \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"production\"}]}],\", vous pouvez cliquer sur le bouton \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Play\"}]}],\" pour déclencher le déploiement sur l'environnement de production.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Conclusion sur le Continuous Delivery\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous avons maintenant un pipeline qui déploie automatiquement sur l'environnement de staging, et qui permet de déclencher manuellement un déploiement sur l'environnement de production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Si nous avons eu des soucis avec le démarrage de l'API sur l'environnement de staging, nous avons déjà pu nous rendre compte de l'importance des logs pour le débogage. Nous allons donc voir comment améliorer les logs de notre application.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Si nécessaire, vous pouvez trouver le code associé au déploiement de l'environnement de production ici : \",[\"$\",\"a\",null,{\"href\":\"https://github.com/e-vinci/cae-theory-demos/tree/main/production\",\"children\":\"production\"}],\".\"]}]]\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Production\"}]]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script></body></html>