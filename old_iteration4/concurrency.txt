1:"$Sreact.fragment"
2:I[5484,["537","static/chunks/537-32c52f136802c48f.js","673","static/chunks/673-8f55286e245006fb.js","177","static/chunks/app/layout-a557f0e5b59d7b71.js"],"default"]
3:I[7468,["537","static/chunks/537-32c52f136802c48f.js","673","static/chunks/673-8f55286e245006fb.js","177","static/chunks/app/layout-a557f0e5b59d7b71.js"],"ClientThemeProvider"]
4:I[7259,["537","static/chunks/537-32c52f136802c48f.js","328","static/chunks/328-d02b7e1054113488.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js"],"default"]
5:I[1758,["537","static/chunks/537-32c52f136802c48f.js","673","static/chunks/673-8f55286e245006fb.js","177","static/chunks/app/layout-a557f0e5b59d7b71.js"],"default"]
6:I[8148,["537","static/chunks/537-32c52f136802c48f.js","673","static/chunks/673-8f55286e245006fb.js","177","static/chunks/app/layout-a557f0e5b59d7b71.js"],"default"]
7:I[5244,[],""]
8:I[3866,[],""]
9:I[3620,["537","static/chunks/537-32c52f136802c48f.js","673","static/chunks/673-8f55286e245006fb.js","177","static/chunks/app/layout-a557f0e5b59d7b71.js"],"default"]
a:I[6240,["537","static/chunks/537-32c52f136802c48f.js","673","static/chunks/673-8f55286e245006fb.js","177","static/chunks/app/layout-a557f0e5b59d7b71.js"],"default"]
c:I[6213,[],"OutletBoundary"]
e:I[6213,[],"MetadataBoundary"]
10:I[6213,[],"ViewportBoundary"]
12:I[4835,[],""]
:HL["/_next/static/css/f76bfe29b96cf8a1.css","style"]
0:{"P":null,"b":"lBCth7YGlYHLzNGMFrvg-","p":"","c":["","old_iteration4","concurrency"],"i":false,"f":[[["",{"children":[["slug","old_iteration4/concurrency","oc"],{"children":["__PAGE__",{}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/f76bfe29b96cf8a1.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L2",null,{"children":["$","$L3",null,{"children":["$","html",null,{"children":[["$","head",null,{"children":[["$","title",null,{"children":"CAE Course"}],["$","link",null,{"rel":"icon","type":"image/svg+xml","href":"/favicon.svg"}]]}],["$","$L4",null,{"component":"body","sx":{"display":"flex","flexDirection":"column","minHeight":"100vh","margin":0},"children":[["$","header",null,{"children":["$","$L5",null,{"siteMetaData":{"version":"","title":"CAE","description":"siteDescription","url":"siteURL","youtubeUrl":"youtubeUrl","authorEmail":"raphael.baroni@vinci.be","facebookUrl":"facebookUrl","instagramUrl":"instagramUrl","menuLinks":[{"name":"Home","link":"/"},{"name":"Partie 1","link":"","subMenu":[{"name":"Introduction","link":"/part1/intro"},{"name":"Qualit√© g√©n√©rale","link":"/part1/general"}]},{"name":"About","link":"/about"}]}}]}],["$","$L6",null,{"sx":{"padding":"1rem","wordWrap":"break-word","flex":1},"children":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}]}],["$","$L9",null,{}],["$","$La",null,{"siteMetaData":"$0:f:0:1:1:props:children:1:props:children:props:children:props:children:1:props:children:0:props:children:props:siteMetaData"}]]}]]}]}]}]]}],{"children":[["slug","old_iteration4/concurrency","oc"],["$","$1","c",{"children":[null,["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","$0:f:0:1:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$Lb",null,["$","$Lc",null,{"children":"$Ld"}]]}],{},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","a4ItGQN41jHhurDdOyGiq",{"children":[["$","$Le",null,{"children":"$Lf"}],["$","$L10",null,{"children":"$L11"}],null]}]]}],false]],"m":"$undefined","G":["$12","$undefined"],"s":false,"S":true}
13:I[3508,["537","static/chunks/537-32c52f136802c48f.js","328","static/chunks/328-d02b7e1054113488.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js"],"default"]
14:I[5451,["537","static/chunks/537-32c52f136802c48f.js","328","static/chunks/328-d02b7e1054113488.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js"],"default"]
15:I[8174,["537","static/chunks/537-32c52f136802c48f.js","328","static/chunks/328-d02b7e1054113488.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js"],"default"]
16:I[8173,["537","static/chunks/537-32c52f136802c48f.js","328","static/chunks/328-d02b7e1054113488.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js"],""]
17:I[8064,["537","static/chunks/537-32c52f136802c48f.js","328","static/chunks/328-d02b7e1054113488.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js"],"default"]
18:I[4401,["537","static/chunks/537-32c52f136802c48f.js","328","static/chunks/328-d02b7e1054113488.js","340","static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js"],"default"]
b:[["$","$L13",null,{"children":[["$","$L14",null,{"aria-label":"breadcrumb","children":[["$","$L15",null,{"href":"/","underline":"hover","color":"inherit","component":"$16","children":" CAE "}],["$","$L15",null,{"href":"/iteration3","underline":"hover","color":"inherit","component":"$16","children":" It√©ration 3 "}],["$","$L15",null,{"href":"#","underline":"hover","color":"inherit","component":"$16","children":" Gestion de transactions et de la concurrence "}]]}],["$","$L17",null,{"component":"div","sx":{"paddingTop":0,"paddingBottom":0},"children":["$","$L15",null,{"href":"#comment_gerer_des_transactions_dans_spring_boot","underline":"hover","color":"inherit","component":"$16","children":["$","$L18",null,{"primary":" Comment g√©rer des transactions dans Spring Boot ? "}]}]}],["$","$L17",null,{"component":"div","sx":{"paddingTop":0,"paddingBottom":0},"children":["$","$L15",null,{"href":"#pourquoi_gerer_la_concurrence","underline":"hover","color":"inherit","component":"$16","children":["$","$L18",null,{"primary":" Pourquoi g√©rer la concurrence ? "}]}]}],["$","$L17",null,{"component":"div","sx":{"paddingTop":0,"paddingBottom":0},"children":["$","$L15",null,{"href":"#comment_gerer_la_concurrence","underline":"hover","color":"inherit","component":"$16","children":["$","$L18",null,{"primary":" Comment g√©rer la concurrence ? "}]}]}],["$","$L17",null,{"component":"div","sx":{"paddingTop":0,"paddingBottom":0},"children":["$","$L15",null,{"href":"#optimistic_locking_dans_spring_boot","underline":"hover","color":"inherit","component":"$16","children":["$","$L18",null,{"primary":" Optimistic Locking dans Spring Boot "}]}]}],["$","$L17",null,{"component":"div","sx":{"paddingTop":0,"paddingBottom":0},"children":["$","$L15",null,{"href":"#pessimistic_locking_dans_spring_boot","underline":"hover","color":"inherit","component":"$16","children":["$","$L18",null,{"primary":" Pessimistic Locking dans Spring Boot "}]}]}]]}],"\n",["$","h1",null,{"children":["$","a",null,{"id":"comment_gerer_des_transactions_dans_spring_boot","children":" Comment g√©rer des transactions dans Spring Boot ? "}]}],"\n",["$","h2",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"Les transactions sont un moyen de regrouper plusieurs op√©rations en une seule unit√© logique. Cela garantit que toutes les op√©rations sont ex√©cut√©es de mani√®re atomique, c'est-√†-dire que toutes les op√©rations sont ex√©cut√©es ou aucune op√©ration n'est ex√©cut√©e."}],"\n",["$","p",null,{"children":["Avec Spring Boot, vous pouvez g√©rer les transactions en utilisant l'annotation ",["$","strong",null,{"children":["$","code",null,{"children":"@Transactional"}]}],". Cette annotation permet de d√©finir une m√©thode comme transactionnelle. Cela signifie que toutes les op√©rations sur la base de donn√©es effectu√©es dans cette m√©thode seront regroup√©es en une seule transaction."]}],"\n",["$","p",null,{"children":"Par exemple, si vous souhaitez ajouter une adresse √† un utilisateur, vous devez ajouter l'adresse et mettre √† jour l'utilisateur en m√™me temps. Si l'une des op√©rations √©choue, vous ne voulez pas que l'autre op√©ration soit ex√©cut√©e. Les transactions garantissent que les deux op√©rations sont ex√©cut√©es ensemble."}],"\n",["$","p",null,{"children":["Si une exception est lev√©e dans une m√©thode annot√©e avec ",["$","strong",null,{"children":["$","code",null,{"children":"@Transactional"}]}],", la transaction est automatiquement annul√©e et les op√©rations effectu√©es dans cette transaction sont annul√©es. Cela correspond √† un ",["$","strong",null,{"children":["$","code",null,{"children":"rollback"}]}]," au niveau de la base de donn√©es.\nCela garantit que les donn√©es restent coh√©rentes. Si tout se passe bien, la transaction est valid√©e et les op√©rations sont confirm√©es. Cela correspond √† un ",["$","strong",null,{"children":["$","code",null,{"children":"commit"}]}]," au niveau de la base de donn√©es."]}],"\n",["$","p",null,{"children":"Les transactions ne r√®glent pas les probl√®mes de concurrence que nous verrons plus tard. N√©anmoins, si les transactions sont coupl√©es √† la gestion de la concurrence (optimistic ou pessimistic locking trait√©s apr√®s la gestion des transactions), elles permettent de g√©rer les conflits de mani√®re plus robuste."}],"\n",["$","h2",null,{"children":"Bases pour les transactions"}],"\n",["$","p",null,{"children":"Voici un exemple de transaction en Java avec Spring Boot, lorsque nous avons un repository pour les utilisateurs et un repository pour les adresses."}],"\n",["$","p",null,{"children":"Voici les entit√©s :"}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Entity"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"User"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@Id"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@GeneratedValue"}],["$","span",null,{"className":"token punctuation","children":"("}],"strategy ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token class-name","children":"GenerationType"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"IDENTITY"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"7","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," name",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"9","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@OneToOne"}],["$","span",null,{"className":"token punctuation","children":"("}],"cascade ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token class-name","children":"CascadeType"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"ALL"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@JoinColumn"}],["$","span",null,{"className":"token punctuation","children":"("}],"name ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"address_id\""}],["$","span",null,{"className":"token punctuation","children":","}]," referencedColumnName ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"id\""}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"Address"}]," address",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"13","children":["    ",["$","span",null,{"className":"token comment","children":"// Getters et setters"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"15","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"16","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Entity"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"17","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"Address"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"18","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@Id"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"19","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@GeneratedValue"}],["$","span",null,{"className":"token punctuation","children":"("}],"strategy ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token class-name","children":"GenerationType"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"IDENTITY"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"20","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"21","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"22","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@Column"}],["$","span",null,{"className":"token punctuation","children":"("}],"unique ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token boolean","children":"true"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token comment","children":"// Emp√™che les doublons d'adresses"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"23","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," street",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"24","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"25","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," city",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"26","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"27","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," postalCode",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"28","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"29","children":["    ",["$","span",null,{"className":"token comment","children":"// Getters et setters"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"30","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"Voici les repositories :"}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Repository"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"interface"}]," ",["$","span",null,{"className":"token class-name","children":"UserRepository"}]," ",["$","span",null,{"className":"token keyword","children":"extends"}]," ",["$","span",null,{"className":"token class-name","children":"CrudRepository"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"User"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":"Long"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"Voici les DTO pour les requ√™tes :"}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"UserDTO"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," name",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"AddressDTO"}]," address",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"5","children":["    ",["$","span",null,{"className":"token comment","children":"// Getters et setters"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"8","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"AddressDTO"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," street",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," city",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," postalCode",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"13","children":["    ",["$","span",null,{"className":"token comment","children":"// Getters et setters"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"Voici le contr√¥leur :"}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@RestController"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token annotation punctuation","children":"@RequestMapping"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"/users\""}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"UserController"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"5","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"final"}]," ",["$","span",null,{"className":"token class-name","children":"UserService"}]," userService",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"7","children":["    ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"UserController"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"UserService"}]," userService",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":["        ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],"userService ",["$","span",null,{"className":"token operator","children":"="}]," userService",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"11","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@PostMapping"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":["    ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"User"}]," ",["$","span",null,{"className":"token function","children":"addUserWithAddress"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token annotation punctuation","children":"@RequestBody"}]," ",["$","span",null,{"className":"token class-name","children":"UserDTO"}]," userDTO",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":["        ",["$","span",null,{"className":"token keyword","children":"return"}]," userService",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"addUserWithAddress"}],["$","span",null,{"className":"token punctuation","children":"("}],"userDTO",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"15","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"Voici l'exception que nous souhaitons lancer pour une adresse d√©j√† existante :"}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-Java code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"AddressAlreadyExistsException"}]," ",["$","span",null,{"className":"token keyword","children":"extends"}]," ",["$","span",null,{"className":"token class-name","children":"RuntimeException"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"AddressAlreadyExistsException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"String"}]," message",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token keyword","children":"super"}],["$","span",null,{"className":"token punctuation","children":"("}],"message",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"Voici un service pour ajouter une adresse et un utilisateur :"}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Service"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"UserService"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"4","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"final"}]," ",["$","span",null,{"className":"token class-name","children":"UserRepository"}]," userRepository",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"final"}]," ",["$","span",null,{"className":"token class-name","children":"AddressRepository"}]," addressRepository",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"7","children":["    ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"UserService"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"UserRepository"}]," userRepository",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":"AddressRepository"}]," addressRepository",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":["        ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],"userRepository ",["$","span",null,{"className":"token operator","children":"="}]," userRepository",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":["        ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],"addressRepository ",["$","span",null,{"className":"token operator","children":"="}]," addressRepository",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"12","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@Transactional"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":["    ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"User"}]," ",["$","span",null,{"className":"token function","children":"addUserWithAddress"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"UserDTO"}]," userDTO",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":["        ",["$","span",null,{"className":"token comment","children":"// V√©rifier si l'adresse existe d√©j√†"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"15","children":["        ",["$","span",null,{"className":"token class-name","children":"Optional"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"Address"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," existingAddress ",["$","span",null,{"className":"token operator","children":"="}]," addressRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findByStreetAndCityAndPostalCode"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":["                userDTO",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getAddress"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getStreet"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"17","children":["                userDTO",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getAddress"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getCity"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"18","children":["                userDTO",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getAddress"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getPostalCode"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"19","children":["        ",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"20","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"21","children":["        ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"existingAddress",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"isPresent"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"22","children":["            ",["$","span",null,{"className":"token keyword","children":"throw"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"AddressAlreadyExistsException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"L'adresse existe d√©j√† !\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"23","children":["        ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"24","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"25","children":["        ",["$","span",null,{"className":"token comment","children":"// Sauvegarder l'adresse"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"26","children":["        ",["$","span",null,{"className":"token class-name","children":"Address"}]," address ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"Address"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"27","children":["        address",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setStreet"}],["$","span",null,{"className":"token punctuation","children":"("}],"userDTO",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getAddress"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getStreet"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"28","children":["        address",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setCity"}],["$","span",null,{"className":"token punctuation","children":"("}],"userDTO",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getAddress"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getCity"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"29","children":["        address",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setPostalCode"}],["$","span",null,{"className":"token punctuation","children":"("}],"userDTO",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getAddress"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getPostalCode"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"30","children":["        addressRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"save"}],["$","span",null,{"className":"token punctuation","children":"("}],"address",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"31","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"32","children":["        ",["$","span",null,{"className":"token comment","children":"// Sauvegarder l'utilisateur"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"33","children":["        ",["$","span",null,{"className":"token class-name","children":"User"}]," user ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"User"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"34","children":["        user",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setName"}],["$","span",null,{"className":"token punctuation","children":"("}],"userDTO",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getName"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"35","children":["        user",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setAddress"}],["$","span",null,{"className":"token punctuation","children":"("}],"address",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"36","children":["        ",["$","span",null,{"className":"token keyword","children":"return"}]," userRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"save"}],["$","span",null,{"className":"token punctuation","children":"("}],"user",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token comment","children":"// Retourner l'utilisateur sauvegard√©"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"37","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"38","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"children":["Ici la gestion des transactions est assur√©e par l'annotation ",["$","strong",null,{"children":["$","code",null,{"children":"@Transactional"}]}]," sur la m√©thode ",["$","strong",null,{"children":["$","code",null,{"children":"addUserWithAddress"}]}],". Cela signifie que toutes les op√©rations effectu√©es dans cette m√©thode seront regroup√©es en une seule transaction. Cela garantit que toutes les op√©rations sont ex√©cut√©es de mani√®re atomique, c'est-√†-dire que toutes les op√©rations sont ex√©cut√©es ou aucune op√©ration n'est ex√©cut√©e."]}],"\n"]}],"\n",["$","p",null,{"children":["üí≠ Peux-tu imaginer une autre raison pour que JPA √©choue √† sauvegarder l'adresse ?",["$","br",null,{}],"\n","Normalement, JPA ne devrait pas √©chouer √† sauvegarder l'adresse, car normalement, dans le contr√¥leur, on est cens√© valider tous les param√®tres avant d'appeler le service.",["$","br",null,{}],"\n","Une fois l'adresse sauvegard√©e, on pourrait imaginer que l'on ne peut pas sauvegarder l'utilisateur. Par exemple, si l'utilisateur a d√©j√† √©t√© sauvegard√©, on ne peut pas le sauvegarder √† nouveau.",["$","br",null,{}],"\n","L'avantage de la transaction est que si l'une des op√©rations √©choue, l'autre op√©ration ne sera pas ex√©cut√©e. Cela garantit que les donn√©es restent coh√©rentes.",["$","br",null,{}],"\n","Bien s√ªr, pour rendre le code plus robuste et clair, il faudrait aussi v√©rifier si l'utilisateur existe d√©j√† avant de le sauvegarder."]}],"\n",["$","p",null,{"children":["üí≠ Est-ce que les transactions sont suffisantes dans cet exemple pour se prot√©ger contre les acc√®s concurrents ?",["$","br",null,{}],"\n","Si deux transactions distinctes tentent de sauvegarder la m√™me adresse ou le m√™me utilisateur en m√™me temps, il pourrait y avoir des conflits ou des incoh√©rences.",["$","br",null,{}],"\n","Cependant, l'optimistic ou le pessimistic locking (que nous verrons plus tard) n'est pas n√©cessaire ici car :"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["La m√©thode ",["$","strong",null,{"children":["$","code",null,{"children":"save"}]}]," de JPA garantit que l'adresse ne sera pas dupliqu√©e si une contrainte d'unicit√© est d√©finie sur la colonne street (comme dans votre entit√© ",["$","strong",null,{"children":["$","code",null,{"children":"Address"}]}]," avec ",["$","strong",null,{"children":["$","code",null,{"children":"@Column(unique = true)"}]}],")."]}],"\n",["$","li",null,{"children":["Si deux transactions tentent de sauvegarder la m√™me adresse en m√™me temps, la base de donn√©es l√®vera une exception (par exemple, une ",["$","strong",null,{"children":["$","code",null,{"children":"ConstraintViolationException"}]}],"). La deuxi√®me transaction sera annul√©e, garantissant que l'adresse n'est pas dupliqu√©e."]}],"\n"]}],"\n",["$","p",null,{"children":["Et finalement, voici le gestionnaire global d'exceptions pour l'exception ",["$","strong",null,{"children":["$","code",null,{"children":"AddressAlreadyExistsException"}]}]," :"]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@ControllerAdvice"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"GlobalExceptionHandler"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"4","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@ExceptionHandler"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"AddressAlreadyExistsException"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token keyword","children":"class"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["    ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"handleAddressAlreadyExistsException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"AddressAlreadyExistsException"}]," ex",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":["        ",["$","span",null,{"className":"token keyword","children":"throw"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"ResponseStatusException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"HttpStatus"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"CONFLICT"}],["$","span",null,{"className":"token punctuation","children":","}]," ex",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getMessage"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"9","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@ExceptionHandler"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Exception"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token keyword","children":"class"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":["    ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"handleGenericException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Exception"}]," ex",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":["        ",["$","span",null,{"className":"token keyword","children":"throw"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"ResponseStatusException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"HttpStatus"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"INTERNAL_SERVER_ERROR"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"Une erreur est survenue : \""}]," ",["$","span",null,{"className":"token operator","children":"+"}]," ex",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getMessage"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["Ici, le gestionnaire global d'exceptions renvoie une r√©ponse ",["$","strong",null,{"children":["$","code",null,{"children":"409 Conflict"}]}]," au client en cas d'exception ",["$","strong",null,{"children":["$","code",null,{"children":"AddressAlreadyExistsException"}]}],". Cela signifie que si l'adresse existe d√©j√†, le client recevra une r√©ponse ",["$","strong",null,{"children":["$","code",null,{"children":"409 Conflict"}]}],"."]}],"\n",["$","h2",null,{"children":"Exemple concret"}],"\n",["$","p",null,{"children":"Veuillez mettre √† jour votre projet GitLab contenant la gestion des Pizzas pour ajouter la gestion des transactions."}],"\n",["$","p",null,{"children":["Il suffit de rajouter l'annotation ",["$","strong",null,{"children":["$","code",null,{"children":"@Transactional"}]}]," sur les m√©thodes de service qui effectuent des op√©rations de mise √† jour sur la base de donn√©es et qui d√©pendent du succ√®s d'autres op√©rations."]}],"\n",["$","p",null,{"children":["Par exemple, au niveau de l'API de gestion de pizzas, lorsque nous ajoutons, ou effa√ßons des pizzas, nous faisons des op√©rations au niveau d'Azure Storage pour stocker ou effacer les images des pizzas.",["$","br",null,{}],"\n","Si ces op√©rations √©chouent, nous ne voulons pas que les op√©rations de mise √† jour de la base de donn√©es soient ex√©cut√©es.",["$","br",null,{}],"\n","Veuillez donc mettre √† jour le service de gestion des pizzas nomm√© ",["$","strong",null,{"children":["$","code",null,{"children":"services/PizzaService"}]}],"."]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token keyword","children":"package"}]," ",["$","span",null,{"className":"token namespace","children":["be",["$","span",null,{"className":"token punctuation","children":"."}],"vinci",["$","span",null,{"className":"token punctuation","children":"."}],"ipl",["$","span",null,{"className":"token punctuation","children":"."}],"cae",["$","span",null,{"className":"token punctuation","children":"."}],"demo",["$","span",null,{"className":"token punctuation","children":"."}],"services"]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"3","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["be",["$","span",null,{"className":"token punctuation","children":"."}],"vinci",["$","span",null,{"className":"token punctuation","children":"."}],"ipl",["$","span",null,{"className":"token punctuation","children":"."}],"cae",["$","span",null,{"className":"token punctuation","children":"."}],"demo",["$","span",null,{"className":"token punctuation","children":"."}],"models",["$","span",null,{"className":"token punctuation","children":"."}],"dtos",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"NewPizza"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["be",["$","span",null,{"className":"token punctuation","children":"."}],"vinci",["$","span",null,{"className":"token punctuation","children":"."}],"ipl",["$","span",null,{"className":"token punctuation","children":"."}],"cae",["$","span",null,{"className":"token punctuation","children":"."}],"demo",["$","span",null,{"className":"token punctuation","children":"."}],"models",["$","span",null,{"className":"token punctuation","children":"."}],"entities",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"Pizza"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["be",["$","span",null,{"className":"token punctuation","children":"."}],"vinci",["$","span",null,{"className":"token punctuation","children":"."}],"ipl",["$","span",null,{"className":"token punctuation","children":"."}],"cae",["$","span",null,{"className":"token punctuation","children":"."}],"demo",["$","span",null,{"className":"token punctuation","children":"."}],"repositories",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"PizzaRepository"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["com",["$","span",null,{"className":"token punctuation","children":"."}],"azure",["$","span",null,{"className":"token punctuation","children":"."}],"storage",["$","span",null,{"className":"token punctuation","children":"."}],"blob",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"BlobClientBuilder"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["com",["$","span",null,{"className":"token punctuation","children":"."}],"azure",["$","span",null,{"className":"token punctuation","children":"."}],"storage",["$","span",null,{"className":"token punctuation","children":"."}],"blob",["$","span",null,{"className":"token punctuation","children":"."}],"models",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"BlobHttpHeaders"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["java",["$","span",null,{"className":"token punctuation","children":"."}],"io",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"IOException"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["java",["$","span",null,{"className":"token punctuation","children":"."}],"util",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"HashMap"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["java",["$","span",null,{"className":"token punctuation","children":"."}],"util",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"Map"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["java",["$","span",null,{"className":"token punctuation","children":"."}],"util",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"UUID"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["org",["$","span",null,{"className":"token punctuation","children":"."}],"springframework",["$","span",null,{"className":"token punctuation","children":"."}],"beans",["$","span",null,{"className":"token punctuation","children":"."}],"factory",["$","span",null,{"className":"token punctuation","children":"."}],"annotation",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"Value"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["org",["$","span",null,{"className":"token punctuation","children":"."}],"springframework",["$","span",null,{"className":"token punctuation","children":"."}],"stereotype",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"Service"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["org",["$","span",null,{"className":"token punctuation","children":"."}],"springframework",["$","span",null,{"className":"token punctuation","children":"."}],"transaction",["$","span",null,{"className":"token punctuation","children":"."}],"annotation",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"Transactional"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"15","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["org",["$","span",null,{"className":"token punctuation","children":"."}],"springframework",["$","span",null,{"className":"token punctuation","children":"."}],"web",["$","span",null,{"className":"token punctuation","children":"."}],"multipart",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"MultipartFile"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"17","children":["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]}],["$","span",null,{"className":"code-line line-number","line":"18","children":["$","span",null,{"className":"token doc-comment comment","children":" * Pizza service.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"19","children":[["$","span",null,{"className":"token doc-comment comment","children":" */"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"20","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Service"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"21","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"PizzaService"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"22","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"23","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"final"}]," ",["$","span",null,{"className":"token class-name","children":"PizzaRepository"}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"24","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"final"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," blobServiceEndpoint",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"25","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"final"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," sasToken",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"26","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"final"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," containerName",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"27","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"28","children":["  ",["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"29","children":["$","span",null,{"className":"token doc-comment comment","children":"   * Constructor.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"30","children":["$","span",null,{"className":"token doc-comment comment","children":"   *\n"}]}],["$","span",null,{"className":"code-line line-number","line":"31","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"pizzaRepository"}]," the pizza repository\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"32","children":[["$","span",null,{"className":"token doc-comment comment","children":"   */"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"33","children":["  ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"PizzaService"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"PizzaRepository"}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"34","children":["      ",["$","span",null,{"className":"token annotation punctuation","children":"@Value"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"${azure.blob.service-endpoint}\""}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," blobServiceEndpoint",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"35","children":["      ",["$","span",null,{"className":"token annotation punctuation","children":"@Value"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"${azure.blob.sas-token}\""}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," sasToken",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"36","children":["      ",["$","span",null,{"className":"token annotation punctuation","children":"@Value"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"${azure.blob.container-name}\""}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," containerName",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"37","children":["    ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],"pizzaRepository ",["$","span",null,{"className":"token operator","children":"="}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"38","children":["    ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],"blobServiceEndpoint ",["$","span",null,{"className":"token operator","children":"="}]," blobServiceEndpoint",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"39","children":["    ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],"sasToken ",["$","span",null,{"className":"token operator","children":"="}]," sasToken",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"40","children":["    ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],"containerName ",["$","span",null,{"className":"token operator","children":"="}]," containerName",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"41","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"42","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"43","children":["  ",["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"44","children":["$","span",null,{"className":"token doc-comment comment","children":"   * Read all pizzas.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"45","children":["$","span",null,{"className":"token doc-comment comment","children":"   *\n"}]}],["$","span",null,{"className":"code-line line-number","line":"46","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"order"}]," if order contains \"title\" the pizzas will be ordered by title in ascending order\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"47","children":["$","span",null,{"className":"token doc-comment comment","children":"   *              if order contains \"-title\" the pizzas will be ordered by title in descending\n"}]}],["$","span",null,{"className":"code-line line-number","line":"48","children":["$","span",null,{"className":"token doc-comment comment","children":"   *              order.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"49","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@return"}]," the pizzas\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"50","children":[["$","span",null,{"className":"token doc-comment comment","children":"   */"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"51","children":["  ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"Iterable"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"Pizza"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token function","children":"readAllPizzas"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"String"}]," order",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"52","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"order ",["$","span",null,{"className":"token operator","children":"=="}]," ",["$","span",null,{"className":"token keyword","children":"null"}]," ",["$","span",null,{"className":"token operator","children":"||"}]," ",["$","span",null,{"className":"token operator","children":"!"}],"order",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"contains"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"title\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"53","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findAll"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"54","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"55","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"56","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"order",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"contains"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"-\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"57","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findAllByOrderByTitleDesc"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"58","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"59","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findAllByOrderByTitleAsc"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"60","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"61","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"62","children":["  ",["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"63","children":["$","span",null,{"className":"token doc-comment comment","children":"   * Read a pizza by its id.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"64","children":["$","span",null,{"className":"token doc-comment comment","children":"   *\n"}]}],["$","span",null,{"className":"code-line line-number","line":"65","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"id"}]," the id\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"66","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@return"}]," the pizza\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"67","children":[["$","span",null,{"className":"token doc-comment comment","children":"   */"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"68","children":["  ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"Pizza"}]," ",["$","span",null,{"className":"token function","children":"readPizzaById"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"69","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],"id",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElse"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"70","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"71","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"72","children":["  ",["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"73","children":["$","span",null,{"className":"token doc-comment comment","children":"   * Create a pizza.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"74","children":["$","span",null,{"className":"token doc-comment comment","children":"   *\n"}]}],["$","span",null,{"className":"code-line line-number","line":"75","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"newPizza"}]," the new pizza\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"76","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"image"}],"    the image\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"77","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@return"}]," the pizza\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"78","children":[["$","span",null,{"className":"token doc-comment comment","children":"   */"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"79","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@Transactional"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"80","children":["  ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"Pizza"}]," ",["$","span",null,{"className":"token function","children":"createPizza"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"NewPizza"}]," newPizza",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":"MultipartFile"}]," image",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"81","children":["    ",["$","span",null,{"className":"token class-name","children":"Pizza"}]," pizza ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"Pizza"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"82","children":["    pizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],"newPizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"83","children":["    pizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setContent"}],["$","span",null,{"className":"token punctuation","children":"("}],"newPizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getContent"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"84","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"85","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"image ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token keyword","children":"null"}]," ",["$","span",null,{"className":"token operator","children":"&&"}]," ",["$","span",null,{"className":"token operator","children":"!"}],"image",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"isEmpty"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"86","children":["      ",["$","span",null,{"className":"token class-name","children":"String"}]," blobUrl ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token function","children":"uploadImageToBlob"}],["$","span",null,{"className":"token punctuation","children":"("}],"image",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"87","children":["      pizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setImageLocation"}],["$","span",null,{"className":"token punctuation","children":"("}],"blobUrl",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"88","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"89","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"90","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"save"}],["$","span",null,{"className":"token punctuation","children":"("}],"pizza",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"91","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"92","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"93","children":["  ",["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"94","children":["$","span",null,{"className":"token doc-comment comment","children":"   * Upload an image to a blob on Azure storage with a generated UUID as filename. The image is\n"}]}],["$","span",null,{"className":"code-line line-number","line":"95","children":["$","span",null,{"className":"token doc-comment comment","children":"   * uploaded to the \"images\" folder. The original filename is stored in the metadata.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"96","children":["$","span",null,{"className":"token doc-comment comment","children":"   *\n"}]}],["$","span",null,{"className":"code-line line-number","line":"97","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"image"}],"\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"98","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@return"}]," the blob url\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"99","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@throws"}]," ",["$","span",null,{"className":"token reference","children":["$","span",null,{"className":"token class-name","children":"IOException"}]}],"\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"100","children":[["$","span",null,{"className":"token doc-comment comment","children":"   */"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"101","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," ",["$","span",null,{"className":"token function","children":"uploadImageToBlob"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"MultipartFile"}]," image",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"102","children":["    ",["$","span",null,{"className":"token class-name","children":"String"}]," imageUUID ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token constant","children":"UUID"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"randomUUID"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"toString"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"103","children":["    ",["$","span",null,{"className":"token class-name","children":"Map"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"String"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":"String"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," metadata ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"HashMap"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token punctuation","children":">"}]]}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"104","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"105","children":["    ",["$","span",null,{"className":"token class-name","children":"String"}]," blobName ",["$","span",null,{"className":"token operator","children":"="}]," imageUUID",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"106","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"107","children":["    metadata",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"put"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"originalFileName\""}],["$","span",null,{"className":"token punctuation","children":","}]," image",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getOriginalFilename"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"108","children":["    ",["$","span",null,{"className":"token class-name","children":"BlobClientBuilder"}]," blobClientBuilder ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"BlobClientBuilder"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"109","children":["        ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"endpoint"}],["$","span",null,{"className":"token punctuation","children":"("}],"blobServiceEndpoint",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"110","children":["        ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"sasToken"}],["$","span",null,{"className":"token punctuation","children":"("}],"sasToken",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"111","children":["        ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"containerName"}],["$","span",null,{"className":"token punctuation","children":"("}],"containerName",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"112","children":["        ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"blobName"}],["$","span",null,{"className":"token punctuation","children":"("}],"blobName",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"113","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"114","children":["    ",["$","span",null,{"className":"token keyword","children":"try"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"115","children":["      blobClientBuilder",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"buildClient"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"upload"}],["$","span",null,{"className":"token punctuation","children":"("}],"image",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getInputStream"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," image",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getSize"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token boolean","children":"true"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"116","children":["      blobClientBuilder",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"buildClient"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setMetadata"}],["$","span",null,{"className":"token punctuation","children":"("}],"metadata",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"117","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}]," ",["$","span",null,{"className":"token keyword","children":"catch"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"IOException"}]," e",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"118","children":["      ",["$","span",null,{"className":"token keyword","children":"throw"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"RuntimeException"}],["$","span",null,{"className":"token punctuation","children":"("}],"e",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"119","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"120","children":["    blobClientBuilder",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"buildClient"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"121","children":["        ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setHttpHeaders"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"BlobHttpHeaders"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setContentType"}],["$","span",null,{"className":"token punctuation","children":"("}],"image",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getContentType"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"122","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"123","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," blobClientBuilder",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"buildClient"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getBlobUrl"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"124","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"125","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"126","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"127","children":["  ",["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"128","children":["$","span",null,{"className":"token doc-comment comment","children":"   * Delete a pizza by its id.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"129","children":["$","span",null,{"className":"token doc-comment comment","children":"   *\n"}]}],["$","span",null,{"className":"code-line line-number","line":"130","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"id"}]," the id\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"131","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@return"}]," the pizza\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"132","children":[["$","span",null,{"className":"token doc-comment comment","children":"   */"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"133","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@Transactional"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"134","children":["  ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"Pizza"}]," ",["$","span",null,{"className":"token function","children":"deletePizza"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"135","children":["    ",["$","span",null,{"className":"token class-name","children":"Pizza"}]," pizza ",["$","span",null,{"className":"token operator","children":"="}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],"id",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElse"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"136","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"pizza ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"137","children":["      ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"pizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getImageLocation"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"138","children":["        ",["$","span",null,{"className":"token function","children":"deleteImageFromBlob"}],["$","span",null,{"className":"token punctuation","children":"("}],"pizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getImageLocation"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"139","children":["      ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"140","children":["      pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"delete"}],["$","span",null,{"className":"token punctuation","children":"("}],"pizza",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"141","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"142","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," pizza",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"143","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"144","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"145","children":["  ",["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"146","children":["$","span",null,{"className":"token doc-comment comment","children":"   * Delete an image from the blob storage.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"147","children":["$","span",null,{"className":"token doc-comment comment","children":"   *\n"}]}],["$","span",null,{"className":"code-line line-number","line":"148","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"imageLocation"}]," the image location\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"149","children":[["$","span",null,{"className":"token doc-comment comment","children":"   */"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"150","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"deleteImageFromBlob"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"String"}]," imageLocation",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"151","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"imageLocation ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token keyword","children":"null"}]," ",["$","span",null,{"className":"token operator","children":"&&"}]," ",["$","span",null,{"className":"token operator","children":"!"}],"imageLocation",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"isEmpty"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"&&"}]," imageLocation",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"contains"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"152","children":["        blobServiceEndpoint",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"153","children":["      ",["$","span",null,{"className":"token class-name","children":"String"}]," blobName ",["$","span",null,{"className":"token operator","children":"="}]," imageLocation",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"substring"}],["$","span",null,{"className":"token punctuation","children":"("}],"imageLocation",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"lastIndexOf"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"/\""}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"+"}]," ",["$","span",null,{"className":"token number","children":"1"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"154","children":["      ",["$","span",null,{"className":"token class-name","children":"BlobClientBuilder"}]," blobClientBuilder ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"BlobClientBuilder"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"155","children":["          ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"endpoint"}],["$","span",null,{"className":"token punctuation","children":"("}],"blobServiceEndpoint",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"156","children":["          ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"sasToken"}],["$","span",null,{"className":"token punctuation","children":"("}],"sasToken",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"157","children":["          ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"containerName"}],["$","span",null,{"className":"token punctuation","children":"("}],"containerName",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"158","children":["          ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"blobName"}],["$","span",null,{"className":"token punctuation","children":"("}],"blobName",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"159","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"160","children":["      blobClientBuilder",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"buildClient"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"delete"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"161","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"162","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"163","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"164","children":["  ",["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"165","children":["$","span",null,{"className":"token doc-comment comment","children":"   * Update a pizza.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"166","children":["$","span",null,{"className":"token doc-comment comment","children":"   *\n"}]}],["$","span",null,{"className":"code-line line-number","line":"167","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"id"}],"       the id\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"168","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"newPizza"}]," the new pizza\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"169","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@return"}]," the pizza\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"170","children":[["$","span",null,{"className":"token doc-comment comment","children":"   */"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"171","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@Transactional"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"172","children":["  ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"Pizza"}]," ",["$","span",null,{"className":"token function","children":"updatePizza"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":"NewPizza"}]," newPizza",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"173","children":["    ",["$","span",null,{"className":"token class-name","children":"Pizza"}]," pizza ",["$","span",null,{"className":"token operator","children":"="}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],"id",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElse"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"174","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"pizza ",["$","span",null,{"className":"token operator","children":"=="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"175","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"176","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"177","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"178","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"newPizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"179","children":["      pizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],"newPizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"180","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"181","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"newPizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getContent"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"182","children":["      pizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setContent"}],["$","span",null,{"className":"token punctuation","children":"("}],"newPizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getContent"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"183","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"184","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"185","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"save"}],["$","span",null,{"className":"token punctuation","children":"("}],"pizza",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"186","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"187","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"188","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["Gr√¢ce √† ces ajouts minuscules, si par exemple l'op√©ration de sauvegarde de l'image √©choue, l'op√©ration de sauvegarde de la pizza ne sera pas ex√©cut√©e. En effet, si la fonction ",["$","strong",null,{"children":["$","code",null,{"children":"uploadImageToBlob"}]}]," l√®ve une exception, la transaction sera annul√©e et la pizza ne sera pas sauvegard√©e.",["$","br",null,{}],"\n","Nous n'avons pas r√©ellement besoin de transaction pour cette op√©ration, car la sauvegarde de la pizza ne se fait que si l'op√©ration de sauvegarde de l'image r√©ussit. N√©anmoins, nous pouvons facilement imaginer un sc√©nario o√π la transaction serait n√©cessaire, par exemple :"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"si nous devions sauvegarder la pizza avant de sauvegarder l'image."}],"\n",["$","li",null,{"children":"si nous devions d'abord sauvegarder les ingr√©dients de la pizza avant de sauvegarder la pizza, puis d'uploader l'image."}],"\n"]}],"\n",["$","p",null,{"children":"Dans ces cas, les transactions garantissent que toutes les op√©rations sur la DB sont ex√©cut√©es ou aucune op√©ration n'est ex√©cut√©e."}],"\n",["$","h2",null,{"children":"En savoir plus"}],"\n",["$","p",null,{"children":["Si vous souhaitez en savoir plus sur les transactions avec Spring Boot, vous pouvez consulter cet article : ",["$","a",null,{"href":"https://docs.spring.io/spring-framework/reference/data-access/transaction.html","children":"https://docs.spring.io/spring-framework/reference/data-access/transaction.html"}]]}],"\n",["$","h1",null,{"children":["$","a",null,{"id":"pourquoi_gerer_la_concurrence","children":" Pourquoi g√©rer la concurrence ? "}]}],"\n",["$","p",null,{"children":"La concurrence est un sujet important en informatique. En effet, de nombreux probl√®mes peuvent survenir si la concurrence n'est pas g√©r√©e correctement. Par exemple, si deux processus essaient de modifier la m√™me donn√©e en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es."}],"\n",["$","p",null,{"children":"Prenons l'exemple d'une application o√π l'on g√®re un stock de produits. Si deux utilisateurs essaient de modifier la quantit√© d'un produit en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es. Par exemple, si un utilisateur essaie d'ajouter 5 unit√©s √† la quantit√© d'un produit, et qu'un autre utilisateur essaie de retirer 3 unit√©s du m√™me produit en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es."}],"\n",["$","p",null,{"children":["NB : La concurrence pourrait entra√Æner des probl√®mes de performance si elle n'est pas g√©r√©e correctement. Par exemple, si plusieurs processus essaient d'acc√©der √† la m√™me ressource en m√™me temps, il peut y avoir des probl√®mes de latence et de ralentissement. N√©anmoins, nous ne devons g√©n√©ralement pas g√©rer ce type de probl√®me car cela est automatiquement trait√© par les frameworks que nous utilisons. En effet, en cas de multiples requ√™tes sur une m√™me ressource, le framework Spring Boot g√®re cela en cr√©ant un pool de threads pour traiter les requ√™tes. Comment √ßa fonctionne ?",["$","br",null,{}],"\n","Lorsqu'une requ√™te HTTP arrive, un thread est extrait du pool pour traiter cette requ√™te.",["$","br",null,{}],"\n","Une fois la requ√™te trait√©e, le thread est remis dans le pool pour √™tre r√©utilis√©.",["$","br",null,{}],"\n","Cela permet de limiter le nombre de threads actifs et d'√©viter de cr√©er un nouveau thread pour chaque requ√™te, ce qui serait co√ªteux en termes de performances."]}],"\n",["$","h1",null,{"children":["$","a",null,{"id":"comment_gerer_la_concurrence","children":" Comment g√©rer la concurrence ? "}]}],"\n",["$","h2",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"Il existe plusieurs fa√ßons de g√©rer la concurrence en informatique. Voici quelques-unes des techniques les plus courantes :"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Optimistic Locking"}]," : Cette technique consiste √† v√©rifier si la donn√©e a √©t√© modifi√©e par un autre processus avant de la modifier. Si la donn√©e a √©t√© modifi√©e, une exception est lev√©e et le processus doit g√©rer cette exception."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Pessimistic Locking"}]," : Cette technique consiste √† verrouiller la donn√©e avant de la modifier. Cela garantit qu'aucun autre processus ne peut modifier la donn√©e tant que le verrou n'est pas lib√©r√©."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Transactions"}]," : Comme vu pr√©c√©demment, les transactions sont un moyen de regrouper plusieurs op√©rations sur une base de donn√©es en une seule unit√© logique. Cela garantit que toutes les op√©rations sont ex√©cut√©es de mani√®re atomique, c'est-√†-dire que toutes les op√©rations sont ex√©cut√©es ou aucune op√©ration n'est ex√©cut√©e. Les transactions sont particuli√®rement utiles pour garantir la coh√©rence des donn√©es dans des sc√©narios de concurrence, sans pour autant r√©gler les probl√®mes de concurrence en eux-m√™mes."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Verrous distribu√©s"}]," : Les verrous distribu√©s peuvent √™tre utilis√©s pour coordonner l'acc√®s √† une ressource partag√©e entre plusieurs processus. Redis peut √™tre utilis√© pour ce genre d'applications. Des verrous peuvent √™tre utilis√©s pour garantir que seuls un certain nombre de processus peuvent acc√©der √† la ressource en m√™me temps. Cela est particuli√®rement utile dans des architectures distribu√©es, type microservices, o√π plusieurs instances doivent g√©rer une ressource partag√©e. Nous n'aborderons pas ce sujet dans ce cours, car notre application n'est pas distribu√©e."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"File de messages"}]," : Une file de messages (comme RabbitMQ ou Kafka) peut √™tre utilis√©e pour g√©rer la concurrence. Les messages sont envoy√©s √† une file, puis trait√©s par un ou plusieurs consommateurs. Cela permet de g√©rer la concurrence en s√©parant la production de la consommation de messages. Ce type de solution est particuli√®rement utile dans des architectures distribu√©es, o√π plusieurs instances doivent traiter des messages en parall√®le. Nous n'aborderons pas ce sujet dans ce cours."]}],"\n"]}],"\n",["$","h1",null,{"children":["$","a",null,{"id":"optimistic_locking_dans_spring_boot","children":" Optimistic Locking dans Spring Boot "}]}],"\n",["$","h2",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"L'optimistic locking repose sur l'id√©e que les conflits sont rares. Avant de mettre √† jour une donn√©e, on v√©rifie si elle a √©t√© modifi√©e par un autre processus en utilisant un champ de version."}],"\n",["$","p",null,{"children":"L'optimistic locking est id√©al pour les sc√©narios o√π les conflits sont peu fr√©quents, comme la mise √† jour d'un nom de produit ou la mise √† jour d'une quantit√© en stock, lorsque le stock est modifiable par un nombre limit√© d'utilisateurs."}],"\n",["$","p",null,{"children":"L'int√©r√™t de l'optimistic locking est qu'il n'y a pas de verrouillage de la ressource, ce qui permet √† plusieurs processus de lire la ressource en m√™me temps. Cela am√©liore les performances de l'application. Cependant, si un conflit survient, il faut g√©rer l'exception lev√©e par la base de donn√©es."}],"\n",["$","h2",null,{"children":"Bases pour l'optimistic locking"}],"\n",["$","p",null,{"children":"Voici un exemple d'optimistic locking en Java avec JPA :"}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Entity"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"Product"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@Id"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@GeneratedValue"}],["$","span",null,{"className":"token punctuation","children":"("}],"strategy ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token class-name","children":"GenerationType"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"IDENTITY"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"7","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," name",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"9","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"int"}]," quantity",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"11","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@Version"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"long"}]," version",["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token comment","children":"// Champ utilis√© pour l'optimistic locking"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"14","children":["    ",["$","span",null,{"className":"token comment","children":"// Getters et setters"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"15","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"17","children":[["$","span",null,{"className":"token comment","children":"// Partie du service pour mettre √† jour le stock d'un produit"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"18","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"19","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Transactional"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"20","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"updateStock"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Long"}]," productId",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"int"}]," quantityToRemove",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"21","children":["    ",["$","span",null,{"className":"token class-name","children":"Product"}]," product ",["$","span",null,{"className":"token operator","children":"="}]," productRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],"productId",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"22","children":["            ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElseThrow"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"->"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"RuntimeException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Produit non trouv√©\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"23","children":"    \n"}],["$","span",null,{"className":"code-line line-number","line":"24","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"<"}]," quantityToRemove",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"25","children":["        ",["$","span",null,{"className":"token keyword","children":"throw"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"RuntimeException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Stock insuffisant\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"26","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"27","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"28","children":["    product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"-"}]," quantityToRemove",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"29","children":["    productRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"save"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token comment","children":"// V√©rifie automatiquement la version"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"30","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["Dans cet exemple, le champ ",["$","strong",null,{"children":["$","code",null,{"children":"version"}]}]," est utilis√© pour l'optimistic locking. Lorsque la m√©thode ",["$","code",null,{"children":"save"}]," est appel√©e, JPA v√©rifie automatiquement si la version de l'entit√© en base de donn√©es correspond √† la version de l'entit√© en m√©moire. Si ce n'est pas le cas, une exception ",["$","strong",null,{"children":["$","code",null,{"children":"OptimisticLockException"}]}]," est lev√©e."]}],"\n",["$","p",null,{"children":[["$","strong",null,{"children":["$","code",null,{"children":"@Transactional"}]}]," : Cette annotation permet de d√©finir une m√©thode comme transactionnelle. Cela signifie que toutes les op√©rations effectu√©es dans cette m√©thode seront regroup√©es en une seule transaction. Ici, comme il n'y a qu'une seule op√©ration (la mise √† jour du stock), l'annotation ",["$","strong",null,{"children":["$","code",null,{"children":"@Transactional"}]}]," n'est pas strictement n√©cessaire, mais elle est recommand√©e pour des raisons de clart√©.",["$","br",null,{}],"\n","En effet, si vous ajoutez d'autres op√©rations de modification dans cette m√©thode, elles seront automatiquement incluses dans la transaction."]}],"\n",["$","p",null,{"children":"Ici l'on v√©rifie la version de l'entit√© en base de donn√©es au moment de la sauvegarde. Cela est suffisant pour g√©rer les conflits dans le cadre d'une op√©ration transactionnelle unique, si l'on imaginait que deux utilisateurs essaient de modifier la quantit√© d'un produit en m√™me temps."}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"children":["Attention : Le code donn√© pour l'optimistic locking dans l'exemple ci-dessus fonctionne bien dans le cadre d'une op√©ration transactionnelle unique, o√π la version est v√©rifi√©e au moment de l'ex√©cution de la m√©thode ",["$","strong",null,{"children":["$","code",null,{"children":"updateStock"}]}],". Cependant, dans le contexte d'une API RESTful, o√π les appels sont effectu√©s par des clients distincts (par exemple, deux requ√™tes HTTP s√©par√©es), ce code ne couvre pas le cas o√π la version doit √™tre v√©rifi√©e entre deux requ√™tes clientes, lorsqu'il y a une op√©ration de lecture suivie d'une op√©ration de mise √† jour. Nous verrons comment g√©rer ce cas dans la section suivante."]}],"\n"]}],"\n",["$","h2",null,{"children":"Exemple concret"}],"\n",["$","p",null,{"children":"Veuillez mettre √† jour votre projet GitLab contenant la gestion des Pizzas pour ajouter l'optimistic locking."}],"\n",["$","p",null,{"children":["üí≠ Quelle serait l'op√©ration la plus √©vidente qui pourrait √™tre sujet √† des probl√®mes de concurrence ?",["$","br",null,{}],"\n","L'op√©ration la plus √©vidente qui pourrait √™tre sujette √† des probl√®mes de concurrence est l'op√©ration de mise √† jour d'une pizza. En effet, si deux utilisateurs essaient de modifier la m√™me pizza en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es. Par exemple, si un utilisateur essaie de modifier le titre d'une pizza, et qu'un autre utilisateur essaie de modifier la description de la m√™me pizza en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es."]}],"\n",["$","p",null,{"children":["Pour ajouter l'optimistic locking √† notre application, nous devons ajouter un champ de version √† l'entit√© ",["$","strong",null,{"children":["$","code",null,{"children":"Pizza"}]}]," et utiliser cet attribut pour g√©rer les conflits de version lors de la mise √† jour d'une pizza."]}],"\n",["$","p",null,{"children":["Veuillez donc mettre √† jour l'entit√© ",["$","strong",null,{"children":["$","code",null,{"children":"Pizza"}]}]," pour ajouter un champ de version :"]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Entity"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Table"}],["$","span",null,{"className":"token punctuation","children":"("}],"name ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"pizzas\""}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Data"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":[["$","span",null,{"className":"token annotation punctuation","children":"@NoArgsConstructor"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"Pizza"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"7","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@Id"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@GeneratedValue"}],["$","span",null,{"className":"token punctuation","children":"("}],"strategy ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token class-name","children":"GenerationType"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"IDENTITY"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"11","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@Column"}],["$","span",null,{"className":"token punctuation","children":"("}],"nullable ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token boolean","children":"false"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," title",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"14","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@Column"}],["$","span",null,{"className":"token punctuation","children":"("}],"nullable ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token boolean","children":"false"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"15","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," content",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"17","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@Column"}],["$","span",null,{"className":"token punctuation","children":"("}],"nullable ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token boolean","children":"true"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"18","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," imageLocation",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"19","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"20","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@Version"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"21","children":["  ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"Long"}]," version",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"22","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["A l'aide du client HTTP d'IntelliJ, veuillez ajouter une pizza en ex√©cutant la requ√™te de cr√©ation de pizza contenant une image contenue dans le fichier ",["$","strong",null,{"children":["$","code",null,{"children":"/tests/java/pizzas.http"}]}],"."]}],"\n",["$","p",null,{"children":["Puis, via l'onglet ",["$","strong",null,{"children":["$","code",null,{"children":"Database"}]}]," d'IntelliJ, veuillez vous connecter √† votre DB local et v√©rifier que la pizza a bien √©t√© ajout√©e.",["$","br",null,{}],"\n","Vous devriez observer que la table ",["$","strong",null,{"children":["$","code",null,{"children":"Pizza"}]}]," de votre DB contient une nouvelle entr√©e avec un champ ",["$","strong",null,{"children":["$","code",null,{"children":"version"}]}]," initialis√© √† ",["$","strong",null,{"children":["$","code",null,{"children":"0"}]}],"."]}],"\n",["$","p",null,{"children":["A chaque op√©ration de mise √† jour d'une pizza, le champ ",["$","strong",null,{"children":["$","code",null,{"children":"version"}]}]," sera automatiquement incr√©ment√© par JPA."]}],"\n",["$","p",null,{"children":["Veuillez ex√©cuter la requ√™te de mise √† jour d'une pizza contenue dans le fichier ",["$","strong",null,{"children":["$","code",null,{"children":"/tests/java/pizzas.http"}]}],".",["$","br",null,{}],"\n","Vous devriez observer que la version de la pizza a √©t√© incr√©ment√©e dans la DB, passant de ",["$","strong",null,{"children":["$","code",null,{"children":"0"}]}]," √† ",["$","strong",null,{"children":["$","code",null,{"children":"1"}]}],"."]}],"\n",["$","p",null,{"children":["Il est difficile de simuler un conflit de version avec le client HTTP d'IntelliJ, car les requ√™tes sont ex√©cut√©es de mani√®re s√©quentielle.",["$","br",null,{}],"\n","Pour ce cours, nous ne simulerons pas de conflit de version, mais vous pouvez imaginer que si deux utilisateurs tentent de modifier la m√™me pizza en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.",["$","br",null,{}],"\n","Dans ce cas, voici le code d√©j√† existant de ",["$","strong",null,{"children":["$","code",null,{"children":"PizzaService"}]}]," qui va soulever une exception ",["$","strong",null,{"children":["$","code",null,{"children":"OptimisticLockException"}]}]," si la version de la pizza en m√©moire ne correspond pas √† la version de la pizza en base de donn√©es :"]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Transactional"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":["  ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"Pizza"}]," ",["$","span",null,{"className":"token function","children":"updatePizza"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":"NewPizza"}]," newPizza",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"3","children":["    ",["$","span",null,{"className":"token class-name","children":"Pizza"}]," pizza ",["$","span",null,{"className":"token operator","children":"="}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],"id",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElse"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"pizza ",["$","span",null,{"className":"token operator","children":"=="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"8","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"newPizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":["      pizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],"newPizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"newPizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getContent"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":["      pizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setContent"}],["$","span",null,{"className":"token punctuation","children":"("}],"newPizza",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getContent"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"15","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," pizzaRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"save"}],["$","span",null,{"className":"token punctuation","children":"("}],"pizza",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["En effet, lors du ",["$","strong",null,{"children":["$","code",null,{"children":"save"}]}]," de la pizza, JPA v√©rifie automatiquement si la version de la pizza en m√©moire (retourn√©e par ",["$","strong",null,{"children":["$","code",null,{"children":"pizzaRepository.findById(id).orElse(null)"}]}],") correspond √† la version de la pizza en base de donn√©es. Si ce n'est pas le cas, une exception ",["$","strong",null,{"children":["$","code",null,{"children":"OptimisticLockException"}]}]," est lev√©e car √ßa signifierait qu'un autre utilisateur aurait mis √† jour la pizza entre le moment du ",["$","strong",null,{"children":["$","code",null,{"children":"findById"}]}]," et du ",["$","strong",null,{"children":["$","code",null,{"children":"save"}]}],"."]}],"\n",["$","h2",null,{"children":"Optimistic locking dans une API RESTful avec lecture suivie d'une mise √† jour"}],"\n",["$","h3",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":["Dans une API RESTful, il est courant que le client effectue une requ√™te ",["$","strong",null,{"children":["$","code",null,{"children":"GET"}]}]," pour r√©cup√©rer une ressource, puis une requ√™te ",["$","strong",null,{"children":["$","code",null,{"children":"PUT"}]}]," ou ",["$","strong",null,{"children":["$","code",null,{"children":"PATCH"}]}]," pour la mettre √† jour. Dans ce cas, il est n√©cessaire de v√©rifier que la version de la ressource n'a pas chang√© entre les deux requ√™tes."]}],"\n",["$","p",null,{"children":"Par exemple, si l'on veut assurer que deux clients ne modifient pas en m√™me temps le nom d'un produit, on doit v√©rifier que la version du produit n'a pas chang√© entre la lecture et la mise √† jour. Car si un client lit le produit, puis un autre client modifie le produit, le premier client pourrait √©craser les modifications du second client sans le savoir."}],"\n",["$","h3",null,{"children":"Principes pour g√©rer l'optimistic locking dans une API RESTful avec lecture suivie d'une mise √† jour"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":["Ajouter le champ ",["$","strong",null,{"children":["$","code",null,{"children":"@Version"}]}]," dans l'entit√©",["$","br",null,{}],"\n","Le champ ",["$","strong",null,{"children":["$","code",null,{"children":"@Version"}]}]," est utilis√© pour g√©rer l'optimistic locking. JPA v√©rifie automatiquement ce champ lors de la sauvegarde."]}],"\n"]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Entity"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"Product"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@Id"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@GeneratedValue"}],["$","span",null,{"className":"token punctuation","children":"("}],"strategy ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token class-name","children":"GenerationType"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"IDENTITY"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"7","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token class-name","children":"String"}]," name",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"9","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"int"}]," quantity",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"11","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@Version"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"long"}]," version",["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token comment","children":"// Champ utilis√© pour l'optimistic locking"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"14","children":["    ",["$","span",null,{"className":"token comment","children":"// Getters et setters"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"15","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","ol",null,{"start":"2","children":["\n",["$","li",null,{"children":["Lecture de la ressource avec la version (GET)",["$","br",null,{}],"\n","Lorsqu'un client r√©cup√®re une ressource, incluez la version dans la r√©ponse pour qu'il puisse l'utiliser lors de la mise √† jour."]}],"\n"]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@GetMapping"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"/products/{id}\""}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"ProductDTO"}]," ",["$","span",null,{"className":"token function","children":"getProduct"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token annotation punctuation","children":"@PathVariable"}]," ",["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":["    ",["$","span",null,{"className":"token class-name","children":"Product"}]," product ",["$","span",null,{"className":"token operator","children":"="}]," productRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],"id",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["            ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElseThrow"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"->"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"RuntimeException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Produit non trouv√©\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"6","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"ProductDTO"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getId"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getName"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getVersion"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"9","children":[["$","span",null,{"className":"token comment","children":"// Code pour l'op√©ration de lecture d'un produit"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":[["$","span",null,{"className":"token annotation punctuation","children":"@GetMapping"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"/products/{id}\""}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"ProductDTO"}]," ",["$","span",null,{"className":"token function","children":"getProduct"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token annotation punctuation","children":"@PathVariable"}]," ",["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":["    ",["$","span",null,{"className":"token class-name","children":"Product"}]," product ",["$","span",null,{"className":"token operator","children":"="}]," productRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],"id",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":["            ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElseThrow"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"->"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"RuntimeException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Produit non trouv√©\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"15","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"ProductDTO"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getId"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getName"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getVersion"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","ol",null,{"start":"3","children":["\n",["$","li",null,{"children":["Mise √† jour de la ressource avec v√©rification de la version (PUT)",["$","br",null,{}],"\n","Lors de la mise √† jour, le client doit inclure la version qu'il a re√ßue dans la requ√™te. Si cette version ne correspond pas √† la version actuelle de la ressource, on d√©cide de lever une exception ",["$","strong",null,{"children":["$","code",null,{"children":"OptimisticLockException"}]}]," seulement si le nom du produit a √©t√© mis √† jour.",["$","br",null,{}],"\n","De plus, JPA effectue automatiquement la v√©rification de la version si le champ ",["$","strong",null,{"children":["$","code",null,{"children":"@Version"}]}]," est pr√©sent dans l'entit√© et que vous utilisez une m√©thode comme ",["$","strong",null,{"children":["$","code",null,{"children":"save()"}]}]," pour persister l'entit√©. Lorsque vous appelez ",["$","strong",null,{"children":["$","code",null,{"children":"productRepository.save(product)"}]}],", JPA compare la version de l'entit√© en m√©moire avec celle en base de donn√©es.",["$","br",null,{}],"\n","Si elles ne correspondent pas (par exemple, si un autre client a modifi√© la ressource entre-temps), une exception ",["$","strong",null,{"children":["$","code",null,{"children":"OptimisticLockException"}]}]," est aussi lev√©e."]}],"\n"]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token comment","children":"// Code pour l'op√©ration de mise √† jour d'un produit"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Transactional"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":[["$","span",null,{"className":"token annotation punctuation","children":"@PutMapping"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"/products/{id}\""}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"ResponseEntity"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"Void"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token function","children":"updateProduct"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token annotation punctuation","children":"@PathVariable"}]," ",["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token annotation punctuation","children":"@RequestBody"}]," ",["$","span",null,{"className":"token class-name","children":"UpdateProductRequest"}]," request",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["    ",["$","span",null,{"className":"token class-name","children":"Product"}]," product ",["$","span",null,{"className":"token operator","children":"="}]," productRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],"id",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":["            ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElseThrow"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"->"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"RuntimeException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Produit non trouv√©\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"8","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"<"}]," request",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getQuantityToRemove"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":["        ",["$","span",null,{"className":"token keyword","children":"throw"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"RuntimeException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Stock insuffisant\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"12","children":["    ",["$","span",null,{"className":"token comment","children":"// V√©rification explicite de la version "}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"13","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token operator","children":"!"}],"product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getVersion"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"equals"}],["$","span",null,{"className":"token punctuation","children":"("}],"request",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getVersion"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"14","children":["      ",["$","span",null,{"className":"token keyword","children":"if"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token operator","children":"!"}],"product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getName"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"equals"}],["$","span",null,{"className":"token punctuation","children":"("}],"request",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getName"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"15","children":["        ",["$","span",null,{"className":"token keyword","children":"throw"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"OptimisticLockException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Conflit de version d√©tect√© lors du changement de nom\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"16","children":["      ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"17","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"18","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"19","children":["    ",["$","span",null,{"className":"token comment","children":"// Mise √† jour du nom"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"20","children":["    product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setName"}],["$","span",null,{"className":"token punctuation","children":"("}],"request",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getName"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"21","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"22","children":["    ",["$","span",null,{"className":"token comment","children":"// Mise √† jour de la quantit√©"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"23","children":["    product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"+"}]," request",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getQuantityToRemove"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"24","children":["    productRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"save"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"25","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"26","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token class-name","children":"ResponseEntity"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"noContent"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"build"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"27","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"28","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"29","children":[["$","span",null,{"className":"token comment","children":"// Code pour UpdateProductRequest"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"30","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"UpdateProductRequest"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"31","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," string name",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"32","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"int"}]," quantityToRemove",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"33","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"long"}]," version",["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token comment","children":"// Version re√ßue lors de la lecture"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"34","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"35","children":["    ",["$","span",null,{"className":"token comment","children":"// Getters et setters"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"36","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","ol",null,{"start":"4","children":["\n",["$","li",null,{"children":"Gestion des conflits"}],"\n"]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token annotation punctuation","children":"@ControllerAdvice"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"GlobalExceptionHandler"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@ExceptionHandler"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"OptimisticLockException"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token keyword","children":"class"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"ResponseEntity"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"String"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token function","children":"handleOptimisticLockException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"OptimisticLockException"}]," ex",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token class-name","children":"ResponseEntity"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"status"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"HttpStatus"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"CONFLICT"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"body"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Conflit de version d√©tect√©\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["En cas de conflit de version, le gestionnaire global d'exceptions renvoie une r√©ponse ",["$","strong",null,{"children":["$","code",null,{"children":"409 Conflict"}]}]," au client."]}],"\n",["$","p",null,{"children":["Le client peut alors g√©rer ce cas en r√©cup√©rant √† nouveau la ressource, en affichant un message √† l'utilisateur ou en effectuant une autre action appropri√©e.",["$","br",null,{}],"\n","Notamment, en cas de tentative de modification du nom du produit, le client peut afficher un message √† l'utilisateur pour l'informer du conflit et lui demander de confirmer la modification."]}],"\n",["$","p",null,{"children":"Il faudrait bien s√ªr adapter ce code √† votre application, en fonction de vos besoins et de votre architecture. Par exemple, vous pourriez ajouter un champs pour g√©rer la confirmation de la modification du nom du produit, ou ajouter des informations suppl√©mentaires dans la r√©ponse pour aider le client √† g√©rer le conflit."}],"\n",["$","h2",null,{"children":"En savoir plus"}],"\n",["$","p",null,{"children":["Si vous souhaitez en savoir plus sur l'optimistic locking, vous pouvez consulter cet article : ",["$","a",null,{"href":"https://www.baeldung.com/jpa-optimistic-locking","children":"https://www.baeldung.com/jpa-optimistic-locking"}]]}],"\n",["$","h1",null,{"children":["$","a",null,{"id":"pessimistic_locking_dans_spring_boot","children":" Pessimistic Locking dans Spring Boot "}]}],"\n",["$","h2",null,{"children":"Introduction"}],"\n",["$","p",null,{"children":"Le pessimistic locking repose sur l'id√©e que les conflits sont fr√©quents. Avant de mettre √† jour une donn√©e, on verrouille la ressource pour emp√™cher tout autre processus de la modifier."}],"\n",["$","p",null,{"children":"Le pessimistic locking est id√©al pour les sc√©narios o√π les conflits sont fr√©quents, comme la mise √† jour d'un stock de produits lorsque le stock peut √™tre modifi√© par √©norm√©ment d'utilisateurs en m√™me temps."}],"\n",["$","h2",null,{"children":"Bases pour le pessimistic locking"}],"\n",["$","p",null,{"children":"Voici un exemple de pessimistic locking en Java avec JPA :"}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token comment","children":"// Partie du service pour mettre √† jour le stock d'un produit"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"2","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Transactional"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"updateStockWithPessimisticLock"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Long"}]," productId",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"int"}]," quantityToAdd",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["    ",["$","span",null,{"className":"token class-name","children":"Product"}]," product ",["$","span",null,{"className":"token operator","children":"="}]," productRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findByIdWithLock"}],["$","span",null,{"className":"token punctuation","children":"("}],"productId",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["            ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElseThrow"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"->"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"RuntimeException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Produit non trouv√©\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"7","children":["    product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"+"}]," quantityToAdd",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":["    productRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"save"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"11","children":[["$","span",null,{"className":"token comment","children":"// Repository"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"13","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Repository"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"interface"}]," ",["$","span",null,{"className":"token class-name","children":"ProductRepository"}]," ",["$","span",null,{"className":"token keyword","children":"extends"}]," ",["$","span",null,{"className":"token class-name","children":"CrudRepository"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"Product"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":"Long"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"15","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@Lock"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"LockModeType"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"PESSIMISTIC_WRITE"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":["    ",["$","span",null,{"className":"token class-name","children":"Optional"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"Product"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Long"}]," productId",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"17","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["Avec JPA, vous pouvez utiliser ",["$","strong",null,{"children":["$","code",null,{"children":"@Lock"}]}]," directement sur la m√©thode ",["$","strong",null,{"children":["$","code",null,{"children":"findById"}]}]," pour appliquer un verrou pessimiste sans avoir besoin d'une requ√™te personnalis√©e."]}],"\n",["$","p",null,{"children":[["$","strong",null,{"children":["$","code",null,{"children":"@Lock(LockModeType.PESSIMISTIC_WRITE)"}]}]," : Cette annotation permet d'appliquer un verrou pessimiste en √©criture sur la ressource. Cela signifie que la ressource est verrouill√©e pour emp√™cher tout autre processus de la modifier."]}],"\n",["$","p",null,{"children":["Dans cet exemple, le verrou pessimiste est appliqu√© lors de la recherche du produit √† mettre √† jour. Cela garantit qu'aucun autre processus ne peut modifier le produit tant que le verrou n'est pas lib√©r√©. A quel moment le verrou est-il lib√©r√© ? Le verrou est g√©n√©ralement lib√©r√© √† la fin de la transaction, c'est-√†-dire lorsque la m√©thode annot√©e avec ",["$","strong",null,{"children":["$","code",null,{"children":"@Transactional"}]}]," se termine."]}],"\n",["$","p",null,{"children":"Que se passe-t-il si un autre processus essaie de lire ou de modifier la ressource verrouill√©e ? Imaginons que 10 utilisateurs essaient de mettre √† jour le stock d'un produit en m√™me temps. Le premier utilisateur obtient le verrou et met √† jour le stock. Les 9 autres utilisateurs attendent que le verrou soit lib√©r√©. Une fois que le premier utilisateur a termin√©, le verrou est lib√©r√© et un des 9 autres utilisateurs obtient le verrou et met √† jour le stock. Les 8 autres utilisateurs attendent, et ainsi de suite."}],"\n",["$","h2",null,{"children":"Probl√®me √©ventuel de performance"}],"\n",["$","p",null,{"children":"Le pessimistic locking peut entra√Æner des probl√®mes de performance si les verrous sont maintenus trop longtemps. Par exemple, si un utilisateur obtient un verrou et met √† jour le stock, mais ne termine pas l'op√©ration, le verrou est maintenu et les autres utilisateurs doivent attendre. Cela peut entra√Æner des probl√®mes de latence et de ralentissement."}],"\n",["$","p",null,{"children":["Heureusement, si une exception est lev√©e, gr√¢ce √† la transaction ",["$","strong",null,{"children":["$","code",null,{"children":"@Transactional"}]}],", le verrou est automatiquement lib√©r√©."]}],"\n",["$","p",null,{"children":["Pour √©viter que les verrous ne soient maintenus trop longtemps, il est recommand√© de limiter la dur√©e des transactions en ajoutant un timeout. Par exemple, vous pouvez ajouter une annotation ",["$","strong",null,{"children":["$","code",null,{"children":"@Transactional(timeout = 10)"}]}]," pour limiter la dur√©e de la transaction √† 10 secondes. Si la transaction ne se termine pas dans les 10 secondes, une exception est lev√©e et le verrou est lib√©r√©."]}],"\n",["$","p",null,{"children":["Comment s'appelle l'exception lev√©e en cas de timeout ? L'exception lev√©e en cas de timeout est une ",["$","strong",null,{"children":["$","code",null,{"children":"TransactionTimedOutException"}]}],". Cette exception est lev√©e si la transaction ne se termine pas dans le d√©lai imparti."]}],"\n",["$","p",null,{"children":"Voici notre exemple de pessimistic locking avec un timeout :"}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number highlight-line","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Transactional"}],["$","span",null,{"className":"token punctuation","children":"("}],"timeout ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token number","children":"10"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"updateStockWithPessimisticLock"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Long"}]," productId",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"int"}]," quantityToAdd",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":["    ",["$","span",null,{"className":"token class-name","children":"Product"}]," product ",["$","span",null,{"className":"token operator","children":"="}]," productRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findByIdWithLock"}],["$","span",null,{"className":"token punctuation","children":"("}],"productId",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["            ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElseThrow"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"->"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"RuntimeException"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Produit non trouv√©\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"6","children":["    product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getQuantity"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"+"}]," quantityToAdd",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":["    productRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"save"}],["$","span",null,{"className":"token punctuation","children":"("}],"product",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"8","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"10","children":[["$","span",null,{"className":"token comment","children":"// Repository"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"12","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Repository"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"interface"}]," ",["$","span",null,{"className":"token class-name","children":"ProductRepository"}]," ",["$","span",null,{"className":"token keyword","children":"extends"}]," ",["$","span",null,{"className":"token class-name","children":"CrudRepository"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"Product"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":"Long"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":["    ",["$","span",null,{"className":"token annotation punctuation","children":"@Lock"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"LockModeType"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"PESSIMISTIC_WRITE"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"15","children":["    ",["$","span",null,{"className":"token class-name","children":"Optional"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"Product"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"Long"}]," productId",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"17","children":"\n"}]]}]}],"\n",["$","h2",null,{"children":"Exemple concret"}],"\n",["$","p",null,{"children":"Veuillez mettre √† jour votre projet GitLab contenant la gestion des Pizzas et des Boissons pour ajouter le pessimistic locking."}],"\n",["$","p",null,{"children":"Nous allons imaginer un sc√©nario un peu tir√© par les cheveux o√π 100 utilisateurs essaient en m√™me temps de modifier une boisson. Nous sommes d'accord que c'est peu probable, mais cela nous permettra de simuler un cas de pessimistic locking."}],"\n",["$","p",null,{"children":["Commen√ßons par mettre √† jour le repository ",["$","strong",null,{"children":["$","code",null,{"children":"DrinkRepository"}]}]," pour ajouter le pessimistic locking :"]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Repository"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token keyword","children":"interface"}]," ",["$","span",null,{"className":"token class-name","children":"DrinkRepository"}]," ",["$","span",null,{"className":"token keyword","children":"extends"}]," ",["$","span",null,{"className":"token class-name","children":"CrudRepository"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"Drink"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":"Long"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"3","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"4","children":["  ",["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["$","span",null,{"className":"token doc-comment comment","children":"   * Find all drinks with a price less than or equal to the given price.\n"}]}],["$","span",null,{"className":"code-line line-number","line":"6","children":["$","span",null,{"className":"token doc-comment comment","children":"   *\n"}]}],["$","span",null,{"className":"code-line line-number","line":"7","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"price"}]," the price\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"8","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@return"}]," the drinks\n"]}]}],["$","span",null,{"className":"code-line line-number","line":"9","children":[["$","span",null,{"className":"token doc-comment comment","children":"   */"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":["  ",["$","span",null,{"className":"token class-name","children":"Iterable"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"Drink"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token function","children":"findAllByPriceLessThanEqual"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"double"}]," price",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":"\n"}],["$","span",null,{"className":"code-line line-number highlight-line","line":"12","children":["  ",["$","span",null,{"className":"token doc-comment comment","children":"/**\n"}]]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"13","children":["$","span",null,{"className":"token doc-comment comment","children":"   * Find a drink by its id.\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"14","children":["$","span",null,{"className":"token doc-comment comment","children":"   *\n"}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"15","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@param"}]," ",["$","span",null,{"className":"token parameter","children":"id"}]," the id\n"]}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"16","children":["$","span",null,{"className":"token doc-comment comment","children":["   * ",["$","span",null,{"className":"token keyword","children":"@return"}]," the drink\n"]}]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"17","children":[["$","span",null,{"className":"token doc-comment comment","children":"   */"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"18","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@Override"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"19","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@NonNull"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"20","children":["  ",["$","span",null,{"className":"token annotation punctuation","children":"@Lock"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"LockModeType"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"PESSIMISTIC_WRITE"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"21","children":["  ",["$","span",null,{"className":"token class-name","children":"Optional"}],["$","span",null,{"className":"token generics","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"Drink"}],["$","span",null,{"className":"token punctuation","children":">"}]]}]," ",["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token annotation punctuation","children":"@NonNull"}]," ",["$","span",null,{"className":"token class-name","children":"Long"}]," id",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"22","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["Nous avons ajout√© l'annotation ",["$","strong",null,{"children":["$","code",null,{"children":"@Lock(LockModeType.PESSIMISTIC_WRITE)"}]}]," sur la m√©thode ",["$","strong",null,{"children":["$","code",null,{"children":"findById"}]}]," pour appliquer un verrou pessimiste en √©criture sur la ressource. Cela signifie que la ressource renvoy√©e par cette m√©thode est verrouill√©e pour emp√™cher tout autre processus de la modifier."]}],"\n",["$","p",null,{"children":["Ensuite, mettons √† jour le service ",["$","strong",null,{"children":["$","code",null,{"children":"DrinkService"}]}]," pour l'op√©ration de mise √† jour d'une boisson :"]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":[["$","span",null,{"className":"code-line line-number","line":"1","children":[["$","span",null,{"className":"token annotation punctuation","children":"@Transactional"}],["$","span",null,{"className":"token punctuation","children":"("}],"timeout ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token number","children":"10"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"2","children":["  ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token class-name","children":"Drink"}]," ",["$","span",null,{"className":"token function","children":"updateOneDrink"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"long"}]," id",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":"NewDrink"}]," newDrink",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"3","children":["    ",["$","span",null,{"className":"token class-name","children":"Drink"}]," drink ",["$","span",null,{"className":"token operator","children":"="}]," drinkRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"findById"}],["$","span",null,{"className":"token punctuation","children":"("}],"id",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"orElse"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"4","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"drink ",["$","span",null,{"className":"token operator","children":"=="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"5","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"6","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"7","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"8","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"newDrink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"9","children":["      drink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],"newDrink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getTitle"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"10","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"11","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"newDrink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getImage"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"12","children":["      drink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setImage"}],["$","span",null,{"className":"token punctuation","children":"("}],"newDrink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getImage"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"13","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"14","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"newDrink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getVolume"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":">"}]," ",["$","span",null,{"className":"token number","children":"0.0"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number highlight-line","line":"15","children":["      drink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setVolume"}],["$","span",null,{"className":"token punctuation","children":"("}],"newDrink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getVolume"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"16","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"17","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"newDrink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getPrice"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":">"}]," ",["$","span",null,{"className":"token number","children":"0.0"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"18","children":["      drink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"setPrice"}],["$","span",null,{"className":"token punctuation","children":"("}],"newDrink",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getPrice"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"19","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"20","children":"\n"}],["$","span",null,{"className":"code-line line-number","line":"21","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," drinkRepository",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"save"}],["$","span",null,{"className":"token punctuation","children":"("}],"drink",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line line-number","line":"22","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"children":["Attention, pour importer l'annotation ",["$","strong",null,{"children":["$","code",null,{"children":"@Transactional"}]}],", vous devez ajouter l'import de ",["$","strong",null,{"children":["$","code",null,{"children":"springframework"}]}]," et pas de ",["$","strong",null,{"children":["$","code",null,{"children":"jakarta"}]}]," :"]}],"\n"]}],"\n",["$","pre",null,{"className":"language-java","children":["$","code",null,{"className":"language-java code-highlight","children":["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token import","children":[["$","span",null,{"className":"token namespace","children":["org",["$","span",null,{"className":"token punctuation","children":"."}],"springframework",["$","span",null,{"className":"token punctuation","children":"."}],"transaction",["$","span",null,{"className":"token punctuation","children":"."}],"annotation",["$","span",null,{"className":"token punctuation","children":"."}]]}],["$","span",null,{"className":"token class-name","children":"Transactional"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]}]}],"\n",["$","p",null,{"children":["Nous avons ajout√© l'annotation ",["$","strong",null,{"children":["$","code",null,{"children":"@Transactional(timeout = 10)"}]}]," pour limiter la dur√©e de la transaction √† 10 secondes. Si la transaction ne se termine pas dans les 10 secondes, une exception ",["$","strong",null,{"children":["$","code",null,{"children":"TransactionTimedOutException"}]}]," est lev√©e et le verrou est lib√©r√©."]}],"\n",["$","p",null,{"children":["Via le client HTTP d'IntelliJ, nous ne pouvons pas simuler un cas de pessimistic locking, car les requ√™tes sont ex√©cut√©es de mani√®re s√©quentielle.",["$","br",null,{}],"\n","Pour ce cours, nous ne simulerons pas de cas de pessimistic locking, mais vous pouvez imaginer que si 100 utilisateurs tentent de modifier la m√™me boisson en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.",["$","br",null,{}],"\n","Ici le syst√®me de verrous assure que seul un utilisateur √† la fois peut modifier une boisson. Les autres utilisateurs doivent attendre que le verrou soit lib√©r√©.",["$","br",null,{}],"\n","Bien s√ªr, ce type de sc√©nario est peu probable dans la vraie vie, et est acceptable si l'on accepte que les donn√©es de la ressource puissent √™tre modifi√©es √† tour de r√¥le, garantissant la coh√©rence des donn√©es pour chaque modification, mais pas entre les modifications."]}],"\n",["$","p",null,{"children":"En effet, si un utilisateur modifie une boisson, puis un autre utilisateur modifie la m√™me boisson, la deuxi√®me modification √©crasera la premi√®re, sans que cela ne pose de probl√®me de coh√©rence des donn√©es."}],"\n",["$","p",null,{"children":"Mais qui d√©tient la v√©rit√© au niveau des donn√©es ? Le dernier utilisateur ? Si la r√©ponse √† cette question est oui, alors le pessimistic locking est une bonne solution. Si la r√©ponse est non, alors il faudra trouver une autre solution pour g√©rer la concurrence."}],"\n",["$","p",null,{"children":["üí≠ Quelle genre de solution ?",["$","br",null,{}],"\n","Une solution pourrait √™tre d'utiliser l'optimistic locking, qui permet de g√©rer les conflits de version entre les modifications de la ressource.  Il faudra alors renvoyer des codes HTTP d'erreurs aux utilisateurs qui tentent de modifier une ressource qui a √©t√© modifi√©e entre-temps, et leur demander de recharger la ressource pour obtenir la version la plus r√©cente."]}],"\n",["$","p",null,{"children":["Si n√©cessaire, vous pouvez trouver le code associ√© √† la gestion de transactions et de la concurrence ici : ",["$","a",null,{"href":"https://github.com/e-vinci/cae-theory-demos/tree/main/concurrency","children":"concurrency"}],"."]}],"\n",["$","h2",null,{"children":"En savoir plus"}],"\n",["$","p",null,{"children":["Si vous souhaitez en savoir plus sur le pessimistic locking, vous pouvez consulter cet article : ",["$","a",null,{"href":"https://www.baeldung.com/jpa-pessimistic-locking","children":"https://www.baeldung.com/jpa-pessimistic-locking"}]]}]]
11:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
f:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Concurrence"}]]
d:null
