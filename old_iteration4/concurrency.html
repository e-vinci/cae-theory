<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/f76bfe29b96cf8a1.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-b7059c8cc37787ef.js"/><script src="/_next/static/chunks/4bd1b696-1c20c52a7d48565d.js" async=""></script><script src="/_next/static/chunks/517-56c8ed8f1dd1ffbe.js" async=""></script><script src="/_next/static/chunks/main-app-67bb3b1da9f5c788.js" async=""></script><script src="/_next/static/chunks/537-32c52f136802c48f.js" async=""></script><script src="/_next/static/chunks/673-8f55286e245006fb.js" async=""></script><script src="/_next/static/chunks/app/layout-a557f0e5b59d7b71.js" async=""></script><script src="/_next/static/chunks/328-d02b7e1054113488.js" async=""></script><script src="/_next/static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js" async=""></script><title>CAE Course</title><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><title>Concurrence</title><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script><style data-emotion="mui-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-global 1o1x9wj">blockquote{border-left:5px solid #1976d2;background-color:rgba(0, 0, 0, 0.04);padding:0.5em;margin:1em 0;}table{width:100%;border-collapse:collapse;overflow-x:auto;display:block;}th{border:1px solid rgba(0, 0, 0, 0.12);padding:8px;background-color:#1976d2;color:#fff;font-weight:bold;}td{border:1px solid rgba(0, 0, 0, 0.12);padding:8px;}tr:nth-of-type(even){background-color:rgba(0, 0, 0, 0.04);}tr:hover{background-color:rgba(0, 0, 0, 0.08);}</style><style data-emotion="mui 1ru2rpl hjjbnr y50vno awgou1 tdg6lc 1mm3lge q7mezt 1myx5lw 130f8nx 6n7j50 mcfrop o34szc 1xdhyk6 13wylk3 1oz5b8u dnbkh3 0 5pbuzx 981n55 bxmwoh 20tnkx 1lkm1he 1gw0kg2 1uzdcm9 kxijxt wfm2y7 51eq8m 1ttcndq ub0mep 1nd5pgh ihsi0z 14rdsw0 fyswvn">.mui-1ru2rpl{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;margin:0px;}.mui-hjjbnr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;--AppBar-background:#1976d2;--AppBar-color:#fff;background-color:var(--AppBar-background);color:var(--AppBar-color);background-color:#1976d2;color:#fff;}.mui-y50vno{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:var(--Paper-shadow);background-image:var(--Paper-overlay);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;--AppBar-background:#1976d2;--AppBar-color:#fff;background-color:var(--AppBar-background);color:var(--AppBar-color);background-color:#1976d2;color:#fff;}.mui-awgou1{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.mui-awgou1{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.mui-awgou1{min-height:48px;}}}@media (min-width:600px){.mui-awgou1{min-height:64px;}}.mui-tdg6lc{text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);margin-left:-12px;color:inherit;margin-right:16px;}.mui-tdg6lc:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.mui-tdg6lc:hover{background-color:transparent;}}.mui-tdg6lc.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.mui-tdg6lc.MuiIconButton-loading{color:transparent;}.mui-1mm3lge{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);margin-left:-12px;color:inherit;margin-right:16px;}.mui-1mm3lge::-moz-focus-inner{border-style:none;}.mui-1mm3lge.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-1mm3lge{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-1mm3lge:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.mui-1mm3lge:hover{background-color:transparent;}}.mui-1mm3lge.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.mui-1mm3lge.MuiIconButton-loading{color:transparent;}.mui-q7mezt{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;}.mui-1myx5lw{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:1.25rem;line-height:1.6;letter-spacing:0.0075em;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}@media (min-width:600px){.mui-1myx5lw{display:block;}}@media (min-width:0px){.mui-130f8nx{display:none;}}@media (min-width:600px){.mui-130f8nx{display:block;}}.mui-6n7j50{display:inline;}.mui-mcfrop{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 16px;border:0;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;padding:6px 8px;color:var(--variant-textColor);background-color:var(--variant-textBg);color:inherit;border-color:currentColor;--variant-containedBg:#e0e0e0;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#fff;}.mui-mcfrop:hover{-webkit-text-decoration:none;text-decoration:none;}.mui-mcfrop.Mui-disabled{color:rgba(0, 0, 0, 0.26);}@media (hover: hover){.mui-mcfrop:hover{--variant-containedBg:#f5f5f5;--variant-textBg:rgba(0, 0, 0, 0.04);--variant-outlinedBg:rgba(0, 0, 0, 0.04);}}.mui-mcfrop.MuiButton-loading{color:transparent;}.mui-o34szc{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 16px;border:0;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;padding:6px 8px;color:var(--variant-textColor);background-color:var(--variant-textBg);color:inherit;border-color:currentColor;--variant-containedBg:#e0e0e0;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#fff;}.mui-o34szc::-moz-focus-inner{border-style:none;}.mui-o34szc.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-o34szc{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-o34szc:hover{-webkit-text-decoration:none;text-decoration:none;}.mui-o34szc.Mui-disabled{color:rgba(0, 0, 0, 0.26);}@media (hover: hover){.mui-o34szc:hover{--variant-containedBg:#f5f5f5;--variant-textBg:rgba(0, 0, 0, 0.04);--variant-outlinedBg:rgba(0, 0, 0, 0.04);}}.mui-o34szc.MuiButton-loading{color:transparent;}.mui-1oz5b8u{z-index:1200;}@media (min-width:0px){.mui-1oz5b8u{display:block;}}@media (min-width:600px){.mui-1oz5b8u{display:none;}}.mui-1oz5b8u .MuiDrawer-paper{box-sizing:border-box;width:240px;color:#fff;background-color:#1976d2;}.mui-dnbkh3{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;padding-left:16px;padding-right:16px;padding:1rem;word-wrap:break-word;-webkit-flex:1;-ms-flex:1;flex:1;}@media (min-width:600px){.mui-dnbkh3{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.mui-dnbkh3{max-width:1200px;}}.mui-5pbuzx{--Grid-columns:12;--Grid-columnSpacing:16px;--Grid-rowSpacing:16px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;min-width:0;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:var(--Grid-rowSpacing) var(--Grid-columnSpacing);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:#1976d2;color:#fff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:16px;}.mui-5pbuzx >*{--Grid-parent-columns:12;}.mui-5pbuzx >*{--Grid-parent-columnSpacing:16px;}.mui-5pbuzx >*{--Grid-parent-rowSpacing:16px;}.mui-981n55{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 12 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 12) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;text-align:center;}@media (min-width:900px){.mui-981n55{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 4 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 4) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}.mui-bxmwoh{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;}.mui-20tnkx{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 12 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 12) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;}@media (min-width:900px){.mui-20tnkx{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 4 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 4) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}.mui-1lkm1he{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;}@media (min-width:0px){.mui-1lkm1he{-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}}@media (min-width:900px){.mui-1lkm1he{-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}}.mui-1gw0kg2{text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);color:#fff;}.mui-1gw0kg2:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.mui-1gw0kg2:hover{background-color:transparent;}}.mui-1gw0kg2.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.mui-1gw0kg2.MuiIconButton-loading{color:transparent;}.mui-1uzdcm9{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);color:#fff;}.mui-1uzdcm9::-moz-focus-inner{border-style:none;}.mui-1uzdcm9.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-1uzdcm9{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-1uzdcm9:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.mui-1uzdcm9:hover{background-color:transparent;}}.mui-1uzdcm9.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.mui-1uzdcm9.MuiIconButton-loading{color:transparent;}.mui-kxijxt{list-style:none;margin:0;padding:0;position:relative;padding-top:8px;padding-bottom:8px;width:100%;border-radius:8px;border:1px solid;border-color:rgba(0, 0, 0, 0.12);padding:0.5rem;}.mui-wfm2y7{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:rgba(0, 0, 0, 0.6);}.mui-51eq8m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0;margin:0;list-style:none;}.mui-1ttcndq{-webkit-text-decoration:none;text-decoration:none;color:inherit;}.mui-1ttcndq:hover{-webkit-text-decoration:underline;text-decoration:underline;}.mui-ub0mep{margin:0;font:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;-webkit-text-decoration:none;text-decoration:none;color:inherit;}.mui-ub0mep:hover{-webkit-text-decoration:underline;text-decoration:underline;}.mui-1nd5pgh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin-left:8px;margin-right:8px;}.mui-ihsi0z{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;-webkit-text-decoration:none;text-decoration:none;width:100%;box-sizing:border-box;text-align:left;padding-top:8px;padding-bottom:8px;padding-left:16px;padding-right:16px;padding-top:0px;padding-bottom:0px;}.mui-14rdsw0{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;min-width:0;margin-top:4px;margin-bottom:4px;}.MuiTypography-root:where(.mui-14rdsw0 .MuiListItemText-primary){display:block;}.MuiTypography-root:where(.mui-14rdsw0 .MuiListItemText-secondary){display:block;}.mui-fyswvn{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}</style></head><body class="MuiBox-root mui-1ru2rpl"><header><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic mui-y50vno" style="--Paper-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12)"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular mui-awgou1"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-edgeStart MuiIconButton-sizeMedium mui-1mm3lge" tabindex="0" type="button" aria-label="open drawer"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"></path></svg></button><div class="MuiTypography-root MuiTypography-h6 mui-1myx5lw">CAE</div><div class="MuiBox-root mui-130f8nx"><div class="MuiBox-root mui-6n7j50"><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" href="/">Home</a></div><div class="MuiBox-root mui-6n7j50"><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" type="button">Partie 1</button></div><div class="MuiBox-root mui-6n7j50"><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" href="/about">About</a></div></div></div></header><nav></nav></header><div class="MuiContainer-root MuiContainer-maxWidthLg mui-dnbkh3"><ul class="MuiList-root MuiList-padding mui-kxijxt"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M14.59 8 12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41zM12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"></path></svg><nav class="MuiTypography-root MuiTypography-body1 MuiBreadcrumbs-root mui-wfm2y7" aria-label="breadcrumb"><ol class="MuiBreadcrumbs-ol mui-51eq8m"><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="/"> CAE </a></li><li aria-hidden="true" class="MuiBreadcrumbs-separator mui-1nd5pgh">/</li><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="/iteration3"> It√©ration 3 </a></li><li aria-hidden="true" class="MuiBreadcrumbs-separator mui-1nd5pgh">/</li><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#"> Gestion de transactions et de la concurrence </a></li></ol></nav><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_gerer_des_transactions_dans_spring_boot"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment g√©rer des transactions dans Spring Boot ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#pourquoi_gerer_la_concurrence"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Pourquoi g√©rer la concurrence ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_gerer_la_concurrence"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment g√©rer la concurrence ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#optimistic_locking_dans_spring_boot"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Optimistic Locking dans Spring Boot </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#pessimistic_locking_dans_spring_boot"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Pessimistic Locking dans Spring Boot </span></div></a></div></ul>
<h1><a id="comment_gerer_des_transactions_dans_spring_boot"> Comment g√©rer des transactions dans Spring Boot ? </a></h1>
<h2>Introduction</h2>
<p>Les transactions sont un moyen de regrouper plusieurs op√©rations en une seule unit√© logique. Cela garantit que toutes les op√©rations sont ex√©cut√©es de mani√®re atomique, c&#x27;est-√†-dire que toutes les op√©rations sont ex√©cut√©es ou aucune op√©ration n&#x27;est ex√©cut√©e.</p>
<p>Avec Spring Boot, vous pouvez g√©rer les transactions en utilisant l&#x27;annotation <strong><code>@Transactional</code></strong>. Cette annotation permet de d√©finir une m√©thode comme transactionnelle. Cela signifie que toutes les op√©rations sur la base de donn√©es effectu√©es dans cette m√©thode seront regroup√©es en une seule transaction.</p>
<p>Par exemple, si vous souhaitez ajouter une adresse √† un utilisateur, vous devez ajouter l&#x27;adresse et mettre √† jour l&#x27;utilisateur en m√™me temps. Si l&#x27;une des op√©rations √©choue, vous ne voulez pas que l&#x27;autre op√©ration soit ex√©cut√©e. Les transactions garantissent que les deux op√©rations sont ex√©cut√©es ensemble.</p>
<p>Si une exception est lev√©e dans une m√©thode annot√©e avec <strong><code>@Transactional</code></strong>, la transaction est automatiquement annul√©e et les op√©rations effectu√©es dans cette transaction sont annul√©es. Cela correspond √† un <strong><code>rollback</code></strong> au niveau de la base de donn√©es.
Cela garantit que les donn√©es restent coh√©rentes. Si tout se passe bien, la transaction est valid√©e et les op√©rations sont confirm√©es. Cela correspond √† un <strong><code>commit</code></strong> au niveau de la base de donn√©es.</p>
<p>Les transactions ne r√®glent pas les probl√®mes de concurrence que nous verrons plus tard. N√©anmoins, si les transactions sont coupl√©es √† la gestion de la concurrence (optimistic ou pessimistic locking trait√©s apr√®s la gestion des transactions), elles permettent de g√©rer les conflits de mani√®re plus robuste.</p>
<h2>Bases pour les transactions</h2>
<p>Voici un exemple de transaction en Java avec Spring Boot, lorsque nous avons un repository pour les utilisateurs et un repository pour les adresses.</p>
<p>Voici les entit√©s :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@Entity</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token annotation punctuation">@Id</span>
</span><span class="code-line line-number" line="4">    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">    <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="10">    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;address_id&quot;</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="11">    <span class="token keyword">private</span> <span class="token class-name">Address</span> address<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13">    <span class="token comment">// Getters et setters</span>
</span><span class="code-line line-number" line="14"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16"><span class="token annotation punctuation">@Entity</span>
</span><span class="code-line line-number" line="17"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="18">    <span class="token annotation punctuation">@Id</span>
</span><span class="code-line line-number" line="19">    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="20">    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="21">
</span><span class="code-line line-number" line="22">    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// Emp√™che les doublons d&#x27;adresses</span>
</span><span class="code-line line-number" line="23">    <span class="token keyword">private</span> <span class="token class-name">String</span> street<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="24">
</span><span class="code-line line-number" line="25">    <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="26">
</span><span class="code-line line-number" line="27">    <span class="token keyword">private</span> <span class="token class-name">String</span> postalCode<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="28">
</span><span class="code-line line-number" line="29">    <span class="token comment">// Getters et setters</span>
</span><span class="code-line line-number" line="30"><span class="token punctuation">}</span>
</span></code></pre>
<p>Voici les repositories :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@Repository</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3"><span class="token punctuation">}</span>
</span></code></pre>
<p>Voici les DTO pour les requ√™tes :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDTO</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword">private</span> <span class="token class-name">AddressDTO</span> address<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">    <span class="token comment">// Getters et setters</span>
</span><span class="code-line line-number" line="6"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressDTO</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">    <span class="token keyword">private</span> <span class="token class-name">String</span> street<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">    <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    <span class="token keyword">private</span> <span class="token class-name">String</span> postalCode<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13">    <span class="token comment">// Getters et setters</span>
</span><span class="code-line line-number" line="14"><span class="token punctuation">}</span>
</span></code></pre>
<p>Voici le contr√¥leur :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@RestController</span>
</span><span class="code-line line-number" line="2"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">    <span class="token keyword">public</span> <span class="token class-name">UserController</span><span class="token punctuation">(</span><span class="token class-name">UserService</span> userService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">        <span class="token keyword">this</span><span class="token punctuation">.</span>userService <span class="token operator">=</span> userService<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11">    <span class="token annotation punctuation">@PostMapping</span>
</span><span class="code-line line-number" line="12">    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">addUserWithAddress</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">UserDTO</span> userDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">addUserWithAddress</span><span class="token punctuation">(</span>userDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span>
</span></code></pre>
<p>Voici l&#x27;exception que nous souhaitons lancer pour une adresse d√©j√† existante :</p>
<pre class="language-java"><code class="language-Java code-highlight"><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressAlreadyExistsException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">AddressAlreadyExistsException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>Voici un service pour ajouter une adresse et un utilisateur :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@Service</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AddressRepository</span> addressRepository<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">    <span class="token keyword">public</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">,</span> <span class="token class-name">AddressRepository</span> addressRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">        <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository <span class="token operator">=</span> userRepository<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">        <span class="token keyword">this</span><span class="token punctuation">.</span>addressRepository <span class="token operator">=</span> addressRepository<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number highlight-line" line="12">    <span class="token annotation punctuation">@Transactional</span>
</span><span class="code-line line-number" line="13">    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">addUserWithAddress</span><span class="token punctuation">(</span><span class="token class-name">UserDTO</span> userDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="14">        <span class="token comment">// V√©rifier si l&#x27;adresse existe d√©j√†</span>
</span><span class="code-line line-number" line="15">        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span> existingAddress <span class="token operator">=</span> addressRepository<span class="token punctuation">.</span><span class="token function">findByStreetAndCityAndPostalCode</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="16">                userDTO<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStreet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="17">                userDTO<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="18">                userDTO<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPostalCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="19">        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="20">
</span><span class="code-line line-number" line="21">        <span class="token keyword">if</span> <span class="token punctuation">(</span>existingAddress<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="22">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AddressAlreadyExistsException</span><span class="token punctuation">(</span><span class="token string">&quot;L&#x27;adresse existe d√©j√† !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="23">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="24">
</span><span class="code-line line-number" line="25">        <span class="token comment">// Sauvegarder l&#x27;adresse</span>
</span><span class="code-line line-number" line="26">        <span class="token class-name">Address</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="27">        address<span class="token punctuation">.</span><span class="token function">setStreet</span><span class="token punctuation">(</span>userDTO<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStreet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="28">        address<span class="token punctuation">.</span><span class="token function">setCity</span><span class="token punctuation">(</span>userDTO<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="29">        address<span class="token punctuation">.</span><span class="token function">setPostalCode</span><span class="token punctuation">(</span>userDTO<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPostalCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="30">        addressRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="31">
</span><span class="code-line line-number" line="32">        <span class="token comment">// Sauvegarder l&#x27;utilisateur</span>
</span><span class="code-line line-number" line="33">        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="34">        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>userDTO<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="35">        user<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="36">        <span class="token keyword">return</span> userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Retourner l&#x27;utilisateur sauvegard√©</span>
</span><span class="code-line line-number" line="37">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="38"><span class="token punctuation">}</span>
</span></code></pre>
<blockquote>
<p>Ici la gestion des transactions est assur√©e par l&#x27;annotation <strong><code>@Transactional</code></strong> sur la m√©thode <strong><code>addUserWithAddress</code></strong>. Cela signifie que toutes les op√©rations effectu√©es dans cette m√©thode seront regroup√©es en une seule transaction. Cela garantit que toutes les op√©rations sont ex√©cut√©es de mani√®re atomique, c&#x27;est-√†-dire que toutes les op√©rations sont ex√©cut√©es ou aucune op√©ration n&#x27;est ex√©cut√©e.</p>
</blockquote>
<p>üí≠ Peux-tu imaginer une autre raison pour que JPA √©choue √† sauvegarder l&#x27;adresse ?<br/>
<!-- -->Normalement, JPA ne devrait pas √©chouer √† sauvegarder l&#x27;adresse, car normalement, dans le contr√¥leur, on est cens√© valider tous les param√®tres avant d&#x27;appeler le service.<br/>
<!-- -->Une fois l&#x27;adresse sauvegard√©e, on pourrait imaginer que l&#x27;on ne peut pas sauvegarder l&#x27;utilisateur. Par exemple, si l&#x27;utilisateur a d√©j√† √©t√© sauvegard√©, on ne peut pas le sauvegarder √† nouveau.<br/>
<!-- -->L&#x27;avantage de la transaction est que si l&#x27;une des op√©rations √©choue, l&#x27;autre op√©ration ne sera pas ex√©cut√©e. Cela garantit que les donn√©es restent coh√©rentes.<br/>
<!-- -->Bien s√ªr, pour rendre le code plus robuste et clair, il faudrait aussi v√©rifier si l&#x27;utilisateur existe d√©j√† avant de le sauvegarder.</p>
<p>üí≠ Est-ce que les transactions sont suffisantes dans cet exemple pour se prot√©ger contre les acc√®s concurrents ?<br/>
<!-- -->Si deux transactions distinctes tentent de sauvegarder la m√™me adresse ou le m√™me utilisateur en m√™me temps, il pourrait y avoir des conflits ou des incoh√©rences.<br/>
<!-- -->Cependant, l&#x27;optimistic ou le pessimistic locking (que nous verrons plus tard) n&#x27;est pas n√©cessaire ici car :</p>
<ul>
<li>La m√©thode <strong><code>save</code></strong> de JPA garantit que l&#x27;adresse ne sera pas dupliqu√©e si une contrainte d&#x27;unicit√© est d√©finie sur la colonne street (comme dans votre entit√© <strong><code>Address</code></strong> avec <strong><code>@Column(unique = true)</code></strong>).</li>
<li>Si deux transactions tentent de sauvegarder la m√™me adresse en m√™me temps, la base de donn√©es l√®vera une exception (par exemple, une <strong><code>ConstraintViolationException</code></strong>). La deuxi√®me transaction sera annul√©e, garantissant que l&#x27;adresse n&#x27;est pas dupliqu√©e.</li>
</ul>
<p>Et finalement, voici le gestionnaire global d&#x27;exceptions pour l&#x27;exception <strong><code>AddressAlreadyExistsException</code></strong> :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@ControllerAdvice</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">AddressAlreadyExistsException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleAddressAlreadyExistsException</span><span class="token punctuation">(</span><span class="token class-name">AddressAlreadyExistsException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ResponseStatusException</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">CONFLICT</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="10">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleGenericException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ResponseStatusException</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">,</span> <span class="token string">&quot;Une erreur est survenue : &quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="13"><span class="token punctuation">}</span>
</span></code></pre>
<p>Ici, le gestionnaire global d&#x27;exceptions renvoie une r√©ponse <strong><code>409 Conflict</code></strong> au client en cas d&#x27;exception <strong><code>AddressAlreadyExistsException</code></strong>. Cela signifie que si l&#x27;adresse existe d√©j√†, le client recevra une r√©ponse <strong><code>409 Conflict</code></strong>.</p>
<h2>Exemple concret</h2>
<p>Veuillez mettre √† jour votre projet GitLab contenant la gestion des Pizzas pour ajouter la gestion des transactions.</p>
<p>Il suffit de rajouter l&#x27;annotation <strong><code>@Transactional</code></strong> sur les m√©thodes de service qui effectuent des op√©rations de mise √† jour sur la base de donn√©es et qui d√©pendent du succ√®s d&#x27;autres op√©rations.</p>
<p>Par exemple, au niveau de l&#x27;API de gestion de pizzas, lorsque nous ajoutons, ou effa√ßons des pizzas, nous faisons des op√©rations au niveau d&#x27;Azure Storage pour stocker ou effacer les images des pizzas.<br/>
<!-- -->Si ces op√©rations √©chouent, nous ne voulons pas que les op√©rations de mise √† jour de la base de donn√©es soient ex√©cut√©es.<br/>
<!-- -->Veuillez donc mettre √† jour le service de gestion des pizzas nomm√© <strong><code>services/PizzaService</code></strong>.</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">package</span> <span class="token namespace">be<span class="token punctuation">.</span>vinci<span class="token punctuation">.</span>ipl<span class="token punctuation">.</span>cae<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>services</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">be<span class="token punctuation">.</span>vinci<span class="token punctuation">.</span>ipl<span class="token punctuation">.</span>cae<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>models<span class="token punctuation">.</span>dtos<span class="token punctuation">.</span></span><span class="token class-name">NewPizza</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">be<span class="token punctuation">.</span>vinci<span class="token punctuation">.</span>ipl<span class="token punctuation">.</span>cae<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>models<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Pizza</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">be<span class="token punctuation">.</span>vinci<span class="token punctuation">.</span>ipl<span class="token punctuation">.</span>cae<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>repositories<span class="token punctuation">.</span></span><span class="token class-name">PizzaRepository</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>azure<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>blob<span class="token punctuation">.</span></span><span class="token class-name">BlobClientBuilder</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>azure<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>blob<span class="token punctuation">.</span>models<span class="token punctuation">.</span></span><span class="token class-name">BlobHttpHeaders</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UUID</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17"><span class="token doc-comment comment">/**
</span></span><span class="code-line line-number" line="18"><span class="token doc-comment comment"> * Pizza service.
</span></span><span class="code-line line-number" line="19"><span class="token doc-comment comment"> */</span>
</span><span class="code-line line-number" line="20"><span class="token annotation punctuation">@Service</span>
</span><span class="code-line line-number" line="21"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PizzaService</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="22">
</span><span class="code-line line-number" line="23">  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PizzaRepository</span> pizzaRepository<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="24">  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> blobServiceEndpoint<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="25">  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> sasToken<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="26">  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> containerName<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="27">
</span><span class="code-line line-number" line="28">  <span class="token doc-comment comment">/**
</span></span><span class="code-line line-number" line="29"><span class="token doc-comment comment">   * Constructor.
</span></span><span class="code-line line-number" line="30"><span class="token doc-comment comment">   *
</span></span><span class="code-line line-number" line="31"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">pizzaRepository</span> the pizza repository
</span></span><span class="code-line line-number" line="32"><span class="token doc-comment comment">   */</span>
</span><span class="code-line line-number" line="33">  <span class="token keyword">public</span> <span class="token class-name">PizzaService</span><span class="token punctuation">(</span><span class="token class-name">PizzaRepository</span> pizzaRepository<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="34">      <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${azure.blob.service-endpoint}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> blobServiceEndpoint<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="35">      <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${azure.blob.sas-token}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> sasToken<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="36">      <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${azure.blob.container-name}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> containerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="37">    <span class="token keyword">this</span><span class="token punctuation">.</span>pizzaRepository <span class="token operator">=</span> pizzaRepository<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="38">    <span class="token keyword">this</span><span class="token punctuation">.</span>blobServiceEndpoint <span class="token operator">=</span> blobServiceEndpoint<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="39">    <span class="token keyword">this</span><span class="token punctuation">.</span>sasToken <span class="token operator">=</span> sasToken<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="40">    <span class="token keyword">this</span><span class="token punctuation">.</span>containerName <span class="token operator">=</span> containerName<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="41">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="42">
</span><span class="code-line line-number" line="43">  <span class="token doc-comment comment">/**
</span></span><span class="code-line line-number" line="44"><span class="token doc-comment comment">   * Read all pizzas.
</span></span><span class="code-line line-number" line="45"><span class="token doc-comment comment">   *
</span></span><span class="code-line line-number" line="46"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">order</span> if order contains &quot;title&quot; the pizzas will be ordered by title in ascending order
</span></span><span class="code-line line-number" line="47"><span class="token doc-comment comment">   *              if order contains &quot;-title&quot; the pizzas will be ordered by title in descending
</span></span><span class="code-line line-number" line="48"><span class="token doc-comment comment">   *              order.
</span></span><span class="code-line line-number" line="49"><span class="token doc-comment comment">   * <span class="token keyword">@return</span> the pizzas
</span></span><span class="code-line line-number" line="50"><span class="token doc-comment comment">   */</span>
</span><span class="code-line line-number" line="51">  <span class="token keyword">public</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pizza</span><span class="token punctuation">&gt;</span></span> <span class="token function">readAllPizzas</span><span class="token punctuation">(</span><span class="token class-name">String</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="52">    <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>order<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="53">      <span class="token keyword">return</span> pizzaRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="54">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="55">
</span><span class="code-line line-number" line="56">    <span class="token keyword">if</span> <span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="57">      <span class="token keyword">return</span> pizzaRepository<span class="token punctuation">.</span><span class="token function">findAllByOrderByTitleDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="58">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="59">    <span class="token keyword">return</span> pizzaRepository<span class="token punctuation">.</span><span class="token function">findAllByOrderByTitleAsc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="60">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="61">
</span><span class="code-line line-number" line="62">  <span class="token doc-comment comment">/**
</span></span><span class="code-line line-number" line="63"><span class="token doc-comment comment">   * Read a pizza by its id.
</span></span><span class="code-line line-number" line="64"><span class="token doc-comment comment">   *
</span></span><span class="code-line line-number" line="65"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">id</span> the id
</span></span><span class="code-line line-number" line="66"><span class="token doc-comment comment">   * <span class="token keyword">@return</span> the pizza
</span></span><span class="code-line line-number" line="67"><span class="token doc-comment comment">   */</span>
</span><span class="code-line line-number" line="68">  <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">readPizzaById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="69">    <span class="token keyword">return</span> pizzaRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="70">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="71">
</span><span class="code-line line-number" line="72">  <span class="token doc-comment comment">/**
</span></span><span class="code-line line-number" line="73"><span class="token doc-comment comment">   * Create a pizza.
</span></span><span class="code-line line-number" line="74"><span class="token doc-comment comment">   *
</span></span><span class="code-line line-number" line="75"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">newPizza</span> the new pizza
</span></span><span class="code-line line-number" line="76"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">image</span>    the image
</span></span><span class="code-line line-number" line="77"><span class="token doc-comment comment">   * <span class="token keyword">@return</span> the pizza
</span></span><span class="code-line line-number" line="78"><span class="token doc-comment comment">   */</span>
</span><span class="code-line line-number highlight-line" line="79">  <span class="token annotation punctuation">@Transactional</span>
</span><span class="code-line line-number" line="80">  <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">createPizza</span><span class="token punctuation">(</span><span class="token class-name">NewPizza</span> newPizza<span class="token punctuation">,</span> <span class="token class-name">MultipartFile</span> image<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="81">    <span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="82">    pizza<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>newPizza<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="83">    pizza<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>newPizza<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="84">
</span><span class="code-line line-number" line="85">    <span class="token keyword">if</span> <span class="token punctuation">(</span>image <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>image<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="86">      <span class="token class-name">String</span> blobUrl <span class="token operator">=</span> <span class="token function">uploadImageToBlob</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="87">      pizza<span class="token punctuation">.</span><span class="token function">setImageLocation</span><span class="token punctuation">(</span>blobUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="88">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="89">
</span><span class="code-line line-number" line="90">    <span class="token keyword">return</span> pizzaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>pizza<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="91">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="92">
</span><span class="code-line line-number" line="93">  <span class="token doc-comment comment">/**
</span></span><span class="code-line line-number" line="94"><span class="token doc-comment comment">   * Upload an image to a blob on Azure storage with a generated UUID as filename. The image is
</span></span><span class="code-line line-number" line="95"><span class="token doc-comment comment">   * uploaded to the &quot;images&quot; folder. The original filename is stored in the metadata.
</span></span><span class="code-line line-number" line="96"><span class="token doc-comment comment">   *
</span></span><span class="code-line line-number" line="97"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">image</span>
</span></span><span class="code-line line-number" line="98"><span class="token doc-comment comment">   * <span class="token keyword">@return</span> the blob url
</span></span><span class="code-line line-number" line="99"><span class="token doc-comment comment">   * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
</span></span><span class="code-line line-number" line="100"><span class="token doc-comment comment">   */</span>
</span><span class="code-line line-number" line="101">  <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">uploadImageToBlob</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> image<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="102">    <span class="token class-name">String</span> imageUUID <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="103">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> metadata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="104">
</span><span class="code-line line-number" line="105">    <span class="token class-name">String</span> blobName <span class="token operator">=</span> imageUUID<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="106">
</span><span class="code-line line-number" line="107">    metadata<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;originalFileName&quot;</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="108">    <span class="token class-name">BlobClientBuilder</span> blobClientBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlobClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="109">        <span class="token punctuation">.</span><span class="token function">endpoint</span><span class="token punctuation">(</span>blobServiceEndpoint<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="110">        <span class="token punctuation">.</span><span class="token function">sasToken</span><span class="token punctuation">(</span>sasToken<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="111">        <span class="token punctuation">.</span><span class="token function">containerName</span><span class="token punctuation">(</span>containerName<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="112">        <span class="token punctuation">.</span><span class="token function">blobName</span><span class="token punctuation">(</span>blobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="113">
</span><span class="code-line line-number" line="114">    <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="115">      blobClientBuilder<span class="token punctuation">.</span><span class="token function">buildClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="116">      blobClientBuilder<span class="token punctuation">.</span><span class="token function">buildClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMetadata</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="117">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="118">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="119">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="120">    blobClientBuilder<span class="token punctuation">.</span><span class="token function">buildClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="121">        <span class="token punctuation">.</span><span class="token function">setHttpHeaders</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlobHttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="122">
</span><span class="code-line line-number" line="123">    <span class="token keyword">return</span> blobClientBuilder<span class="token punctuation">.</span><span class="token function">buildClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBlobUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="124">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="125">
</span><span class="code-line line-number" line="126">
</span><span class="code-line line-number" line="127">  <span class="token doc-comment comment">/**
</span></span><span class="code-line line-number" line="128"><span class="token doc-comment comment">   * Delete a pizza by its id.
</span></span><span class="code-line line-number" line="129"><span class="token doc-comment comment">   *
</span></span><span class="code-line line-number" line="130"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">id</span> the id
</span></span><span class="code-line line-number" line="131"><span class="token doc-comment comment">   * <span class="token keyword">@return</span> the pizza
</span></span><span class="code-line line-number" line="132"><span class="token doc-comment comment">   */</span>
</span><span class="code-line line-number highlight-line" line="133">  <span class="token annotation punctuation">@Transactional</span>
</span><span class="code-line line-number" line="134">  <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">deletePizza</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="135">    <span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> pizzaRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="136">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pizza <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="137">      <span class="token keyword">if</span> <span class="token punctuation">(</span>pizza<span class="token punctuation">.</span><span class="token function">getImageLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="138">        <span class="token function">deleteImageFromBlob</span><span class="token punctuation">(</span>pizza<span class="token punctuation">.</span><span class="token function">getImageLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="139">      <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="140">      pizzaRepository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>pizza<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="141">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="142">    <span class="token keyword">return</span> pizza<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="143">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="144">
</span><span class="code-line line-number" line="145">  <span class="token doc-comment comment">/**
</span></span><span class="code-line line-number" line="146"><span class="token doc-comment comment">   * Delete an image from the blob storage.
</span></span><span class="code-line line-number" line="147"><span class="token doc-comment comment">   *
</span></span><span class="code-line line-number" line="148"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">imageLocation</span> the image location
</span></span><span class="code-line line-number" line="149"><span class="token doc-comment comment">   */</span>
</span><span class="code-line line-number" line="150">  <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">deleteImageFromBlob</span><span class="token punctuation">(</span><span class="token class-name">String</span> imageLocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="151">    <span class="token keyword">if</span> <span class="token punctuation">(</span>imageLocation <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>imageLocation<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> imageLocation<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="152">        blobServiceEndpoint<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="153">      <span class="token class-name">String</span> blobName <span class="token operator">=</span> imageLocation<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>imageLocation<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="154">      <span class="token class-name">BlobClientBuilder</span> blobClientBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlobClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="155">          <span class="token punctuation">.</span><span class="token function">endpoint</span><span class="token punctuation">(</span>blobServiceEndpoint<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="156">          <span class="token punctuation">.</span><span class="token function">sasToken</span><span class="token punctuation">(</span>sasToken<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="157">          <span class="token punctuation">.</span><span class="token function">containerName</span><span class="token punctuation">(</span>containerName<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="158">          <span class="token punctuation">.</span><span class="token function">blobName</span><span class="token punctuation">(</span>blobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="159">
</span><span class="code-line line-number" line="160">      blobClientBuilder<span class="token punctuation">.</span><span class="token function">buildClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="161">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="162">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="163">
</span><span class="code-line line-number" line="164">  <span class="token doc-comment comment">/**
</span></span><span class="code-line line-number" line="165"><span class="token doc-comment comment">   * Update a pizza.
</span></span><span class="code-line line-number" line="166"><span class="token doc-comment comment">   *
</span></span><span class="code-line line-number" line="167"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">id</span>       the id
</span></span><span class="code-line line-number" line="168"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">newPizza</span> the new pizza
</span></span><span class="code-line line-number" line="169"><span class="token doc-comment comment">   * <span class="token keyword">@return</span> the pizza
</span></span><span class="code-line line-number" line="170"><span class="token doc-comment comment">   */</span>
</span><span class="code-line line-number highlight-line" line="171">  <span class="token annotation punctuation">@Transactional</span>
</span><span class="code-line line-number" line="172">  <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">updatePizza</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">NewPizza</span> newPizza<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="173">    <span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> pizzaRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="174">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pizza <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="175">      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="176">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="177">
</span><span class="code-line line-number" line="178">    <span class="token keyword">if</span> <span class="token punctuation">(</span>newPizza<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="179">      pizza<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>newPizza<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="180">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="181">    <span class="token keyword">if</span> <span class="token punctuation">(</span>newPizza<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="182">      pizza<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>newPizza<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="183">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="184">
</span><span class="code-line line-number" line="185">    <span class="token keyword">return</span> pizzaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>pizza<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="186">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="187">
</span><span class="code-line line-number" line="188"><span class="token punctuation">}</span>
</span></code></pre>
<p>Gr√¢ce √† ces ajouts minuscules, si par exemple l&#x27;op√©ration de sauvegarde de l&#x27;image √©choue, l&#x27;op√©ration de sauvegarde de la pizza ne sera pas ex√©cut√©e. En effet, si la fonction <strong><code>uploadImageToBlob</code></strong> l√®ve une exception, la transaction sera annul√©e et la pizza ne sera pas sauvegard√©e.<br/>
<!-- -->Nous n&#x27;avons pas r√©ellement besoin de transaction pour cette op√©ration, car la sauvegarde de la pizza ne se fait que si l&#x27;op√©ration de sauvegarde de l&#x27;image r√©ussit. N√©anmoins, nous pouvons facilement imaginer un sc√©nario o√π la transaction serait n√©cessaire, par exemple :</p>
<ul>
<li>si nous devions sauvegarder la pizza avant de sauvegarder l&#x27;image.</li>
<li>si nous devions d&#x27;abord sauvegarder les ingr√©dients de la pizza avant de sauvegarder la pizza, puis d&#x27;uploader l&#x27;image.</li>
</ul>
<p>Dans ces cas, les transactions garantissent que toutes les op√©rations sur la DB sont ex√©cut√©es ou aucune op√©ration n&#x27;est ex√©cut√©e.</p>
<h2>En savoir plus</h2>
<p>Si vous souhaitez en savoir plus sur les transactions avec Spring Boot, vous pouvez consulter cet article : <a href="https://docs.spring.io/spring-framework/reference/data-access/transaction.html">https://docs.spring.io/spring-framework/reference/data-access/transaction.html</a></p>
<h1><a id="pourquoi_gerer_la_concurrence"> Pourquoi g√©rer la concurrence ? </a></h1>
<p>La concurrence est un sujet important en informatique. En effet, de nombreux probl√®mes peuvent survenir si la concurrence n&#x27;est pas g√©r√©e correctement. Par exemple, si deux processus essaient de modifier la m√™me donn√©e en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.</p>
<p>Prenons l&#x27;exemple d&#x27;une application o√π l&#x27;on g√®re un stock de produits. Si deux utilisateurs essaient de modifier la quantit√© d&#x27;un produit en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es. Par exemple, si un utilisateur essaie d&#x27;ajouter 5 unit√©s √† la quantit√© d&#x27;un produit, et qu&#x27;un autre utilisateur essaie de retirer 3 unit√©s du m√™me produit en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.</p>
<p>NB : La concurrence pourrait entra√Æner des probl√®mes de performance si elle n&#x27;est pas g√©r√©e correctement. Par exemple, si plusieurs processus essaient d&#x27;acc√©der √† la m√™me ressource en m√™me temps, il peut y avoir des probl√®mes de latence et de ralentissement. N√©anmoins, nous ne devons g√©n√©ralement pas g√©rer ce type de probl√®me car cela est automatiquement trait√© par les frameworks que nous utilisons. En effet, en cas de multiples requ√™tes sur une m√™me ressource, le framework Spring Boot g√®re cela en cr√©ant un pool de threads pour traiter les requ√™tes. Comment √ßa fonctionne ?<br/>
<!-- -->Lorsqu&#x27;une requ√™te HTTP arrive, un thread est extrait du pool pour traiter cette requ√™te.<br/>
<!-- -->Une fois la requ√™te trait√©e, le thread est remis dans le pool pour √™tre r√©utilis√©.<br/>
<!-- -->Cela permet de limiter le nombre de threads actifs et d&#x27;√©viter de cr√©er un nouveau thread pour chaque requ√™te, ce qui serait co√ªteux en termes de performances.</p>
<h1><a id="comment_gerer_la_concurrence"> Comment g√©rer la concurrence ? </a></h1>
<h2>Introduction</h2>
<p>Il existe plusieurs fa√ßons de g√©rer la concurrence en informatique. Voici quelques-unes des techniques les plus courantes :</p>
<ul>
<li><strong>Optimistic Locking</strong> : Cette technique consiste √† v√©rifier si la donn√©e a √©t√© modifi√©e par un autre processus avant de la modifier. Si la donn√©e a √©t√© modifi√©e, une exception est lev√©e et le processus doit g√©rer cette exception.</li>
<li><strong>Pessimistic Locking</strong> : Cette technique consiste √† verrouiller la donn√©e avant de la modifier. Cela garantit qu&#x27;aucun autre processus ne peut modifier la donn√©e tant que le verrou n&#x27;est pas lib√©r√©.</li>
<li><strong>Transactions</strong> : Comme vu pr√©c√©demment, les transactions sont un moyen de regrouper plusieurs op√©rations sur une base de donn√©es en une seule unit√© logique. Cela garantit que toutes les op√©rations sont ex√©cut√©es de mani√®re atomique, c&#x27;est-√†-dire que toutes les op√©rations sont ex√©cut√©es ou aucune op√©ration n&#x27;est ex√©cut√©e. Les transactions sont particuli√®rement utiles pour garantir la coh√©rence des donn√©es dans des sc√©narios de concurrence, sans pour autant r√©gler les probl√®mes de concurrence en eux-m√™mes.</li>
<li><strong>Verrous distribu√©s</strong> : Les verrous distribu√©s peuvent √™tre utilis√©s pour coordonner l&#x27;acc√®s √† une ressource partag√©e entre plusieurs processus. Redis peut √™tre utilis√© pour ce genre d&#x27;applications. Des verrous peuvent √™tre utilis√©s pour garantir que seuls un certain nombre de processus peuvent acc√©der √† la ressource en m√™me temps. Cela est particuli√®rement utile dans des architectures distribu√©es, type microservices, o√π plusieurs instances doivent g√©rer une ressource partag√©e. Nous n&#x27;aborderons pas ce sujet dans ce cours, car notre application n&#x27;est pas distribu√©e.</li>
<li><strong>File de messages</strong> : Une file de messages (comme RabbitMQ ou Kafka) peut √™tre utilis√©e pour g√©rer la concurrence. Les messages sont envoy√©s √† une file, puis trait√©s par un ou plusieurs consommateurs. Cela permet de g√©rer la concurrence en s√©parant la production de la consommation de messages. Ce type de solution est particuli√®rement utile dans des architectures distribu√©es, o√π plusieurs instances doivent traiter des messages en parall√®le. Nous n&#x27;aborderons pas ce sujet dans ce cours.</li>
</ul>
<h1><a id="optimistic_locking_dans_spring_boot"> Optimistic Locking dans Spring Boot </a></h1>
<h2>Introduction</h2>
<p>L&#x27;optimistic locking repose sur l&#x27;id√©e que les conflits sont rares. Avant de mettre √† jour une donn√©e, on v√©rifie si elle a √©t√© modifi√©e par un autre processus en utilisant un champ de version.</p>
<p>L&#x27;optimistic locking est id√©al pour les sc√©narios o√π les conflits sont peu fr√©quents, comme la mise √† jour d&#x27;un nom de produit ou la mise √† jour d&#x27;une quantit√© en stock, lorsque le stock est modifiable par un nombre limit√© d&#x27;utilisateurs.</p>
<p>L&#x27;int√©r√™t de l&#x27;optimistic locking est qu&#x27;il n&#x27;y a pas de verrouillage de la ressource, ce qui permet √† plusieurs processus de lire la ressource en m√™me temps. Cela am√©liore les performances de l&#x27;application. Cependant, si un conflit survient, il faut g√©rer l&#x27;exception lev√©e par la base de donn√©es.</p>
<h2>Bases pour l&#x27;optimistic locking</h2>
<p>Voici un exemple d&#x27;optimistic locking en Java avec JPA :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@Entity</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token annotation punctuation">@Id</span>
</span><span class="code-line line-number" line="4">    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">    <span class="token keyword">private</span> <span class="token keyword">int</span> quantity<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number highlight-line" line="11">    <span class="token annotation punctuation">@Version</span>
</span><span class="code-line line-number" line="12">    <span class="token keyword">private</span> <span class="token keyword">long</span> version<span class="token punctuation">;</span> <span class="token comment">// Champ utilis√© pour l&#x27;optimistic locking</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">    <span class="token comment">// Getters et setters</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17"><span class="token comment">// Partie du service pour mettre √† jour le stock d&#x27;un produit</span>
</span><span class="code-line line-number" line="18">
</span><span class="code-line line-number highlight-line" line="19"><span class="token annotation punctuation">@Transactional</span>
</span><span class="code-line line-number" line="20"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateStock</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token keyword">int</span> quantityToRemove<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="21">    <span class="token class-name">Product</span> product <span class="token operator">=</span> productRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>productId<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="22">            <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Produit non trouv√©&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="23">    
</span><span class="code-line line-number" line="24">    <span class="token keyword">if</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> quantityToRemove<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="25">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Stock insuffisant&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="26">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="27">
</span><span class="code-line line-number" line="28">    product<span class="token punctuation">.</span><span class="token function">setQuantity</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> quantityToRemove<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number highlight-line" line="29">    productRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// V√©rifie automatiquement la version</span>
</span><span class="code-line line-number" line="30"><span class="token punctuation">}</span>
</span></code></pre>
<p>Dans cet exemple, le champ <strong><code>version</code></strong> est utilis√© pour l&#x27;optimistic locking. Lorsque la m√©thode <code>save</code> est appel√©e, JPA v√©rifie automatiquement si la version de l&#x27;entit√© en base de donn√©es correspond √† la version de l&#x27;entit√© en m√©moire. Si ce n&#x27;est pas le cas, une exception <strong><code>OptimisticLockException</code></strong> est lev√©e.</p>
<p><strong><code>@Transactional</code></strong> : Cette annotation permet de d√©finir une m√©thode comme transactionnelle. Cela signifie que toutes les op√©rations effectu√©es dans cette m√©thode seront regroup√©es en une seule transaction. Ici, comme il n&#x27;y a qu&#x27;une seule op√©ration (la mise √† jour du stock), l&#x27;annotation <strong><code>@Transactional</code></strong> n&#x27;est pas strictement n√©cessaire, mais elle est recommand√©e pour des raisons de clart√©.<br/>
<!-- -->En effet, si vous ajoutez d&#x27;autres op√©rations de modification dans cette m√©thode, elles seront automatiquement incluses dans la transaction.</p>
<p>Ici l&#x27;on v√©rifie la version de l&#x27;entit√© en base de donn√©es au moment de la sauvegarde. Cela est suffisant pour g√©rer les conflits dans le cadre d&#x27;une op√©ration transactionnelle unique, si l&#x27;on imaginait que deux utilisateurs essaient de modifier la quantit√© d&#x27;un produit en m√™me temps.</p>
<blockquote>
<p>Attention : Le code donn√© pour l&#x27;optimistic locking dans l&#x27;exemple ci-dessus fonctionne bien dans le cadre d&#x27;une op√©ration transactionnelle unique, o√π la version est v√©rifi√©e au moment de l&#x27;ex√©cution de la m√©thode <strong><code>updateStock</code></strong>. Cependant, dans le contexte d&#x27;une API RESTful, o√π les appels sont effectu√©s par des clients distincts (par exemple, deux requ√™tes HTTP s√©par√©es), ce code ne couvre pas le cas o√π la version doit √™tre v√©rifi√©e entre deux requ√™tes clientes, lorsqu&#x27;il y a une op√©ration de lecture suivie d&#x27;une op√©ration de mise √† jour. Nous verrons comment g√©rer ce cas dans la section suivante.</p>
</blockquote>
<h2>Exemple concret</h2>
<p>Veuillez mettre √† jour votre projet GitLab contenant la gestion des Pizzas pour ajouter l&#x27;optimistic locking.</p>
<p>üí≠ Quelle serait l&#x27;op√©ration la plus √©vidente qui pourrait √™tre sujet √† des probl√®mes de concurrence ?<br/>
<!-- -->L&#x27;op√©ration la plus √©vidente qui pourrait √™tre sujette √† des probl√®mes de concurrence est l&#x27;op√©ration de mise √† jour d&#x27;une pizza. En effet, si deux utilisateurs essaient de modifier la m√™me pizza en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es. Par exemple, si un utilisateur essaie de modifier le titre d&#x27;une pizza, et qu&#x27;un autre utilisateur essaie de modifier la description de la m√™me pizza en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.</p>
<p>Pour ajouter l&#x27;optimistic locking √† notre application, nous devons ajouter un champ de version √† l&#x27;entit√© <strong><code>Pizza</code></strong> et utiliser cet attribut pour g√©rer les conflits de version lors de la mise √† jour d&#x27;une pizza.</p>
<p>Veuillez donc mettre √† jour l&#x27;entit√© <strong><code>Pizza</code></strong> pour ajouter un champ de version :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@Entity</span>
</span><span class="code-line line-number" line="2"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;pizzas&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="3"><span class="token annotation punctuation">@Data</span>
</span><span class="code-line line-number" line="4"><span class="token annotation punctuation">@NoArgsConstructor</span>
</span><span class="code-line line-number" line="5"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pizza</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">  <span class="token annotation punctuation">@Id</span>
</span><span class="code-line line-number" line="8">  <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="9">  <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11">  <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="12">  <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">  <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="15">  <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">  <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="18">  <span class="token keyword">private</span> <span class="token class-name">String</span> imageLocation<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="19">
</span><span class="code-line line-number highlight-line" line="20">  <span class="token annotation punctuation">@Version</span>
</span><span class="code-line line-number" line="21">  <span class="token keyword">private</span> <span class="token class-name">Long</span> version<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="22"><span class="token punctuation">}</span>
</span></code></pre>
<p>A l&#x27;aide du client HTTP d&#x27;IntelliJ, veuillez ajouter une pizza en ex√©cutant la requ√™te de cr√©ation de pizza contenant une image contenue dans le fichier <strong><code>/tests/java/pizzas.http</code></strong>.</p>
<p>Puis, via l&#x27;onglet <strong><code>Database</code></strong> d&#x27;IntelliJ, veuillez vous connecter √† votre DB local et v√©rifier que la pizza a bien √©t√© ajout√©e.<br/>
<!-- -->Vous devriez observer que la table <strong><code>Pizza</code></strong> de votre DB contient une nouvelle entr√©e avec un champ <strong><code>version</code></strong> initialis√© √† <strong><code>0</code></strong>.</p>
<p>A chaque op√©ration de mise √† jour d&#x27;une pizza, le champ <strong><code>version</code></strong> sera automatiquement incr√©ment√© par JPA.</p>
<p>Veuillez ex√©cuter la requ√™te de mise √† jour d&#x27;une pizza contenue dans le fichier <strong><code>/tests/java/pizzas.http</code></strong>.<br/>
<!-- -->Vous devriez observer que la version de la pizza a √©t√© incr√©ment√©e dans la DB, passant de <strong><code>0</code></strong> √† <strong><code>1</code></strong>.</p>
<p>Il est difficile de simuler un conflit de version avec le client HTTP d&#x27;IntelliJ, car les requ√™tes sont ex√©cut√©es de mani√®re s√©quentielle.<br/>
<!-- -->Pour ce cours, nous ne simulerons pas de conflit de version, mais vous pouvez imaginer que si deux utilisateurs tentent de modifier la m√™me pizza en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.<br/>
<!-- -->Dans ce cas, voici le code d√©j√† existant de <strong><code>PizzaService</code></strong> qui va soulever une exception <strong><code>OptimisticLockException</code></strong> si la version de la pizza en m√©moire ne correspond pas √† la version de la pizza en base de donn√©es :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@Transactional</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">updatePizza</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">NewPizza</span> newPizza<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number highlight-line" line="3">    <span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> pizzaRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pizza <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8">    <span class="token keyword">if</span> <span class="token punctuation">(</span>newPizza<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">      pizza<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>newPizza<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="11">    <span class="token keyword">if</span> <span class="token punctuation">(</span>newPizza<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">      pizza<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>newPizza<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="14">
</span><span class="code-line line-number highlight-line" line="15">    <span class="token keyword">return</span> pizzaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>pizza<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">  <span class="token punctuation">}</span>
</span></code></pre>
<p>En effet, lors du <strong><code>save</code></strong> de la pizza, JPA v√©rifie automatiquement si la version de la pizza en m√©moire (retourn√©e par <strong><code>pizzaRepository.findById(id).orElse(null)</code></strong>) correspond √† la version de la pizza en base de donn√©es. Si ce n&#x27;est pas le cas, une exception <strong><code>OptimisticLockException</code></strong> est lev√©e car √ßa signifierait qu&#x27;un autre utilisateur aurait mis √† jour la pizza entre le moment du <strong><code>findById</code></strong> et du <strong><code>save</code></strong>.</p>
<h2>Optimistic locking dans une API RESTful avec lecture suivie d&#x27;une mise √† jour</h2>
<h3>Introduction</h3>
<p>Dans une API RESTful, il est courant que le client effectue une requ√™te <strong><code>GET</code></strong> pour r√©cup√©rer une ressource, puis une requ√™te <strong><code>PUT</code></strong> ou <strong><code>PATCH</code></strong> pour la mettre √† jour. Dans ce cas, il est n√©cessaire de v√©rifier que la version de la ressource n&#x27;a pas chang√© entre les deux requ√™tes.</p>
<p>Par exemple, si l&#x27;on veut assurer que deux clients ne modifient pas en m√™me temps le nom d&#x27;un produit, on doit v√©rifier que la version du produit n&#x27;a pas chang√© entre la lecture et la mise √† jour. Car si un client lit le produit, puis un autre client modifie le produit, le premier client pourrait √©craser les modifications du second client sans le savoir.</p>
<h3>Principes pour g√©rer l&#x27;optimistic locking dans une API RESTful avec lecture suivie d&#x27;une mise √† jour</h3>
<ol>
<li>Ajouter le champ <strong><code>@Version</code></strong> dans l&#x27;entit√©<br/>
<!-- -->Le champ <strong><code>@Version</code></strong> est utilis√© pour g√©rer l&#x27;optimistic locking. JPA v√©rifie automatiquement ce champ lors de la sauvegarde.</li>
</ol>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@Entity</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token annotation punctuation">@Id</span>
</span><span class="code-line line-number" line="4">    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">    <span class="token keyword">private</span> <span class="token keyword">int</span> quantity<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number highlight-line" line="11">    <span class="token annotation punctuation">@Version</span>
</span><span class="code-line line-number" line="12">    <span class="token keyword">private</span> <span class="token keyword">long</span> version<span class="token punctuation">;</span> <span class="token comment">// Champ utilis√© pour l&#x27;optimistic locking</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">    <span class="token comment">// Getters et setters</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span>
</span></code></pre>
<ol start="2">
<li>Lecture de la ressource avec la version (GET)<br/>
<!-- -->Lorsqu&#x27;un client r√©cup√®re une ressource, incluez la version dans la r√©ponse pour qu&#x27;il puisse l&#x27;utiliser lors de la mise √† jour.</li>
</ol>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/products/{id}&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">public</span> <span class="token class-name">ProductDTO</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token class-name">Product</span> product <span class="token operator">=</span> productRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">            <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Produit non trouv√©&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProductDTO</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> product<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> product<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9"><span class="token comment">// Code pour l&#x27;op√©ration de lecture d&#x27;un produit</span>
</span><span class="code-line line-number" line="10"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/products/{id}&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="11"><span class="token keyword">public</span> <span class="token class-name">ProductDTO</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">    <span class="token class-name">Product</span> product <span class="token operator">=</span> productRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="13">            <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Produit non trouv√©&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">
</span><span class="code-line line-number highlight-line" line="15">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProductDTO</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> product<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> product<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16"><span class="token punctuation">}</span>
</span></code></pre>
<ol start="3">
<li>Mise √† jour de la ressource avec v√©rification de la version (PUT)<br/>
<!-- -->Lors de la mise √† jour, le client doit inclure la version qu&#x27;il a re√ßue dans la requ√™te. Si cette version ne correspond pas √† la version actuelle de la ressource, on d√©cide de lever une exception <strong><code>OptimisticLockException</code></strong> seulement si le nom du produit a √©t√© mis √† jour.<br/>
<!-- -->De plus, JPA effectue automatiquement la v√©rification de la version si le champ <strong><code>@Version</code></strong> est pr√©sent dans l&#x27;entit√© et que vous utilisez une m√©thode comme <strong><code>save()</code></strong> pour persister l&#x27;entit√©. Lorsque vous appelez <strong><code>productRepository.save(product)</code></strong>, JPA compare la version de l&#x27;entit√© en m√©moire avec celle en base de donn√©es.<br/>
<!-- -->Si elles ne correspondent pas (par exemple, si un autre client a modifi√© la ressource entre-temps), une exception <strong><code>OptimisticLockException</code></strong> est aussi lev√©e.</li>
</ol>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// Code pour l&#x27;op√©ration de mise √† jour d&#x27;un produit</span>
</span><span class="code-line line-number" line="2"><span class="token annotation punctuation">@Transactional</span>
</span><span class="code-line line-number" line="3"><span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/products/{id}&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4"><span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">updateProduct</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">UpdateProductRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token class-name">Product</span> product <span class="token operator">=</span> productRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="6">            <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Produit non trouv√©&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8">    <span class="token keyword">if</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> request<span class="token punctuation">.</span><span class="token function">getQuantityToRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Stock insuffisant&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">    <span class="token comment">// V√©rification explicite de la version </span>
</span><span class="code-line line-number highlight-line" line="13">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>product<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number highlight-line" line="14">      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number highlight-line" line="15">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OptimisticLockException</span><span class="token punctuation">(</span><span class="token string">&quot;Conflit de version d√©tect√© lors du changement de nom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number highlight-line" line="16">      <span class="token punctuation">}</span>
</span><span class="code-line line-number highlight-line" line="17">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="18">
</span><span class="code-line line-number" line="19">    <span class="token comment">// Mise √† jour du nom</span>
</span><span class="code-line line-number" line="20">    product<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="21">
</span><span class="code-line line-number" line="22">    <span class="token comment">// Mise √† jour de la quantit√©</span>
</span><span class="code-line line-number" line="23">    product<span class="token punctuation">.</span><span class="token function">setQuantity</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getQuantityToRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="24">    productRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="25">
</span><span class="code-line line-number" line="26">    <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">noContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="27"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="28">
</span><span class="code-line line-number" line="29"><span class="token comment">// Code pour UpdateProductRequest</span>
</span><span class="code-line line-number" line="30"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateProductRequest</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="31">    <span class="token keyword">private</span> string name<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="32">    <span class="token keyword">private</span> <span class="token keyword">int</span> quantityToRemove<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="33">    <span class="token keyword">private</span> <span class="token keyword">long</span> version<span class="token punctuation">;</span> <span class="token comment">// Version re√ßue lors de la lecture</span>
</span><span class="code-line line-number" line="34">
</span><span class="code-line line-number" line="35">    <span class="token comment">// Getters et setters</span>
</span><span class="code-line line-number" line="36"><span class="token punctuation">}</span>
</span></code></pre>
<ol start="4">
<li>Gestion des conflits</li>
</ol>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line"><span class="token annotation punctuation">@ControllerAdvice</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">OptimisticLockException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleOptimisticLockException</span><span class="token punctuation">(</span><span class="token class-name">OptimisticLockException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">CONFLICT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">&quot;Conflit de version d√©tect√©&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>En cas de conflit de version, le gestionnaire global d&#x27;exceptions renvoie une r√©ponse <strong><code>409 Conflict</code></strong> au client.</p>
<p>Le client peut alors g√©rer ce cas en r√©cup√©rant √† nouveau la ressource, en affichant un message √† l&#x27;utilisateur ou en effectuant une autre action appropri√©e.<br/>
<!-- -->Notamment, en cas de tentative de modification du nom du produit, le client peut afficher un message √† l&#x27;utilisateur pour l&#x27;informer du conflit et lui demander de confirmer la modification.</p>
<p>Il faudrait bien s√ªr adapter ce code √† votre application, en fonction de vos besoins et de votre architecture. Par exemple, vous pourriez ajouter un champs pour g√©rer la confirmation de la modification du nom du produit, ou ajouter des informations suppl√©mentaires dans la r√©ponse pour aider le client √† g√©rer le conflit.</p>
<h2>En savoir plus</h2>
<p>Si vous souhaitez en savoir plus sur l&#x27;optimistic locking, vous pouvez consulter cet article : <a href="https://www.baeldung.com/jpa-optimistic-locking">https://www.baeldung.com/jpa-optimistic-locking</a></p>
<h1><a id="pessimistic_locking_dans_spring_boot"> Pessimistic Locking dans Spring Boot </a></h1>
<h2>Introduction</h2>
<p>Le pessimistic locking repose sur l&#x27;id√©e que les conflits sont fr√©quents. Avant de mettre √† jour une donn√©e, on verrouille la ressource pour emp√™cher tout autre processus de la modifier.</p>
<p>Le pessimistic locking est id√©al pour les sc√©narios o√π les conflits sont fr√©quents, comme la mise √† jour d&#x27;un stock de produits lorsque le stock peut √™tre modifi√© par √©norm√©ment d&#x27;utilisateurs en m√™me temps.</p>
<h2>Bases pour le pessimistic locking</h2>
<p>Voici un exemple de pessimistic locking en Java avec JPA :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// Partie du service pour mettre √† jour le stock d&#x27;un produit</span>
</span><span class="code-line line-number highlight-line" line="2"><span class="token annotation punctuation">@Transactional</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateStockWithPessimisticLock</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token keyword">int</span> quantityToAdd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">    <span class="token class-name">Product</span> product <span class="token operator">=</span> productRepository<span class="token punctuation">.</span><span class="token function">findByIdWithLock</span><span class="token punctuation">(</span>productId<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">            <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Produit non trouv√©&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">    product<span class="token punctuation">.</span><span class="token function">setQuantity</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> quantityToAdd<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">    productRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11"><span class="token comment">// Repository</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13"><span class="token annotation punctuation">@Repository</span>
</span><span class="code-line line-number" line="14"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ProductRepository</span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number highlight-line" line="15">    <span class="token annotation punctuation">@Lock</span><span class="token punctuation">(</span><span class="token class-name">LockModeType</span><span class="token punctuation">.</span><span class="token constant">PESSIMISTIC_WRITE</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="16">    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="17"><span class="token punctuation">}</span>
</span></code></pre>
<p>Avec JPA, vous pouvez utiliser <strong><code>@Lock</code></strong> directement sur la m√©thode <strong><code>findById</code></strong> pour appliquer un verrou pessimiste sans avoir besoin d&#x27;une requ√™te personnalis√©e.</p>
<p><strong><code>@Lock(LockModeType.PESSIMISTIC_WRITE)</code></strong> : Cette annotation permet d&#x27;appliquer un verrou pessimiste en √©criture sur la ressource. Cela signifie que la ressource est verrouill√©e pour emp√™cher tout autre processus de la modifier.</p>
<p>Dans cet exemple, le verrou pessimiste est appliqu√© lors de la recherche du produit √† mettre √† jour. Cela garantit qu&#x27;aucun autre processus ne peut modifier le produit tant que le verrou n&#x27;est pas lib√©r√©. A quel moment le verrou est-il lib√©r√© ? Le verrou est g√©n√©ralement lib√©r√© √† la fin de la transaction, c&#x27;est-√†-dire lorsque la m√©thode annot√©e avec <strong><code>@Transactional</code></strong> se termine.</p>
<p>Que se passe-t-il si un autre processus essaie de lire ou de modifier la ressource verrouill√©e ? Imaginons que 10 utilisateurs essaient de mettre √† jour le stock d&#x27;un produit en m√™me temps. Le premier utilisateur obtient le verrou et met √† jour le stock. Les 9 autres utilisateurs attendent que le verrou soit lib√©r√©. Une fois que le premier utilisateur a termin√©, le verrou est lib√©r√© et un des 9 autres utilisateurs obtient le verrou et met √† jour le stock. Les 8 autres utilisateurs attendent, et ainsi de suite.</p>
<h2>Probl√®me √©ventuel de performance</h2>
<p>Le pessimistic locking peut entra√Æner des probl√®mes de performance si les verrous sont maintenus trop longtemps. Par exemple, si un utilisateur obtient un verrou et met √† jour le stock, mais ne termine pas l&#x27;op√©ration, le verrou est maintenu et les autres utilisateurs doivent attendre. Cela peut entra√Æner des probl√®mes de latence et de ralentissement.</p>
<p>Heureusement, si une exception est lev√©e, gr√¢ce √† la transaction <strong><code>@Transactional</code></strong>, le verrou est automatiquement lib√©r√©.</p>
<p>Pour √©viter que les verrous ne soient maintenus trop longtemps, il est recommand√© de limiter la dur√©e des transactions en ajoutant un timeout. Par exemple, vous pouvez ajouter une annotation <strong><code>@Transactional(timeout = 10)</code></strong> pour limiter la dur√©e de la transaction √† 10 secondes. Si la transaction ne se termine pas dans les 10 secondes, une exception est lev√©e et le verrou est lib√©r√©.</p>
<p>Comment s&#x27;appelle l&#x27;exception lev√©e en cas de timeout ? L&#x27;exception lev√©e en cas de timeout est une <strong><code>TransactionTimedOutException</code></strong>. Cette exception est lev√©e si la transaction ne se termine pas dans le d√©lai imparti.</p>
<p>Voici notre exemple de pessimistic locking avec un timeout :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number highlight-line" line="1"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateStockWithPessimisticLock</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token keyword">int</span> quantityToAdd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token class-name">Product</span> product <span class="token operator">=</span> productRepository<span class="token punctuation">.</span><span class="token function">findByIdWithLock</span><span class="token punctuation">(</span>productId<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">            <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Produit non trouv√©&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6">    product<span class="token punctuation">.</span><span class="token function">setQuantity</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> quantityToAdd<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">    productRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10"><span class="token comment">// Repository</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12"><span class="token annotation punctuation">@Repository</span>
</span><span class="code-line line-number" line="13"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ProductRepository</span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="14">    <span class="token annotation punctuation">@Lock</span><span class="token punctuation">(</span><span class="token class-name">LockModeType</span><span class="token punctuation">.</span><span class="token constant">PESSIMISTIC_WRITE</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="15">    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="17">
</span></code></pre>
<h2>Exemple concret</h2>
<p>Veuillez mettre √† jour votre projet GitLab contenant la gestion des Pizzas et des Boissons pour ajouter le pessimistic locking.</p>
<p>Nous allons imaginer un sc√©nario un peu tir√© par les cheveux o√π 100 utilisateurs essaient en m√™me temps de modifier une boisson. Nous sommes d&#x27;accord que c&#x27;est peu probable, mais cela nous permettra de simuler un cas de pessimistic locking.</p>
<p>Commen√ßons par mettre √† jour le repository <strong><code>DrinkRepository</code></strong> pour ajouter le pessimistic locking :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@Repository</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DrinkRepository</span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Drink</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token doc-comment comment">/**
</span></span><span class="code-line line-number" line="5"><span class="token doc-comment comment">   * Find all drinks with a price less than or equal to the given price.
</span></span><span class="code-line line-number" line="6"><span class="token doc-comment comment">   *
</span></span><span class="code-line line-number" line="7"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">price</span> the price
</span></span><span class="code-line line-number" line="8"><span class="token doc-comment comment">   * <span class="token keyword">@return</span> the drinks
</span></span><span class="code-line line-number" line="9"><span class="token doc-comment comment">   */</span>
</span><span class="code-line line-number" line="10">  <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Drink</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllByPriceLessThanEqual</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number highlight-line" line="12">  <span class="token doc-comment comment">/**
</span></span><span class="code-line line-number highlight-line" line="13"><span class="token doc-comment comment">   * Find a drink by its id.
</span></span><span class="code-line line-number highlight-line" line="14"><span class="token doc-comment comment">   *
</span></span><span class="code-line line-number highlight-line" line="15"><span class="token doc-comment comment">   * <span class="token keyword">@param</span> <span class="token parameter">id</span> the id
</span></span><span class="code-line line-number highlight-line" line="16"><span class="token doc-comment comment">   * <span class="token keyword">@return</span> the drink
</span></span><span class="code-line line-number highlight-line" line="17"><span class="token doc-comment comment">   */</span>
</span><span class="code-line line-number highlight-line" line="18">  <span class="token annotation punctuation">@Override</span>
</span><span class="code-line line-number highlight-line" line="19">  <span class="token annotation punctuation">@NonNull</span>
</span><span class="code-line line-number highlight-line" line="20">  <span class="token annotation punctuation">@Lock</span><span class="token punctuation">(</span><span class="token class-name">LockModeType</span><span class="token punctuation">.</span><span class="token constant">PESSIMISTIC_WRITE</span><span class="token punctuation">)</span>
</span><span class="code-line line-number highlight-line" line="21">  <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Drink</span><span class="token punctuation">&gt;</span></span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="22"><span class="token punctuation">}</span>
</span></code></pre>
<p>Nous avons ajout√© l&#x27;annotation <strong><code>@Lock(LockModeType.PESSIMISTIC_WRITE)</code></strong> sur la m√©thode <strong><code>findById</code></strong> pour appliquer un verrou pessimiste en √©criture sur la ressource. Cela signifie que la ressource renvoy√©e par cette m√©thode est verrouill√©e pour emp√™cher tout autre processus de la modifier.</p>
<p>Ensuite, mettons √† jour le service <strong><code>DrinkService</code></strong> pour l&#x27;op√©ration de mise √† jour d&#x27;une boisson :</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line line-number" line="1"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">public</span> <span class="token class-name">Drink</span> <span class="token function">updateOneDrink</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">,</span> <span class="token class-name">NewDrink</span> newDrink<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number highlight-line" line="3">    <span class="token class-name">Drink</span> drink <span class="token operator">=</span> drinkRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">if</span> <span class="token punctuation">(</span>drink <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8">    <span class="token keyword">if</span> <span class="token punctuation">(</span>newDrink<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">      drink<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>newDrink<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="11">    <span class="token keyword">if</span> <span class="token punctuation">(</span>newDrink<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">      drink<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span>newDrink<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="14">    <span class="token keyword">if</span> <span class="token punctuation">(</span>newDrink<span class="token punctuation">.</span><span class="token function">getVolume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number highlight-line" line="15">      drink<span class="token punctuation">.</span><span class="token function">setVolume</span><span class="token punctuation">(</span>newDrink<span class="token punctuation">.</span><span class="token function">getVolume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="17">    <span class="token keyword">if</span> <span class="token punctuation">(</span>newDrink<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="18">      drink<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>newDrink<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="19">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="20">
</span><span class="code-line line-number" line="21">    <span class="token keyword">return</span> drinkRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>drink<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="22">  <span class="token punctuation">}</span>
</span></code></pre>
<blockquote>
<p>Attention, pour importer l&#x27;annotation <strong><code>@Transactional</code></strong>, vous devez ajouter l&#x27;import de <strong><code>springframework</code></strong> et pas de <strong><code>jakarta</code></strong> :</p>
</blockquote>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span></span><span class="token punctuation">;</span>
</span></code></pre>
<p>Nous avons ajout√© l&#x27;annotation <strong><code>@Transactional(timeout = 10)</code></strong> pour limiter la dur√©e de la transaction √† 10 secondes. Si la transaction ne se termine pas dans les 10 secondes, une exception <strong><code>TransactionTimedOutException</code></strong> est lev√©e et le verrou est lib√©r√©.</p>
<p>Via le client HTTP d&#x27;IntelliJ, nous ne pouvons pas simuler un cas de pessimistic locking, car les requ√™tes sont ex√©cut√©es de mani√®re s√©quentielle.<br/>
<!-- -->Pour ce cours, nous ne simulerons pas de cas de pessimistic locking, mais vous pouvez imaginer que si 100 utilisateurs tentent de modifier la m√™me boisson en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.<br/>
<!-- -->Ici le syst√®me de verrous assure que seul un utilisateur √† la fois peut modifier une boisson. Les autres utilisateurs doivent attendre que le verrou soit lib√©r√©.<br/>
<!-- -->Bien s√ªr, ce type de sc√©nario est peu probable dans la vraie vie, et est acceptable si l&#x27;on accepte que les donn√©es de la ressource puissent √™tre modifi√©es √† tour de r√¥le, garantissant la coh√©rence des donn√©es pour chaque modification, mais pas entre les modifications.</p>
<p>En effet, si un utilisateur modifie une boisson, puis un autre utilisateur modifie la m√™me boisson, la deuxi√®me modification √©crasera la premi√®re, sans que cela ne pose de probl√®me de coh√©rence des donn√©es.</p>
<p>Mais qui d√©tient la v√©rit√© au niveau des donn√©es ? Le dernier utilisateur ? Si la r√©ponse √† cette question est oui, alors le pessimistic locking est une bonne solution. Si la r√©ponse est non, alors il faudra trouver une autre solution pour g√©rer la concurrence.</p>
<p>üí≠ Quelle genre de solution ?<br/>
<!-- -->Une solution pourrait √™tre d&#x27;utiliser l&#x27;optimistic locking, qui permet de g√©rer les conflits de version entre les modifications de la ressource.  Il faudra alors renvoyer des codes HTTP d&#x27;erreurs aux utilisateurs qui tentent de modifier une ressource qui a √©t√© modifi√©e entre-temps, et leur demander de recharger la ressource pour obtenir la version la plus r√©cente.</p>
<p>Si n√©cessaire, vous pouvez trouver le code associ√© √† la gestion de transactions et de la concurrence ici : <a href="https://github.com/e-vinci/cae-theory-demos/tree/main/concurrency">concurrency</a>.</p>
<h2>En savoir plus</h2>
<p>Si vous souhaitez en savoir plus sur le pessimistic locking, vous pouvez consulter cet article : <a href="https://www.baeldung.com/jpa-pessimistic-locking">https://www.baeldung.com/jpa-pessimistic-locking</a></p></div><div></div><footer class="MuiBox-root mui-0"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-row MuiGrid-spacing-xs-2 mui-5pbuzx"><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-12 MuiGrid-grid-md-4 mui-981n55"><p class="MuiTypography-root MuiTypography-body2 mui-bxmwoh">¬© <!-- -->2026<!-- --> - Cr√©√© avec Next.js</p></div><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-12 MuiGrid-grid-md-4 mui-20tnkx"><div class="MuiBox-root mui-1lkm1he"><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium mui-1uzdcm9" tabindex="0" href="mailto:raphael.baroni@vinci.be" aria-label="Envoyer un email"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"></path></svg></a></div></div><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-12 MuiGrid-grid-md-4 mui-981n55"><p class="MuiTypography-root MuiTypography-body2 mui-bxmwoh">e-vinci/cae</p></div></div></footer><script src="/_next/static/chunks/webpack-b7059c8cc37787ef.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[5484,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"673\",\"static/chunks/673-8f55286e245006fb.js\",\"177\",\"static/chunks/app/layout-a557f0e5b59d7b71.js\"],\"default\"]\n3:I[7468,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"673\",\"static/chunks/673-8f55286e245006fb.js\",\"177\",\"static/chunks/app/layout-a557f0e5b59d7b71.js\"],\"ClientThemeProvider\"]\n4:I[7259,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"328\",\"static/chunks/328-d02b7e1054113488.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js\"],\"default\"]\n5:I[1758,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"673\",\"static/chunks/673-8f55286e245006fb.js\",\"177\",\"static/chunks/app/layout-a557f0e5b59d7b71.js\"],\"default\"]\n6:I[8148,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"673\",\"static/chunks/673-8f55286e245006fb.js\",\"177\",\"static/chunks/app/layout-a557f0e5b59d7b71.js\"],\"default\"]\n7:I[5244,[],\"\"]\n8:I[3866,[],\"\"]\n9:I[3620,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"673\",\"static/chunks/673-8f55286e245006fb.js\",\"177\",\"static/chunks/app/layout-a557f0e5b59d7b71.js\"],\"default\"]\na:I[6240,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"673\",\"static/chunks/673-8f55286e245006fb.js\",\"177\",\"static/chunks/app/layout-a557f0e5b59d7b71.js\"],\"default\"]\nc:I[6213,[],\"OutletBoundary\"]\ne:I[6213,[],\"MetadataBoundary\"]\n10:I[6213,[],\"ViewportBoundary\"]\n12:I[4835,[],\"\"]\n:HL[\"/_next/static/css/f76bfe29b96cf8a1.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"lBCth7YGlYHLzNGMFrvg-\",\"p\":\"\",\"c\":[\"\",\"old_iteration4\",\"concurrency\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"slug\",\"old_iteration4/concurrency\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f76bfe29b96cf8a1.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"children\":[\"$\",\"html\",null,{\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"title\",null,{\"children\":\"CAE Course\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/svg+xml\",\"href\":\"/favicon.svg\"}]]}],[\"$\",\"$L4\",null,{\"component\":\"body\",\"sx\":{\"display\":\"flex\",\"flexDirection\":\"column\",\"minHeight\":\"100vh\",\"margin\":0},\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"$L5\",null,{\"siteMetaData\":{\"version\":\"\",\"title\":\"CAE\",\"description\":\"siteDescription\",\"url\":\"siteURL\",\"youtubeUrl\":\"youtubeUrl\",\"authorEmail\":\"raphael.baroni@vinci.be\",\"facebookUrl\":\"facebookUrl\",\"instagramUrl\":\"instagramUrl\",\"menuLinks\":[{\"name\":\"Home\",\"link\":\"/\"},{\"name\":\"Partie 1\",\"link\":\"\",\"subMenu\":[{\"name\":\"Introduction\",\"link\":\"/part1/intro\"},{\"name\":\"Qualit√© g√©n√©rale\",\"link\":\"/part1/general\"}]},{\"name\":\"About\",\"link\":\"/about\"}]}}]}],[\"$\",\"$L6\",null,{\"sx\":{\"padding\":\"1rem\",\"wordWrap\":\"break-word\",\"flex\":1},\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L9\",null,{}],[\"$\",\"$La\",null,{\"siteMetaData\":\"$0:f:0:1:1:props:children:1:props:children:props:children:props:children:1:props:children:0:props:children:props:siteMetaData\"}]]}]]}]}]}]]}],{\"children\":[[\"slug\",\"old_iteration4/concurrency\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$0:f:0:1:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Lb\",null,[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}]]}],{},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"a4ItGQN41jHhurDdOyGiq\",{\"children\":[[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[\"$\",\"$L10\",null,{\"children\":\"$L11\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$12\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"13:I[3508,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"328\",\"static/chunks/328-d02b7e1054113488.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js\"],\"default\"]\n14:I[5451,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"328\",\"static/chunks/328-d02b7e1054113488.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js\"],\"default\"]\n15:I[8174,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"328\",\"static/chunks/328-d02b7e1054113488.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js\"],\"default\"]\n16:I[8173,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"328\",\"static/chunks/328-d02b7e1054113488.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js\"],\"\"]\n17:I[8064,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"328\",\"static/chunks/328-d02b7e1054113488.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js\"],\"default\"]\n18:I[4401,[\"537\",\"static/chunks/537-32c52f136802c48f.js\",\"328\",\"static/chunks/328-d02b7e1054113488.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-7063113fe138371e.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"$L13\",null,{\"children\":[[\"$\",\"$L14\",null,{\"aria-label\":\"breadcrumb\",\"children\":[[\"$\",\"$L15\",null,{\"href\":\"/\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$16\",\"children\":\" CAE \"}],[\"$\",\"$L15\",null,{\"href\":\"/iteration3\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$16\",\"children\":\" It√©ration 3 \"}],[\"$\",\"$L15\",null,{\"href\":\"#\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$16\",\"children\":\" Gestion de transactions et de la concurrence \"}]]}],[\"$\",\"$L17\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L15\",null,{\"href\":\"#comment_gerer_des_transactions_dans_spring_boot\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$16\",\"children\":[\"$\",\"$L18\",null,{\"primary\":\" Comment g√©rer des transactions dans Spring Boot ? \"}]}]}],[\"$\",\"$L17\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L15\",null,{\"href\":\"#pourquoi_gerer_la_concurrence\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$16\",\"children\":[\"$\",\"$L18\",null,{\"primary\":\" Pourquoi g√©rer la concurrence ? \"}]}]}],[\"$\",\"$L17\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L15\",null,{\"href\":\"#comment_gerer_la_concurrence\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$16\",\"children\":[\"$\",\"$L18\",null,{\"primary\":\" Comment g√©rer la concurrence ? \"}]}]}],[\"$\",\"$L17\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L15\",null,{\"href\":\"#optimistic_locking_dans_spring_boot\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$16\",\"children\":[\"$\",\"$L18\",null,{\"primary\":\" Optimistic Locking dans Spring Boot \"}]}]}],[\"$\",\"$L17\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L15\",null,{\"href\":\"#pessimistic_locking_dans_spring_boot\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$16\",\"children\":[\"$\",\"$L18\",null,{\"primary\":\" Pessimistic Locking dans Spring Boot \"}]}]}]]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_gerer_des_transactions_dans_spring_boot\",\"children\":\" Comment g√©rer des transactions dans Spring Boot ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Les transactions sont un moyen de regrouper plusieurs op√©rations en une seule unit√© logique. Cela garantit que toutes les op√©rations sont ex√©cut√©es de mani√®re atomique, c'est-√†-dire que toutes les op√©rations sont ex√©cut√©es ou aucune op√©ration n'est ex√©cut√©e.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Avec Spring Boot, vous pouvez g√©rer les transactions en utilisant l'annotation \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional\"}]}],\". Cette annotation permet de d√©finir une m√©thode comme transactionnelle. Cela signifie que toutes les op√©rations sur la base de donn√©es effectu√©es dans cette m√©thode seront regroup√©es en une seule transaction.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Par exemple, si vous souhaitez ajouter une adresse √† un utilisateur, vous devez ajouter l'adresse et mettre √† jour l'utilisateur en m√™me temps. Si l'une des op√©rations √©choue, vous ne voulez pas que l'autre op√©ration soit ex√©cut√©e. Les transactions garantissent que les deux op√©rations sont ex√©cut√©es ensemble.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Si une exception est lev√©e dans une m√©thode annot√©e avec \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional\"}]}],\", la transaction est automatiquement annul√©e et les op√©rations effectu√©es dans cette transaction sont annul√©es. Cela correspond √† un \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"rollback\"}]}],\" au niveau de la base de donn√©es.\\nCela garantit que les donn√©es restent coh√©rentes. Si tout se passe bien, la transaction est valid√©e et les op√©rations sont confirm√©es. Cela correspond √† un \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"commit\"}]}],\" au niveau de la base de donn√©es.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Les transactions ne r√®glent pas les probl√®mes de concurrence que nous verrons plus tard. N√©anmoins, si les transactions sont coupl√©es √† la gestion de la concurrence (optimistic ou pessimistic locking trait√©s apr√®s la gestion des transactions), elles permettent de g√©rer les conflits de mani√®re plus robuste.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Bases pour les transactions\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici un exemple de transaction en Java avec Spring Boot, lorsque nous avons un repository pour les utilisateurs et un repository pour les adresses.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici les entit√©s :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Entity\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"User\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Id\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@GeneratedValue\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"strategy \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"GenerationType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"IDENTITY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@OneToOne\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"cascade \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"CascadeType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"ALL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@JoinColumn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"name \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"address_id\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" referencedColumnName \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"id\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Address\"}],\" address\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Getters et setters\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Entity\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Address\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Id\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@GeneratedValue\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"strategy \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"GenerationType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"IDENTITY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Column\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"unique \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Emp√™che les doublons d'adresses\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" street\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" city\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" postalCode\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Getters et setters\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici les repositories :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Repository\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"interface\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserRepository\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"extends\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"CrudRepository\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"User\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici les DTO pour les requ√™tes :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserDTO\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AddressDTO\"}],\" address\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Getters et setters\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AddressDTO\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" street\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" city\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" postalCode\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Getters et setters\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici le contr√¥leur :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@RestController\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@RequestMapping\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"/users\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserController\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"final\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserService\"}],\" userService\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserController\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserService\"}],\" userService\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"this\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"userService \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" userService\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@PostMapping\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"User\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"addUserWithAddress\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@RequestBody\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserDTO\"}],\" userDTO\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" userService\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"addUserWithAddress\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"userDTO\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici l'exception que nous souhaitons lancer pour une adresse d√©j√† existante :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-Java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AddressAlreadyExistsException\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"extends\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RuntimeException\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AddressAlreadyExistsException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"super\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici un service pour ajouter une adresse et un utilisateur :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Service\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserService\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"final\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserRepository\"}],\" userRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"final\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AddressRepository\"}],\" addressRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserService\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserRepository\"}],\" userRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AddressRepository\"}],\" addressRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"this\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"userRepository \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" userRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"this\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"addressRepository \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" addressRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"12\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Transactional\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"User\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"addUserWithAddress\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UserDTO\"}],\" userDTO\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// V√©rifier si l'adresse existe d√©j√†\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Optional\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Address\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" existingAddress \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" addressRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findByStreetAndCityAndPostalCode\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"                userDTO\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getAddress\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getStreet\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"                userDTO\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getAddress\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getCity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"                userDTO\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getAddress\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getPostalCode\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"existingAddress\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"isPresent\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AddressAlreadyExistsException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"L'adresse existe d√©j√† !\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Sauvegarder l'adresse\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Address\"}],\" address \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Address\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[\"        address\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setStreet\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"userDTO\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getAddress\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getStreet\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"        address\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setCity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"userDTO\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getAddress\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getCity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"        address\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setPostalCode\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"userDTO\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getAddress\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getPostalCode\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[\"        addressRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"save\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"address\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Sauvegarder l'utilisateur\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"User\"}],\" user \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"User\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"34\",\"children\":[\"        user\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"userDTO\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"35\",\"children\":[\"        user\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setAddress\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"address\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"36\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" userRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"save\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"user\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Retourner l'utilisateur sauvegard√©\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"37\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"38\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Ici la gestion des transactions est assur√©e par l'annotation \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional\"}]}],\" sur la m√©thode \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"addUserWithAddress\"}]}],\". Cela signifie que toutes les op√©rations effectu√©es dans cette m√©thode seront regroup√©es en une seule transaction. Cela garantit que toutes les op√©rations sont ex√©cut√©es de mani√®re atomique, c'est-√†-dire que toutes les op√©rations sont ex√©cut√©es ou aucune op√©ration n'est ex√©cut√©e.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"üí≠ Peux-tu imaginer une autre raison pour que JPA √©choue √† sauvegarder l'adresse ?\",[\"$\",\"br\",null,{}],\"\\n\",\"Normalement, JPA ne devrait pas √©chouer √† sauvegarder l'adresse, car normalement, dans le contr√¥leur, on est cens√© valider tous les param√®tres avant d'appeler le service.\",[\"$\",\"br\",null,{}],\"\\n\",\"Une fois l'adresse sauvegard√©e, on pourrait imaginer que l'on ne peut pas sauvegarder l'utilisateur. Par exemple, si l'utilisateur a d√©j√† √©t√© sauvegard√©, on ne peut pas le sauvegarder √† nouveau.\",[\"$\",\"br\",null,{}],\"\\n\",\"L'avantage de la transaction est que si l'une des op√©rations √©choue, l'autre op√©ration ne sera pas ex√©cut√©e. Cela garantit que les donn√©es restent coh√©rentes.\",[\"$\",\"br\",null,{}],\"\\n\",\"Bien s√ªr, pour rendre le code plus robuste et clair, il faudrait aussi v√©rifier si l'utilisateur existe d√©j√† avant de le sauvegarder.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"üí≠ Est-ce que les transactions sont suffisantes dans cet exemple pour se prot√©ger contre les acc√®s concurrents ?\",[\"$\",\"br\",null,{}],\"\\n\",\"Si deux transactions distinctes tentent de sauvegarder la m√™me adresse ou le m√™me utilisateur en m√™me temps, il pourrait y avoir des conflits ou des incoh√©rences.\",[\"$\",\"br\",null,{}],\"\\n\",\"Cependant, l'optimistic ou le pessimistic locking (que nous verrons plus tard) n'est pas n√©cessaire ici car :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"La m√©thode \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"save\"}]}],\" de JPA garantit que l'adresse ne sera pas dupliqu√©e si une contrainte d'unicit√© est d√©finie sur la colonne street (comme dans votre entit√© \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Address\"}]}],\" avec \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Column(unique = true)\"}]}],\").\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Si deux transactions tentent de sauvegarder la m√™me adresse en m√™me temps, la base de donn√©es l√®vera une exception (par exemple, une \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"ConstraintViolationException\"}]}],\"). La deuxi√®me transaction sera annul√©e, garantissant que l'adresse n'est pas dupliqu√©e.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Et finalement, voici le gestionnaire global d'exceptions pour l'exception \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AddressAlreadyExistsException\"}]}],\" :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@ControllerAdvice\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"GlobalExceptionHandler\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@ExceptionHandler\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AddressAlreadyExistsException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handleAddressAlreadyExistsException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AddressAlreadyExistsException\"}],\" ex\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ResponseStatusException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HttpStatus\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"CONFLICT\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ex\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getMessage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@ExceptionHandler\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Exception\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handleGenericException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Exception\"}],\" ex\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ResponseStatusException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HttpStatus\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"INTERNAL_SERVER_ERROR\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Une erreur est survenue : \\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" ex\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getMessage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Ici, le gestionnaire global d'exceptions renvoie une r√©ponse \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"409 Conflict\"}]}],\" au client en cas d'exception \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AddressAlreadyExistsException\"}]}],\". Cela signifie que si l'adresse existe d√©j√†, le client recevra une r√©ponse \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"409 Conflict\"}]}],\".\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Exemple concret\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez mettre √† jour votre projet GitLab contenant la gestion des Pizzas pour ajouter la gestion des transactions.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Il suffit de rajouter l'annotation \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional\"}]}],\" sur les m√©thodes de service qui effectuent des op√©rations de mise √† jour sur la base de donn√©es et qui d√©pendent du succ√®s d'autres op√©rations.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Par exemple, au niveau de l'API de gestion de pizzas, lorsque nous ajoutons, ou effa√ßons des pizzas, nous faisons des op√©rations au niveau d'Azure Storage pour stocker ou effacer les images des pizzas.\",[\"$\",\"br\",null,{}],\"\\n\",\"Si ces op√©rations √©chouent, nous ne voulons pas que les op√©rations de mise √† jour de la base de donn√©es soient ex√©cut√©es.\",[\"$\",\"br\",null,{}],\"\\n\",\"Veuillez donc mettre √† jour le service de gestion des pizzas nomm√© \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"services/PizzaService\"}]}],\".\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"package\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"be\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"vinci\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"ipl\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"demo\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"services\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"be\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"vinci\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"ipl\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"demo\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"models\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"dtos\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"NewPizza\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"be\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"vinci\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"ipl\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"demo\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"models\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"entities\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"be\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"vinci\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"ipl\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"demo\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"repositories\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"PizzaRepository\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"com\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"azure\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"storage\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"blob\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BlobClientBuilder\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"com\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"azure\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"storage\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"blob\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"models\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BlobHttpHeaders\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"java\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IOException\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"java\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"util\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"java\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"util\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Map\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"java\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"util\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UUID\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"org\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"springframework\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"beans\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"factory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"annotation\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Value\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"org\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"springframework\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"stereotype\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Service\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"org\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"springframework\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"transaction\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"annotation\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Transactional\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"org\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"springframework\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"web\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"multipart\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"MultipartFile\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\" * Pizza service.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\" */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Service\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"PizzaService\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"final\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"PizzaRepository\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"final\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" blobServiceEndpoint\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"final\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" sasToken\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"final\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" containerName\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * Constructor.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"pizzaRepository\"}],\" the pizza repository\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"PizzaService\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"PizzaRepository\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"34\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Value\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"${azure.blob.service-endpoint}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" blobServiceEndpoint\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"35\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Value\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"${azure.blob.sas-token}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" sasToken\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"36\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Value\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"${azure.blob.container-name}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" containerName\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"37\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"this\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"pizzaRepository \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"38\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"this\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"blobServiceEndpoint \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" blobServiceEndpoint\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"39\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"this\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"sasToken \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" sasToken\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"40\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"this\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"containerName \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" containerName\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"41\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"42\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"43\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"44\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * Read all pizzas.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"45\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"46\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"order\"}],\" if order contains \\\"title\\\" the pizzas will be ordered by title in ascending order\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"47\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *              if order contains \\\"-title\\\" the pizzas will be ordered by title in descending\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"48\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *              order.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"49\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@return\"}],\" the pizzas\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"50\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"51\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Iterable\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"readAllPizzas\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" order\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"52\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"order \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"order\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"contains\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"title\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"53\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findAll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"54\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"55\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"56\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"order\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"contains\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"57\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findAllByOrderByTitleDesc\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"58\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"59\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findAllByOrderByTitleAsc\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"60\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"61\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"62\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"63\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * Read a pizza by its id.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"64\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"65\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"id\"}],\" the id\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"66\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@return\"}],\" the pizza\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"67\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"68\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"readPizzaById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"69\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElse\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"70\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"71\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"72\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"73\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * Create a pizza.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"74\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"75\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"newPizza\"}],\" the new pizza\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"76\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"image\"}],\"    the image\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"77\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@return\"}],\" the pizza\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"78\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"79\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Transactional\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"80\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"createPizza\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"NewPizza\"}],\" newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"MultipartFile\"}],\" image\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"81\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],\" pizza \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"82\",\"children\":[\"    pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"83\",\"children\":[\"    pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setContent\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getContent\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"84\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"85\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"image \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"image\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"isEmpty\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"86\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" blobUrl \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"uploadImageToBlob\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"image\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"87\",\"children\":[\"      pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setImageLocation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"blobUrl\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"88\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"89\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"90\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"save\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"91\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"92\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"93\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"94\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * Upload an image to a blob on Azure storage with a generated UUID as filename. The image is\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"95\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * uploaded to the \\\"images\\\" folder. The original filename is stored in the metadata.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"96\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"97\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"image\"}],\"\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"98\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@return\"}],\" the blob url\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"99\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@throws\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token reference\",\"children\":[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IOException\"}]}],\"\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"100\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"101\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"uploadImageToBlob\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"MultipartFile\"}],\" image\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"102\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" imageUUID \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"UUID\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"randomUUID\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"toString\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"103\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Map\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" metadata \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"104\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"105\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" blobName \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" imageUUID\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"106\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"107\",\"children\":[\"    metadata\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"put\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"originalFileName\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" image\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getOriginalFilename\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"108\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BlobClientBuilder\"}],\" blobClientBuilder \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BlobClientBuilder\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"109\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"endpoint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"blobServiceEndpoint\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"110\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"sasToken\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"sasToken\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"111\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"containerName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"containerName\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"112\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"blobName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"blobName\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"113\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"114\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"try\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"115\",\"children\":[\"      blobClientBuilder\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"buildClient\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"upload\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"image\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getInputStream\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" image\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getSize\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"116\",\"children\":[\"      blobClientBuilder\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"buildClient\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setMetadata\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"metadata\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"117\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"catch\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IOException\"}],\" e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"118\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RuntimeException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"119\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"120\",\"children\":[\"    blobClientBuilder\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"buildClient\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"121\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setHttpHeaders\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BlobHttpHeaders\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setContentType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"image\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getContentType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"122\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"123\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" blobClientBuilder\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"buildClient\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getBlobUrl\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"124\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"125\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"126\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"127\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"128\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * Delete a pizza by its id.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"129\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"130\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"id\"}],\" the id\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"131\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@return\"}],\" the pizza\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"132\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"133\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Transactional\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"134\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"deletePizza\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"135\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],\" pizza \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElse\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"136\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pizza \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"137\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getImageLocation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"138\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"deleteImageFromBlob\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getImageLocation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"139\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"140\",\"children\":[\"      pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"delete\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"141\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"142\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"143\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"144\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"145\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"146\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * Delete an image from the blob storage.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"147\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"148\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"imageLocation\"}],\" the image location\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"149\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"150\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"deleteImageFromBlob\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" imageLocation\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"151\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"imageLocation \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"imageLocation\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"isEmpty\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\" imageLocation\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"contains\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"152\",\"children\":[\"        blobServiceEndpoint\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"153\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" blobName \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" imageLocation\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"substring\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"imageLocation\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"lastIndexOf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"/\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"154\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BlobClientBuilder\"}],\" blobClientBuilder \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BlobClientBuilder\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"155\",\"children\":[\"          \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"endpoint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"blobServiceEndpoint\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"156\",\"children\":[\"          \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"sasToken\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"sasToken\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"157\",\"children\":[\"          \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"containerName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"containerName\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"158\",\"children\":[\"          \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"blobName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"blobName\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"159\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"160\",\"children\":[\"      blobClientBuilder\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"buildClient\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"delete\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"161\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"162\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"163\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"164\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"165\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * Update a pizza.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"166\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"167\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"id\"}],\"       the id\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"168\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"newPizza\"}],\" the new pizza\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"169\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@return\"}],\" the pizza\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"170\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"171\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Transactional\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"172\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"updatePizza\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"NewPizza\"}],\" newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"173\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],\" pizza \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElse\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"174\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pizza \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"175\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"176\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"177\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"178\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"179\",\"children\":[\"      pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"180\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"181\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getContent\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"182\",\"children\":[\"      pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setContent\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getContent\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"183\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"184\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"185\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"save\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"186\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"187\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"188\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Gr√¢ce √† ces ajouts minuscules, si par exemple l'op√©ration de sauvegarde de l'image √©choue, l'op√©ration de sauvegarde de la pizza ne sera pas ex√©cut√©e. En effet, si la fonction \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"uploadImageToBlob\"}]}],\" l√®ve une exception, la transaction sera annul√©e et la pizza ne sera pas sauvegard√©e.\",[\"$\",\"br\",null,{}],\"\\n\",\"Nous n'avons pas r√©ellement besoin de transaction pour cette op√©ration, car la sauvegarde de la pizza ne se fait que si l'op√©ration de sauvegarde de l'image r√©ussit. N√©anmoins, nous pouvons facilement imaginer un sc√©nario o√π la transaction serait n√©cessaire, par exemple :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"si nous devions sauvegarder la pizza avant de sauvegarder l'image.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"si nous devions d'abord sauvegarder les ingr√©dients de la pizza avant de sauvegarder la pizza, puis d'uploader l'image.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Dans ces cas, les transactions garantissent que toutes les op√©rations sur la DB sont ex√©cut√©es ou aucune op√©ration n'est ex√©cut√©e.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"En savoir plus\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Si vous souhaitez en savoir plus sur les transactions avec Spring Boot, vous pouvez consulter cet article : \",[\"$\",\"a\",null,{\"href\":\"https://docs.spring.io/spring-framework/reference/data-access/transaction.html\",\"children\":\"https://docs.spring.io/spring-framework/reference/data-access/transaction.html\"}]]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"pourquoi_gerer_la_concurrence\",\"children\":\" Pourquoi g√©rer la concurrence ? \"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"La concurrence est un sujet important en informatique. En effet, de nombreux probl√®mes peuvent survenir si la concurrence n'est pas g√©r√©e correctement. Par exemple, si deux processus essaient de modifier la m√™me donn√©e en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Prenons l'exemple d'une application o√π l'on g√®re un stock de produits. Si deux utilisateurs essaient de modifier la quantit√© d'un produit en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es. Par exemple, si un utilisateur essaie d'ajouter 5 unit√©s √† la quantit√© d'un produit, et qu'un autre utilisateur essaie de retirer 3 unit√©s du m√™me produit en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"NB : La concurrence pourrait entra√Æner des probl√®mes de performance si elle n'est pas g√©r√©e correctement. Par exemple, si plusieurs processus essaient d'acc√©der √† la m√™me ressource en m√™me temps, il peut y avoir des probl√®mes de latence et de ralentissement. N√©anmoins, nous ne devons g√©n√©ralement pas g√©rer ce type de probl√®me car cela est automatiquement trait√© par les frameworks que nous utilisons. En effet, en cas de multiples requ√™tes sur une m√™me ressource, le framework Spring Boot g√®re cela en cr√©ant un pool de threads pour traiter les requ√™tes. Comment √ßa fonctionne ?\",[\"$\",\"br\",null,{}],\"\\n\",\"Lorsqu'une requ√™te HTTP arrive, un thread est extrait du pool pour traiter cette requ√™te.\",[\"$\",\"br\",null,{}],\"\\n\",\"Une fois la requ√™te trait√©e, le thread est remis dans le pool pour √™tre r√©utilis√©.\",[\"$\",\"br\",null,{}],\"\\n\",\"Cela permet de limiter le nombre de threads actifs et d'√©viter de cr√©er un nouveau thread pour chaque requ√™te, ce qui serait co√ªteux en termes de performances.\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_gerer_la_concurrence\",\"children\":\" Comment g√©rer la concurrence ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Il existe plusieurs fa√ßons de g√©rer la concurrence en informatique. Voici quelques-unes des techniques les plus courantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Optimistic Locking\"}],\" : Cette technique consiste √† v√©rifier si la donn√©e a √©t√© modifi√©e par un autre processus avant de la modifier. Si la donn√©e a √©t√© modifi√©e, une exception est lev√©e et le processus doit g√©rer cette exception.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Pessimistic Locking\"}],\" : Cette technique consiste √† verrouiller la donn√©e avant de la modifier. Cela garantit qu'aucun autre processus ne peut modifier la donn√©e tant que le verrou n'est pas lib√©r√©.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Transactions\"}],\" : Comme vu pr√©c√©demment, les transactions sont un moyen de regrouper plusieurs op√©rations sur une base de donn√©es en une seule unit√© logique. Cela garantit que toutes les op√©rations sont ex√©cut√©es de mani√®re atomique, c'est-√†-dire que toutes les op√©rations sont ex√©cut√©es ou aucune op√©ration n'est ex√©cut√©e. Les transactions sont particuli√®rement utiles pour garantir la coh√©rence des donn√©es dans des sc√©narios de concurrence, sans pour autant r√©gler les probl√®mes de concurrence en eux-m√™mes.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Verrous distribu√©s\"}],\" : Les verrous distribu√©s peuvent √™tre utilis√©s pour coordonner l'acc√®s √† une ressource partag√©e entre plusieurs processus. Redis peut √™tre utilis√© pour ce genre d'applications. Des verrous peuvent √™tre utilis√©s pour garantir que seuls un certain nombre de processus peuvent acc√©der √† la ressource en m√™me temps. Cela est particuli√®rement utile dans des architectures distribu√©es, type microservices, o√π plusieurs instances doivent g√©rer une ressource partag√©e. Nous n'aborderons pas ce sujet dans ce cours, car notre application n'est pas distribu√©e.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"File de messages\"}],\" : Une file de messages (comme RabbitMQ ou Kafka) peut √™tre utilis√©e pour g√©rer la concurrence. Les messages sont envoy√©s √† une file, puis trait√©s par un ou plusieurs consommateurs. Cela permet de g√©rer la concurrence en s√©parant la production de la consommation de messages. Ce type de solution est particuli√®rement utile dans des architectures distribu√©es, o√π plusieurs instances doivent traiter des messages en parall√®le. Nous n'aborderons pas ce sujet dans ce cours.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"optimistic_locking_dans_spring_boot\",\"children\":\" Optimistic Locking dans Spring Boot \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"L'optimistic locking repose sur l'id√©e que les conflits sont rares. Avant de mettre √† jour une donn√©e, on v√©rifie si elle a √©t√© modifi√©e par un autre processus en utilisant un champ de version.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"L'optimistic locking est id√©al pour les sc√©narios o√π les conflits sont peu fr√©quents, comme la mise √† jour d'un nom de produit ou la mise √† jour d'une quantit√© en stock, lorsque le stock est modifiable par un nombre limit√© d'utilisateurs.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"L'int√©r√™t de l'optimistic locking est qu'il n'y a pas de verrouillage de la ressource, ce qui permet √† plusieurs processus de lire la ressource en m√™me temps. Cela am√©liore les performances de l'application. Cependant, si un conflit survient, il faut g√©rer l'exception lev√©e par la base de donn√©es.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Bases pour l'optimistic locking\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici un exemple d'optimistic locking en Java avec JPA :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Entity\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Id\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@GeneratedValue\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"strategy \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"GenerationType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"IDENTITY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" quantity\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"11\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Version\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" version\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Champ utilis√© pour l'optimistic locking\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Getters et setters\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Partie du service pour mettre √† jour le stock d'un produit\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"19\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Transactional\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"updateStock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" productId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" quantityToRemove\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],\" product \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" productRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"productId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElseThrow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RuntimeException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Produit non trouv√©\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":\"    \\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" quantityToRemove\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RuntimeException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Stock insuffisant\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"    product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" quantityToRemove\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"29\",\"children\":[\"    productRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"save\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// V√©rifie automatiquement la version\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Dans cet exemple, le champ \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"version\"}]}],\" est utilis√© pour l'optimistic locking. Lorsque la m√©thode \",[\"$\",\"code\",null,{\"children\":\"save\"}],\" est appel√©e, JPA v√©rifie automatiquement si la version de l'entit√© en base de donn√©es correspond √† la version de l'entit√© en m√©moire. Si ce n'est pas le cas, une exception \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"OptimisticLockException\"}]}],\" est lev√©e.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional\"}]}],\" : Cette annotation permet de d√©finir une m√©thode comme transactionnelle. Cela signifie que toutes les op√©rations effectu√©es dans cette m√©thode seront regroup√©es en une seule transaction. Ici, comme il n'y a qu'une seule op√©ration (la mise √† jour du stock), l'annotation \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional\"}]}],\" n'est pas strictement n√©cessaire, mais elle est recommand√©e pour des raisons de clart√©.\",[\"$\",\"br\",null,{}],\"\\n\",\"En effet, si vous ajoutez d'autres op√©rations de modification dans cette m√©thode, elles seront automatiquement incluses dans la transaction.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Ici l'on v√©rifie la version de l'entit√© en base de donn√©es au moment de la sauvegarde. Cela est suffisant pour g√©rer les conflits dans le cadre d'une op√©ration transactionnelle unique, si l'on imaginait que deux utilisateurs essaient de modifier la quantit√© d'un produit en m√™me temps.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Attention : Le code donn√© pour l'optimistic locking dans l'exemple ci-dessus fonctionne bien dans le cadre d'une op√©ration transactionnelle unique, o√π la version est v√©rifi√©e au moment de l'ex√©cution de la m√©thode \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"updateStock\"}]}],\". Cependant, dans le contexte d'une API RESTful, o√π les appels sont effectu√©s par des clients distincts (par exemple, deux requ√™tes HTTP s√©par√©es), ce code ne couvre pas le cas o√π la version doit √™tre v√©rifi√©e entre deux requ√™tes clientes, lorsqu'il y a une op√©ration de lecture suivie d'une op√©ration de mise √† jour. Nous verrons comment g√©rer ce cas dans la section suivante.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Exemple concret\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez mettre √† jour votre projet GitLab contenant la gestion des Pizzas pour ajouter l'optimistic locking.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"üí≠ Quelle serait l'op√©ration la plus √©vidente qui pourrait √™tre sujet √† des probl√®mes de concurrence ?\",[\"$\",\"br\",null,{}],\"\\n\",\"L'op√©ration la plus √©vidente qui pourrait √™tre sujette √† des probl√®mes de concurrence est l'op√©ration de mise √† jour d'une pizza. En effet, si deux utilisateurs essaient de modifier la m√™me pizza en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es. Par exemple, si un utilisateur essaie de modifier le titre d'une pizza, et qu'un autre utilisateur essaie de modifier la description de la m√™me pizza en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour ajouter l'optimistic locking √† notre application, nous devons ajouter un champ de version √† l'entit√© \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Pizza\"}]}],\" et utiliser cet attribut pour g√©rer les conflits de version lors de la mise √† jour d'une pizza.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez donc mettre √† jour l'entit√© \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Pizza\"}]}],\" pour ajouter un champ de version :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Entity\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Table\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"name \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"pizzas\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Data\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@NoArgsConstructor\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Id\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@GeneratedValue\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"strategy \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"GenerationType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"IDENTITY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Column\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"nullable \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"false\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" title\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Column\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"nullable \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"false\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" content\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Column\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"nullable \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" imageLocation\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"20\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Version\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" version\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"A l'aide du client HTTP d'IntelliJ, veuillez ajouter une pizza en ex√©cutant la requ√™te de cr√©ation de pizza contenant une image contenue dans le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"/tests/java/pizzas.http\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Puis, via l'onglet \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Database\"}]}],\" d'IntelliJ, veuillez vous connecter √† votre DB local et v√©rifier que la pizza a bien √©t√© ajout√©e.\",[\"$\",\"br\",null,{}],\"\\n\",\"Vous devriez observer que la table \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Pizza\"}]}],\" de votre DB contient une nouvelle entr√©e avec un champ \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"version\"}]}],\" initialis√© √† \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"0\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"A chaque op√©ration de mise √† jour d'une pizza, le champ \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"version\"}]}],\" sera automatiquement incr√©ment√© par JPA.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez ex√©cuter la requ√™te de mise √† jour d'une pizza contenue dans le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"/tests/java/pizzas.http\"}]}],\".\",[\"$\",\"br\",null,{}],\"\\n\",\"Vous devriez observer que la version de la pizza a √©t√© incr√©ment√©e dans la DB, passant de \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"0\"}]}],\" √† \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"1\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Il est difficile de simuler un conflit de version avec le client HTTP d'IntelliJ, car les requ√™tes sont ex√©cut√©es de mani√®re s√©quentielle.\",[\"$\",\"br\",null,{}],\"\\n\",\"Pour ce cours, nous ne simulerons pas de conflit de version, mais vous pouvez imaginer que si deux utilisateurs tentent de modifier la m√™me pizza en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.\",[\"$\",\"br\",null,{}],\"\\n\",\"Dans ce cas, voici le code d√©j√† existant de \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PizzaService\"}]}],\" qui va soulever une exception \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"OptimisticLockException\"}]}],\" si la version de la pizza en m√©moire ne correspond pas √† la version de la pizza en base de donn√©es :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Transactional\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"updatePizza\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"NewPizza\"}],\" newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"3\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pizza\"}],\" pizza \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElse\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pizza \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"      pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getContent\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"      pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setContent\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newPizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getContent\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"15\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" pizzaRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"save\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pizza\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"En effet, lors du \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"save\"}]}],\" de la pizza, JPA v√©rifie automatiquement si la version de la pizza en m√©moire (retourn√©e par \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"pizzaRepository.findById(id).orElse(null)\"}]}],\") correspond √† la version de la pizza en base de donn√©es. Si ce n'est pas le cas, une exception \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"OptimisticLockException\"}]}],\" est lev√©e car √ßa signifierait qu'un autre utilisateur aurait mis √† jour la pizza entre le moment du \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"findById\"}]}],\" et du \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"save\"}]}],\".\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Optimistic locking dans une API RESTful avec lecture suivie d'une mise √† jour\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Dans une API RESTful, il est courant que le client effectue une requ√™te \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"GET\"}]}],\" pour r√©cup√©rer une ressource, puis une requ√™te \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PUT\"}]}],\" ou \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PATCH\"}]}],\" pour la mettre √† jour. Dans ce cas, il est n√©cessaire de v√©rifier que la version de la ressource n'a pas chang√© entre les deux requ√™tes.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Par exemple, si l'on veut assurer que deux clients ne modifient pas en m√™me temps le nom d'un produit, on doit v√©rifier que la version du produit n'a pas chang√© entre la lecture et la mise √† jour. Car si un client lit le produit, puis un autre client modifie le produit, le premier client pourrait √©craser les modifications du second client sans le savoir.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Principes pour g√©rer l'optimistic locking dans une API RESTful avec lecture suivie d'une mise √† jour\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Ajouter le champ \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Version\"}]}],\" dans l'entit√©\",[\"$\",\"br\",null,{}],\"\\n\",\"Le champ \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Version\"}]}],\" est utilis√© pour g√©rer l'optimistic locking. JPA v√©rifie automatiquement ce champ lors de la sauvegarde.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Entity\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Id\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@GeneratedValue\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"strategy \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"GenerationType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"IDENTITY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],\" name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" quantity\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"11\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Version\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" version\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Champ utilis√© pour l'optimistic locking\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Getters et setters\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"2\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Lecture de la ressource avec la version (GET)\",[\"$\",\"br\",null,{}],\"\\n\",\"Lorsqu'un client r√©cup√®re une ressource, incluez la version dans la r√©ponse pour qu'il puisse l'utiliser lors de la mise √† jour.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@GetMapping\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"/products/{id}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ProductDTO\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getProduct\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@PathVariable\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],\" product \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" productRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElseThrow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RuntimeException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Produit non trouv√©\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ProductDTO\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getId\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getVersion\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Code pour l'op√©ration de lecture d'un produit\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@GetMapping\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"/products/{id}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ProductDTO\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getProduct\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@PathVariable\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],\" product \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" productRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElseThrow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RuntimeException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Produit non trouv√©\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"15\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ProductDTO\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getId\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getVersion\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"3\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Mise √† jour de la ressource avec v√©rification de la version (PUT)\",[\"$\",\"br\",null,{}],\"\\n\",\"Lors de la mise √† jour, le client doit inclure la version qu'il a re√ßue dans la requ√™te. Si cette version ne correspond pas √† la version actuelle de la ressource, on d√©cide de lever une exception \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"OptimisticLockException\"}]}],\" seulement si le nom du produit a √©t√© mis √† jour.\",[\"$\",\"br\",null,{}],\"\\n\",\"De plus, JPA effectue automatiquement la v√©rification de la version si le champ \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Version\"}]}],\" est pr√©sent dans l'entit√© et que vous utilisez une m√©thode comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"save()\"}]}],\" pour persister l'entit√©. Lorsque vous appelez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"productRepository.save(product)\"}]}],\", JPA compare la version de l'entit√© en m√©moire avec celle en base de donn√©es.\",[\"$\",\"br\",null,{}],\"\\n\",\"Si elles ne correspondent pas (par exemple, si un autre client a modifi√© la ressource entre-temps), une exception \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"OptimisticLockException\"}]}],\" est aussi lev√©e.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Code pour l'op√©ration de mise √† jour d'un produit\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Transactional\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@PutMapping\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"/products/{id}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ResponseEntity\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Void\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"updateProduct\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@PathVariable\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@RequestBody\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UpdateProductRequest\"}],\" request\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],\" product \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" productRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElseThrow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RuntimeException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Produit non trouv√©\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" request\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getQuantityToRemove\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RuntimeException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Stock insuffisant\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// V√©rification explicite de la version \"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"13\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getVersion\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"equals\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"request\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getVersion\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"14\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"equals\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"request\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"15\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"OptimisticLockException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Conflit de version d√©tect√© lors du changement de nom\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"16\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"17\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Mise √† jour du nom\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[\"    product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"request\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getName\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Mise √† jour de la quantit√©\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"    product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" request\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getQuantityToRemove\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"    productRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"save\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ResponseEntity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"noContent\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Code pour UpdateProductRequest\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"UpdateProductRequest\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" string name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" quantityToRemove\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" version\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Version re√ßue lors de la lecture\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"34\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"35\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Getters et setters\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"36\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"4\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Gestion des conflits\"}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@ControllerAdvice\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"GlobalExceptionHandler\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@ExceptionHandler\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"OptimisticLockException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ResponseEntity\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handleOptimisticLockException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"OptimisticLockException\"}],\" ex\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ResponseEntity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"status\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HttpStatus\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"CONFLICT\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"body\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Conflit de version d√©tect√©\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"En cas de conflit de version, le gestionnaire global d'exceptions renvoie une r√©ponse \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"409 Conflict\"}]}],\" au client.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Le client peut alors g√©rer ce cas en r√©cup√©rant √† nouveau la ressource, en affichant un message √† l'utilisateur ou en effectuant une autre action appropri√©e.\",[\"$\",\"br\",null,{}],\"\\n\",\"Notamment, en cas de tentative de modification du nom du produit, le client peut afficher un message √† l'utilisateur pour l'informer du conflit et lui demander de confirmer la modification.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Il faudrait bien s√ªr adapter ce code √† votre application, en fonction de vos besoins et de votre architecture. Par exemple, vous pourriez ajouter un champs pour g√©rer la confirmation de la modification du nom du produit, ou ajouter des informations suppl√©mentaires dans la r√©ponse pour aider le client √† g√©rer le conflit.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"En savoir plus\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Si vous souhaitez en savoir plus sur l'optimistic locking, vous pouvez consulter cet article : \",[\"$\",\"a\",null,{\"href\":\"https://www.baeldung.com/jpa-optimistic-locking\",\"children\":\"https://www.baeldung.com/jpa-optimistic-locking\"}]]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"pessimistic_locking_dans_spring_boot\",\"children\":\" Pessimistic Locking dans Spring Boot \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Le pessimistic locking repose sur l'id√©e que les conflits sont fr√©quents. Avant de mettre √† jour une donn√©e, on verrouille la ressource pour emp√™cher tout autre processus de la modifier.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Le pessimistic locking est id√©al pour les sc√©narios o√π les conflits sont fr√©quents, comme la mise √† jour d'un stock de produits lorsque le stock peut √™tre modifi√© par √©norm√©ment d'utilisateurs en m√™me temps.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Bases pour le pessimistic locking\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici un exemple de pessimistic locking en Java avec JPA :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Partie du service pour mettre √† jour le stock d'un produit\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Transactional\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"updateStockWithPessimisticLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" productId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" quantityToAdd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],\" product \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" productRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findByIdWithLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"productId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElseThrow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RuntimeException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Produit non trouv√©\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"    product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" quantityToAdd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"    productRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"save\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Repository\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Repository\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"interface\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ProductRepository\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"extends\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"CrudRepository\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"15\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Lock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"LockModeType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PESSIMISTIC_WRITE\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Optional\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" productId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Avec JPA, vous pouvez utiliser \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Lock\"}]}],\" directement sur la m√©thode \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"findById\"}]}],\" pour appliquer un verrou pessimiste sans avoir besoin d'une requ√™te personnalis√©e.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Lock(LockModeType.PESSIMISTIC_WRITE)\"}]}],\" : Cette annotation permet d'appliquer un verrou pessimiste en √©criture sur la ressource. Cela signifie que la ressource est verrouill√©e pour emp√™cher tout autre processus de la modifier.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Dans cet exemple, le verrou pessimiste est appliqu√© lors de la recherche du produit √† mettre √† jour. Cela garantit qu'aucun autre processus ne peut modifier le produit tant que le verrou n'est pas lib√©r√©. A quel moment le verrou est-il lib√©r√© ? Le verrou est g√©n√©ralement lib√©r√© √† la fin de la transaction, c'est-√†-dire lorsque la m√©thode annot√©e avec \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional\"}]}],\" se termine.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Que se passe-t-il si un autre processus essaie de lire ou de modifier la ressource verrouill√©e ? Imaginons que 10 utilisateurs essaient de mettre √† jour le stock d'un produit en m√™me temps. Le premier utilisateur obtient le verrou et met √† jour le stock. Les 9 autres utilisateurs attendent que le verrou soit lib√©r√©. Une fois que le premier utilisateur a termin√©, le verrou est lib√©r√© et un des 9 autres utilisateurs obtient le verrou et met √† jour le stock. Les 8 autres utilisateurs attendent, et ainsi de suite.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Probl√®me √©ventuel de performance\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Le pessimistic locking peut entra√Æner des probl√®mes de performance si les verrous sont maintenus trop longtemps. Par exemple, si un utilisateur obtient un verrou et met √† jour le stock, mais ne termine pas l'op√©ration, le verrou est maintenu et les autres utilisateurs doivent attendre. Cela peut entra√Æner des probl√®mes de latence et de ralentissement.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Heureusement, si une exception est lev√©e, gr√¢ce √† la transaction \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional\"}]}],\", le verrou est automatiquement lib√©r√©.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour √©viter que les verrous ne soient maintenus trop longtemps, il est recommand√© de limiter la dur√©e des transactions en ajoutant un timeout. Par exemple, vous pouvez ajouter une annotation \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional(timeout = 10)\"}]}],\" pour limiter la dur√©e de la transaction √† 10 secondes. Si la transaction ne se termine pas dans les 10 secondes, une exception est lev√©e et le verrou est lib√©r√©.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Comment s'appelle l'exception lev√©e en cas de timeout ? L'exception lev√©e en cas de timeout est une \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"TransactionTimedOutException\"}]}],\". Cette exception est lev√©e si la transaction ne se termine pas dans le d√©lai imparti.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici notre exemple de pessimistic locking avec un timeout :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Transactional\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"timeout \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"updateStockWithPessimisticLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" productId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" quantityToAdd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],\" product \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" productRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findByIdWithLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"productId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElseThrow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RuntimeException\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Produit non trouv√©\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"    product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getQuantity\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" quantityToAdd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"    productRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"save\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"product\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Repository\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Repository\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"interface\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ProductRepository\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"extends\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"CrudRepository\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Lock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"LockModeType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PESSIMISTIC_WRITE\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Optional\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Product\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" productId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":\"\\n\"}]]}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Exemple concret\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez mettre √† jour votre projet GitLab contenant la gestion des Pizzas et des Boissons pour ajouter le pessimistic locking.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous allons imaginer un sc√©nario un peu tir√© par les cheveux o√π 100 utilisateurs essaient en m√™me temps de modifier une boisson. Nous sommes d'accord que c'est peu probable, mais cela nous permettra de simuler un cas de pessimistic locking.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Commen√ßons par mettre √† jour le repository \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"DrinkRepository\"}]}],\" pour ajouter le pessimistic locking :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Repository\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"interface\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"DrinkRepository\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"extends\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"CrudRepository\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Drink\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * Find all drinks with a price less than or equal to the given price.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"price\"}],\" the price\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@return\"}],\" the drinks\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Iterable\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Drink\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findAllByPriceLessThanEqual\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"double\"}],\" price\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"12\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"/**\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"13\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   * Find a drink by its id.\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"14\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   *\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"15\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":\"id\"}],\" the id\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"16\",\"children\":[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":[\"   * \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"@return\"}],\" the drink\\n\"]}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"17\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token doc-comment comment\",\"children\":\"   */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"18\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Override\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"19\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@NonNull\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"20\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Lock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"LockModeType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PESSIMISTIC_WRITE\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"21\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Optional\"}],[\"$\",\"span\",null,{\"className\":\"token generics\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Drink\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@NonNull\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous avons ajout√© l'annotation \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Lock(LockModeType.PESSIMISTIC_WRITE)\"}]}],\" sur la m√©thode \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"findById\"}]}],\" pour appliquer un verrou pessimiste en √©criture sur la ressource. Cela signifie que la ressource renvoy√©e par cette m√©thode est verrouill√©e pour emp√™cher tout autre processus de la modifier.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Ensuite, mettons √† jour le service \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"DrinkService\"}]}],\" pour l'op√©ration de mise √† jour d'une boisson :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token annotation punctuation\",\"children\":\"@Transactional\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"timeout \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Drink\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"updateOneDrink\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"NewDrink\"}],\" newDrink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"3\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Drink\"}],\" drink \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" drinkRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"findById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"orElse\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"drink \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newDrink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"      drink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newDrink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getTitle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newDrink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getImage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"      drink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setImage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newDrink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getImage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newDrink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getVolume\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0.0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"15\",\"children\":[\"      drink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setVolume\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newDrink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getVolume\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newDrink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getPrice\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0.0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"      drink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setPrice\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"newDrink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getPrice\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" drinkRepository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"save\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"drink\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Attention, pour importer l'annotation \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional\"}]}],\", vous devez ajouter l'import de \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"springframework\"}]}],\" et pas de \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"jakarta\"}]}],\" :\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-java\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-java code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token import\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"org\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"springframework\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"transaction\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"annotation\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Transactional\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous avons ajout√© l'annotation \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"@Transactional(timeout = 10)\"}]}],\" pour limiter la dur√©e de la transaction √† 10 secondes. Si la transaction ne se termine pas dans les 10 secondes, une exception \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"TransactionTimedOutException\"}]}],\" est lev√©e et le verrou est lib√©r√©.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Via le client HTTP d'IntelliJ, nous ne pouvons pas simuler un cas de pessimistic locking, car les requ√™tes sont ex√©cut√©es de mani√®re s√©quentielle.\",[\"$\",\"br\",null,{}],\"\\n\",\"Pour ce cours, nous ne simulerons pas de cas de pessimistic locking, mais vous pouvez imaginer que si 100 utilisateurs tentent de modifier la m√™me boisson en m√™me temps, il peut y avoir des probl√®mes de coh√©rence des donn√©es.\",[\"$\",\"br\",null,{}],\"\\n\",\"Ici le syst√®me de verrous assure que seul un utilisateur √† la fois peut modifier une boisson. Les autres utilisateurs doivent attendre que le verrou soit lib√©r√©.\",[\"$\",\"br\",null,{}],\"\\n\",\"Bien s√ªr, ce type de sc√©nario est peu probable dans la vraie vie, et est acceptable si l'on accepte que les donn√©es de la ressource puissent √™tre modifi√©es √† tour de r√¥le, garantissant la coh√©rence des donn√©es pour chaque modification, mais pas entre les modifications.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"En effet, si un utilisateur modifie une boisson, puis un autre utilisateur modifie la m√™me boisson, la deuxi√®me modification √©crasera la premi√®re, sans que cela ne pose de probl√®me de coh√©rence des donn√©es.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Mais qui d√©tient la v√©rit√© au niveau des donn√©es ? Le dernier utilisateur ? Si la r√©ponse √† cette question est oui, alors le pessimistic locking est une bonne solution. Si la r√©ponse est non, alors il faudra trouver une autre solution pour g√©rer la concurrence.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"üí≠ Quelle genre de solution ?\",[\"$\",\"br\",null,{}],\"\\n\",\"Une solution pourrait √™tre d'utiliser l'optimistic locking, qui permet de g√©rer les conflits de version entre les modifications de la ressource.  Il faudra alors renvoyer des codes HTTP d'erreurs aux utilisateurs qui tentent de modifier une ressource qui a √©t√© modifi√©e entre-temps, et leur demander de recharger la ressource pour obtenir la version la plus r√©cente.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Si n√©cessaire, vous pouvez trouver le code associ√© √† la gestion de transactions et de la concurrence ici : \",[\"$\",\"a\",null,{\"href\":\"https://github.com/e-vinci/cae-theory-demos/tree/main/concurrency\",\"children\":\"concurrency\"}],\".\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"En savoir plus\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Si vous souhaitez en savoir plus sur le pessimistic locking, vous pouvez consulter cet article : \",[\"$\",\"a\",null,{\"href\":\"https://www.baeldung.com/jpa-pessimistic-locking\",\"children\":\"https://www.baeldung.com/jpa-pessimistic-locking\"}]]}]]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Concurrence\"}]]\n"])</script><script>self.__next_f.push([1,"d:null\n"])</script></body></html>