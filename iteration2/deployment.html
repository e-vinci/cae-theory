<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/cae-theory/_next/static/css/fd89b796fb218fbf.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/cae-theory/_next/static/chunks/webpack-0335b56ac768253e.js"/><script src="/cae-theory/_next/static/chunks/4bd1b696-1c20c52a7d48565d.js" async=""></script><script src="/cae-theory/_next/static/chunks/517-35a1bc7953f03a32.js" async=""></script><script src="/cae-theory/_next/static/chunks/main-app-058efed246406231.js" async=""></script><script src="/cae-theory/_next/static/chunks/144-6ef9499ac178c5dc.js" async=""></script><script src="/cae-theory/_next/static/chunks/245-30e455921c0f8f22.js" async=""></script><script src="/cae-theory/_next/static/chunks/app/layout-a6c5d823159daef4.js" async=""></script><script src="/cae-theory/_next/static/chunks/830-d07b37352b41f989.js" async=""></script><script src="/cae-theory/_next/static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js" async=""></script><title>CAE Course</title><link rel="icon" type="image/svg+xml" href="/cae-theory/favicon.svg"/><title>Déploiement</title><script src="/cae-theory/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script><style data-emotion="mui-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-global 1o1x9wj">blockquote{border-left:5px solid #1976d2;background-color:rgba(0, 0, 0, 0.04);padding:0.5em;margin:1em 0;}table{width:100%;border-collapse:collapse;overflow-x:auto;display:block;}th{border:1px solid rgba(0, 0, 0, 0.12);padding:8px;background-color:#1976d2;color:#fff;font-weight:bold;}td{border:1px solid rgba(0, 0, 0, 0.12);padding:8px;}tr:nth-of-type(even){background-color:rgba(0, 0, 0, 0.04);}tr:hover{background-color:rgba(0, 0, 0, 0.08);}</style><style data-emotion="mui ljfsoa w6pz14 awgou1 tdg6lc 1mm3lge 1dya3jy q7mezt 1myx5lw 130f8nx 6n7j50 mcfrop o34szc 1xdhyk6 13wylk3 1oz5b8u 1gychr7 kxijxt wfm2y7 51eq8m 1ttcndq ub0mep 1nd5pgh ihsi0z 14rdsw0 fyswvn">.mui-ljfsoa{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;--AppBar-background:#1976d2;--AppBar-color:#fff;background-color:var(--AppBar-background);color:var(--AppBar-color);color:#fff;}.mui-w6pz14{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:var(--Paper-shadow);background-image:var(--Paper-overlay);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;--AppBar-background:#1976d2;--AppBar-color:#fff;background-color:var(--AppBar-background);color:var(--AppBar-color);color:#fff;}.mui-awgou1{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.mui-awgou1{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.mui-awgou1{min-height:48px;}}}@media (min-width:600px){.mui-awgou1{min-height:64px;}}.mui-tdg6lc{text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);margin-left:-12px;color:inherit;margin-right:16px;}.mui-tdg6lc:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.mui-tdg6lc:hover{background-color:transparent;}}.mui-tdg6lc.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.mui-tdg6lc.MuiIconButton-loading{color:transparent;}.mui-1mm3lge{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);margin-left:-12px;color:inherit;margin-right:16px;}.mui-1mm3lge::-moz-focus-inner{border-style:none;}.mui-1mm3lge.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-1mm3lge{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-1mm3lge:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.mui-1mm3lge:hover{background-color:transparent;}}.mui-1mm3lge.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.mui-1mm3lge.MuiIconButton-loading{color:transparent;}.mui-1dya3jy{display:none;position:absolute;visibility:visible;top:50%;left:50%;-webkit-transform:translate(-50%, -50%);-moz-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%);color:rgba(0, 0, 0, 0.26);}.mui-q7mezt{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;}.mui-1myx5lw{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:1.25rem;line-height:1.6;letter-spacing:0.0075em;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}@media (min-width:600px){.mui-1myx5lw{display:block;}}@media (min-width:0px){.mui-130f8nx{display:none;}}@media (min-width:600px){.mui-130f8nx{display:block;}}.mui-6n7j50{display:inline;}.mui-mcfrop{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 16px;border:0;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;padding:6px 8px;color:var(--variant-textColor);background-color:var(--variant-textBg);color:inherit;border-color:currentColor;--variant-containedBg:#e0e0e0;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#fff;}.mui-mcfrop:hover{-webkit-text-decoration:none;text-decoration:none;}.mui-mcfrop.Mui-disabled{color:rgba(0, 0, 0, 0.26);}@media (hover: hover){.mui-mcfrop:hover{--variant-containedBg:#f5f5f5;--variant-textBg:rgba(0, 0, 0, 0.04);--variant-outlinedBg:rgba(0, 0, 0, 0.04);}}.mui-mcfrop.MuiButton-loading{color:transparent;}.mui-o34szc{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 16px;border:0;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;padding:6px 8px;color:var(--variant-textColor);background-color:var(--variant-textBg);color:inherit;border-color:currentColor;--variant-containedBg:#e0e0e0;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#fff;}.mui-o34szc::-moz-focus-inner{border-style:none;}.mui-o34szc.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-o34szc{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-o34szc:hover{-webkit-text-decoration:none;text-decoration:none;}.mui-o34szc.Mui-disabled{color:rgba(0, 0, 0, 0.26);}@media (hover: hover){.mui-o34szc:hover{--variant-containedBg:#f5f5f5;--variant-textBg:rgba(0, 0, 0, 0.04);--variant-outlinedBg:rgba(0, 0, 0, 0.04);}}.mui-o34szc.MuiButton-loading{color:transparent;}.mui-1oz5b8u{z-index:1200;}@media (min-width:0px){.mui-1oz5b8u{display:block;}}@media (min-width:600px){.mui-1oz5b8u{display:none;}}.mui-1oz5b8u .MuiDrawer-paper{box-sizing:border-box;width:240px;color:#fff;background-color:#1976d2;}.mui-1gychr7{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;padding-left:16px;padding-right:16px;padding:1rem;word-wrap:break-word;}@media (min-width:600px){.mui-1gychr7{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.mui-1gychr7{max-width:1200px;}}.mui-kxijxt{list-style:none;margin:0;padding:0;position:relative;padding-top:8px;padding-bottom:8px;width:100%;border-radius:8px;border:1px solid;border-color:rgba(0, 0, 0, 0.12);padding:0.5rem;}.mui-wfm2y7{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:rgba(0, 0, 0, 0.6);}.mui-51eq8m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0;margin:0;list-style:none;}.mui-1ttcndq{-webkit-text-decoration:none;text-decoration:none;color:inherit;}.mui-1ttcndq:hover{-webkit-text-decoration:underline;text-decoration:underline;}.mui-ub0mep{margin:0;font:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;-webkit-text-decoration:none;text-decoration:none;color:inherit;}.mui-ub0mep:hover{-webkit-text-decoration:underline;text-decoration:underline;}.mui-1nd5pgh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin-left:8px;margin-right:8px;}.mui-ihsi0z{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;-webkit-text-decoration:none;text-decoration:none;width:100%;box-sizing:border-box;text-align:left;padding-top:8px;padding-bottom:8px;padding-left:16px;padding-right:16px;padding-top:0px;padding-bottom:0px;}.mui-14rdsw0{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;min-width:0;margin-top:4px;margin-bottom:4px;}.MuiTypography-root:where(.mui-14rdsw0 .MuiListItemText-primary){display:block;}.MuiTypography-root:where(.mui-14rdsw0 .MuiListItemText-secondary){display:block;}.mui-fyswvn{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}</style></head><body><header><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic mui-w6pz14" style="--Paper-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12)"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular mui-awgou1"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-edgeStart MuiIconButton-sizeMedium mui-1mm3lge" tabindex="0" type="button" id=":R1l5nb:" aria-label="open drawer"><span class="MuiIconButton-loadingIndicator mui-1dya3jy"></span><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuIcon"><path d="M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"></path></svg></button><div class="MuiTypography-root MuiTypography-h6 mui-1myx5lw">CAE</div><div class="MuiBox-root mui-130f8nx"><div class="MuiBox-root mui-6n7j50"><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" id=":R8rl5nb:" href="/cae-theory">Home</a></div><div class="MuiBox-root mui-6n7j50"><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" id=":R9bl5nb:" href="/cae-theory/intro">Intro</a></div><div class="MuiBox-root mui-6n7j50"><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" type="button" id=":Rprl5nb:">Qualité</button></div><div class="MuiBox-root mui-6n7j50"><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" type="button" id=":Rqbl5nb:">Itération 2</button></div><div class="MuiBox-root mui-6n7j50"><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit mui-o34szc" tabindex="0" id=":Rarl5nb:" href="/cae-theory/about">About</a></div></div></div></header><nav></nav></header><div class="MuiContainer-root MuiContainer-maxWidthLg mui-1gychr7"><ul class="MuiList-root MuiList-padding mui-kxijxt"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="HighlightOffIcon"><path d="M14.59 8 12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41zM12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"></path></svg><nav class="MuiTypography-root MuiTypography-body1 MuiBreadcrumbs-root mui-wfm2y7" aria-label="breadcrumb"><ol class="MuiBreadcrumbs-ol mui-51eq8m"><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="/cae-theory"> CAE </a></li><li aria-hidden="true" class="MuiBreadcrumbs-separator mui-1nd5pgh">/</li><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="/cae-theory/iteration2"> Itération 2 </a></li><li aria-hidden="true" class="MuiBreadcrumbs-separator mui-1nd5pgh">/</li><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#"> Déploiement </a></li></ol></nav><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#pourquoi_et_ou_deployer"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Pourquoi et où déployer ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_creer_un_compte_azure_avec_des_credits_gratuits"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment créer un compte Azure avec des crédits gratuits ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_deployer_notre_db"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment déployer notre DB ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_creer_un_environnement_local_proche_de_lenvironnement_de_staging"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment créer un environnement local proche de l&#x27;environnement de staging ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_est_il_possible_de_deployer_une_application_sur_azure_web_app_service"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment est-il possible de déployer une application sur Azure Web App Service ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_creer_une_application_sur_azure_web_app_service"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment créer une application sur Azure Web App Service ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_donner_acces_a_dautres_applications_a_une_azure_web_app"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment donner accès à d&#x27;autres applications à une Azure Web App ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_faire_un_push_des_images_de_git_lab_vers_azure_app_service"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment faire un push des images de GitLab vers Azure App Service ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_deployer_seulement_en_cas_de_fusion_de_modification_sur_le_main"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment déployer seulement en cas de fusion de modification sur le main ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_realiser_des_tests_e_2_e_sur_lapp_en_production"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment réaliser des tests e2e sur l&#x27;app en production ? </span></div></a></div><div class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ihsi0z"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-ub0mep" href="#comment_attendre_que_l_api_soit_bien_demarree_avant_de_lancer_les_tests_e_2_e"><div class="MuiListItemText-root mui-14rdsw0"><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary mui-fyswvn"> Comment attendre que l&#x27;API soit bien démarrée avant de lancer les tests e2e ? </span></div></a></div></ul>
<h1><a id="pourquoi_et_ou_deployer"> Pourquoi et où déployer ? </a></h1>
<h2>Introduction</h2>
<p>Le déploiement d&#x27;une application web est une étape cruciale dans le cycle de vie d&#x27;une application web. Il s&#x27;agit de rendre l&#x27;application accessible à ses utilisateurs finaux.</p>
<p>Dans ce cours, dans la partie sur la <a href="general">gestion des environnements</a>, nous avons déjà vu que nous allions utiliser :</p>
<ul>
<li><strong>GitLab CI/CD</strong> pour automatiser le déploiement de notre application (SaaS).</li>
<li><strong>Azure App Service</strong> pour héberger notre application (PaaS).</li>
</ul>
<p>En effet, lorsqu&#x27;on fait du DevOps, on va généralement utiliser des services cloud pour déployer nos applications. Cela permet de ne pas avoir à gérer l&#x27;infrastructure sous-jacente, et de se concentrer sur le développement de l&#x27;application.</p>
<h2>Staging environnement</h2>
<p>Le staging environnement est un environnement de test qui est une réplique de l&#x27;environnement de production. Il permet de tester l&#x27;application dans des conditions proches de la production avant de la déployer pour tous les utilisateurs finaux.</p>
<p>Le staging environnement est généralement utilisé pour :</p>
<ul>
<li>Tester les nouvelles fonctionnalités avant de les déployer en production.</li>
<li>Vérifier que les mises à jour de l&#x27;application ne causent pas de régressions.</li>
<li>Effectuer des tests de performance et de charge.</li>
</ul>
<p>Pour ce cours, nous allons d&#x27;abord déployer notre application sur le staging environnement. Nous verrons plus tard comment déployer l&#x27;application en production après la réussite de tests dans l&#x27;environnement de staging.</p>
<p>Tout ce que nous allons apprendre sur le déploiement de l&#x27;application sur le staging environnement sera applicable pour le déploiement en production.</p>
<p>Voici à quoi nous souhaitons que le staging environnement ressemble pour cette première étape de déploiement :</p>
<div>Loading...</div>
<p>Voici quelques points importants à noter sur le diagramme ci-dessus :</p>
<ul>
<li>Le frontend et l&#x27;API sont déployés sur un <strong>Azure App Service</strong>.</li>
<li>Pour les étudiants Vinci, le hosting de la DB est offert par la Haute École de Vinci. Pour les autres, vous pouvez utiliser un service cloud comme <strong>Azure Databse for PostgreSQL</strong>.</li>
</ul>
<p>Pour le déploiement, nous allons procéder en plusieurs étapes :</p>
<ol>
<li>Déploiement de la base de données vers le staging environnement. Lancement de notre API en nous connectant à la DB de staging.</li>
<li>Création d&#x27;une environnement local très proche de l&#x27;environnement de staging contenant le reverse proxy, le frontend et l&#x27;API au sein d&#x27;un Docker Compose, l&#x27;API se connectant à la DB de staging.</li>
<li>Déploiement du reverse proxy, du frontend et de l&#x27;API sur le staging environnement.</li>
<li>Réalisation des tests e2e sur le staging environnement à partir de GitLab CI/CD.</li>
</ol>
<p>Avant d&#x27;aller plus loin, nous allons d&#x27;abord voir comment créer un compte sur Azure afin d&#x27;avoir des crédits gratuits pour déployer notre application.</p>
<h1><a id="comment_creer_un_compte_azure_avec_des_credits_gratuits"> Comment créer un compte Azure avec des crédits gratuits ? </a></h1>
<p>Afin d&#x27;héberger notre application sur Azure, nous allons devoir créer un compte Azure. Heureusement, Microsoft offre des crédits gratuits :</p>
<ul>
<li>pour les étudiants : <a href="https://azure.microsoft.com/en-us/free/students/">https://azure.microsoft.com/en-us/free/students/</a></li>
<li>pour les non-étudiants : <a href="https://azure.microsoft.com/en-us/free/">https://azure.microsoft.com/en-us/free/</a> (attention, les crédits gratuits ne sont valables que pour 30 jours, et vous devrez ajouter une carte de crédit).</li>
<li>pour les startups : <a href="https://www.microsoft.com/en-us/startups">https://www.microsoft.com/en-us/startups</a></li>
</ul>
<p>Pour les étudiants Vinci, veuillez donc suivre les instructions sur le lien suivant : <a href="https://azure.microsoft.com/en-us/free/students/">https://azure.microsoft.com/en-us/free/students/</a><br/>
<!-- -->Vous devrez :</p>
<ul>
<li>vous logguer avec votre compte Vinci</li>
<li>introduire vos données et le Nom de l&#x27;école</li>
<li>cliquer sur <strong><code>Verify academic status</code></strong> et suivre les instructions</li>
</ul>
<h1><a id="comment_deployer_notre_db"> Comment déployer notre DB ? </a></h1>
<h2>Introduction</h2>
<p>Actuellement, notre application utilise une base de données locale dans un conteneur Docker.</p>
<p>Pour les étudiants Vinci, vous avez ou allez recevoir un email avec les informations de connexion à la base de données de la Haute École de Vinci.</p>
<p>Pour les autres :</p>
<ul>
<li>vous pouvez utiliser un service cloud comme <strong>Azure Database for PostgreSQL</strong> : <a href="https://azure.microsoft.com/en-us/products/postgresql/">https://azure.microsoft.com/en-us/products/postgresql/</a></li>
<li>veuillez créer une base de données PostgreSQL et noter les informations de connexion :<!-- -->
<ul>
<li><strong><code>url</code></strong> de connexion si vous l&#x27;avez, sinon vous pouvez la construire avec les informations suivantes :<!-- -->
<ul>
<li><strong><code>Host</code></strong></li>
<li><strong><code>Database</code></strong></li>
<li><strong><code>Port</code></strong></li>
<li>L&#x27;URL ressemblera à cela : <strong><code>jdbc:postgresql://&lt;Host&gt;:&lt;Port&gt;/&lt;Database&gt;</code></strong></li>
</ul>
</li>
<li><strong><code>Username</code></strong></li>
<li><strong><code>Password</code></strong></li>
</ul>
</li>
</ul>
<h2>Connexion à votre DB visible sur internet</h2>
<h3>Comment gérer l&#x27;environnement de développement et de staging ?</h3>
<p>Pour ce tutoriel (nommé <code>staging</code>), nous souhaitons pouvoir créer un environnement locale qui se connecte à la DB de staging à l&#x27;aide de Docker Compose. Pour ce tutoriel, veuillez créer une nouvelle &quot;feature branch&quot; sur votre projet GitLab (par exemple, vous pouvez la nommer <strong><code>chore/staging</code></strong>).</p>
<p>En fait, nous souhaitons :</p>
<ul>
<li>Quand nous démarrons notre API à l&#x27;aide d&#x27;IntelliJ, via notre environnement de développement, qu&#x27;elle se connecte à la DB dans le container Docker local (non visible sur internet).</li>
<li>Quand nous démarrons notre API à l&#x27;aide de Docker Compose, via notre environnement de staging, qu&#x27;elle se connecte à la DB de staging qui est visible sur internet.</li>
</ul>
<p>Comment rendre cela possible ?<br/>
<!-- -->Nous souhaitons que l&#x27;API se connecte à la DB en utilisant une URL de connexion qui est différente selon l&#x27;environnement. Pour ce faire, nous allons utiliser deux fichiers de configuration différents :</p>
<ul>
<li><strong><code>application.properties</code></strong> pour l&#x27;environnement de développement.</li>
<li><strong><code>application-staging.properties</code></strong> pour l&#x27;environnement de staging.</li>
</ul>
<h3>Comment gérer la configuration de l&#x27;environnement de staging ?</h3>
<p>Nous pourrions créer le fichier <strong><code>application-staging.properties</code></strong> dans le dossier <strong><code>src/main/resources</code></strong> de notre API avec le contenu suivant :</p>
<pre class="language-properties"><code class="language-properties code-highlight"><span class="code-line"><span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">demo</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">3000</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:postgresql://localhost:5432/cae_db</span>
</span><span class="code-line"><span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">cae_user</span>
</span><span class="code-line"><span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">cae</span>
</span><span class="code-line"><span class="token key attr-name">spring.jpa.generate-ddl</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</span><span class="code-line"><span class="token key attr-name">spring.sql.init.mode</span><span class="token punctuation">=</span><span class="token value attr-value">always</span>
</span><span class="code-line"><span class="token key attr-name">spring.jpa.defer-datasource-initialization</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</span></code></pre>
<p>Nous souhaiterions mettre à jour ce fichier pour qu&#x27;il se connecte à la DB de staging. Pour ce faire, une première idée serait de remplacer les valeurs de <strong><code>spring.datasource.url</code></strong>, <strong><code>spring.datasource.username</code></strong> et <strong><code>spring.datasource.password</code></strong> par les informations de connexion à notre DB.</p>
<p>Cependant, nous ne voulons pas stocker ces informations de connexion dans le code source de notre application. En effet, cela pourrait poser des problèmes de sécurité si notre code source est rendu public. C&#x27;est d&#x27;ailleurs une très mauvaise pratique de stocker des informations sensibles dans le code source.</p>
<p>Pour résoudre ce problème, nous allons utiliser les <strong>variables d&#x27;environnement</strong>. Les variables d&#x27;environnement sont des variables qui sont définies dans l&#x27;environnement d&#x27;exécution de notre application. Elles peuvent être utilisées pour stocker des informations sensibles comme les informations de connexion à la DB.</p>
<p>Pour ce faire, nous pourrions remplacer les valeurs de <strong><code>spring.datasource.url</code></strong>, <strong><code>spring.datasource.username</code></strong> et <strong><code>spring.datasource.password</code></strong> par des variables d&#x27;environnement directement au sein du fichier <strong><code>application-staging.properties</code></strong>.</p>
<p>Veuillez créer le fichier <strong><code>application-staging.properties</code></strong> dans le dossier <strong><code>src/main/resources</code></strong> de votre API avec le contenu suivant :</p>
<pre class="language-properties"><code class="language-properties code-highlight"><span class="code-line"><span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">demo</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">3000</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">${SPRING_DATASOURCE_URL}</span>
</span><span class="code-line"><span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">${SPRING_DATASOURCE_USERNAME}</span>
</span><span class="code-line"><span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">${SPRING_DATASOURCE_PASSWORD}</span>
</span><span class="code-line"><span class="token key attr-name">spring.jpa.generate-ddl</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</span><span class="code-line"><span class="token key attr-name">spring.sql.init.mode</span><span class="token punctuation">=</span><span class="token value attr-value">always</span>
</span><span class="code-line"><span class="token key attr-name">spring.jpa.defer-datasource-initialization</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</span></code></pre>
<p><strong><code>SPRING_DATASOURCE_URL</code></strong>, <strong><code>SPRING_DATASOURCE_USERNAME</code></strong> et <strong><code>SPRING_DATASOURCE_PASSWORD</code></strong> sont des variables d&#x27;environnement que nous allons définir dans notre environnement de staging.</p>
<p>Avant de passer à l&#x27;environnement de staging complet sur le cloud, il serait intéressant de voir si localement on pourrait démarrer nos services en utilisant la DB de staging. On peut imaginer deux scénarios :</p>
<ul>
<li>Scénario 1 : On utilise notre environnement de développement pour démarrer notre API et notre DB de staging.</li>
<li>Scénario 2 : On utilise Docker Compose pour démarrer notre API  (notre DB de staging est démarrée indépendamment de l&#x27;API et est visible sur internet).</li>
</ul>
<p>Même si le scénario 1 est plus simple, le scénario 2 est plus proche de ce que nous allons faire en production.</p>
<p>Nous allons premièrement voir comment démarrer notre API localement via notre environnement de développement. Lorsque nous passerons au déploiement de l&#x27;API &amp; du frontend, nous verrons comment démarrer notre API via Docker Compose.</p>
<h3>Comment démarrer notre API localement via notre environnement de développement avec une DB de stagging ?</h3>
<p>Pour démarrer notre API localement via notre environnement de développement avec une DB de staging, nous allons devoir définir les variables d&#x27;environnement <strong><code>SPRING_DATASOURCE_URL</code></strong>, <strong><code>SPRING_DATASOURCE_USERNAME</code></strong> et <strong><code>SPRING_DATASOURCE_PASSWORD</code></strong>.</p>
<p>Le plus simple est d&#x27;utiliser la librairie <strong><code>spring-dotenv</code></strong> pour définir ces variables d&#x27;environnement. <strong><code>spring-dotenv</code></strong> est une librairie qui permet de charger des variables d&#x27;environnement à partir d&#x27;un fichier <strong><code>.env</code></strong>.</p>
<p>Au sein de votre API, veuillez suivre ces instructions pour installer <strong><code>spring-dotenv</code></strong> (ajout de la bonne dépendance dans Maven) : <a href="https://github.com/paulschwarz/spring-dotenv">https://github.com/paulschwarz/spring-dotenv</a></p>
<p>Le fichier <strong><code>.env</code></strong> est un fichier qui contient les variables d&#x27;environnement que nous souhaitons définir pour, actuellement, l&#x27;API uniquement. Nous allons créer un fichier <strong><code>.env</code></strong> à la racine de notre dossier <strong><code>api</code></strong> avec le contenu suivant (remplacez les valeurs par celles de votre DB de staging) :</p>
<pre class="language-properties"><code class="language-properties code-highlight"><span class="code-line"><span class="token key attr-name">SPRING_DATASOURCE_URL</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:postgresql://hostnameOrIPToYourPostgresServer:YOUR_PORT/YOUR_DB_NAME</span>
</span><span class="code-line"><span class="token key attr-name">SPRING_DATASOURCE_USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">yourUsername   </span>
</span><span class="code-line"><span class="token key attr-name">SPRING_DATASOURCE_PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">yourPassword</span>
</span></code></pre>
<p>Attention à bien vous assurer que le fichier <strong><code>.env</code></strong> n&#x27;est pas versionné dans Git. Pour ce faire, vérifiez que <strong><code>.env</code></strong> est présent dans le fichier <strong><code>.gitignore</code></strong> de votre projet.</p>
<p>Pour démarrer notre API en utilisant le profil <strong><code>staging</code></strong>, nous savons déjà comment le faire via un terminal :</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">mvn spring-boot:run -Dspring-boot.run.profiles<span class="token operator">=</span>staging
</span></code></pre>
<p>Pour rappel, un profil dans Spring Boot est une manière de définir des configurations spécifiques pour un environnement donné. Dans notre cas, le profil <strong><code>staging</code></strong> est utilisé pour définir les configurations spécifiques à l&#x27;environnement de staging.</p>
<p>Par contre, comment démarrer notre API en utilisant le profil <strong><code>staging</code></strong> via IntelliJ ?</p>
<p>Veuillez ouvrir IntelliJ au niveau du projet associé à votre API et suivre ces instructions pour démarrer votre API en utilisant le profil <strong><code>staging</code></strong> :</p>
<ol>
<li>Cliquez sur <strong><code>Edit Configurations...</code></strong> dans le menu de configuration d&#x27;IntelliJ.</li>
<li>Sélectionnez la configuration <strong><code>Spring Boot</code></strong> de votre API (elle peut s&#x27;appeler <strong><code>DemoApplication</code></strong> par exemple).</li>
<li>En haut à gauche, cliquez sur l&#x27;icône <strong><code>Copy Configuration</code></strong> pour créer une nouvelle configuration.</li>
<li>Nommez cette nouvelle configuration <strong><code>Staging DB</code></strong> par exemple.</li>
<li>Dans le champ <strong><code>Active profiles</code></strong>, ajoutez <strong><code>staging</code></strong>.</li>
<li>Cliquez sur <strong><code>OK</code></strong> pour sauvegarder la configuration.</li>
</ol>
<p>Maintenant, vous pouvez démarrer votre API en utilisant le profil <strong><code>staging</code></strong> via IntelliJ en sélectionnant la configuration <strong><code>Staging DB</code></strong> et en cliquant sur le bouton <strong><code>Run</code></strong>.</p>
<p>Veuillez vérifier que votre API se connecte bien à la DB de staging en démarrant votre API via IntelliJ. N&#x27;hésitez pas à exécuter des requêtes HTTP pour vérifier que tout fonctionne correctement.</p>
<p>Nous allons maintenant voir comment démarrer notre API via Docker Compose en utilisant la DB de staging.</p>
<h1><a id="comment_creer_un_environnement_local_proche_de_lenvironnement_de_staging"> Comment créer un environnement local proche de l&#x27;environnement de staging ? </a></h1>
<h2>Introduction</h2>
<p>Avant de déployer notre API &amp; notre frontend, il est important de mettre en place tous les services nécessaires pour que notre application fonctionne correctement. Pour ce faire, nous allons utiliser Docker Compose.</p>
<p>Nous allons donc créer un environnement local qui se rapproche de l&#x27;environnement de staging, en mettant temporairement de côté les tests e2e pour avancer pas à pas. Cet environnement local sera composé de :</p>
<div>Loading...</div>
<p>Pour ce faire, nous allons créer un fichier <strong><code>docker-compose.local.staging.yml</code></strong> à la racine de notre projet GitLab avec le contenu suivant :</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line line-number" line="1"><span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">  <span class="token key atrule">frontend</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="3">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> frontend<span class="token punctuation">-</span>prod
</span><span class="code-line line-number" line="4">    <span class="token key atrule">image</span><span class="token punctuation">:</span> frontend<span class="token punctuation">-</span>prod
</span><span class="code-line line-number" line="5">    <span class="token key atrule">build</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="6">      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./frontend
</span><span class="code-line line-number" line="7">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="8">      <span class="token punctuation">-</span> 5172<span class="token punctuation">:</span><span class="token number">5172</span>
</span><span class="code-line line-number" line="9">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="10">      <span class="token punctuation">-</span> api
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">  <span class="token key atrule">api</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="13">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> api<span class="token punctuation">-</span>prod
</span><span class="code-line line-number" line="14">    <span class="token key atrule">image</span><span class="token punctuation">:</span> api<span class="token punctuation">-</span>prod
</span><span class="code-line line-number" line="15">    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./api
</span><span class="code-line line-number" line="16">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="17">      <span class="token punctuation">-</span> 3000<span class="token punctuation">:</span><span class="token number">3000</span>
</span><span class="code-line line-number highlight-line" line="18">    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="19">      <span class="token punctuation">-</span> SPRING_DATASOURCE_URL=$<span class="token punctuation">{</span>SPRING_DATASOURCE_URL<span class="token punctuation">}</span>
</span><span class="code-line line-number highlight-line" line="20">      <span class="token punctuation">-</span> SPRING_DATASOURCE_USERNAME=$<span class="token punctuation">{</span>SPRING_DATASOURCE_USERNAME<span class="token punctuation">}</span>
</span><span class="code-line line-number highlight-line" line="21">      <span class="token punctuation">-</span> SPRING_DATASOURCE_PASSWORD=$<span class="token punctuation">{</span>SPRING_DATASOURCE_PASSWORD<span class="token punctuation">}</span>
</span><span class="code-line line-number" line="22">    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-jar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;app.jar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--spring.profiles.active=staging&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="23">
</span><span class="code-line line-number" line="24">  <span class="token key atrule">reverse-proxy</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="25">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod
</span><span class="code-line line-number" line="26">    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine
</span><span class="code-line line-number" line="27">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="28">      <span class="token punctuation">-</span> <span class="token datetime number">80:80</span>
</span><span class="code-line line-number" line="29">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="30">      <span class="token punctuation">-</span> frontend
</span><span class="code-line line-number" line="31">      <span class="token punctuation">-</span> api
</span><span class="code-line line-number" line="32">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="33">      <span class="token punctuation">-</span> ./nginx.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf
</span></code></pre>
<p>C&#x27;est en fait notre précédente configuration de tests e2e, mais sans les tests e2e et sans la DB.</p>
<blockquote>
<p>Attention, nous avons aussi changé le profil actif de l&#x27;API en <strong><code>staging</code></strong> pour utiliser les variables d&#x27;environnement attendues dans le fichier <strong><code>application-staging.properties</code></strong>.</p>
</blockquote>
<p>Comment est-ce que les variables d&#x27;environnements sont rendues disponibles dans le service <strong><code>api</code></strong> ?</p>
<p>Nous allons devoir définir les variables d&#x27;environnement <strong><code>SPRING_DATASOURCE_URL</code></strong>, <strong><code>SPRING_DATASOURCE_USERNAME</code></strong> et <strong><code>SPRING_DATASOURCE_PASSWORD</code></strong> afin qu&#x27;elles soient disponibles dans le service <strong><code>api</code></strong> (au sein du conteneur de l&#x27;API).</p>
<p>Pour ce faire, nous pouvons utiliser le fichier <strong><code>.env</code></strong> que nous avons créé précédemment pour qu&#x27;il soit lu par Docker Compose. Le plus rapide et efficace est de lancer la commande suivante dans un terminal à la racine de votre projet GitLab :</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">docker</span> compose <span class="token parameter variable">-f</span> docker-compose.staging.yml --env-file api/.env up <span class="token parameter variable">--build</span> 
</span></code></pre>
<p>En effet, la commande <strong><code>--env-file api/.env</code></strong> permet de spécifier un fichier <strong><code>.env</code></strong> (qui se trouve dans le répertoire <strong><code>api</code></strong>) qui sera lu par Docker Compose et dont les variables d&#x27;environnement seront rendues disponibles pour les services. Les variables d&#x27;environnement définies dans ce fichier ne sont pas automatiquement injectées dans les conteneurs Docker par défaut. Vous devez explicitement les passer via la section <strong><code>environment:</code></strong> dans le fichier <strong><code>docker-compose.staging.yml</code></strong>.</p>
<p>Ainsi <strong><code>- SPRING_DATASOURCE_URL=${SPRING_DATASOURCE_URL}</code></strong> signifie que la variable d&#x27;environnement <strong><code>SPRING_DATASOURCE_URL</code></strong> sera disponible dans le conteneur de l&#x27;API avec la valeur de la variable d&#x27;environnement <strong><code>SPRING_DATASOURCE_URL</code></strong> définie dans le fichier <strong><code>.env</code></strong>.</p>
<p>Veuillez vérifier que tous vos services démarrent correctement en utilisant le fichier <strong><code>docker-compose.staging.yml</code></strong> : pour ce faire, il suffit d&#x27;ouvrir un navigateur et de naviguer sur <a href="http://localhost">http://localhost</a> pour vérifier que tout est fonctionnel.</p>
<p>Nous allons maintenant voir comment déployer notre application sur Azure Web App Service.</p>
<h1><a id="comment_est_il_possible_de_deployer_une_application_sur_azure_web_app_service"> Comment est-il possible de déployer une application sur Azure Web App Service ? </a></h1>
<h2>Introduction</h2>
<p>Maintenant que nous avons notre environnement de staging local qui fonctionne correctement, nous allons voir comment déployer notre application sur Azure Web App Service.</p>
<p>Azure Web App Service est un service cloud (PaaS) qui permet de déployer des applications web sans avoir à gérer l&#x27;infrastructure sous-jacente. Il est idéal pour déployer des applications web qui nécessitent une haute disponibilité et une scalabilité automatique.</p>
<h2>Comment déployer une application sur Azure Web App Service ?</h2>
<p>Il existe plusieurs façons de déployer une application sur Azure Web App Service</p>
<ul>
<li><strong>Publish code</strong> : vous pouvez publier votre code source directement sur Azure. Dans ce cas, vous devez choisir un runtime (Java, Node.js, Python, etc.) et Azure s&#x27;occupera de l&#x27;exécution de votre application. Vous devez créer autant de Web App que de services à déployer. Vous pouvez ensuite utiliser différent moyens pour pousser le code vers Azure : GitHub, Azure Repos, Local Git (CI/CD), External Git ou FTP.</li>
<li><strong>Publish single container</strong> : vous pouvez publier un conteneur Docker sur Azure. Dans ce cas, vous devez créer un conteneur Docker pour chaque service à déployer et les publier sur Azure.</li>
<li><strong>Publish docker compose</strong> : vous pouvez publier un fichier <strong><code>docker-compose.yml</code></strong> sur Azure. Dans ce cas, vous devez créer un fichier <strong><code>docker-compose.yml</code></strong> qui définit les services à déployer et les publier sur Azure. Le gros avantage de cette méthode est que vous pouvez déployer plusieurs services en une seule fois.</li>
</ul>
<p>Pour ce cours, nous allons utiliser la méthode <strong>Publish docker compose</strong> pour déployer tous nos services en une seule fois dans une seule Web App.</p>
<h1><a id="comment_creer_une_application_sur_azure_web_app_service"> Comment créer une application sur Azure Web App Service ? </a></h1>
<h2>Création d&#x27;une Azure Web App</h2>
<p>Vous devez avoir une <strong>subscription</strong> à Azure. Les instructions pour obtenir des crédits gratuits sont disponibles plus haut dans cette page.</p>
<p>Pour déployer une application sur Azure Web App Service, vous devez d&#x27;abord créer une <strong>Web App</strong>.</p>
<p>Il est possible de le faire via le portail Azure ou via la ligne de commande. Pour ce tutoriel, nous utiliserons le portail Azure.</p>
<p>Veuillez vous connecter au portail Azure : <a href="https://portal.azure.com/">https://portal.azure.com/</a></p>
<p>Cliquez ensuite sur <strong><code>App Services</code></strong>. Si vous avez bien une <strong>subscription</strong>, alors vous aurez l&#x27;option <strong><code>Create</code></strong>. Cliquez dessus.</p>
<p>Choisissez <strong><code>Web App</code></strong> et cliquez sur <strong><code>Create</code></strong>.</p>
<p>Dans la section <strong><code>Basics</code></strong>, remplissez les informations suivantes :</p>
<ul>
<li><strong><code>Subscription</code></strong> : choisissez votre subscription, probablement <strong><code>Azure for Students</code></strong>.</li>
<li><strong><code>Resource Group</code></strong> : créez un nouveau <strong><code>Resource Group</code></strong> ou utilisez un existant. Par exemple <strong><code>caeGroup</code></strong>.</li>
<li><strong><code>Name</code></strong> : donnez un nom à votre Web App. Par exemple <strong><code>cae-groupxy-staging-app</code></strong>.</li>
<li><strong><code>Publish</code></strong> : choisissez <strong><code>Container</code></strong>.</li>
<li><strong><code>Operating System</code></strong> : choisissez <strong><code>Linux</code></strong>.</li>
<li><strong><code>Region</code></strong> : choisissez une région disponible dans un plan gratuit. Par exemple <strong><code>Central US</code></strong>. Attention, si vous choisissez <strong><code>France Central</code></strong> par exemple, vous n&#x27;aurez pas de plan gratuit.</li>
<li><strong><code>Linux Plan</code></strong> : Garder le plan par défaut.</li>
<li><strong><code>Pricing plan</code></strong> : choisissez <strong><code>F1</code></strong> pour avoir un plan gratuit. 60 CPU minutes par jour sont inclues.</li>
<li>Cliquez sur <strong><code>Review + create</code></strong>.</li>
<li>Cliquez sur <strong><code>Create</code></strong>.</li>
<li>Cliquez sur <strong><code>Go to resource</code></strong>.</li>
<li>Notez l&#x27;URL de votre Web App, par exemple : <a href="https://cae-groupxy-staging-app-fza6c0ebghahfufh.centralus-01.azurewebsites.net/">https://cae-groupxy-staging-app-fza6c0ebghahfufh.centralus-01.azurewebsites.net/</a></li>
</ul>
<p>Avec votre browser, vous pouvez maintenant naviguer sur l&#x27;URL de votre Web App pour vérifier que tout fonctionne correctement. Vous devriez voir une page par défaut d&#x27;Azure : &quot;Welcome to nginx!&quot;.</p>
<h1><a id="comment_donner_acces_a_dautres_applications_a_une_azure_web_app"> Comment donner accès à d&#x27;autres applications à une Azure Web App ? </a></h1>
<h2>Introduction</h2>
<p>Maintenant que nous avons créé notre Web App, nous allons la configurer pour qu&#x27;elle puisse déployer tous nos services via Docker Compose à partir de GitLab.</p>
<h2>Création d&#x27;un service principal</h2>
<h3>Introduction</h3>
<p>Un <strong>service principal</strong> est une identité de sécurité utilisée par les applications, les services et les outils d&#x27;automatisation pour accéder aux ressources Azure.</p>
<p>Un service principal permet :</p>
<ul>
<li><strong>Une authentification sécurisée</strong> : Le service principal permettra à GitLab CI/CD de s&#x27;authentifier de manière sécurisée auprès d&#x27;Azure pour déployer des ressources.</li>
<li><strong>Un accès contrôlé</strong>: Vous pouvez définir des rôles et des autorisations spécifiques pour le service principal, limitant ainsi l&#x27;accès aux ressources nécessaires uniquement.</li>
<li><strong>Une automatisation</strong> : Le service principal permet d&#x27;automatiser les déploiements et les opérations sur Azure sans intervention manuelle.</li>
</ul>
<h3>🍬 Création d&#x27;un service principal en utilisant la ligne de commande Azure</h3>
<p>Pour les étudiants Vinci, cette procédure va probablement échouer car vous n&#x27;avez pas les droits nécessaires pour créer un service principal via la ligne de commande Azure. Passer donc à la section qui suit pour créer un service principal via le portail Azure.</p>
<p>Veuillez suivre les instructions suivantes pour créer un service principal à l&#x27;aide de la ligne de commande Azure :</p>
<ul>
<li>Connectez vous à votre portail Azure.</li>
<li>Ouvrez un cloud shell (icône en haut à droite).</li>
<li>Exécutez la commande suivante pour créer un service principal nommé <strong><code>staging-service-principal</code></strong> avec le rôle <strong><code>contributor</code></strong> sur le <strong><code>Resource Group</code></strong> de votre Web App :</li>
</ul>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">az ad sp create-for-rbac <span class="token parameter variable">--name</span> <span class="token string">&quot;staging-service-principal&quot;</span> <span class="token parameter variable">--role</span> contributor <span class="token parameter variable">--scopes</span> /subscriptions/<span class="token operator">&lt;</span>subscription-id<span class="token operator">&gt;</span>/resourceGroups/<span class="token operator">&lt;</span>staging-resource-group<span class="token operator">&gt;</span>
</span></code></pre>
<blockquote>
<p>Attention à ne pas avoir d&#x27;espaces inutiles dans la commande ! Un bon exemple serait : <strong><code>az ad sp create-for-rbac --name &quot;staging-service-principal&quot; --role contributor --scopes /subscriptions/ef4cb19c-8c1e-45dd-b46a-c5a0ece77c90/resourceGroups/caeGroup</code></strong>.</p>
</blockquote>
<p>Vous devez remplacer <strong><code>&lt;subscription-id&gt;</code></strong> par l&#x27;<strong><code>ID</code></strong> de votre subscription et <strong><code>&lt;staging-resource-group&gt;</code></strong> par le nom de votre <strong><code>Resource Group</code></strong> de staging.<br/>
<!-- -->Vous trouvez ces informations dans le portail Azure, en sélectionnant votre Web App, dans son <strong><code>Overview</code></strong> :</p>
<ul>
<li><strong><code>Subscription</code></strong> : <strong><code>Subscription ID</code></strong> (<strong><code>ef4cb19c-8c1e-45dd-b46a-c5a0ece77c90</code></strong> par exemple).</li>
<li><strong><code>Resource Group</code></strong> : <strong><code>Resource Group</code></strong> (<strong><code>caeGroup</code></strong> par exemple).</li>
</ul>
<p>Il est possible que vous ayez comme message : <code>Insufficient privileges to complete the operation.</code></p>
<p>Dans ce cas, il faut malheureusement utiliser le portail Azure pour créer le service principal.</p>
<h3>Création d&#x27;un service principal en utilisant le portail Azure</h3>
<p>Voici comment faire :</p>
<ul>
<li>Via le portail Azure,
D&#x27;abord cherchez :  <strong><code>App registrations</code></strong></li>
<li>Cliquez sur <strong><code>New registration</code></strong></li>
<li>Donnez un <strong><code>Name</code></strong> : <strong><code>staging ci/cd</code></strong> par exemple.</li>
<li>Laissez le reste tel quel et cliquez sur <strong><code>Register</code></strong>.</li>
</ul>
<p>Veuillez noter ces informations :</p>
<ul>
<li><strong><code>Application (client) ID</code></strong> : <strong><code>c4b1b1b1-1b1b-1b1b-1b1b-1b1b1b1b1b1b</code></strong> par exemple. C&#x27;est votre <strong><code>AZURE_CLIENT_ID</code></strong>.</li>
<li><strong><code>Directory (tenant) ID</code></strong> : <strong><code>d4b1b1b1-1b1b-1b1b-1b1b-1b1b1b1b1b1b</code></strong> par exemple. C&#x27;est votre <strong><code>AZURE_TENANT_ID</code></strong>.</li>
</ul>
<p>Ensuite, veuillez :</p>
<ul>
<li>Cliquer sur <strong><code>Manage</code></strong>, puis sur <strong><code>Certificates &amp; secrets</code></strong>.</li>
<li>Cliquer sur <strong><code>New client secret</code></strong>.</li>
<li>Donner un <strong><code>Description</code></strong> : <strong><code>gitlab ci/cd secret</code></strong> par exemple.</li>
<li>Choisir une <strong><code>Expires</code></strong> : <strong><code>730 days</code></strong> par exemple.</li>
<li>Cliquer sur <strong><code>Add</code></strong>.</li>
<li>Noter la <strong><code>Value</code></strong> de votre secret, comme par exemple : <strong><code>b4b1b1b1-1b1b-1b1b-1b1b-1b1b1b1b1b1b</code></strong>. C&#x27;est votre <strong><code>AZURE_CLIENT_SECRET</code></strong>.</li>
</ul>
<h3>Ajout du service principal à l&#x27;Azure Web App via le portail Azure</h3>
<p>Au niveau de votre Azure Web App (<strong><code>cae-groupxy-staging-app</code></strong> par exemple) via le portail Azure, veuillez :</p>
<ul>
<li>Cliquer sur <strong><code>Access control (IAM)</code></strong>.</li>
<li>Cliquer sur <strong><code>Add a role assignment</code></strong>.</li>
<li>Cliquer sur <strong><code>Members</code></strong>. <strong><code>User, group, or service principal</code></strong> est sélectionné par défaut.</li>
<li>Cliquer sur <strong><code>Select members</code></strong>.</li>
<li>Chercher le service principal (l&#x27;application que vous avez inscrite juste auparavant) que vous avez créé. Par exemple, <strong><code>staging ci/cd</code></strong>.</li>
<li>Cliquer sur <strong><code>Select</code></strong>.</li>
<li>Cliquer sur <strong><code>Role</code></strong>, puis sur <strong><code>Privileged administrator roles</code></strong>. Choisir <strong><code>Contributor</code></strong>.</li>
<li>Cliquer sur <strong><code>Review + assign</code></strong>.</li>
</ul>
<p>A la fin de cette étape, vous avez créé un service principal et vous l&#x27;avez ajouté à votre Web App avec le rôle <strong><code>Contributor</code></strong>.</p>
<p>Veuillez garder ces infos en lieu sûr : <strong><code>AZURE_CLIENT_SECRET</code></strong>, <strong><code>AZURE_TENANT_ID</code></strong>, <strong><code>AZURE_CLIENT_ID</code></strong>.
Ces infos seront nécessaires pour la suite !</p>
<p>Voici un exemple de ce que vous devriez avoir à la fin de cette étape :</p>
<pre class="language-properties"><code class="language-properties code-highlight"><span class="code-line"><span class="token key attr-name">AZURE_CLIENT_SECRET</span><span class="token punctuation">=</span><span class="token value attr-value">am45Q~jpcc2G64r3GumcGdYRE99cwxddfsqWeD8DcW1</span>
</span><span class="code-line"><span class="token key attr-name">AZURE_TENANT_ID</span><span class="token punctuation">=</span><span class="token value attr-value">f7a15dq7-57cb-5855-8d36-0545f95aada17</span>
</span><span class="code-line"><span class="token key attr-name">AZURE_CLIENT_ID</span><span class="token punctuation">=</span><span class="token value attr-value">fs8f6ea8-8807-4764-a394-f0bessqf7e8cbe</span>
</span></code></pre>
<h2>Configuration de la Web App pour les variables d&#x27;environnements attendues</h2>
<h3>Introduction</h3>
<p>Pour que notre Web App puisse se connecter correctement à notre DB de staging, nous devons définir les variables d&#x27;environnement <strong><code>SPRING_DATASOURCE_URL</code></strong>, <strong><code>SPRING_DATASOURCE_USERNAME</code></strong> et <strong><code>SPRING_DATASOURCE_PASSWORD</code></strong> au niveau de notre Web App.</p>
<p>En local, les variables d&#x27;environnement sont définies dans le fichier <strong><code>.env</code></strong>. Sur Azure, les variables d&#x27;environnement sont définies au niveau de la Web App. Ces secrets sont stockés de manière sécurisée dans Azure.</p>
<h3>Configuration des variables d&#x27;environnements</h3>
<p>Au niveau de votre Azure Web App (<strong><code>cae-groupxy-staging-app</code></strong> par exemple) via le portail Azure, veuillez :</p>
<ul>
<li>Cliquer sur <strong><code>Settings</code></strong>.</li>
<li>Cliquer sur <strong><code>Environment variables</code></strong>.</li>
<li>Ajouter les variables d&#x27;environnement suivantes en cliquant sur <strong><code>Add</code></strong> :<!-- -->
<ul>
<li><strong><code>SPRING_DATASOURCE_URL</code></strong> (<strong><code>Name</code></strong>): l&#x27;URL de connexion à votre DB de staging (<strong><code>Value</code></strong>). Cliquez sur <strong><code>Apply</code></strong>.</li>
<li><strong><code>SPRING_DATASOURCE_USERNAME</code></strong> (<strong><code>Name</code></strong>): le nom d&#x27;utilisateur de votre DB de staging (<strong><code>Value</code></strong>). Cliquez sur <strong><code>Apply</code></strong>.</li>
<li><strong><code>SPRING_DATASOURCE_PASSWORD</code></strong> (<strong><code>Name</code></strong>): le mot de passe de votre DB de staging (<strong><code>Value</code></strong>). Cliquez sur <strong><code>Apply</code></strong>.</li>
<li>N&#x27;oubliez pas de cliquer sur <strong><code>Apply</code></strong> pour sauvegarder l&#x27;ajout des 3 variables, puis <strong><code>Confirm</code></strong>.</li>
</ul>
</li>
</ul>
<p>Dans une prochaine étape, nous allons voir comment déployer notre application sur Azure Web App Service à l&#x27;aide de GitLab CI/CD.</p>
<h1><a id="comment_faire_un_push_des_images_de_git_lab_vers_azure_app_service"> Comment faire un push des images de GitLab vers Azure App Service ? </a></h1>
<h2>Introduction</h2>
<p>Maintenant que nous avons créé notre Web App et configuré les variables d&#x27;environnement, nous allons voir comment déployer nos services sur Azure Web App Service à l&#x27;aide de GitLab CI/CD.</p>
<p>Pour ce faire, nous allons d&#x27;abord pousser les images Docker de nos services vers le GitLab Registry. Ensuite, nous allons déployer ces images sur Azure Web App Service.</p>
<p>Le GitLab Registry est un registre Docker privé qui permet de stocker des images Docker.</p>
<p>Son rôle va être d&#x27;accueillir les images Docker de nos services. Ces images seront ensuite utilisées pour déployer nos services sur Azure Web App Service.</p>
<h2>Création d&#x27;un token d&#x27;accès pour le GitLab Registry</h2>
<p>Afin que Azure puisse accéder aux images qui se trouveront dans le GitLab Registry, nous allons devoir créer un token d&#x27;accès.</p>
<p>Pour ce faire, veuillez suivre les instructions suivantes :</p>
<ul>
<li>Connectez-vous à votre projet GitLab.</li>
<li>Cliquez sur <strong><code>Settings</code></strong>.</li>
<li>Cliquez sur <strong><code>Repository</code></strong>.</li>
<li>Cliquez sur <strong><code>Deploy Tokens</code></strong>.</li>
<li>Cliquez sur <strong><code>Add token</code></strong>.</li>
<li>Donnez un <strong><code>Name</code></strong> : <strong><code>pull-image-token</code></strong> par exemple.</li>
<li>Cochez <strong><code>read_registry</code></strong>.</li>
<li>Cliquez sur <strong><code>Create deploy token</code></strong>.</li>
<li>Notez le <strong><code>username</code></strong> (deviendra <strong><code>PULL_IMAGE_TOKEN_USERNAME</code></strong>) et le <strong><code>password</code></strong> (deviendra <strong><code>PULL_IMAGE_TOKEN_PASSWORD</code></strong>). Vous en aurez besoin pour la suite comme variables d&#x27;environnement.</li>
</ul>
<p>Voici un exemple de ce que vous devriez avoir noté à la fin de cette étape :</p>
<pre class="language-properties"><code class="language-properties code-highlight"><span class="code-line"><span class="token key attr-name">PULL_IMAGE_TOKEN_USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">gitlab+deploy-token-5667774</span>
</span><span class="code-line"><span class="token key attr-name">PULL_IMAGE_TOKEN_PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">gldt-Sc5rz_QATFUZDcXVb2CQ</span>
</span></code></pre>
<h2>Ajout des variables d&#x27;environnement pour l&#x27;accès au GitLab Registry depuis Azure</h2>
<p>Toujours dans votre projet GitLab, vous allez ajouter les variables d&#x27;environnement qui seront utilisées pour accéder au GitLab Registry depuis Azure.</p>
<p>Pour ce faire, veuillez suivre les instructions suivantes :</p>
<ul>
<li>Connectez-vous à votre projet GitLab.</li>
<li>Cliquez sur <strong><code>Settings</code></strong>.</li>
<li>Cliquez sur <strong><code>CI/CD</code></strong>.</li>
<li>Cliquez sur <strong><code>Variables</code></strong>.</li>
<li>Cliquez sur <strong><code>Add variable</code></strong>.</li>
<li>Ajoutez comme <strong><code>Key</code></strong> <strong><code>PULL_IMAGE_TOKEN_USERNAME</code></strong> et comme <strong><code>Value</code></strong> la valeur que vous avez notée précédemment.</li>
<li>Sélectionnez <strong><code>Masked</code></strong>.</li>
<li>Désélectionnez <strong><code>Protect variable</code></strong>.</li>
<li>Cliquez sur <strong><code>Add variable</code></strong>.</li>
<li>Ajoutez comme <strong><code>Key</code></strong> <strong><code>PULL_IMAGE_TOKEN_PASSWORD</code></strong> et comme <strong><code>Value</code></strong> la valeur que vous avez notée précédemment.</li>
<li>Sélectionnez <strong><code>Masked</code></strong>.</li>
<li>Désélectionnez <strong><code>Protect variable</code></strong>.</li>
<li>Cliquez sur <strong><code>Add variable</code></strong>.</li>
</ul>
<h2>Ajout des variables d&#x27;environnement pour l&#x27;accès à Azure</h2>
<p>Toujours dans votre projet GitLab, vous allez ajouter les variables d&#x27;environnement qui seront utilisées pour accéder à Azure depuis GitLab CI/CD.</p>
<p>Pour ce faire, veuillez suivre les instructions suivantes :</p>
<ul>
<li>Connectez-vous à votre projet GitLab.</li>
<li>Cliquez sur <strong><code>Settings</code></strong>.</li>
<li>Cliquez sur <strong><code>CI/CD</code></strong>.</li>
<li>Cliquez sur <strong><code>Variables</code></strong>.</li>
<li>Cliquez sur <strong><code>Add variable</code></strong>.</li>
<li>Ajoutez comme <strong><code>Key</code></strong> <strong><code>AZURE_CLIENT_SECRET</code></strong> et comme <strong><code>Value</code></strong> la valeur que vous avez notée précédemment.</li>
<li>Sélectionnez <strong><code>Masked</code></strong>.</li>
<li>Désélectionnez <strong><code>Protect variable</code></strong>.</li>
<li>Cliquez sur <strong><code>Add variable</code></strong>.</li>
<li>Ajoutez comme <strong><code>Key</code></strong> <strong><code>AZURE_TENANT_ID</code></strong> et comme <strong><code>Value</code></strong> la valeur que vous avez notée précédemment.</li>
<li>Sélectionnez <strong><code>Masked</code></strong>.</li>
<li>Désélectionnez <strong><code>Protect variable</code></strong>.</li>
<li>Cliquez sur <strong><code>Add variable</code></strong>.</li>
<li>Ajoutez comme <strong><code>Key</code></strong> <strong><code>AZURE_CLIENT_ID</code></strong> et comme <strong><code>Value</code></strong> la valeur que vous avez notée précédemment.</li>
<li>Sélectionnez <strong><code>Masked</code></strong>.</li>
<li>Désélectionnez <strong><code>Protect variable</code></strong>.</li>
<li>Cliquez sur <strong><code>Add variable</code></strong>.</li>
</ul>
<h2>Workflow de déploiement</h2>
<p>Voici le workflow de déploiement que nous allons suivre :</p>
<ol>
<li>Nous allons d&#x27;abord réaliser les tests de notre frontend et de notre API.</li>
<li>Si les tests passent, nous allons construire les images Docker de nos services et pousser ces images vers le GitLab Registry.</li>
<li>Nous allons déployer ces images sur Azure Web App Service. A partir de notre pipeline, nous allons nous connecter à Azure et déployer les images Docker sur notre Web App en demandant à Azure de faire un pull des images depuis le GitLab Registry.</li>
</ol>
<p>En image, voila ce que cela donne :</p>
<div>Loading...</div>
<h2>Création d&#x27;une image personnalisée pour le reverse proxy</h2>
<p>Pour le reverse proxy, nous souhaitons aussi avoir une image prête à être déployée sur Azure Web App Service. Pour ce faire, nous allons créer un fichier <strong><code>Dockerfile</code></strong> au sein d&#x27;un nouveau dossier <strong><code>reverse-proxy</code></strong> avec le contenu suivant :</p>
<pre class="language-dockerfile"><code class="language-dockerfile code-highlight"><span class="code-line"><span class="token instruction"><span class="token keyword">FROM</span> nginx:alpine</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">COPY</span> nginx.conf /etc/nginx/nginx.conf</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;nginx&quot;</span>, <span class="token string">&quot;-g&quot;</span>, <span class="token string">&quot;daemon off;&quot;</span>]</span>
</span></code></pre>
<p>Veuillez aussi copier le fichier <strong><code>nginx.conf</code></strong> contenu à la racine de votre projet GitLab dans le dossier <strong><code>reverse-proxy</code></strong>.</p>
<p>Nous devons mettre à jour le Docker Compose pour construire l&#x27;image de notre reverse proxy. Pour ce faire, veuillez mettre à jour le fichier <strong><code>docker-compose.staging.yml</code></strong> :</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line line-number" line="1"><span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">  <span class="token key atrule">frontend</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="3">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> frontend<span class="token punctuation">-</span>prod
</span><span class="code-line line-number" line="4">    <span class="token key atrule">image</span><span class="token punctuation">:</span> frontend<span class="token punctuation">-</span>prod
</span><span class="code-line line-number" line="5">    <span class="token key atrule">build</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="6">      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./frontend
</span><span class="code-line line-number" line="7">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="8">      <span class="token punctuation">-</span> 5172<span class="token punctuation">:</span><span class="token number">5172</span>
</span><span class="code-line line-number" line="9">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="10">      <span class="token punctuation">-</span> api
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">  <span class="token key atrule">api</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="13">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> api<span class="token punctuation">-</span>prod
</span><span class="code-line line-number" line="14">    <span class="token key atrule">image</span><span class="token punctuation">:</span> api<span class="token punctuation">-</span>prod
</span><span class="code-line line-number" line="15">    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./api
</span><span class="code-line line-number" line="16">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="17">      <span class="token punctuation">-</span> 3000<span class="token punctuation">:</span><span class="token number">3000</span>
</span><span class="code-line line-number" line="18">    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="19">      <span class="token punctuation">-</span> SPRING_DATASOURCE_URL=$<span class="token punctuation">{</span>SPRING_DATASOURCE_URL<span class="token punctuation">}</span>
</span><span class="code-line line-number" line="20">      <span class="token punctuation">-</span> SPRING_DATASOURCE_USERNAME=$<span class="token punctuation">{</span>SPRING_DATASOURCE_USERNAME<span class="token punctuation">}</span>
</span><span class="code-line line-number" line="21">      <span class="token punctuation">-</span> SPRING_DATASOURCE_PASSWORD=$<span class="token punctuation">{</span>SPRING_DATASOURCE_PASSWORD<span class="token punctuation">}</span>
</span><span class="code-line line-number" line="22">    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-jar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;app.jar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--spring.profiles.active=staging&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="23">
</span><span class="code-line line-number" line="24">  <span class="token key atrule">reverse-proxy</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="25">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod
</span><span class="code-line line-number highlight-line" line="26">    <span class="token key atrule">image</span><span class="token punctuation">:</span> reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod
</span><span class="code-line line-number highlight-line" line="27">    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./reverse<span class="token punctuation">-</span>proxy
</span><span class="code-line line-number" line="28">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="29">      <span class="token punctuation">-</span> <span class="token datetime number">80:80</span>
</span></code></pre>
<p>Pour le service <strong><code>reverse-proxy</code></strong>, nous avons ajouté la ligne <strong><code>build: ./reverse-proxy</code></strong> pour construire l&#x27;image de notre reverse proxy.</p>
<h2>Mise à jour du fichier .gitlab-ci.yml</h2>
<h3>Introduction</h3>
<p>Nous allons maintenant mettre à jour le fichier <strong><code>.gitlab-ci.yml</code></strong> pour déployer nos services sur Azure Web App Service :</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line line-number" line="1"><span class="token key atrule">stages</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">-</span> test
</span><span class="code-line line-number" line="3">  <span class="token punctuation">-</span> build
</span><span class="code-line line-number highlight-line" line="4">  <span class="token punctuation">-</span> staging
</span><span class="code-line line-number" line="5"><span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="6">  <span class="token key atrule">MAVEN_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository&quot;</span>
</span><span class="code-line line-number highlight-line" line="7">  <span class="token key atrule">VERSION</span><span class="token punctuation">:</span> $CI_PIPELINE_IID
</span><span class="code-line line-number highlight-line" line="8">  <span class="token key atrule">REGISTRY</span><span class="token punctuation">:</span> $CI_REGISTRY 
</span><span class="code-line line-number highlight-line" line="9">  <span class="token key atrule">REGISTRY_IMAGE_BASE_PATH</span><span class="token punctuation">:</span> $REGISTRY/$CI_PROJECT_PATH
</span><span class="code-line line-number highlight-line" line="10">  <span class="token key atrule">AZURE_WEBAPP_NAME</span><span class="token punctuation">:</span> cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app <span class="token comment"># Remplacer par le nom de votre Web App Azure</span>
</span><span class="code-line line-number highlight-line" line="11">  <span class="token key atrule">AZURE_WEBAPP_RESOURCE_GROUP</span><span class="token punctuation">:</span> caeGroup <span class="token comment"># Remplacer par le nom de votre Resource Group Azure</span>
</span><span class="code-line line-number" line="12">  
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14"><span class="token key atrule">api test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="15">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="16">  <span class="token key atrule">image</span><span class="token punctuation">:</span> maven<span class="token punctuation">:</span>3.9.9<span class="token punctuation">-</span>amazoncorretto<span class="token punctuation">-</span><span class="token number">21</span>
</span><span class="code-line line-number" line="17">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="18">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="19">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="20">        <span class="token punctuation">-</span> api/pom.xml
</span><span class="code-line line-number" line="21">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="22">      <span class="token punctuation">-</span> $CI_PROJECT_DIR/.m2/repository
</span><span class="code-line line-number" line="23">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="24">    <span class="token punctuation">-</span> cd api
</span><span class="code-line line-number" line="25">    <span class="token punctuation">-</span> mvn clean test
</span><span class="code-line line-number" line="26">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="27">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="28">      <span class="token punctuation">-</span> api/target/reports/
</span><span class="code-line line-number" line="29">      <span class="token punctuation">-</span> api/target/site/
</span><span class="code-line line-number" line="30">      <span class="token punctuation">-</span> api/target/surefire<span class="token punctuation">-</span>reports/
</span><span class="code-line line-number" line="31">
</span><span class="code-line line-number" line="32"><span class="token key atrule">frontend test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="33">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="34">  <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>alpine
</span><span class="code-line line-number" line="35">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="36">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="37">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="38">        <span class="token punctuation">-</span> frontend/package<span class="token punctuation">-</span>lock.json
</span><span class="code-line line-number" line="39">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="40">      <span class="token punctuation">-</span> frontend/node_modules
</span><span class="code-line line-number" line="41">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="42">    <span class="token punctuation">-</span> cd frontend
</span><span class="code-line line-number" line="43">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="44">    <span class="token punctuation">-</span> npm run lint
</span><span class="code-line line-number" line="45">    <span class="token punctuation">-</span> npm run coverage
</span><span class="code-line line-number" line="46">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="47">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="48">      <span class="token punctuation">-</span> frontend/coverage/
</span><span class="code-line line-number" line="49">
</span><span class="code-line line-number" line="50"><span class="token key atrule">build</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="51">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
</span><span class="code-line line-number" line="52">  <span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>latest
</span><span class="code-line line-number" line="53">  <span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="54">    <span class="token punctuation">-</span> docker<span class="token punctuation">:</span>20<span class="token punctuation">-</span>dind
</span><span class="code-line line-number highlight-line" line="55">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="56">    <span class="token punctuation">-</span> echo $CI_REGISTRY_PASSWORD <span class="token punctuation">|</span> docker login <span class="token punctuation">-</span>u $CI_REGISTRY_USER $CI_REGISTRY <span class="token punctuation">-</span><span class="token punctuation">-</span>password<span class="token punctuation">-</span>stdin
</span><span class="code-line line-number highlight-line" line="57">    <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>compose <span class="token punctuation">-</span>f docker<span class="token punctuation">-</span>compose.staging.yml build
</span><span class="code-line line-number highlight-line" line="58">    <span class="token punctuation">-</span> for service in frontend<span class="token punctuation">-</span>prod api<span class="token punctuation">-</span>prod reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod; do
</span><span class="code-line line-number highlight-line" line="59">        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number highlight-line" line="60">        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number highlight-line" line="61">        docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number highlight-line" line="62">        docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number highlight-line" line="63">      done
</span><span class="code-line line-number" line="64">
</span><span class="code-line line-number highlight-line" line="65"><span class="token key atrule">deploy</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="66">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number highlight-line" line="67">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/azure<span class="token punctuation">-</span>cli
</span><span class="code-line line-number highlight-line" line="68">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="69">    <span class="token punctuation">-</span> az login <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>principal <span class="token punctuation">-</span><span class="token punctuation">-</span>username $AZURE_CLIENT_ID <span class="token punctuation">-</span><span class="token punctuation">-</span>password $AZURE_CLIENT_SECRET <span class="token punctuation">-</span><span class="token punctuation">-</span>tenant $AZURE_TENANT_ID
</span><span class="code-line line-number highlight-line" line="70">    <span class="token punctuation">-</span> az webapp config container set <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>type compose <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>file docker<span class="token punctuation">-</span>compose.deploy.yml <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>user $PULL_IMAGE_TOKEN_USERNAME <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>password $PULL_IMAGE_TOKEN_PASSWORD
</span><span class="code-line line-number highlight-line" line="71">    <span class="token punctuation">-</span> az webapp start <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span></code></pre>
<p>Voici les changements apportés au fichier <strong><code>.gitlab-ci.yml</code></strong> :</p>
<ul>
<li>Nous avons ajouté une nouvelle variable <strong><code>VERSION</code></strong> qui contient l&#x27;identifiant du pipeline. Cette variable sera utilisée pour tagger les images Docker avec un numéro de version. <strong><code>$CI_PIPELINE_IID</code></strong> est une variable GitLab qui contient l&#x27;identifiant du pipeline.</li>
<li>Nous avons ajouté une nouvelle variable <strong><code>REGISTRY</code></strong> qui contient l&#x27;URL du GitLab Registry. <strong><code>$CI_REGISTRY</code></strong> est une variable GitLab qui contient l&#x27;URL du GitLab Registry.</li>
<li>Nous avons ajouté une nouvelle variable <strong><code>AZURE_WEBAPP_NAME</code></strong> qui doit être adaptée pour contenir le nom de notre Web App Azure.</li>
<li>Nous avons ajouté une nouvelle variable <strong><code>AZURE_WEBAPP_RESOURCE_GROUP</code></strong> qui doit être adapté pour contenir le nom du <strong><code>Resource Group</code></strong> de notre Web App Azure.</li>
<li><strong><code>echo $CI_REGISTRY_PASSWORD | docker login -u $CI_REGISTRY_USER $CI_REGISTRY --password-stdin</code></strong> : nous nous connectons au GitLab Registry en utilisant les variables d&#x27;environnement <strong><code>CI_REGISTRY_USER</code></strong> et <strong><code>CI_REGISTRY_PASSWORD</code></strong>. Ces variables sont automatiquement définies par GitLab.</li>
<li><strong><code>docker-compose -f docker-compose.staging.yml build</code></strong> : nous construisons les images Docker de nos services en utilisant le fichier <strong><code>docker-compose.staging.yml</code></strong>. Nous n&#x27;indiquons plus de fichier <strong><code>.env</code></strong> car les variables d&#x27;environnement sont définies au niveau de notre Web App Azure.</li>
<li><strong><code>for service in frontend-prod api-prod reverse-proxy-prod; do</code></strong> : boucle sur les services <strong><code>frontend-prod</code></strong>, <strong><code>api-prod</code></strong> et <strong><code>reverse-proxy-prod</code></strong> afin de tagger et pousser les images Docker vers le GitLab Registry.</li>
<li><strong><code>docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service:latest;</code></strong> : nous taggons l&#x27;image Docker avec le tag <strong><code>latest</code></strong>.</li>
<li><strong><code>docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service:$VERSION;</code></strong> : nous taggons l&#x27;image Docker avec le tag <strong><code>$VERSION</code></strong>.</li>
<li><strong><code>docker push $REGISTRY_IMAGE_BASE_PATH/$service:latest;</code></strong> : nous poussons l&#x27;image Docker vers le GitLab Registry avec le tag <strong><code>latest</code></strong>.</li>
<li><strong><code>docker push $REGISTRY_IMAGE_BASE_PATH/$service:$VERSION;</code></strong> : nous poussons l&#x27;image Docker vers le GitLab Registry avec le tag <strong><code>$VERSION</code></strong>.</li>
<li>Nous avons ajouté un nouveau job <strong><code>deploy</code></strong> qui va déployer nos services sur Azure Web App Service.</li>
<li><strong><code>az login --service-principal --username $AZURE_CLIENT_ID --password $AZURE_CLIENT_SECRET --tenant $AZURE_TENANT_ID</code></strong> : nous nous connectons à Azure en utilisant les variables d&#x27;environnement <strong><code>AZURE_CLIENT_ID</code></strong>, <strong><code>AZURE_CLIENT_SECRET</code></strong> et <strong><code>AZURE_TENANT_ID</code></strong>.</li>
<li><strong><code>az webapp config container set --name $AZURE_WEBAPP_NAME --resource-group $AZURE_WEBAPP_RESOURCE_GROUP --multicontainer-config-type compose --multicontainer-config-file docker-compose.deploy.yml --container-registry-user $PULL_IMAGE_TOKEN_USERNAME --container-registry-password $PULL_IMAGE_TOKEN_PASSWORD</code></strong> : nous déployons nos services sur Azure Web App Service en utilisant le fichier <strong><code>docker-compose.deploy.yml</code></strong> et les variables d&#x27;environnement <strong><code>PULL_IMAGE_TOKEN_USERNAME</code></strong> et <strong><code>PULL_IMAGE_TOKEN_PASSWORD</code></strong>.</li>
<li><strong><code>az webapp start --name $AZURE_WEBAPP_NAME --resource-group $AZURE_WEBAPP_RESOURCE_GROUP</code></strong> : nous démarrons notre Web App Azure.</li>
</ul>
<p>Nous allons maintenant voir comment créer le fichier <strong><code>docker-compose.deploy.yml</code></strong> qui sera utilisé par Azure pour faire un pull des images Docker depuis le GitLab Registry.</p>
<h2>Création du fichier docker-compose.deploy.yml</h2>
<p>Nous allons créer un fichier <strong><code>docker-compose.deploy.yml</code></strong> à la racine de notre projet GitLab avec le contenu suivant :</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">frontend</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.gitlab.com/e<span class="token punctuation">-</span>vinci/cae<span class="token punctuation">-</span>projects/2025<span class="token punctuation">-</span>cae<span class="token punctuation">-</span>projects/cae<span class="token punctuation">-</span>group<span class="token punctuation">-</span>xy/frontend<span class="token punctuation">-</span>prod<span class="token punctuation">:</span>latest <span class="token comment"># Remplacer par l&#x27;image Docker de votre frontend</span>
</span><span class="code-line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> frontend<span class="token punctuation">-</span>prod
</span><span class="code-line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> 5172<span class="token punctuation">:</span><span class="token number">5172</span>
</span><span class="code-line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> api
</span><span class="code-line">
</span><span class="code-line">  <span class="token key atrule">api</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.gitlab.com/e<span class="token punctuation">-</span>vinci/cae<span class="token punctuation">-</span>projects/2025<span class="token punctuation">-</span>cae<span class="token punctuation">-</span>projects/cae<span class="token punctuation">-</span>group<span class="token punctuation">-</span>xy/api<span class="token punctuation">-</span>prod<span class="token punctuation">:</span>latest <span class="token comment"># Remplacer par l&#x27;image Docker de votre API</span>
</span><span class="code-line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> api<span class="token punctuation">-</span>prod
</span><span class="code-line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> 3000<span class="token punctuation">:</span><span class="token number">3000</span>
</span><span class="code-line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> SPRING_DATASOURCE_URL=$<span class="token punctuation">{</span>SPRING_DATASOURCE_URL<span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token punctuation">-</span> SPRING_DATASOURCE_USERNAME=$<span class="token punctuation">{</span>SPRING_DATASOURCE_USERNAME<span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token punctuation">-</span> SPRING_DATASOURCE_PASSWORD=$<span class="token punctuation">{</span>SPRING_DATASOURCE_PASSWORD<span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-jar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;app.jar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--spring.profiles.active=staging&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token key atrule">reverse-proxy</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.gitlab.com/e<span class="token punctuation">-</span>vinci/cae<span class="token punctuation">-</span>projects/2025<span class="token punctuation">-</span>cae<span class="token punctuation">-</span>projects/cae<span class="token punctuation">-</span>group<span class="token punctuation">-</span>xy/reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod<span class="token punctuation">:</span>latest <span class="token comment"># Remplacer par l&#x27;image Docker de votre reverse proxy</span>
</span><span class="code-line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod
</span><span class="code-line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token datetime number">80:80</span>
</span></code></pre>
<p>Ce fichier <strong><code>docker-compose.deploy.yml</code></strong> est similaire au fichier <strong><code>docker-compose.staging.yml</code></strong>. La seule différence est que nous utilisons les images Docker que nous avons poussées vers le GitLab Registry.</p>
<p>Pour connaître le chemin de vos images Docker dans le GitLab Registry, veuillez suivre les instructions suivantes :</p>
<ul>
<li>Connectez-vous à votre projet GitLab.</li>
<li>Cliquez sur <strong><code>Deploy</code></strong>.</li>
<li>Cliquez sur <strong><code>Container Registry</code></strong>.</li>
<li>Vous verrez les images Docker de vos services. Cliquez sur une image pour voir les tags disponibles.</li>
<li>En cliquant sur un tag, vous verrez le chemin complet de l&#x27;image Docker. Par exemple : <strong><code>Published to the e-vinci/cae-projects/2025-cae-projects/cae-group-xy/reverse-proxy-prod image repository on 19 February 2025 at 19:10:39 CET</code></strong>.</li>
</ul>
<p>Une fois toutes ces étapes réalisées, vous pouvez lancer le pipeline GitLab CI/CD pour déployer vos services sur Azure Web App Service. Pour ce faire, il suffit de pousser votre code sur votre repository GitLab.</p>
<p>Si tout se passe bien, vous devriez voir vos services déployés sur Azure Web App Service. Vous pouvez vérifier que tout fonctionne correctement en naviguant sur l&#x27;URL de votre Web App Azure, par exemple : <a href="https://cae-groupxy-staging-app-fza6c0ebghahfufh.centralus-01.azurewebsites.net/">https://cae-groupxy-staging-app-fza6c0ebghahfufh.centralus-01.azurewebsites.net/</a>.</p>
<h2>Dois-je arrêter ma Web App Azure pour ne pas consommer de minutes CPU ?</h2>
<p>Les 60 minutes de CPU par jour sur Azure Web App Service (plan gratuit F1) se réfèrent à l&#x27;utilisation totale du processeur par votre application, y compris le traitement des requêtes HTTP et toute autre activité nécessitant des ressources CPU. Ce n&#x27;est pas limité au temps de build. Si votre application consomme beaucoup de CPU, vous pourriez dépasser les 60 minutes de CPU par jour.</p>
<p>Vous pouvez arrêter votre Web App Azure pour ne pas consommer de CPU minutes. Pour ce faire, veuillez suivre les instructions suivantes :</p>
<ul>
<li>Connectez-vous à votre portail Azure.</li>
<li>Cliquez sur <strong><code>App Services</code></strong>.</li>
<li>Sélectionnez votre Web App.</li>
<li>Cliquez sur <strong><code>Stop</code></strong>.</li>
</ul>
<p>Pour la redémarrer, il suffit de cliquer sur <strong><code>Start</code></strong>.</p>
<p>Pour voir votre consommation de CPU, vous pouvez suivre les instructions suivantes :</p>
<ul>
<li>Connectez-vous à votre portail Azure.</li>
<li>Cliquez sur <strong><code>App Services</code></strong>.</li>
<li>Sélectionnez votre Web App.</li>
<li>Cliquez sur <strong><code>Monitoring</code></strong>.</li>
<li>Cliquez sur <strong><code>Metrics</code></strong>.</li>
<li>Sélectionnez <strong><code>CPU Time</code></strong> au niveau de <strong><code>Metric</code></strong>.</li>
</ul>
<h1><a id="comment_deployer_seulement_en_cas_de_fusion_de_modification_sur_le_main"> Comment déployer seulement en cas de fusion de modification sur le main ? </a></h1>
<h2>Introduction</h2>
<p>Nous allons voir comment déployer nos services sur Azure Web App Service uniquement en cas de fusion de modifications sur la branche <strong><code>main</code></strong>.</p>
<p>En fait, c&#x27;est quelque chose que nous avons déjà vu. Nous allons simplement ajouter une condition à notre job <strong><code>deploy</code></strong> pour qu&#x27;il ne s&#x27;exécute que si nous fusionnons des modifications sur la branche <strong><code>main</code></strong>.</p>
<h2>Mise à jour du fichier .gitlab-ci.yml</h2>
<p>Veuillez mettre à jour le fichier <strong><code>.gitlab-ci.yml</code></strong> pour déployer nos services sur Azure Web App Service uniquement en cas de fusion de modifications sur la branche <strong><code>main</code></strong> :</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line line-number" line="1"><span class="token key atrule">stages</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">-</span> test
</span><span class="code-line line-number" line="3">  <span class="token punctuation">-</span> build
</span><span class="code-line line-number" line="4">  <span class="token punctuation">-</span> staging
</span><span class="code-line line-number" line="5"><span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="6">  <span class="token key atrule">MAVEN_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository&quot;</span>
</span><span class="code-line line-number" line="7">  <span class="token key atrule">VERSION</span><span class="token punctuation">:</span> $CI_PIPELINE_IID
</span><span class="code-line line-number" line="8">  <span class="token key atrule">REGISTRY</span><span class="token punctuation">:</span> $CI_REGISTRY 
</span><span class="code-line line-number" line="9">  <span class="token key atrule">REGISTRY_IMAGE_BASE_PATH</span><span class="token punctuation">:</span> $REGISTRY/$CI_PROJECT_PATH
</span><span class="code-line line-number" line="10">  <span class="token key atrule">AZURE_WEBAPP_NAME</span><span class="token punctuation">:</span> cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app
</span><span class="code-line line-number" line="11">  <span class="token key atrule">AZURE_WEBAPP_RESOURCE_GROUP</span><span class="token punctuation">:</span> caeGroup
</span><span class="code-line line-number" line="12">  
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14"><span class="token key atrule">api test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="15">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="16">  <span class="token key atrule">image</span><span class="token punctuation">:</span> maven<span class="token punctuation">:</span>3.9.9<span class="token punctuation">-</span>amazoncorretto<span class="token punctuation">-</span><span class="token number">21</span>
</span><span class="code-line line-number" line="17">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="18">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="19">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="20">        <span class="token punctuation">-</span> api/pom.xml
</span><span class="code-line line-number" line="21">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="22">      <span class="token punctuation">-</span> $CI_PROJECT_DIR/.m2/repository
</span><span class="code-line line-number" line="23">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="24">    <span class="token punctuation">-</span> cd api
</span><span class="code-line line-number" line="25">    <span class="token punctuation">-</span> mvn clean test
</span><span class="code-line line-number" line="26">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="27">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="28">      <span class="token punctuation">-</span> api/target/reports/
</span><span class="code-line line-number" line="29">      <span class="token punctuation">-</span> api/target/site/
</span><span class="code-line line-number" line="30">      <span class="token punctuation">-</span> api/target/surefire<span class="token punctuation">-</span>reports/
</span><span class="code-line line-number" line="31">
</span><span class="code-line line-number" line="32"><span class="token key atrule">frontend test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="33">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="34">  <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>alpine
</span><span class="code-line line-number" line="35">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="36">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="37">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="38">        <span class="token punctuation">-</span> frontend/package<span class="token punctuation">-</span>lock.json
</span><span class="code-line line-number" line="39">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="40">      <span class="token punctuation">-</span> frontend/node_modules
</span><span class="code-line line-number" line="41">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="42">    <span class="token punctuation">-</span> cd frontend
</span><span class="code-line line-number" line="43">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="44">    <span class="token punctuation">-</span> npm run lint
</span><span class="code-line line-number" line="45">    <span class="token punctuation">-</span> npm run coverage
</span><span class="code-line line-number" line="46">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="47">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="48">      <span class="token punctuation">-</span> frontend/coverage/
</span><span class="code-line line-number" line="49">
</span><span class="code-line line-number" line="50"><span class="token key atrule">build</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="51">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
</span><span class="code-line line-number" line="52">  <span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>latest
</span><span class="code-line line-number" line="53">  <span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="54">    <span class="token punctuation">-</span> docker<span class="token punctuation">:</span>20<span class="token punctuation">-</span>dind
</span><span class="code-line line-number" line="55">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="56">    <span class="token punctuation">-</span> echo $CI_REGISTRY_PASSWORD <span class="token punctuation">|</span> docker login <span class="token punctuation">-</span>u $CI_REGISTRY_USER $CI_REGISTRY <span class="token punctuation">-</span><span class="token punctuation">-</span>password<span class="token punctuation">-</span>stdin
</span><span class="code-line line-number" line="57">    <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>compose <span class="token punctuation">-</span>f docker<span class="token punctuation">-</span>compose.staging.yml build
</span><span class="code-line line-number" line="58">    <span class="token punctuation">-</span> for service in frontend<span class="token punctuation">-</span>prod api<span class="token punctuation">-</span>prod reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod; do
</span><span class="code-line line-number" line="59">        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="60">        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="61">        docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="62">        docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="63">      done
</span><span class="code-line line-number" line="64">
</span><span class="code-line line-number" line="65"><span class="token key atrule">deploy</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="66">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="67">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/azure<span class="token punctuation">-</span>cli
</span><span class="code-line line-number highlight-line" line="68">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>       
</span><span class="code-line line-number highlight-line" line="69">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="70">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="71">    <span class="token punctuation">-</span> az login <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>principal <span class="token punctuation">-</span><span class="token punctuation">-</span>username $AZURE_CLIENT_ID <span class="token punctuation">-</span><span class="token punctuation">-</span>password $AZURE_CLIENT_SECRET <span class="token punctuation">-</span><span class="token punctuation">-</span>tenant $AZURE_TENANT_ID
</span><span class="code-line line-number" line="72">    <span class="token punctuation">-</span> az webapp config container set <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>type compose <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>file docker<span class="token punctuation">-</span>compose.deploy.yml <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>user $PULL_IMAGE_TOKEN_USERNAME <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>password $PULL_IMAGE_TOKEN_PASSWORD
</span><span class="code-line line-number" line="73">    <span class="token punctuation">-</span> az webapp start <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span></code></pre>
<p><strong><code>if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH</code></strong> : cette condition permet de vérifier si le nom de la branche de la fusion de modifications est égal au nom de la branche par défaut. Si c&#x27;est le cas, le job <strong><code>deploy</code></strong> s&#x27;exécute. Sinon, il ne s&#x27;exécute pas.</p>
<p>Veuillez faire un push de vos modifications sur votre &quot;feature branch&quot;. Vous devriez voir que le job <strong><code>deploy</code></strong> ne s&#x27;exécute pas.</p>
<p>Si vous fusionnez vos modifications sur la branche <strong><code>main</code></strong>, le job <strong><code>deploy</code></strong> s&#x27;exécutera. Nous n&#x27;allons pas tout de suite le faire car nous allons voir comment réaliser des tests e2e sur notre application en production.</p>
<h1><a id="comment_realiser_des_tests_e_2_e_sur_lapp_en_production"> Comment réaliser des tests e2e sur l&#x27;app en production ? </a></h1>
<h2>Introduction</h2>
<p>Dans l&#x27;environnement de tests, nous avons réalisés les tests e2e directement au sein d&#x27;un réseau Docker.</p>
<p>Dans l&#x27;environnement de staging, nous souhaitons réaliser les tests e2e sur les services déployés sur Azure Web App Service.</p>
<p>Voici le workflow que nous allons suivre :</p>
<div>Loading...</div>
<h2>Mise à jour de la configuration des tests e2e</h2>
<p>Dans la configuration de Playwright, nous devons mettre à jour l&#x27;URL de notre application pour qu&#x27;elle pointe vers notre Web App Azure.
Pour le faire correctement, nous allons ajouter une nouvelle variable d&#x27;environnement <strong><code>BASE_URL</code></strong> au niveau de notre Web App Azure afin de pouvoir facilement réaliser les tests e2e quel que soit l&#x27;environnement.</p>
<p>Veuillez mettre à jour le fichier <strong><code>playwright.config.ts</code></strong> au niveau de votre projet <strong><code>e2e</code></strong> :</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line">baseURL<span class="token operator">:</span>
</span><span class="code-line">      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span>
</span><span class="code-line">      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;development&quot;</span>
</span><span class="code-line">        <span class="token operator">?</span> <span class="token string">&quot;http://localhost:5173&quot;</span>
</span><span class="code-line">        <span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span> <span class="token operator">===</span> <span class="token keyword">undefined</span>
</span><span class="code-line">        <span class="token operator">?</span> <span class="token string">&quot;http://reverse-proxy:80&quot;</span>
</span><span class="code-line">        <span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span><span class="token punctuation">,</span>
</span></code></pre>
<h2>Mise à jour du fichier .gitlab-ci.yml</h2>
<p>Veuillez mettre à jour le fichier <strong><code>.gitlab-ci.yml</code></strong> pour réaliser les tests e2e sur notre application en production :</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line line-number" line="1"><span class="token key atrule">stages</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">-</span> test
</span><span class="code-line line-number" line="3">  <span class="token punctuation">-</span> build
</span><span class="code-line line-number" line="4">  <span class="token punctuation">-</span> staging
</span><span class="code-line line-number highlight-line" line="5">  <span class="token punctuation">-</span> e2e
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="8">  <span class="token key atrule">MAVEN_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository&quot;</span>
</span><span class="code-line line-number" line="9">  <span class="token key atrule">VERSION</span><span class="token punctuation">:</span> $CI_PIPELINE_IID
</span><span class="code-line line-number" line="10">  <span class="token key atrule">REGISTRY</span><span class="token punctuation">:</span> $CI_REGISTRY 
</span><span class="code-line line-number" line="11">  <span class="token key atrule">REGISTRY_IMAGE_BASE_PATH</span><span class="token punctuation">:</span> $REGISTRY/$CI_PROJECT_PATH
</span><span class="code-line line-number" line="12">  <span class="token key atrule">AZURE_WEBAPP_NAME</span><span class="token punctuation">:</span> cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app
</span><span class="code-line line-number" line="13">  <span class="token key atrule">AZURE_WEBAPP_RESOURCE_GROUP</span><span class="token punctuation">:</span> caeGroup
</span><span class="code-line line-number highlight-line" line="14">  <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app<span class="token punctuation">-</span>fza6c0ebghahfufh.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number highlight-line" line="15">  <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="16">  
</span><span class="code-line line-number" line="17">
</span><span class="code-line line-number" line="18"><span class="token key atrule">api test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="19">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="20">  <span class="token key atrule">image</span><span class="token punctuation">:</span> maven<span class="token punctuation">:</span>3.9.9<span class="token punctuation">-</span>amazoncorretto<span class="token punctuation">-</span><span class="token number">21</span>
</span><span class="code-line line-number" line="21">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="22">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="23">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="24">        <span class="token punctuation">-</span> api/pom.xml
</span><span class="code-line line-number" line="25">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="26">      <span class="token punctuation">-</span> $CI_PROJECT_DIR/.m2/repository
</span><span class="code-line line-number" line="27">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="28">    <span class="token punctuation">-</span> cd api
</span><span class="code-line line-number" line="29">    <span class="token punctuation">-</span> mvn clean test
</span><span class="code-line line-number" line="30">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="31">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="32">      <span class="token punctuation">-</span> api/target/reports/
</span><span class="code-line line-number" line="33">      <span class="token punctuation">-</span> api/target/site/
</span><span class="code-line line-number" line="34">      <span class="token punctuation">-</span> api/target/surefire<span class="token punctuation">-</span>reports/
</span><span class="code-line line-number" line="35">
</span><span class="code-line line-number" line="36"><span class="token key atrule">frontend test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="37">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="38">  <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>alpine
</span><span class="code-line line-number" line="39">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="40">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="41">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="42">        <span class="token punctuation">-</span> frontend/package<span class="token punctuation">-</span>lock.json
</span><span class="code-line line-number" line="43">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="44">      <span class="token punctuation">-</span> frontend/node_modules
</span><span class="code-line line-number" line="45">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="46">    <span class="token punctuation">-</span> cd frontend
</span><span class="code-line line-number" line="47">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="48">    <span class="token punctuation">-</span> npm run lint
</span><span class="code-line line-number" line="49">    <span class="token punctuation">-</span> npm run coverage
</span><span class="code-line line-number" line="50">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="51">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="52">      <span class="token punctuation">-</span> frontend/coverage/
</span><span class="code-line line-number" line="53">
</span><span class="code-line line-number" line="54"><span class="token key atrule">build</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="55">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
</span><span class="code-line line-number" line="56">  <span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>latest
</span><span class="code-line line-number" line="57">  <span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="58">    <span class="token punctuation">-</span> docker<span class="token punctuation">:</span>20<span class="token punctuation">-</span>dind
</span><span class="code-line line-number" line="59">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="60">    <span class="token punctuation">-</span> echo $CI_REGISTRY_PASSWORD <span class="token punctuation">|</span> docker login <span class="token punctuation">-</span>u $CI_REGISTRY_USER $CI_REGISTRY <span class="token punctuation">-</span><span class="token punctuation">-</span>password<span class="token punctuation">-</span>stdin
</span><span class="code-line line-number" line="61">    <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>compose <span class="token punctuation">-</span>f docker<span class="token punctuation">-</span>compose.staging.yml build
</span><span class="code-line line-number" line="62">    <span class="token punctuation">-</span> for service in frontend<span class="token punctuation">-</span>prod api<span class="token punctuation">-</span>prod reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod; do
</span><span class="code-line line-number" line="63">        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="64">        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="65">        docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="66">        docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="67">      done
</span><span class="code-line line-number" line="68">
</span><span class="code-line line-number" line="69"><span class="token key atrule">deploy</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="70">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="71">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/azure<span class="token punctuation">-</span>cli
</span><span class="code-line line-number" line="72">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>       
</span><span class="code-line line-number" line="73">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="74">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="75">    <span class="token punctuation">-</span> az login <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>principal <span class="token punctuation">-</span><span class="token punctuation">-</span>username $AZURE_CLIENT_ID <span class="token punctuation">-</span><span class="token punctuation">-</span>password $AZURE_CLIENT_SECRET <span class="token punctuation">-</span><span class="token punctuation">-</span>tenant $AZURE_TENANT_ID
</span><span class="code-line line-number" line="76">    <span class="token punctuation">-</span> az webapp config container set <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>type compose <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>file docker<span class="token punctuation">-</span>compose.deploy.yml <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>user $PULL_IMAGE_TOKEN_USERNAME <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>password $PULL_IMAGE_TOKEN_PASSWORD
</span><span class="code-line line-number" line="77">    <span class="token punctuation">-</span> az webapp start <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span><span class="code-line line-number" line="78">
</span><span class="code-line line-number highlight-line" line="79"><span class="token key atrule">e2e tests</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="80">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> e2e
</span><span class="code-line line-number highlight-line" line="81">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.50.1<span class="token punctuation">-</span>jammy
</span><span class="code-line line-number highlight-line" line="82">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>       
</span><span class="code-line line-number highlight-line" line="83">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number highlight-line" line="84">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="85">    <span class="token punctuation">-</span> cd ./e2e
</span><span class="code-line line-number highlight-line" line="86">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number highlight-line" line="87">    <span class="token punctuation">-</span> npx playwright test 
</span><span class="code-line line-number highlight-line" line="88">    <span class="token punctuation">-</span> if <span class="token punctuation">[</span> $<span class="token punctuation">?</span> <span class="token punctuation">-</span>ne 0 <span class="token punctuation">]</span>; then echo &quot;E2E tests failed&quot;; exit 1; fi
</span><span class="code-line line-number highlight-line" line="89">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="90">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number highlight-line" line="91">      <span class="token punctuation">-</span> e2e/playwright<span class="token punctuation">-</span>report/
</span><span class="code-line line-number highlight-line" line="92">      <span class="token punctuation">-</span> e2e/test<span class="token punctuation">-</span>results/
</span></code></pre>
<p>Nous avons ajouté un nouveau job <strong><code>e2e tests</code></strong> qui va réaliser les tests e2e sur notre application en production. Ce job s&#x27;exécute uniquement si nous fusionnons des modifications sur la branche <strong><code>main</code></strong>.</p>
<p>Nous avons ajouté une nouvelle variable d&#x27;environnement <strong><code>BASE_URL</code></strong> qui contient l&#x27;URL de notre Web App Azure.</p>
<p>Nous avons aussi ajouté une nouvelle variable d&#x27;environnement <strong><code>NODE_ENV</code></strong> qui contient l&#x27;environnement de notre application. Cette variable est utilisée pour déterminer l&#x27;URL de notre application dans le fichier <strong><code>playwright.config.ts</code></strong> du projet <strong><code>e2e</code></strong>.</p>
<p>Veuillez pousser vos modifications sur votre repository GitLab. Si les stages <strong><code>test</code></strong> et <strong><code>build</code></strong>  passent, la MR peut être mergée. Si la MR est mergée sur la branche <strong><code>main</code></strong>, les jobs <strong><code>staging</code></strong> et <strong><code>e2e tests</code></strong> s&#x27;exécuteront après avoir réexécuté les stages <strong><code>test</code></strong> et <strong><code>build</code></strong>.</p>
<p>Il est fort probable que nos tests e2e ne passent pas du premier coup. Mais pourquoi ?</p>
<h2>Pourquoi les tests e2e ne passent pas du premier coup ?</h2>
<p>Les tests e2e peuvent ne pas passer du premier coup pour plusieurs raisons :</p>
<ul>
<li>L&#x27;application est lente à charger et les tests sont exécutés avant que l&#x27;application ne soit complètement chargée.</li>
<li>La base de données contient déjà les données des tests précédents.</li>
</ul>
<p>Faut il réinitialiser la DB à chaque démarrage de l&#x27;environnement de staging ?<br/>
<!-- -->Il est recommandé de réinitialiser la base de données à chaque démarrage de l&#x27;environnement de staging. Cela permet de s&#x27;assurer que les données de tests sont toujours les mêmes et que les tests e2e sont exécutés dans des conditions similaires.</p>
<blockquote>
<p>Attention qu&#x27;il est intéressant de réinitialiser la DB à chaque démarrage de l&#x27;environnement de staging pour s&#x27;assurer que les données de tests sont toujours les mêmes et que les tests e2e sont exécutés dans des conditions similaires. Par contre, pour l&#x27;environnement de production, il est recommandé de ne pas réinitialiser la DB à chaque démarrage pour ne pas perdre les données des utilisateurs.</p>
</blockquote>
<h2>Comment réinitialiser la DB à chaque démarrage de l&#x27;environnement de staging ?</h2>
<p>Nous allons faire en sorte de réinitialiser la DB à chaque démarrage de l&#x27;environnement de staging.</p>
<p>Pour continuer dans ce tutoriel, vous devez créer une nouvelle feature branch, car pour lancer les tests e2e, il faudra qu&#x27;il y ait une fusion de modifications sur la branche <strong><code>main</code></strong>.</p>
<p>Nous allons faire en sorte que Spring Boot utilise le profil <strong><code>staging</code></strong> pour réinitialiser la DB à chaque démarrage de notre Web App Azure, en utilisant le fichier <strong><code>application-staging.properties</code></strong>.<br/>
<!-- -->Pour rappel, un profil sous Spring Boot est un ensemble de configurations qui permettent de définir le comportement de l&#x27;application en fonction de l&#x27;environnement dans lequel elle est exécutée.</p>
<p>Veuillez vous assurer que le fichier <strong><code>application-staging.properties</code></strong> est bien créé au niveau de votre projet <strong><code>api</code></strong> :</p>
<pre class="language-properties"><code class="language-properties code-highlight"><span class="code-line"><span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">demo</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">3000</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">${SPRING_DATASOURCE_URL}</span>
</span><span class="code-line"><span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">${SPRING_DATASOURCE_USERNAME}</span>
</span><span class="code-line"><span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">${SPRING_DATASOURCE_PASSWORD}</span>
</span><span class="code-line"><span class="token key attr-name">spring.jpa.generate-ddl</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</span><span class="code-line"><span class="token key attr-name">spring.sql.init.mode</span><span class="token punctuation">=</span><span class="token value attr-value">always</span>
</span><span class="code-line"><span class="token key attr-name">spring.jpa.defer-datasource-initialization</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</span></code></pre>
<p>Pour rappel :</p>
<ul>
<li><strong><code>spring.sql.init.mode=always</code></strong> : cette propriété permet de réinitialiser la DB à chaque démarrage de l&#x27;application.</li>
<li><strong><code>spring.jpa.defer-datasource-initialization=true</code></strong> : cette propriété permet de retarder l&#x27;initialisation de la source de données. D&#x27;abord les entités sont créées, puis la source de données est initialisée via le script <strong><code>data.sql</code></strong>.</li>
</ul>
<p>Nous allons maintenant voir comment configurer notre Web App Azure pour qu&#x27;elle utilise le profil <strong><code>staging</code></strong>.</p>
<p>Pour ce faire, il suffit d&#x27;ajouter une variable d&#x27;environnement au niveau de notre Web App Azure. Cette variable d&#x27;environnement est tout ce qu&#x27;il y a à faire pour que Spring Boot utilise le fichier <strong><code>application-staging.properties</code></strong>.</p>
<p>Au niveau de votre Azure Web App (<strong><code>cae-groupxy-staging-app</code></strong> par exemple) via le portail Azure, veuillez :</p>
<ul>
<li>Cliquer sur <strong><code>Settings</code></strong>.</li>
<li>Cliquer sur <strong><code>Environment variables</code></strong>.</li>
<li>Ajouter la variable d&#x27;environnement suivante en cliquant sur <strong><code>Add</code></strong> :<!-- -->
<ul>
<li><strong><code>SPRING_PROFILES_ACTIVE</code></strong> (<strong><code>Name</code></strong>): <strong><code>staging</code></strong> (<strong><code>Value</code></strong>). Cliquez sur <strong><code>Apply</code></strong>.</li>
<li>N&#x27;oubliez pas de cliquer sur <strong><code>Apply</code></strong> pour sauvegarder l&#x27;ajout de la variable, puis <strong><code>Confirm</code></strong>.</li>
</ul>
</li>
</ul>
<h1><a id="comment_attendre_que_l_api_soit_bien_demarree_avant_de_lancer_les_tests_e_2_e"> Comment attendre que l&#x27;API soit bien démarrée avant de lancer les tests e2e ? </a></h1>
<h2>Introduction</h2>
<p>Dans l&#x27;environnement de staging, nous avons réalisé les tests e2e sur les services déployés sur Azure Web App Service.</p>
<p>Nous avons vu que les tests e2e peuvent ne pas passer du premier coup, notamment parce que l&#x27;application est lente à charger et les tests sont exécutés avant que l&#x27;application ne soit complètement chargée.</p>
<p>Pour assurer que l&#x27;API est prête avant de lancer les tests e2e, nous allons ajouter une étape qui attend que l&#x27;API soit bien démarrée avant de lancer les tests e2e. Pour ce faire, nous allons faire des requêtes HTTP sur l&#x27;API jusqu&#x27;à ce qu&#x27;elle soit prête. On pourrait appeler ça un <strong><code>health check</code></strong>.</p>
<p>Parfois, au niveau des API REST, il est possible de créer un endpoint <strong><code>/health</code></strong> qui permet de vérifier si l&#x27;API est bien démarrée. Ce endpoint peut retourner un code HTTP 200 si l&#x27;API est bien démarrée, après avoir vérifié que la base de données est bien connectée par exemple.</p>
<p>Dans notre tutoriel, nous allons simplement utiliser l&#x27;opération de lecture de toutes les pizzas comme <strong><code>health check</code></strong>. Si l&#x27;opération de lecture de toutes les pizzas retourne un code HTTP 200, alors l&#x27;API est bien démarrée.</p>
<p>Voici le workflow que nous allons suivre :</p>
<div>Loading...</div>
<h2>Mise à jour du fichier .gitlab-ci.yml</h2>
<p>Veuillez mettre à jour le fichier <strong><code>.gitlab-ci.yml</code></strong> pour attendre que l&#x27;API soit bien démarrée avant de lancer les tests e2e :</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line line-number" line="1"><span class="token key atrule">stages</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">-</span> test
</span><span class="code-line line-number" line="3">  <span class="token punctuation">-</span> build
</span><span class="code-line line-number" line="4">  <span class="token punctuation">-</span> staging
</span><span class="code-line line-number" line="5">  <span class="token punctuation">-</span> e2e
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token key atrule">variables</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="8">  <span class="token key atrule">MAVEN_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository&quot;</span>
</span><span class="code-line line-number" line="9">  <span class="token key atrule">VERSION</span><span class="token punctuation">:</span> $CI_PIPELINE_IID
</span><span class="code-line line-number" line="10">  <span class="token key atrule">REGISTRY</span><span class="token punctuation">:</span> $CI_REGISTRY
</span><span class="code-line line-number" line="11">  <span class="token key atrule">REGISTRY_IMAGE_BASE_PATH</span><span class="token punctuation">:</span> $REGISTRY/$CI_PROJECT_PATH
</span><span class="code-line line-number" line="12">  <span class="token key atrule">AZURE_WEBAPP_NAME</span><span class="token punctuation">:</span> cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app
</span><span class="code-line line-number" line="13">  <span class="token key atrule">AZURE_WEBAPP_RESOURCE_GROUP</span><span class="token punctuation">:</span> caeGroup
</span><span class="code-line line-number" line="14">  <span class="token key atrule">BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cae<span class="token punctuation">-</span>groupxy<span class="token punctuation">-</span>staging<span class="token punctuation">-</span>app<span class="token punctuation">-</span>fza6c0ebghahfufh.centralus<span class="token punctuation">-</span>01.azurewebsites.net/
</span><span class="code-line line-number" line="15">  <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17"><span class="token key atrule">api test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="18">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="19">  <span class="token key atrule">image</span><span class="token punctuation">:</span> maven<span class="token punctuation">:</span>3.9.9<span class="token punctuation">-</span>amazoncorretto<span class="token punctuation">-</span><span class="token number">21</span>
</span><span class="code-line line-number" line="20">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="21">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="22">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="23">        <span class="token punctuation">-</span> api/pom.xml
</span><span class="code-line line-number" line="24">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="25">      <span class="token punctuation">-</span> $CI_PROJECT_DIR/.m2/repository
</span><span class="code-line line-number" line="26">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="27">    <span class="token punctuation">-</span> cd api
</span><span class="code-line line-number" line="28">    <span class="token punctuation">-</span> mvn clean test
</span><span class="code-line line-number" line="29">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="30">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="31">      <span class="token punctuation">-</span> api/target/reports/
</span><span class="code-line line-number" line="32">      <span class="token punctuation">-</span> api/target/site/
</span><span class="code-line line-number" line="33">      <span class="token punctuation">-</span> api/target/surefire<span class="token punctuation">-</span>reports/
</span><span class="code-line line-number" line="34">
</span><span class="code-line line-number" line="35"><span class="token key atrule">frontend test</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="36">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
</span><span class="code-line line-number" line="37">  <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>alpine
</span><span class="code-line line-number" line="38">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="39">    <span class="token key atrule">key</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="40">      <span class="token key atrule">files</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="41">        <span class="token punctuation">-</span> frontend/package<span class="token punctuation">-</span>lock.json
</span><span class="code-line line-number" line="42">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="43">      <span class="token punctuation">-</span> frontend/node_modules
</span><span class="code-line line-number" line="44">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="45">    <span class="token punctuation">-</span> cd frontend
</span><span class="code-line line-number" line="46">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="47">    <span class="token punctuation">-</span> npm run lint
</span><span class="code-line line-number" line="48">    <span class="token punctuation">-</span> npm run coverage
</span><span class="code-line line-number" line="49">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="50">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="51">      <span class="token punctuation">-</span> frontend/coverage/
</span><span class="code-line line-number" line="52">
</span><span class="code-line line-number" line="53"><span class="token key atrule">build</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="54">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
</span><span class="code-line line-number" line="55">  <span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>latest
</span><span class="code-line line-number" line="56">  <span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="57">    <span class="token punctuation">-</span> docker<span class="token punctuation">:</span>20<span class="token punctuation">-</span>dind
</span><span class="code-line line-number" line="58">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="59">    <span class="token punctuation">-</span> echo $CI_REGISTRY_PASSWORD <span class="token punctuation">|</span> docker login <span class="token punctuation">-</span>u $CI_REGISTRY_USER $CI_REGISTRY <span class="token punctuation">-</span><span class="token punctuation">-</span>password<span class="token punctuation">-</span>stdin
</span><span class="code-line line-number" line="60">    <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>compose <span class="token punctuation">-</span>f docker<span class="token punctuation">-</span>compose.staging.yml build
</span><span class="code-line line-number" line="61">    <span class="token punctuation">-</span> for service in frontend<span class="token punctuation">-</span>prod api<span class="token punctuation">-</span>prod reverse<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>prod; do
</span><span class="code-line line-number" line="62">      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="63">      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="64">      docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>latest;
</span><span class="code-line line-number" line="65">      docker push $REGISTRY_IMAGE_BASE_PATH/$service<span class="token punctuation">:</span>$VERSION;
</span><span class="code-line line-number" line="66">      done
</span><span class="code-line line-number" line="67">
</span><span class="code-line line-number" line="68"><span class="token key atrule">deploy</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="69">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> staging
</span><span class="code-line line-number" line="70">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/azure<span class="token punctuation">-</span>cli
</span><span class="code-line line-number" line="71">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="72">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="73">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="74">    <span class="token punctuation">-</span> az login <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>principal <span class="token punctuation">-</span><span class="token punctuation">-</span>username $AZURE_CLIENT_ID <span class="token punctuation">-</span><span class="token punctuation">-</span>password $AZURE_CLIENT_SECRET <span class="token punctuation">-</span><span class="token punctuation">-</span>tenant $AZURE_TENANT_ID
</span><span class="code-line line-number" line="75">    <span class="token punctuation">-</span> az webapp config container set <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>type compose <span class="token punctuation">-</span><span class="token punctuation">-</span>multicontainer<span class="token punctuation">-</span>config<span class="token punctuation">-</span>file docker<span class="token punctuation">-</span>compose.deploy.yml <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>user $PULL_IMAGE_TOKEN_USERNAME <span class="token punctuation">-</span><span class="token punctuation">-</span>container<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>password $PULL_IMAGE_TOKEN_PASSWORD
</span><span class="code-line line-number" line="76">    <span class="token punctuation">-</span> az webapp start <span class="token punctuation">-</span><span class="token punctuation">-</span>name $AZURE_WEBAPP_NAME <span class="token punctuation">-</span><span class="token punctuation">-</span>resource<span class="token punctuation">-</span>group $AZURE_WEBAPP_RESOURCE_GROUP
</span><span class="code-line line-number highlight-line" line="77">    <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line line-number highlight-line" line="78"><span class="token scalar string">      for i in {1..30}; do
</span></span><span class="code-line line-number highlight-line" line="79"><span class="token scalar string">        HTTP_STATUS=$(curl -s -o /dev/null -w &quot;%{http_code}&quot; $BASE_URL/api/pizzas);
</span></span><span class="code-line line-number highlight-line" line="80"><span class="token scalar string">        if [ &quot;$HTTP_STATUS&quot; -eq 200 ]; then
</span></span><span class="code-line line-number highlight-line" line="81"><span class="token scalar string">          echo &quot;Azure Web App is functional.&quot;
</span></span><span class="code-line line-number highlight-line" line="82"><span class="token scalar string">          break
</span></span><span class="code-line line-number highlight-line" line="83"><span class="token scalar string">        fi
</span></span><span class="code-line line-number highlight-line" line="84"><span class="token scalar string">        echo &quot;Azure Web App is not ready yet. Waiting for 10 seconds...&quot;
</span></span><span class="code-line line-number highlight-line" line="85"><span class="token scalar string">        sleep 10
</span></span><span class="code-line line-number highlight-line" line="86"><span class="token scalar string">      done</span>
</span><span class="code-line line-number" line="87">
</span><span class="code-line line-number" line="88"><span class="token key atrule">e2e tests</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="89">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> e2e
</span><span class="code-line line-number" line="90">  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.50.1<span class="token punctuation">-</span>jammy
</span><span class="code-line line-number" line="91">  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="92">    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
</span><span class="code-line line-number" line="93">  <span class="token key atrule">script</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="94">    <span class="token punctuation">-</span> cd ./e2e
</span><span class="code-line line-number" line="95">    <span class="token punctuation">-</span> npm ci
</span><span class="code-line line-number" line="96">    <span class="token punctuation">-</span> npx playwright test
</span><span class="code-line line-number" line="97">    <span class="token punctuation">-</span> if <span class="token punctuation">[</span> $<span class="token punctuation">?</span> <span class="token punctuation">-</span>ne 0 <span class="token punctuation">]</span>; then echo &quot;E2E tests failed&quot;; exit 1; fi
</span><span class="code-line line-number" line="98">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="99">    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="100">      <span class="token punctuation">-</span> e2e/playwright<span class="token punctuation">-</span>report/
</span><span class="code-line line-number" line="101">      <span class="token punctuation">-</span> e2e/test<span class="token punctuation">-</span>results/
</span></code></pre>
<p>Dans la boucle <strong><code>for</code></strong> :</p>
<ul>
<li>Nous faisons une requête HTTP sur l&#x27;opération de lecture de toutes les pizzas.</li>
<li>Si le code HTTP est égal à 200, alors l&#x27;API est bien démarrée.</li>
<li>Sinon, nous attendons 10 secondes et nous réessayons jusqu&#x27;à 30 fois.</li>
<li>NB : <strong><code>curl -s -o /dev/null -w &quot;%{http_code}&quot; $BASE_URL/api/pizzas</code></strong> permet de faire une requête HTTP sur l&#x27;opération de lecture de toutes les pizzas et de récupérer le code HTTP. <strong><code>-s</code></strong> permet de ne pas afficher les détails de la requête, <strong><code>-o /dev/null</code></strong> permet de rediriger la sortie de la requête vers <strong><code>/dev/null</code></strong> (<strong><code>/dev/null</code></strong> agit comme un &quot;trou noir&quot;, tout ce qui y est écrit est directement supprimé) et <strong><code>-w &quot;%{http_code}&quot;</code></strong> permet de récupérer le code HTTP.</li>
</ul>
<p>Veuillez pousser vos modifications sur votre repository GitLab. Si les stages <strong><code>test</code></strong> et <strong><code>build</code></strong>  passent, la MR peut être mergée. Si la MR est mergée sur la branche <strong><code>main</code></strong>, les jobs <strong><code>staging</code></strong> et
<strong><code>e2e tests</code></strong> s&#x27;exécuteront après avoir réexécuté les stages <strong><code>test</code></strong> et <strong><code>build</code></strong>.</p>
<p>Normalement, tout devrait fonctionner correctement. Vous devriez voir que les tests e2e passent. Et votre pipeline GitLab CI/CD est maintenant complet. Votre application devrait être déployée sur Azure Web App Service avec succès 🚀 !</p>
<p>Si nécessaire, vous pouvez trouver le code associé au déploiement de l&#x27;environnement staging ici : <a href="https://github.com/e-vinci/cae-theory-demos/tree/main/staging">staging</a>.</p>
<h2>Conclusion sur le déploiement de l&#x27;environnement staging</h2>
<p>Dans ce tutoriel, nous avons vu :</p>
<ul>
<li>comment déployer notre application sur Azure Web App Service en utilisant GitLab CI/CD.</li>
<li>comment réaliser des tests e2e sur notre application disponible sur le cloud.</li>
<li>comment attendre que l&#x27;API soit bien démarrée avant de lancer les tests e2e.</li>
<li>comment réinitialiser la DB à chaque démarrage de l&#x27;environnement de staging.</li>
<li>comment déployer seulement en cas de fusion de modifications sur la branche <strong><code>main</code></strong>.</li>
</ul>
<p>La faiblesse de notre application actuelle est que la seule application qui est visible sur le cloud par les utilisateurs est déployée avant même d&#x27;avoir réalisé les tests e2e. Cela peut poser des problèmes si les tests e2e ne passent pas. Il est recommandé de réaliser les tests e2e avant de déployer l&#x27;application sur le cloud pour les utilisateurs finaux.</p>
<p>Il va donc prochainement falloir créer un nouvel environnement de production pour déployer notre application seulement après avoir réalisé et réussi les tests e2e. Nous verrons cela plus tard 😉.</p>
<p>D&#x27;abord, nous allons nous attaquer à la gestion d&#x27;un autre type d&#x27;images, les photos des pizzas. Nous allons voir comment stocker les photos des pizzas.</p></div><div></div><script src="/cae-theory/_next/static/chunks/webpack-0335b56ac768253e.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[909,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"245\",\"static/chunks/245-30e455921c0f8f22.js\",\"177\",\"static/chunks/app/layout-a6c5d823159daef4.js\"],\"default\"]\n3:I[7468,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"245\",\"static/chunks/245-30e455921c0f8f22.js\",\"177\",\"static/chunks/app/layout-a6c5d823159daef4.js\"],\"ClientThemeProvider\"]\n4:I[1886,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"245\",\"static/chunks/245-30e455921c0f8f22.js\",\"177\",\"static/chunks/app/layout-a6c5d823159daef4.js\"],\"default\"]\n5:I[8412,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"245\",\"static/chunks/245-30e455921c0f8f22.js\",\"177\",\"static/chunks/app/layout-a6c5d823159daef4.js\"],\"default\"]\n6:I[5244,[],\"\"]\n7:I[3866,[],\"\"]\n8:I[3620,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"245\",\"static/chunks/245-30e455921c0f8f22.js\",\"177\",\"static/chunks/app/layout-a6c5d823159daef4.js\"],\"default\"]\na:I[6213,[],\"OutletBoundary\"]\nc:I[6213,[],\"MetadataBoundary\"]\ne:I[6213,[],\"ViewportBoundary\"]\n10:I[4835,[],\"\"]\n:HL[\"/cae-theory/_next/static/css/fd89b796fb218fbf.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"A92IwWAQn47aM2P2a7xIH\",\"p\":\"/cae-theory\",\"c\":[\"\",\"iteration2\",\"deployment\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"slug\",\"iteration2/deployment\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/cae-theory/_next/static/css/fd89b796fb218fbf.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"children\":[\"$\",\"html\",null,{\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"title\",null,{\"children\":\"CAE Course\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/svg+xml\",\"href\":\"/cae-theory/favicon.svg\"}]]}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"$L4\",null,{\"siteMetaData\":{\"version\":\"\",\"title\":\"CAE\",\"description\":\"siteDescription\",\"url\":\"siteURL\",\"youtubeUrl\":\"youtubeUrl\",\"authorEmail\":\"authorEmail\",\"facebookUrl\":\"facebookUrl\",\"instagramUrl\":\"instagramUrl\",\"menuLinks\":[{\"name\":\"Home\",\"link\":\"/\"},{\"name\":\"Intro\",\"link\":\"/intro\"},{\"name\":\"Qualité\",\"link\":\"\",\"subMenu\":[{\"name\":\"Qualité générale\",\"link\":\"/quality/general\"},{\"name\":\"Qualité du frontend\",\"link\":\"/quality/frontend\"},{\"name\":\"Qualité de l'API\",\"link\":\"/quality/api\"},{\"name\":\"Intégration Continue\",\"link\":\"/quality/ci\"},{\"name\":\"Tests e2e\",\"link\":\"/quality/e2e\"}]},{\"name\":\"Itération 2\",\"link\":\"\",\"subMenu\":[{\"name\":\"Gestion des environnements\",\"link\":\"/iteration2/general\"},{\"name\":\"Conteneurisation\",\"link\":\"/iteration2/containerization\"},{\"name\":\"Déploiement\",\"link\":\"/iteration2/deployment\"},{\"name\":\"Gestion des images\",\"link\":\"/iteration2/images\"}]},{\"name\":\"About\",\"link\":\"/about\"}]}}]}],[\"$\",\"$L5\",null,{\"sx\":{\"padding\":\"1rem\",\"wordWrap\":\"break-word\"},\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L8\",null,{}]]}]]}]}]}]]}],{\"children\":[[\"slug\",\"iteration2/deployment\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$0:f:0:1:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L9\",null,[\"$\",\"$La\",null,{\"children\":\"$Lb\"}]]}],{},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"US0fB6LFT2s45tkgPHEhl\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$10\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"11:I[3508,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n12:I[283,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n13:I[6656,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n14:I[8173,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"\"]\n15:I[4754,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n16:I[2738,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n17:I[4036,[\"144\",\"static/chunks/144-6ef9499ac178c5dc.js\",\"830\",\"static/chunks/830-d07b37352b41f989.js\",\"340\",\"static/chunks/app/%5B%5B...slug%5D%5D/page-e6ba2748711f75c3.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"9:[[\"$\",\"$L11\",null,{\"children\":[[\"$\",\"$L12\",null,{\"aria-label\":\"breadcrumb\",\"children\":[[\"$\",\"$L13\",null,{\"href\":\"/\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":\" CAE \"}],[\"$\",\"$L13\",null,{\"href\":\"/iteration2\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":\" Itération 2 \"}],[\"$\",\"$L13\",null,{\"href\":\"#\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":\" Déploiement \"}]]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#pourquoi_et_ou_deployer\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Pourquoi et où déployer ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_creer_un_compte_azure_avec_des_credits_gratuits\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment créer un compte Azure avec des crédits gratuits ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_deployer_notre_db\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment déployer notre DB ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_creer_un_environnement_local_proche_de_lenvironnement_de_staging\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment créer un environnement local proche de l'environnement de staging ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_est_il_possible_de_deployer_une_application_sur_azure_web_app_service\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment est-il possible de déployer une application sur Azure Web App Service ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_creer_une_application_sur_azure_web_app_service\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment créer une application sur Azure Web App Service ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_donner_acces_a_dautres_applications_a_une_azure_web_app\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment donner accès à d'autres applications à une Azure Web App ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_faire_un_push_des_images_de_git_lab_vers_azure_app_service\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment faire un push des images de GitLab vers Azure App Service ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_deployer_seulement_en_cas_de_fusion_de_modification_sur_le_main\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment déployer seulement en cas de fusion de modification sur le main ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_realiser_des_tests_e_2_e_sur_lapp_en_production\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment réaliser des tests e2e sur l'app en production ? \"}]}]}],[\"$\",\"$L15\",null,{\"component\":\"div\",\"sx\":{\"paddingTop\":0,\"paddingBottom\":0},\"children\":[\"$\",\"$L13\",null,{\"href\":\"#comment_attendre_que_l_api_soit_bien_demarree_avant_de_lancer_les_tests_e_2_e\",\"underline\":\"hover\",\"color\":\"inherit\",\"component\":\"$14\",\"children\":[\"$\",\"$L16\",null,{\"primary\":\" Comment attendre que l'API soit bien démarrée avant de lancer les tests e2e ? \"}]}]}]]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"pourquoi_et_ou_deployer\",\"children\":\" Pourquoi et où déployer ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Le déploiement d'une application web est une étape cruciale dans le cycle de vie d'une application web. Il s'agit de rendre l'application accessible à ses utilisateurs finaux.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Dans ce cours, dans la partie sur la \",[\"$\",\"a\",null,{\"href\":\"general\",\"children\":\"gestion des environnements\"}],\", nous avons déjà vu que nous allions utiliser :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"GitLab CI/CD\"}],\" pour automatiser le déploiement de notre application (SaaS).\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Azure App Service\"}],\" pour héberger notre application (PaaS).\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"En effet, lorsqu'on fait du DevOps, on va généralement utiliser des services cloud pour déployer nos applications. Cela permet de ne pas avoir à gérer l'infrastructure sous-jacente, et de se concentrer sur le développement de l'application.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Staging environnement\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Le staging environnement est un environnement de test qui est une réplique de l'environnement de production. Il permet de tester l'application dans des conditions proches de la production avant de la déployer pour tous les utilisateurs finaux.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Le staging environnement est généralement utilisé pour :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Tester les nouvelles fonctionnalités avant de les déployer en production.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Vérifier que les mises à jour de l'application ne causent pas de régressions.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Effectuer des tests de performance et de charge.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour ce cours, nous allons d'abord déployer notre application sur le staging environnement. Nous verrons plus tard comment déployer l'application en production après la réussite de tests dans l'environnement de staging.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Tout ce que nous allons apprendre sur le déploiement de l'application sur le staging environnement sera applicable pour le déploiement en production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici à quoi nous souhaitons que le staging environnement ressemble pour cette première étape de déploiement :\"}],\"\\n\",[\"$\",\"$L17\",null,{\"src\":\"/diagrams/staging-deployment1.puml\",\"alt\":\"Environnement de staging (partie 1 )\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici quelques points importants à noter sur le diagramme ci-dessus :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Le frontend et l'API sont déployés sur un \",[\"$\",\"strong\",null,{\"children\":\"Azure App Service\"}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Pour les étudiants Vinci, le hosting de la DB est offert par la Haute École de Vinci. Pour les autres, vous pouvez utiliser un service cloud comme \",[\"$\",\"strong\",null,{\"children\":\"Azure Databse for PostgreSQL\"}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour le déploiement, nous allons procéder en plusieurs étapes :\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Déploiement de la base de données vers le staging environnement. Lancement de notre API en nous connectant à la DB de staging.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Création d'une environnement local très proche de l'environnement de staging contenant le reverse proxy, le frontend et l'API au sein d'un Docker Compose, l'API se connectant à la DB de staging.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Déploiement du reverse proxy, du frontend et de l'API sur le staging environnement.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Réalisation des tests e2e sur le staging environnement à partir de GitLab CI/CD.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Avant d'aller plus loin, nous allons d'abord voir comment créer un compte sur Azure afin d'avoir des crédits gratuits pour déployer notre application.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_creer_un_compte_azure_avec_des_credits_gratuits\",\"children\":\" Comment créer un compte Azure avec des crédits gratuits ? \"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Afin d'héberger notre application sur Azure, nous allons devoir créer un compte Azure. Heureusement, Microsoft offre des crédits gratuits :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"pour les étudiants : \",[\"$\",\"a\",null,{\"href\":\"https://azure.microsoft.com/en-us/free/students/\",\"children\":\"https://azure.microsoft.com/en-us/free/students/\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"pour les non-étudiants : \",[\"$\",\"a\",null,{\"href\":\"https://azure.microsoft.com/en-us/free/\",\"children\":\"https://azure.microsoft.com/en-us/free/\"}],\" (attention, les crédits gratuits ne sont valables que pour 30 jours, et vous devrez ajouter une carte de crédit).\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"pour les startups : \",[\"$\",\"a\",null,{\"href\":\"https://www.microsoft.com/en-us/startups\",\"children\":\"https://www.microsoft.com/en-us/startups\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour les étudiants Vinci, veuillez donc suivre les instructions sur le lien suivant : \",[\"$\",\"a\",null,{\"href\":\"https://azure.microsoft.com/en-us/free/students/\",\"children\":\"https://azure.microsoft.com/en-us/free/students/\"}],[\"$\",\"br\",null,{}],\"\\n\",\"Vous devrez :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"vous logguer avec votre compte Vinci\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"introduire vos données et le Nom de l'école\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Verify academic status\"}]}],\" et suivre les instructions\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_deployer_notre_db\",\"children\":\" Comment déployer notre DB ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Actuellement, notre application utilise une base de données locale dans un conteneur Docker.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour les étudiants Vinci, vous avez ou allez recevoir un email avec les informations de connexion à la base de données de la Haute École de Vinci.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour les autres :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"vous pouvez utiliser un service cloud comme \",[\"$\",\"strong\",null,{\"children\":\"Azure Database for PostgreSQL\"}],\" : \",[\"$\",\"a\",null,{\"href\":\"https://azure.microsoft.com/en-us/products/postgresql/\",\"children\":\"https://azure.microsoft.com/en-us/products/postgresql/\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"veuillez créer une base de données PostgreSQL et noter les informations de connexion :\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"url\"}]}],\" de connexion si vous l'avez, sinon vous pouvez la construire avec les informations suivantes :\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Host\"}]}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Database\"}]}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Port\"}]}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"L'URL ressemblera à cela : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"jdbc:postgresql://\u003cHost\u003e:\u003cPort\u003e/\u003cDatabase\u003e\"}]}]]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Username\"}]}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Password\"}]}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Connexion à votre DB visible sur internet\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Comment gérer l'environnement de développement et de staging ?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour ce tutoriel (nommé \",[\"$\",\"code\",null,{\"children\":\"staging\"}],\"), nous souhaitons pouvoir créer un environnement locale qui se connecte à la DB de staging à l'aide de Docker Compose. Pour ce tutoriel, veuillez créer une nouvelle \\\"feature branch\\\" sur votre projet GitLab (par exemple, vous pouvez la nommer \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"chore/staging\"}]}],\").\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"En fait, nous souhaitons :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Quand nous démarrons notre API à l'aide d'IntelliJ, via notre environnement de développement, qu'elle se connecte à la DB dans le container Docker local (non visible sur internet).\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Quand nous démarrons notre API à l'aide de Docker Compose, via notre environnement de staging, qu'elle se connecte à la DB de staging qui est visible sur internet.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Comment rendre cela possible ?\",[\"$\",\"br\",null,{}],\"\\n\",\"Nous souhaitons que l'API se connecte à la DB en utilisant une URL de connexion qui est différente selon l'environnement. Pour ce faire, nous allons utiliser deux fichiers de configuration différents :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application.properties\"}]}],\" pour l'environnement de développement.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-staging.properties\"}]}],\" pour l'environnement de staging.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Comment gérer la configuration de l'environnement de staging ?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous pourrions créer le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-staging.properties\"}]}],\" dans le dossier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"src/main/resources\"}]}],\" de notre API avec le contenu suivant :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-properties\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-properties code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.application.name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"demo\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"server.port\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"3000\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.url\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"jdbc:postgresql://localhost:5432/cae_db\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.username\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"cae_user\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.password\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"cae\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.jpa.generate-ddl\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"true\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.sql.init.mode\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"always\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.jpa.defer-datasource-initialization\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"true\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous souhaiterions mettre à jour ce fichier pour qu'il se connecte à la DB de staging. Pour ce faire, une première idée serait de remplacer les valeurs de \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring.datasource.url\"}]}],\", \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring.datasource.username\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring.datasource.password\"}]}],\" par les informations de connexion à notre DB.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Cependant, nous ne voulons pas stocker ces informations de connexion dans le code source de notre application. En effet, cela pourrait poser des problèmes de sécurité si notre code source est rendu public. C'est d'ailleurs une très mauvaise pratique de stocker des informations sensibles dans le code source.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour résoudre ce problème, nous allons utiliser les \",[\"$\",\"strong\",null,{\"children\":\"variables d'environnement\"}],\". Les variables d'environnement sont des variables qui sont définies dans l'environnement d'exécution de notre application. Elles peuvent être utilisées pour stocker des informations sensibles comme les informations de connexion à la DB.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour ce faire, nous pourrions remplacer les valeurs de \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring.datasource.url\"}]}],\", \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring.datasource.username\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring.datasource.password\"}]}],\" par des variables d'environnement directement au sein du fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-staging.properties\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez créer le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-staging.properties\"}]}],\" dans le dossier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"src/main/resources\"}]}],\" de votre API avec le contenu suivant :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-properties\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-properties code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.application.name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"demo\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"server.port\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"3000\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.url\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"$${SPRING_DATASOURCE_URL}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.username\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"$${SPRING_DATASOURCE_USERNAME}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.password\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"$${SPRING_DATASOURCE_PASSWORD}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.jpa.generate-ddl\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"true\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.sql.init.mode\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"always\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.jpa.defer-datasource-initialization\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"true\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL\"}]}],\", \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_USERNAME\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_PASSWORD\"}]}],\" sont des variables d'environnement que nous allons définir dans notre environnement de staging.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Avant de passer à l'environnement de staging complet sur le cloud, il serait intéressant de voir si localement on pourrait démarrer nos services en utilisant la DB de staging. On peut imaginer deux scénarios :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Scénario 1 : On utilise notre environnement de développement pour démarrer notre API et notre DB de staging.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Scénario 2 : On utilise Docker Compose pour démarrer notre API  (notre DB de staging est démarrée indépendamment de l'API et est visible sur internet).\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Même si le scénario 1 est plus simple, le scénario 2 est plus proche de ce que nous allons faire en production.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous allons premièrement voir comment démarrer notre API localement via notre environnement de développement. Lorsque nous passerons au déploiement de l'API \u0026 du frontend, nous verrons comment démarrer notre API via Docker Compose.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Comment démarrer notre API localement via notre environnement de développement avec une DB de stagging ?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour démarrer notre API localement via notre environnement de développement avec une DB de staging, nous allons devoir définir les variables d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL\"}]}],\", \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_USERNAME\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_PASSWORD\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Le plus simple est d'utiliser la librairie \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring-dotenv\"}]}],\" pour définir ces variables d'environnement. \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring-dotenv\"}]}],\" est une librairie qui permet de charger des variables d'environnement à partir d'un fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".env\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Au sein de votre API, veuillez suivre ces instructions pour installer \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring-dotenv\"}]}],\" (ajout de la bonne dépendance dans Maven) : \",[\"$\",\"a\",null,{\"href\":\"https://github.com/paulschwarz/spring-dotenv\",\"children\":\"https://github.com/paulschwarz/spring-dotenv\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".env\"}]}],\" est un fichier qui contient les variables d'environnement que nous souhaitons définir pour, actuellement, l'API uniquement. Nous allons créer un fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".env\"}]}],\" à la racine de notre dossier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"api\"}]}],\" avec le contenu suivant (remplacez les valeurs par celles de votre DB de staging) :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-properties\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-properties code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"SPRING_DATASOURCE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"jdbc:postgresql://hostnameOrIPToYourPostgresServer:YOUR_PORT/YOUR_DB_NAME\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"SPRING_DATASOURCE_USERNAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"yourUsername   \"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"SPRING_DATASOURCE_PASSWORD\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"yourPassword\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Attention à bien vous assurer que le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".env\"}]}],\" n'est pas versionné dans Git. Pour ce faire, vérifiez que \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".env\"}]}],\" est présent dans le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".gitignore\"}]}],\" de votre projet.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour démarrer notre API en utilisant le profil \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\", nous savons déjà comment le faire via un terminal :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-bash\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"mvn spring-boot:run -Dspring-boot.run.profiles\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"staging\\n\"]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour rappel, un profil dans Spring Boot est une manière de définir des configurations spécifiques pour un environnement donné. Dans notre cas, le profil \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\" est utilisé pour définir les configurations spécifiques à l'environnement de staging.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Par contre, comment démarrer notre API en utilisant le profil \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\" via IntelliJ ?\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez ouvrir IntelliJ au niveau du projet associé à votre API et suivre ces instructions pour démarrer votre API en utilisant le profil \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\" :\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Edit Configurations...\"}]}],\" dans le menu de configuration d'IntelliJ.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Sélectionnez la configuration \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Spring Boot\"}]}],\" de votre API (elle peut s'appeler \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"DemoApplication\"}]}],\" par exemple).\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"En haut à gauche, cliquez sur l'icône \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Copy Configuration\"}]}],\" pour créer une nouvelle configuration.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Nommez cette nouvelle configuration \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Staging DB\"}]}],\" par exemple.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dans le champ \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Active profiles\"}]}],\", ajoutez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"OK\"}]}],\" pour sauvegarder la configuration.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Maintenant, vous pouvez démarrer votre API en utilisant le profil \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\" via IntelliJ en sélectionnant la configuration \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Staging DB\"}]}],\" et en cliquant sur le bouton \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Run\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez vérifier que votre API se connecte bien à la DB de staging en démarrant votre API via IntelliJ. N'hésitez pas à exécuter des requêtes HTTP pour vérifier que tout fonctionne correctement.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous allons maintenant voir comment démarrer notre API via Docker Compose en utilisant la DB de staging.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_creer_un_environnement_local_proche_de_lenvironnement_de_staging\",\"children\":\" Comment créer un environnement local proche de l'environnement de staging ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Avant de déployer notre API \u0026 notre frontend, il est important de mettre en place tous les services nécessaires pour que notre application fonctionne correctement. Pour ce faire, nous allons utiliser Docker Compose.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous allons donc créer un environnement local qui se rapproche de l'environnement de staging, en mettant temporairement de côté les tests e2e pour avancer pas à pas. Cet environnement local sera composé de :\"}],\"\\n\",[\"$\",\"$L17\",null,{\"src\":\"/diagrams/local-staging-deployment1.puml\",\"alt\":\"Environnement de staging local\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour ce faire, nous allons créer un fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.local.staging.yml\"}]}],\" à la racine de notre projet GitLab avec le contenu suivant :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"services\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"frontend\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"container_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"context\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" ./frontend\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"ports\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" 5172\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5172\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"depends_on\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"api\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"container_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" ./api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"ports\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" 3000\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3000\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"18\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"19\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" SPRING_DATASOURCE_URL=$\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"SPRING_DATASOURCE_URL\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"20\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" SPRING_DATASOURCE_USERNAME=$\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"SPRING_DATASOURCE_USERNAME\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"21\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" SPRING_DATASOURCE_PASSWORD=$\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"SPRING_DATASOURCE_PASSWORD\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"entrypoint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"java\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-jar\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"app.jar\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"--spring.profiles.active=staging\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"reverse-proxy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"container_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" nginx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"alpine\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"ports\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token datetime number\",\"children\":\"80:80\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"depends_on\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"volumes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" ./nginx.conf\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"/etc/nginx/nginx.conf\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"C'est en fait notre précédente configuration de tests e2e, mais sans les tests e2e et sans la DB.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Attention, nous avons aussi changé le profil actif de l'API en \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\" pour utiliser les variables d'environnement attendues dans le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-staging.properties\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Comment est-ce que les variables d'environnements sont rendues disponibles dans le service \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"api\"}]}],\" ?\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous allons devoir définir les variables d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL\"}]}],\", \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_USERNAME\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_PASSWORD\"}]}],\" afin qu'elles soient disponibles dans le service \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"api\"}]}],\" (au sein du conteneur de l'API).\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour ce faire, nous pouvons utiliser le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".env\"}]}],\" que nous avons créé précédemment pour qu'il soit lu par Docker Compose. Le plus rapide et efficace est de lancer la commande suivante dans un terminal à la racine de votre projet GitLab :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-bash\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"docker\"}],\" compose \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-f\"}],\" docker-compose.staging.yml --env-file api/.env up \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"--build\"}],\" \\n\"]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"En effet, la commande \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"--env-file api/.env\"}]}],\" permet de spécifier un fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".env\"}]}],\" (qui se trouve dans le répertoire \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"api\"}]}],\") qui sera lu par Docker Compose et dont les variables d'environnement seront rendues disponibles pour les services. Les variables d'environnement définies dans ce fichier ne sont pas automatiquement injectées dans les conteneurs Docker par défaut. Vous devez explicitement les passer via la section \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"environment:\"}]}],\" dans le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.staging.yml\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Ainsi \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"- SPRING_DATASOURCE_URL=${SPRING_DATASOURCE_URL}\"}]}],\" signifie que la variable d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL\"}]}],\" sera disponible dans le conteneur de l'API avec la valeur de la variable d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL\"}]}],\" définie dans le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".env\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez vérifier que tous vos services démarrent correctement en utilisant le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.staging.yml\"}]}],\" : pour ce faire, il suffit d'ouvrir un navigateur et de naviguer sur \",[\"$\",\"a\",null,{\"href\":\"http://localhost\",\"children\":\"http://localhost\"}],\" pour vérifier que tout est fonctionnel.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous allons maintenant voir comment déployer notre application sur Azure Web App Service.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_est_il_possible_de_deployer_une_application_sur_azure_web_app_service\",\"children\":\" Comment est-il possible de déployer une application sur Azure Web App Service ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Maintenant que nous avons notre environnement de staging local qui fonctionne correctement, nous allons voir comment déployer notre application sur Azure Web App Service.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Azure Web App Service est un service cloud (PaaS) qui permet de déployer des applications web sans avoir à gérer l'infrastructure sous-jacente. Il est idéal pour déployer des applications web qui nécessitent une haute disponibilité et une scalabilité automatique.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Comment déployer une application sur Azure Web App Service ?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Il existe plusieurs façons de déployer une application sur Azure Web App Service\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Publish code\"}],\" : vous pouvez publier votre code source directement sur Azure. Dans ce cas, vous devez choisir un runtime (Java, Node.js, Python, etc.) et Azure s'occupera de l'exécution de votre application. Vous devez créer autant de Web App que de services à déployer. Vous pouvez ensuite utiliser différent moyens pour pousser le code vers Azure : GitHub, Azure Repos, Local Git (CI/CD), External Git ou FTP.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Publish single container\"}],\" : vous pouvez publier un conteneur Docker sur Azure. Dans ce cas, vous devez créer un conteneur Docker pour chaque service à déployer et les publier sur Azure.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Publish docker compose\"}],\" : vous pouvez publier un fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.yml\"}]}],\" sur Azure. Dans ce cas, vous devez créer un fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.yml\"}]}],\" qui définit les services à déployer et les publier sur Azure. Le gros avantage de cette méthode est que vous pouvez déployer plusieurs services en une seule fois.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour ce cours, nous allons utiliser la méthode \",[\"$\",\"strong\",null,{\"children\":\"Publish docker compose\"}],\" pour déployer tous nos services en une seule fois dans une seule Web App.\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_creer_une_application_sur_azure_web_app_service\",\"children\":\" Comment créer une application sur Azure Web App Service ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Création d'une Azure Web App\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Vous devez avoir une \",[\"$\",\"strong\",null,{\"children\":\"subscription\"}],\" à Azure. Les instructions pour obtenir des crédits gratuits sont disponibles plus haut dans cette page.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour déployer une application sur Azure Web App Service, vous devez d'abord créer une \",[\"$\",\"strong\",null,{\"children\":\"Web App\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Il est possible de le faire via le portail Azure ou via la ligne de commande. Pour ce tutoriel, nous utiliserons le portail Azure.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez vous connecter au portail Azure : \",[\"$\",\"a\",null,{\"href\":\"https://portal.azure.com/\",\"children\":\"https://portal.azure.com/\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Cliquez ensuite sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"App Services\"}]}],\". Si vous avez bien une \",[\"$\",\"strong\",null,{\"children\":\"subscription\"}],\", alors vous aurez l'option \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Create\"}]}],\". Cliquez dessus.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Choisissez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Web App\"}]}],\" et cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Create\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Dans la section \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Basics\"}]}],\", remplissez les informations suivantes :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Subscription\"}]}],\" : choisissez votre subscription, probablement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Azure for Students\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Resource Group\"}]}],\" : créez un nouveau \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Resource Group\"}]}],\" ou utilisez un existant. Par exemple \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"caeGroup\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\" : donnez un nom à votre Web App. Par exemple \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"cae-groupxy-staging-app\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Publish\"}]}],\" : choisissez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Container\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Operating System\"}]}],\" : choisissez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Linux\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Region\"}]}],\" : choisissez une région disponible dans un plan gratuit. Par exemple \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Central US\"}]}],\". Attention, si vous choisissez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"France Central\"}]}],\" par exemple, vous n'aurez pas de plan gratuit.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Linux Plan\"}]}],\" : Garder le plan par défaut.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Pricing plan\"}]}],\" : choisissez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"F1\"}]}],\" pour avoir un plan gratuit. 60 CPU minutes par jour sont inclues.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Review + create\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Create\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Go to resource\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Notez l'URL de votre Web App, par exemple : \",[\"$\",\"a\",null,{\"href\":\"https://cae-groupxy-staging-app-fza6c0ebghahfufh.centralus-01.azurewebsites.net/\",\"children\":\"https://cae-groupxy-staging-app-fza6c0ebghahfufh.centralus-01.azurewebsites.net/\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Avec votre browser, vous pouvez maintenant naviguer sur l'URL de votre Web App pour vérifier que tout fonctionne correctement. Vous devriez voir une page par défaut d'Azure : \\\"Welcome to nginx!\\\".\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_donner_acces_a_dautres_applications_a_une_azure_web_app\",\"children\":\" Comment donner accès à d'autres applications à une Azure Web App ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Maintenant que nous avons créé notre Web App, nous allons la configurer pour qu'elle puisse déployer tous nos services via Docker Compose à partir de GitLab.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Création d'un service principal\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Un \",[\"$\",\"strong\",null,{\"children\":\"service principal\"}],\" est une identité de sécurité utilisée par les applications, les services et les outils d'automatisation pour accéder aux ressources Azure.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Un service principal permet :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Une authentification sécurisée\"}],\" : Le service principal permettra à GitLab CI/CD de s'authentifier de manière sécurisée auprès d'Azure pour déployer des ressources.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Un accès contrôlé\"}],\": Vous pouvez définir des rôles et des autorisations spécifiques pour le service principal, limitant ainsi l'accès aux ressources nécessaires uniquement.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Une automatisation\"}],\" : Le service principal permet d'automatiser les déploiements et les opérations sur Azure sans intervention manuelle.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"🍬 Création d'un service principal en utilisant la ligne de commande Azure\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour les étudiants Vinci, cette procédure va probablement échouer car vous n'avez pas les droits nécessaires pour créer un service principal via la ligne de commande Azure. Passer donc à la section qui suit pour créer un service principal via le portail Azure.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez suivre les instructions suivantes pour créer un service principal à l'aide de la ligne de commande Azure :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Connectez vous à votre portail Azure.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Ouvrez un cloud shell (icône en haut à droite).\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Exécutez la commande suivante pour créer un service principal nommé \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging-service-principal\"}]}],\" avec le rôle \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"contributor\"}]}],\" sur le \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Resource Group\"}]}],\" de votre Web App :\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-bash\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"az ad sp create-for-rbac \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"--name\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"staging-service-principal\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"--role\"}],\" contributor \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"--scopes\"}],\" /subscriptions/\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"subscription-id\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"/resourceGroups/\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"staging-resource-group\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Attention à ne pas avoir d'espaces inutiles dans la commande ! Un bon exemple serait : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"az ad sp create-for-rbac --name \\\"staging-service-principal\\\" --role contributor --scopes /subscriptions/ef4cb19c-8c1e-45dd-b46a-c5a0ece77c90/resourceGroups/caeGroup\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Vous devez remplacer \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"\u003csubscription-id\u003e\"}]}],\" par l'\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"ID\"}]}],\" de votre subscription et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"\u003cstaging-resource-group\u003e\"}]}],\" par le nom de votre \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Resource Group\"}]}],\" de staging.\",[\"$\",\"br\",null,{}],\"\\n\",\"Vous trouvez ces informations dans le portail Azure, en sélectionnant votre Web App, dans son \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Overview\"}]}],\" :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Subscription\"}]}],\" : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Subscription ID\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"ef4cb19c-8c1e-45dd-b46a-c5a0ece77c90\"}]}],\" par exemple).\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Resource Group\"}]}],\" : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Resource Group\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"caeGroup\"}]}],\" par exemple).\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Il est possible que vous ayez comme message : \",[\"$\",\"code\",null,{\"children\":\"Insufficient privileges to complete the operation.\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Dans ce cas, il faut malheureusement utiliser le portail Azure pour créer le service principal.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Création d'un service principal en utilisant le portail Azure\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici comment faire :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Via le portail Azure,\\nD'abord cherchez :  \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"App registrations\"}]}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"New registration\"}]}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Donnez un \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\" : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging ci/cd\"}]}],\" par exemple.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Laissez le reste tel quel et cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Register\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Veuillez noter ces informations :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Application (client) ID\"}]}],\" : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"c4b1b1b1-1b1b-1b1b-1b1b-1b1b1b1b1b1b\"}]}],\" par exemple. C'est votre \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_ID\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Directory (tenant) ID\"}]}],\" : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"d4b1b1b1-1b1b-1b1b-1b1b-1b1b1b1b1b1b\"}]}],\" par exemple. C'est votre \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_TENANT_ID\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Ensuite, veuillez :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Manage\"}]}],\", puis sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Certificates \u0026 secrets\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"New client secret\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Donner un \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Description\"}]}],\" : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"gitlab ci/cd secret\"}]}],\" par exemple.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Choisir une \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Expires\"}]}],\" : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"730 days\"}]}],\" par exemple.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Noter la \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\" de votre secret, comme par exemple : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"b4b1b1b1-1b1b-1b1b-1b1b-1b1b1b1b1b1b\"}]}],\". C'est votre \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_SECRET\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Ajout du service principal à l'Azure Web App via le portail Azure\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Au niveau de votre Azure Web App (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"cae-groupxy-staging-app\"}]}],\" par exemple) via le portail Azure, veuillez :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Access control (IAM)\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add a role assignment\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Members\"}]}],\". \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"User, group, or service principal\"}]}],\" est sélectionné par défaut.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Select members\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Chercher le service principal (l'application que vous avez inscrite juste auparavant) que vous avez créé. Par exemple, \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging ci/cd\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Select\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Role\"}]}],\", puis sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Privileged administrator roles\"}]}],\". Choisir \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Contributor\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Review + assign\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"A la fin de cette étape, vous avez créé un service principal et vous l'avez ajouté à votre Web App avec le rôle \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Contributor\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez garder ces infos en lieu sûr : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_SECRET\"}]}],\", \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_TENANT_ID\"}]}],\", \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_ID\"}]}],\".\\nCes infos seront nécessaires pour la suite !\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici un exemple de ce que vous devriez avoir à la fin de cette étape :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-properties\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-properties code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"AZURE_CLIENT_SECRET\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"am45Q~jpcc2G64r3GumcGdYRE99cwxddfsqWeD8DcW1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"AZURE_TENANT_ID\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"f7a15dq7-57cb-5855-8d36-0545f95aada17\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"AZURE_CLIENT_ID\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"fs8f6ea8-8807-4764-a394-f0bessqf7e8cbe\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Configuration de la Web App pour les variables d'environnements attendues\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour que notre Web App puisse se connecter correctement à notre DB de staging, nous devons définir les variables d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL\"}]}],\", \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_USERNAME\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_PASSWORD\"}]}],\" au niveau de notre Web App.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"En local, les variables d'environnement sont définies dans le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".env\"}]}],\". Sur Azure, les variables d'environnement sont définies au niveau de la Web App. Ces secrets sont stockés de manière sécurisée dans Azure.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Configuration des variables d'environnements\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Au niveau de votre Azure Web App (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"cae-groupxy-staging-app\"}]}],\" par exemple) via le portail Azure, veuillez :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Settings\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Environment variables\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Ajouter les variables d'environnement suivantes en cliquant sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add\"}]}],\" :\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_URL\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\"): l'URL de connexion à votre DB de staging (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\"). Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_USERNAME\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\"): le nom d'utilisateur de votre DB de staging (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\"). Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_DATASOURCE_PASSWORD\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\"): le mot de passe de votre DB de staging (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\"). Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"N'oubliez pas de cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\" pour sauvegarder l'ajout des 3 variables, puis \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Confirm\"}]}],\".\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Dans une prochaine étape, nous allons voir comment déployer notre application sur Azure Web App Service à l'aide de GitLab CI/CD.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_faire_un_push_des_images_de_git_lab_vers_azure_app_service\",\"children\":\" Comment faire un push des images de GitLab vers Azure App Service ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Maintenant que nous avons créé notre Web App et configuré les variables d'environnement, nous allons voir comment déployer nos services sur Azure Web App Service à l'aide de GitLab CI/CD.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour ce faire, nous allons d'abord pousser les images Docker de nos services vers le GitLab Registry. Ensuite, nous allons déployer ces images sur Azure Web App Service.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Le GitLab Registry est un registre Docker privé qui permet de stocker des images Docker.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Son rôle va être d'accueillir les images Docker de nos services. Ces images seront ensuite utilisées pour déployer nos services sur Azure Web App Service.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Création d'un token d'accès pour le GitLab Registry\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Afin que Azure puisse accéder aux images qui se trouveront dans le GitLab Registry, nous allons devoir créer un token d'accès.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour ce faire, veuillez suivre les instructions suivantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Connectez-vous à votre projet GitLab.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Settings\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Repository\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Deploy Tokens\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add token\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Donnez un \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\" : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"pull-image-token\"}]}],\" par exemple.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cochez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"read_registry\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Create deploy token\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Notez le \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"username\"}]}],\" (deviendra \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PULL_IMAGE_TOKEN_USERNAME\"}]}],\") et le \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"password\"}]}],\" (deviendra \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PULL_IMAGE_TOKEN_PASSWORD\"}]}],\"). Vous en aurez besoin pour la suite comme variables d'environnement.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici un exemple de ce que vous devriez avoir noté à la fin de cette étape :\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-properties\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-properties code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"PULL_IMAGE_TOKEN_USERNAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"gitlab+deploy-token-5667774\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"PULL_IMAGE_TOKEN_PASSWORD\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"gldt-Sc5rz_QATFUZDcXVb2CQ\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Ajout des variables d'environnement pour l'accès au GitLab Registry depuis Azure\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Toujours dans votre projet GitLab, vous allez ajouter les variables d'environnement qui seront utilisées pour accéder au GitLab Registry depuis Azure.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour ce faire, veuillez suivre les instructions suivantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Connectez-vous à votre projet GitLab.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Settings\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CI/CD\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Variables\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Ajoutez comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Key\"}]}],\" \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PULL_IMAGE_TOKEN_USERNAME\"}]}],\" et comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\" la valeur que vous avez notée précédemment.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Sélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Masked\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Désélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Protect variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Ajoutez comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Key\"}]}],\" \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PULL_IMAGE_TOKEN_PASSWORD\"}]}],\" et comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\" la valeur que vous avez notée précédemment.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Sélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Masked\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Désélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Protect variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add variable\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Ajout des variables d'environnement pour l'accès à Azure\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Toujours dans votre projet GitLab, vous allez ajouter les variables d'environnement qui seront utilisées pour accéder à Azure depuis GitLab CI/CD.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour ce faire, veuillez suivre les instructions suivantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Connectez-vous à votre projet GitLab.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Settings\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CI/CD\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Variables\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Ajoutez comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Key\"}]}],\" \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_SECRET\"}]}],\" et comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\" la valeur que vous avez notée précédemment.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Sélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Masked\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Désélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Protect variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Ajoutez comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Key\"}]}],\" \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_TENANT_ID\"}]}],\" et comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\" la valeur que vous avez notée précédemment.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Sélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Masked\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Désélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Protect variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Ajoutez comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Key\"}]}],\" \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_ID\"}]}],\" et comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\" la valeur que vous avez notée précédemment.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Sélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Masked\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Désélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Protect variable\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add variable\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Workflow de déploiement\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici le workflow de déploiement que nous allons suivre :\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Nous allons d'abord réaliser les tests de notre frontend et de notre API.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Si les tests passent, nous allons construire les images Docker de nos services et pousser ces images vers le GitLab Registry.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Nous allons déployer ces images sur Azure Web App Service. A partir de notre pipeline, nous allons nous connecter à Azure et déployer les images Docker sur notre Web App en demandant à Azure de faire un pull des images depuis le GitLab Registry.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"En image, voila ce que cela donne :\"}],\"\\n\",[\"$\",\"$L17\",null,{\"src\":\"/diagrams/gitlab-registry.puml\",\"alt\":\"Workflow de déploiement\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Création d'une image personnalisée pour le reverse proxy\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour le reverse proxy, nous souhaitons aussi avoir une image prête à être déployée sur Azure Web App Service. Pour ce faire, nous allons créer un fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Dockerfile\"}]}],\" au sein d'un nouveau dossier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"reverse-proxy\"}]}],\" avec le contenu suivant :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-dockerfile\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-dockerfile code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token instruction\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"FROM\"}],\" nginx:alpine\"]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token instruction\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"COPY\"}],\" nginx.conf /etc/nginx/nginx.conf\"]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token instruction\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"EXPOSE\"}],\" 80\"]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token instruction\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"CMD\"}],\" [\",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"nginx\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-g\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"daemon off;\\\"\"}],\"]\"]}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez aussi copier le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"nginx.conf\"}]}],\" contenu à la racine de votre projet GitLab dans le dossier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"reverse-proxy\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous devons mettre à jour le Docker Compose pour construire l'image de notre reverse proxy. Pour ce faire, veuillez mettre à jour le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.staging.yml\"}]}],\" :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"services\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"frontend\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"container_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"context\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" ./frontend\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"ports\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" 5172\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5172\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"depends_on\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"api\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"container_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" ./api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"ports\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" 3000\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3000\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" SPRING_DATASOURCE_URL=$\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"SPRING_DATASOURCE_URL\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" SPRING_DATASOURCE_USERNAME=$\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"SPRING_DATASOURCE_USERNAME\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" SPRING_DATASOURCE_PASSWORD=$\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"SPRING_DATASOURCE_PASSWORD\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"entrypoint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"java\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-jar\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"app.jar\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"--spring.profiles.active=staging\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"reverse-proxy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"container_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"26\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"27\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" ./reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"ports\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token datetime number\",\"children\":\"80:80\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour le service \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"reverse-proxy\"}]}],\", nous avons ajouté la ligne \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"build: ./reverse-proxy\"}]}],\" pour construire l'image de notre reverse proxy.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Mise à jour du fichier .gitlab-ci.yml\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous allons maintenant mettre à jour le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".gitlab-ci.yml\"}]}],\" pour déployer nos services sur Azure Web App Service :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stages\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"4\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"MAVEN_OPTS\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"7\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"VERSION\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_IID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"8\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_REGISTRY \\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"9\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY_IMAGE_BASE_PATH\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $REGISTRY/$CI_PROJECT_PATH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"10\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# Remplacer par le nom de votre Web App Azure\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"11\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_RESOURCE_GROUP\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" caeGroup \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# Remplacer par le nom de votre Resource Group Azure\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":\"  \\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"api test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" maven\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"3.9.9\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"amazoncorretto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/pom.xml\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" $CI_PROJECT_DIR/.m2/repository\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" mvn clean test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/site/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/surefire\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"frontend test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"34\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"alpine\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"35\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"36\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"37\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"38\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/package\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"lock.json\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"39\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"40\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/node_modules\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"41\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"42\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd frontend\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"43\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"44\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run lint\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"45\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run coverage\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"46\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"47\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"48\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/coverage/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"49\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"50\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"51\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"52\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"53\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"services\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"54\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"dind\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"55\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"56\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" echo $CI_REGISTRY_PASSWORD \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],\" docker login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"u $CI_REGISTRY_USER $CI_REGISTRY \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"stdin\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"57\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"f docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.staging.yml build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"58\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" for service in frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod; do\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"59\",\"children\":[\"        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"60\",\"children\":[\"        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"61\",\"children\":[\"        docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"62\",\"children\":[\"        docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"63\",\"children\":\"      done\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"64\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"65\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"deploy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"66\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"67\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/azure\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cli\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"68\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"69\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"principal \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"username $AZURE_CLIENT_ID \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $AZURE_CLIENT_SECRET \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"tenant $AZURE_TENANT_ID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"70\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp config container set \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"type compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"file docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.deploy.yml \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"user $PULL_IMAGE_TOKEN_USERNAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $PULL_IMAGE_TOKEN_PASSWORD\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"71\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp start \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Voici les changements apportés au fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".gitlab-ci.yml\"}]}],\" :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Nous avons ajouté une nouvelle variable \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"VERSION\"}]}],\" qui contient l'identifiant du pipeline. Cette variable sera utilisée pour tagger les images Docker avec un numéro de version. \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"$$CI_PIPELINE_IID\"}]}],\" est une variable GitLab qui contient l'identifiant du pipeline.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Nous avons ajouté une nouvelle variable \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"REGISTRY\"}]}],\" qui contient l'URL du GitLab Registry. \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"$$CI_REGISTRY\"}]}],\" est une variable GitLab qui contient l'URL du GitLab Registry.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Nous avons ajouté une nouvelle variable \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_WEBAPP_NAME\"}]}],\" qui doit être adaptée pour contenir le nom de notre Web App Azure.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Nous avons ajouté une nouvelle variable \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_WEBAPP_RESOURCE_GROUP\"}]}],\" qui doit être adapté pour contenir le nom du \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Resource Group\"}]}],\" de notre Web App Azure.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"echo $CI_REGISTRY_PASSWORD | docker login -u $CI_REGISTRY_USER $CI_REGISTRY --password-stdin\"}]}],\" : nous nous connectons au GitLab Registry en utilisant les variables d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CI_REGISTRY_USER\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CI_REGISTRY_PASSWORD\"}]}],\". Ces variables sont automatiquement définies par GitLab.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose -f docker-compose.staging.yml build\"}]}],\" : nous construisons les images Docker de nos services en utilisant le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.staging.yml\"}]}],\". Nous n'indiquons plus de fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".env\"}]}],\" car les variables d'environnement sont définies au niveau de notre Web App Azure.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"for service in frontend-prod api-prod reverse-proxy-prod; do\"}]}],\" : boucle sur les services \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"frontend-prod\"}]}],\", \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"api-prod\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"reverse-proxy-prod\"}]}],\" afin de tagger et pousser les images Docker vers le GitLab Registry.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service:latest;\"}]}],\" : nous taggons l'image Docker avec le tag \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"latest\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service:$VERSION;\"}]}],\" : nous taggons l'image Docker avec le tag \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"$$VERSION\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker push $REGISTRY_IMAGE_BASE_PATH/$service:latest;\"}]}],\" : nous poussons l'image Docker vers le GitLab Registry avec le tag \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"latest\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker push $REGISTRY_IMAGE_BASE_PATH/$service:$VERSION;\"}]}],\" : nous poussons l'image Docker vers le GitLab Registry avec le tag \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"$$VERSION\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Nous avons ajouté un nouveau job \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy\"}]}],\" qui va déployer nos services sur Azure Web App Service.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"az login --service-principal --username $AZURE_CLIENT_ID --password $AZURE_CLIENT_SECRET --tenant $AZURE_TENANT_ID\"}]}],\" : nous nous connectons à Azure en utilisant les variables d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_ID\"}]}],\", \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_CLIENT_SECRET\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AZURE_TENANT_ID\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"az webapp config container set --name $AZURE_WEBAPP_NAME --resource-group $AZURE_WEBAPP_RESOURCE_GROUP --multicontainer-config-type compose --multicontainer-config-file docker-compose.deploy.yml --container-registry-user $PULL_IMAGE_TOKEN_USERNAME --container-registry-password $PULL_IMAGE_TOKEN_PASSWORD\"}]}],\" : nous déployons nos services sur Azure Web App Service en utilisant le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.deploy.yml\"}]}],\" et les variables d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PULL_IMAGE_TOKEN_USERNAME\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"PULL_IMAGE_TOKEN_PASSWORD\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"az webapp start --name $AZURE_WEBAPP_NAME --resource-group $AZURE_WEBAPP_RESOURCE_GROUP\"}]}],\" : nous démarrons notre Web App Azure.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous allons maintenant voir comment créer le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.deploy.yml\"}]}],\" qui sera utilisé par Azure pour faire un pull des images Docker depuis le GitLab Registry.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Création du fichier docker-compose.deploy.yml\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous allons créer un fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.deploy.yml\"}]}],\" à la racine de notre projet GitLab avec le contenu suivant :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"services\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"frontend\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" registry.gitlab.com/e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"vinci/cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"projects/2025\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"projects/cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"xy/frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# Remplacer par l'image Docker de votre frontend\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"container_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"ports\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" 5172\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5172\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"depends_on\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"api\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" registry.gitlab.com/e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"vinci/cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"projects/2025\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"projects/cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"xy/api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# Remplacer par l'image Docker de votre API\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"container_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"ports\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" 3000\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3000\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"environment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" SPRING_DATASOURCE_URL=$\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"SPRING_DATASOURCE_URL\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" SPRING_DATASOURCE_USERNAME=$\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"SPRING_DATASOURCE_USERNAME\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" SPRING_DATASOURCE_PASSWORD=$\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"SPRING_DATASOURCE_PASSWORD\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"entrypoint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"java\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-jar\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"app.jar\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"--spring.profiles.active=staging\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"reverse-proxy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" registry.gitlab.com/e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"vinci/cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"projects/2025\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"projects/cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"xy/reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# Remplacer par l'image Docker de votre reverse proxy\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"container_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"ports\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token datetime number\",\"children\":\"80:80\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Ce fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.deploy.yml\"}]}],\" est similaire au fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"docker-compose.staging.yml\"}]}],\". La seule différence est que nous utilisons les images Docker que nous avons poussées vers le GitLab Registry.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour connaître le chemin de vos images Docker dans le GitLab Registry, veuillez suivre les instructions suivantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Connectez-vous à votre projet GitLab.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Deploy\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Container Registry\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Vous verrez les images Docker de vos services. Cliquez sur une image pour voir les tags disponibles.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"En cliquant sur un tag, vous verrez le chemin complet de l'image Docker. Par exemple : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Published to the e-vinci/cae-projects/2025-cae-projects/cae-group-xy/reverse-proxy-prod image repository on 19 February 2025 at 19:10:39 CET\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Une fois toutes ces étapes réalisées, vous pouvez lancer le pipeline GitLab CI/CD pour déployer vos services sur Azure Web App Service. Pour ce faire, il suffit de pousser votre code sur votre repository GitLab.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Si tout se passe bien, vous devriez voir vos services déployés sur Azure Web App Service. Vous pouvez vérifier que tout fonctionne correctement en naviguant sur l'URL de votre Web App Azure, par exemple : \",[\"$\",\"a\",null,{\"href\":\"https://cae-groupxy-staging-app-fza6c0ebghahfufh.centralus-01.azurewebsites.net/\",\"children\":\"https://cae-groupxy-staging-app-fza6c0ebghahfufh.centralus-01.azurewebsites.net/\"}],\".\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Dois-je arrêter ma Web App Azure pour ne pas consommer de minutes CPU ?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Les 60 minutes de CPU par jour sur Azure Web App Service (plan gratuit F1) se réfèrent à l'utilisation totale du processeur par votre application, y compris le traitement des requêtes HTTP et toute autre activité nécessitant des ressources CPU. Ce n'est pas limité au temps de build. Si votre application consomme beaucoup de CPU, vous pourriez dépasser les 60 minutes de CPU par jour.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Vous pouvez arrêter votre Web App Azure pour ne pas consommer de CPU minutes. Pour ce faire, veuillez suivre les instructions suivantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Connectez-vous à votre portail Azure.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"App Services\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Sélectionnez votre Web App.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Stop\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour la redémarrer, il suffit de cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Start\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour voir votre consommation de CPU, vous pouvez suivre les instructions suivantes :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Connectez-vous à votre portail Azure.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"App Services\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Sélectionnez votre Web App.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Monitoring\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Metrics\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Sélectionnez \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CPU Time\"}]}],\" au niveau de \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Metric\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_deployer_seulement_en_cas_de_fusion_de_modification_sur_le_main\",\"children\":\" Comment déployer seulement en cas de fusion de modification sur le main ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous allons voir comment déployer nos services sur Azure Web App Service uniquement en cas de fusion de modifications sur la branche \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"En fait, c'est quelque chose que nous avons déjà vu. Nous allons simplement ajouter une condition à notre job \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy\"}]}],\" pour qu'il ne s'exécute que si nous fusionnons des modifications sur la branche \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main\"}]}],\".\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Mise à jour du fichier .gitlab-ci.yml\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez mettre à jour le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".gitlab-ci.yml\"}]}],\" pour déployer nos services sur Azure Web App Service uniquement en cas de fusion de modifications sur la branche \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main\"}]}],\" :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stages\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"MAVEN_OPTS\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"VERSION\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_IID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_REGISTRY \\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY_IMAGE_BASE_PATH\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $REGISTRY/$CI_PROJECT_PATH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_RESOURCE_GROUP\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" caeGroup\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":\"  \\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"api test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" maven\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"3.9.9\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"amazoncorretto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/pom.xml\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" $CI_PROJECT_DIR/.m2/repository\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" mvn clean test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/site/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/surefire\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"frontend test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"34\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"alpine\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"35\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"36\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"37\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"38\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/package\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"lock.json\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"39\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"40\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/node_modules\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"41\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"42\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd frontend\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"43\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"44\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run lint\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"45\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run coverage\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"46\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"47\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"48\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/coverage/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"49\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"50\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"51\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"52\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"53\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"services\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"54\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"dind\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"55\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"56\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" echo $CI_REGISTRY_PASSWORD \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],\" docker login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"u $CI_REGISTRY_USER $CI_REGISTRY \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"stdin\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"57\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"f docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.staging.yml build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"58\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" for service in frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod; do\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"59\",\"children\":[\"        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"60\",\"children\":[\"        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"61\",\"children\":[\"        docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"62\",\"children\":[\"        docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"63\",\"children\":\"      done\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"64\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"65\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"deploy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"66\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"67\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/azure\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cli\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"68\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"       \\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"69\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"70\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"71\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"principal \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"username $AZURE_CLIENT_ID \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $AZURE_CLIENT_SECRET \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"tenant $AZURE_TENANT_ID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"72\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp config container set \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"type compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"file docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.deploy.yml \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"user $PULL_IMAGE_TOKEN_USERNAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $PULL_IMAGE_TOKEN_PASSWORD\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"73\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp start \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH\"}]}],\" : cette condition permet de vérifier si le nom de la branche de la fusion de modifications est égal au nom de la branche par défaut. Si c'est le cas, le job \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy\"}]}],\" s'exécute. Sinon, il ne s'exécute pas.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez faire un push de vos modifications sur votre \\\"feature branch\\\". Vous devriez voir que le job \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy\"}]}],\" ne s'exécute pas.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Si vous fusionnez vos modifications sur la branche \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main\"}]}],\", le job \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deploy\"}]}],\" s'exécutera. Nous n'allons pas tout de suite le faire car nous allons voir comment réaliser des tests e2e sur notre application en production.\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_realiser_des_tests_e_2_e_sur_lapp_en_production\",\"children\":\" Comment réaliser des tests e2e sur l'app en production ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Dans l'environnement de tests, nous avons réalisés les tests e2e directement au sein d'un réseau Docker.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Dans l'environnement de staging, nous souhaitons réaliser les tests e2e sur les services déployés sur Azure Web App Service.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici le workflow que nous allons suivre :\"}],\"\\n\",[\"$\",\"$L17\",null,{\"src\":\"/diagrams/gitlab-registry2.puml\",\"alt\":\"Workflow de déploiement\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Mise à jour de la configuration des tests e2e\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Dans la configuration de Playwright, nous devons mettre à jour l'URL de notre application pour qu'elle pointe vers notre Web App Azure.\\nPour le faire correctement, nous allons ajouter une nouvelle variable d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"BASE_URL\"}]}],\" au niveau de notre Web App Azure afin de pouvoir facilement réaliser les tests e2e quel que soit l'environnement.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez mettre à jour le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"playwright.config.ts\"}]}],\" au niveau de votre projet \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"e2e\"}]}],\" :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-ts\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-ts code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"baseURL\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      process\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"env\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"NODE_ENV\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"===\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"undefined\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      process\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"env\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"NODE_ENV\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"===\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"development\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"http://localhost:5173\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" process\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"env\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"BASE_URL\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"===\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"undefined\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"http://reverse-proxy:80\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" process\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"env\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Mise à jour du fichier .gitlab-ci.yml\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez mettre à jour le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".gitlab-ci.yml\"}]}],\" pour réaliser les tests e2e sur notre application en production :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stages\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"5\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"MAVEN_OPTS\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"VERSION\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_IID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_REGISTRY \\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY_IMAGE_BASE_PATH\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $REGISTRY/$CI_PROJECT_PATH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_RESOURCE_GROUP\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" caeGroup\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"14\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"fza6c0ebghahfufh.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"15\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"NODE_ENV\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":\"  \\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"api test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" maven\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"3.9.9\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"amazoncorretto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/pom.xml\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" $CI_PROJECT_DIR/.m2/repository\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" mvn clean test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/site/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"34\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/surefire\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"35\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"36\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"frontend test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"37\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"38\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"alpine\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"39\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"40\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"41\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"42\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/package\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"lock.json\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"43\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"44\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/node_modules\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"45\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"46\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd frontend\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"47\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"48\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run lint\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"49\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run coverage\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"50\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"51\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"52\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/coverage/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"53\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"54\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"55\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"56\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"57\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"services\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"58\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"dind\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"59\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"60\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" echo $CI_REGISTRY_PASSWORD \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],\" docker login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"u $CI_REGISTRY_USER $CI_REGISTRY \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"stdin\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"61\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"f docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.staging.yml build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"62\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" for service in frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod; do\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"63\",\"children\":[\"        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"64\",\"children\":[\"        docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"65\",\"children\":[\"        docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"66\",\"children\":[\"        docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"67\",\"children\":\"      done\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"68\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"69\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"deploy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"70\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"71\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/azure\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cli\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"72\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"       \\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"73\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"74\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"75\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"principal \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"username $AZURE_CLIENT_ID \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $AZURE_CLIENT_SECRET \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"tenant $AZURE_TENANT_ID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"76\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp config container set \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"type compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"file docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.deploy.yml \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"user $PULL_IMAGE_TOKEN_USERNAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $PULL_IMAGE_TOKEN_PASSWORD\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"77\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp start \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"78\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"79\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"e2e tests\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"80\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"81\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/playwright\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"v1.50.1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"jammy\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"82\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"       \\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"83\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"84\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"85\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd ./e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"86\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"87\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npx playwright test \\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"88\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" if \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\" $\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"?\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"ne 0 \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"; then echo \\\"E2E tests failed\\\"; exit 1; fi\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"89\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"90\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"91\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e/playwright\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"report/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"92\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e/test\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"results/\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous avons ajouté un nouveau job \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"e2e tests\"}]}],\" qui va réaliser les tests e2e sur notre application en production. Ce job s'exécute uniquement si nous fusionnons des modifications sur la branche \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous avons ajouté une nouvelle variable d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"BASE_URL\"}]}],\" qui contient l'URL de notre Web App Azure.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous avons aussi ajouté une nouvelle variable d'environnement \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"NODE_ENV\"}]}],\" qui contient l'environnement de notre application. Cette variable est utilisée pour déterminer l'URL de notre application dans le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"playwright.config.ts\"}]}],\" du projet \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"e2e\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez pousser vos modifications sur votre repository GitLab. Si les stages \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"test\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"build\"}]}],\"  passent, la MR peut être mergée. Si la MR est mergée sur la branche \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main\"}]}],\", les jobs \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"e2e tests\"}]}],\" s'exécuteront après avoir réexécuté les stages \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"test\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"build\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Il est fort probable que nos tests e2e ne passent pas du premier coup. Mais pourquoi ?\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Pourquoi les tests e2e ne passent pas du premier coup ?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Les tests e2e peuvent ne pas passer du premier coup pour plusieurs raisons :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"L'application est lente à charger et les tests sont exécutés avant que l'application ne soit complètement chargée.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"La base de données contient déjà les données des tests précédents.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Faut il réinitialiser la DB à chaque démarrage de l'environnement de staging ?\",[\"$\",\"br\",null,{}],\"\\n\",\"Il est recommandé de réinitialiser la base de données à chaque démarrage de l'environnement de staging. Cela permet de s'assurer que les données de tests sont toujours les mêmes et que les tests e2e sont exécutés dans des conditions similaires.\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"Attention qu'il est intéressant de réinitialiser la DB à chaque démarrage de l'environnement de staging pour s'assurer que les données de tests sont toujours les mêmes et que les tests e2e sont exécutés dans des conditions similaires. Par contre, pour l'environnement de production, il est recommandé de ne pas réinitialiser la DB à chaque démarrage pour ne pas perdre les données des utilisateurs.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Comment réinitialiser la DB à chaque démarrage de l'environnement de staging ?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous allons faire en sorte de réinitialiser la DB à chaque démarrage de l'environnement de staging.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour continuer dans ce tutoriel, vous devez créer une nouvelle feature branch, car pour lancer les tests e2e, il faudra qu'il y ait une fusion de modifications sur la branche \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous allons faire en sorte que Spring Boot utilise le profil \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\" pour réinitialiser la DB à chaque démarrage de notre Web App Azure, en utilisant le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-staging.properties\"}]}],\".\",[\"$\",\"br\",null,{}],\"\\n\",\"Pour rappel, un profil sous Spring Boot est un ensemble de configurations qui permettent de définir le comportement de l'application en fonction de l'environnement dans lequel elle est exécutée.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez vous assurer que le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-staging.properties\"}]}],\" est bien créé au niveau de votre projet \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"api\"}]}],\" :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-properties\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-properties code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.application.name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"demo\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"server.port\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"3000\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.url\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"$${SPRING_DATASOURCE_URL}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.username\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"$${SPRING_DATASOURCE_USERNAME}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.datasource.password\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"$${SPRING_DATASOURCE_PASSWORD}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.jpa.generate-ddl\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"true\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.sql.init.mode\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"always\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key attr-name\",\"children\":\"spring.jpa.defer-datasource-initialization\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token value attr-value\",\"children\":\"true\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Pour rappel :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring.sql.init.mode=always\"}]}],\" : cette propriété permet de réinitialiser la DB à chaque démarrage de l'application.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring.jpa.defer-datasource-initialization=true\"}]}],\" : cette propriété permet de retarder l'initialisation de la source de données. D'abord les entités sont créées, puis la source de données est initialisée via le script \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"data.sql\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Nous allons maintenant voir comment configurer notre Web App Azure pour qu'elle utilise le profil \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour ce faire, il suffit d'ajouter une variable d'environnement au niveau de notre Web App Azure. Cette variable d'environnement est tout ce qu'il y a à faire pour que Spring Boot utilise le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-staging.properties\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Au niveau de votre Azure Web App (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"cae-groupxy-staging-app\"}]}],\" par exemple) via le portail Azure, veuillez :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Settings\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Environment variables\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Ajouter la variable d'environnement suivante en cliquant sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Add\"}]}],\" :\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SPRING_PROFILES_ACTIVE\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Name\"}]}],\"): \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Value\"}]}],\"). Cliquez sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"N'oubliez pas de cliquer sur \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Apply\"}]}],\" pour sauvegarder l'ajout de la variable, puis \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Confirm\"}]}],\".\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"id\":\"comment_attendre_que_l_api_soit_bien_demarree_avant_de_lancer_les_tests_e_2_e\",\"children\":\" Comment attendre que l'API soit bien démarrée avant de lancer les tests e2e ? \"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Dans l'environnement de staging, nous avons réalisé les tests e2e sur les services déployés sur Azure Web App Service.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Nous avons vu que les tests e2e peuvent ne pas passer du premier coup, notamment parce que l'application est lente à charger et les tests sont exécutés avant que l'application ne soit complètement chargée.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pour assurer que l'API est prête avant de lancer les tests e2e, nous allons ajouter une étape qui attend que l'API soit bien démarrée avant de lancer les tests e2e. Pour ce faire, nous allons faire des requêtes HTTP sur l'API jusqu'à ce qu'elle soit prête. On pourrait appeler ça un \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"health check\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Parfois, au niveau des API REST, il est possible de créer un endpoint \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"/health\"}]}],\" qui permet de vérifier si l'API est bien démarrée. Ce endpoint peut retourner un code HTTP 200 si l'API est bien démarrée, après avoir vérifié que la base de données est bien connectée par exemple.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Dans notre tutoriel, nous allons simplement utiliser l'opération de lecture de toutes les pizzas comme \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"health check\"}]}],\". Si l'opération de lecture de toutes les pizzas retourne un code HTTP 200, alors l'API est bien démarrée.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Voici le workflow que nous allons suivre :\"}],\"\\n\",[\"$\",\"$L17\",null,{\"src\":\"/diagrams/gitlab-registry3.puml\",\"alt\":\"Workflow de déploiement\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Mise à jour du fichier .gitlab-ci.yml\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez mettre à jour le fichier \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\".gitlab-ci.yml\"}]}],\" pour attendre que l'API soit bien démarrée avant de lancer les tests e2e :\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"1\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stages\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"2\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"3\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"4\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"5\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"6\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"7\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"variables\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"8\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"MAVEN_OPTS\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"9\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"VERSION\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_PIPELINE_IID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"10\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_REGISTRY\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"11\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"REGISTRY_IMAGE_BASE_PATH\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $REGISTRY/$CI_PROJECT_PATH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"12\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"13\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"AZURE_WEBAPP_RESOURCE_GROUP\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" caeGroup\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"14\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"BASE_URL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" https\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"//cae\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"groupxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"staging\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"fza6c0ebghahfufh.centralus\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"01.azurewebsites.net/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"15\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"NODE_ENV\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"16\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"17\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"api test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"18\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"19\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" maven\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"3.9.9\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"amazoncorretto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"20\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"21\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"22\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"23\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/pom.xml\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"24\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"25\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" $CI_PROJECT_DIR/.m2/repository\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"26\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"27\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd api\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"28\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" mvn clean test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"29\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"30\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"31\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"32\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/site/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"33\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" api/target/surefire\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"reports/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"34\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"35\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"frontend test\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"36\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"37\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"alpine\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"38\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"cache\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"39\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"40\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"41\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/package\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"lock.json\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"42\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"43\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/node_modules\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"44\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"45\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd frontend\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"46\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"47\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run lint\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"48\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm run coverage\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"49\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"50\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"51\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" frontend/coverage/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"52\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"53\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"54\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"55\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"56\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"services\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"57\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"dind\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"58\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"59\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" echo $CI_REGISTRY_PASSWORD \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],\" docker login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"u $CI_REGISTRY_USER $CI_REGISTRY \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"stdin\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"60\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"f docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.staging.yml build\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"61\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" for service in frontend\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod api\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod reverse\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"proxy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"prod; do\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"62\",\"children\":[\"      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"63\",\"children\":[\"      docker tag $service $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"64\",\"children\":[\"      docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"latest;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"65\",\"children\":[\"      docker push $REGISTRY_IMAGE_BASE_PATH/$service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"$$VERSION;\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"66\",\"children\":\"      done\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"67\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"68\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"deploy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"69\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" staging\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"70\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/azure\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"cli\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"71\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"72\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"73\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"74\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az login \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"principal \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"username $AZURE_CLIENT_ID \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $AZURE_CLIENT_SECRET \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"tenant $AZURE_TENANT_ID\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"75\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp config container set \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"type compose \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"multicontainer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"config\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"file docker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"compose.deploy.yml \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"user $PULL_IMAGE_TOKEN_USERNAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"container\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"registry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"password $PULL_IMAGE_TOKEN_PASSWORD\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"76\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" az webapp start \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"name $AZURE_WEBAPP_NAME \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"resource\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"group $AZURE_WEBAPP_RESOURCE_GROUP\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"77\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"78\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      for i in {1..30}; do\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"79\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        HTTP_STATUS=$(curl -s -o /dev/null -w \\\"%{http_code}\\\" $BASE_URL/api/pizzas);\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"80\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        if [ \\\"$HTTP_STATUS\\\" -eq 200 ]; then\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"81\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"          echo \\\"Azure Web App is functional.\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"82\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"          break\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"83\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        fi\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"84\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        echo \\\"Azure Web App is not ready yet. Waiting for 10 seconds...\\\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"85\",\"children\":[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"        sleep 10\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number highlight-line\",\"line\":\"86\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token scalar string\",\"children\":\"      done\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"87\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"88\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"e2e tests\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"89\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"stage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"90\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"image\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" mcr.microsoft.com/playwright\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"v1.50.1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"jammy\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"91\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"rules\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"92\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"if\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"93\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"script\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"94\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" cd ./e2e\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"95\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npm ci\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"96\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" npx playwright test\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"97\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" if \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\" $\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"?\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"ne 0 \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"; then echo \\\"E2E tests failed\\\"; exit 1; fi\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"98\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"artifacts\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"99\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token key atrule\",\"children\":\"paths\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"100\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e/playwright\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"report/\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line line-number\",\"line\":\"101\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" e2e/test\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\"results/\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Dans la boucle \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"for\"}]}],\" :\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Nous faisons une requête HTTP sur l'opération de lecture de toutes les pizzas.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Si le code HTTP est égal à 200, alors l'API est bien démarrée.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Sinon, nous attendons 10 secondes et nous réessayons jusqu'à 30 fois.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"NB : \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"curl -s -o /dev/null -w \\\"%{http_code}\\\" $BASE_URL/api/pizzas\"}]}],\" permet de faire une requête HTTP sur l'opération de lecture de toutes les pizzas et de récupérer le code HTTP. \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"-s\"}]}],\" permet de ne pas afficher les détails de la requête, \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"-o /dev/null\"}]}],\" permet de rediriger la sortie de la requête vers \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"/dev/null\"}]}],\" (\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"/dev/null\"}]}],\" agit comme un \\\"trou noir\\\", tout ce qui y est écrit est directement supprimé) et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"-w \\\"%{http_code}\\\"\"}]}],\" permet de récupérer le code HTTP.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Veuillez pousser vos modifications sur votre repository GitLab. Si les stages \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"test\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"build\"}]}],\"  passent, la MR peut être mergée. Si la MR est mergée sur la branche \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main\"}]}],\", les jobs \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"staging\"}]}],\" et\\n\",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"e2e tests\"}]}],\" s'exécuteront après avoir réexécuté les stages \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"test\"}]}],\" et \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"build\"}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Normalement, tout devrait fonctionner correctement. Vous devriez voir que les tests e2e passent. Et votre pipeline GitLab CI/CD est maintenant complet. Votre application devrait être déployée sur Azure Web App Service avec succès 🚀 !\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Si nécessaire, vous pouvez trouver le code associé au déploiement de l'environnement staging ici : \",[\"$\",\"a\",null,{\"href\":\"https://github.com/e-vinci/cae-theory-demos/tree/main/staging\",\"children\":\"staging\"}],\".\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Conclusion sur le déploiement de l'environnement staging\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Dans ce tutoriel, nous avons vu :\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"comment déployer notre application sur Azure Web App Service en utilisant GitLab CI/CD.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"comment réaliser des tests e2e sur notre application disponible sur le cloud.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"comment attendre que l'API soit bien démarrée avant de lancer les tests e2e.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"comment réinitialiser la DB à chaque démarrage de l'environnement de staging.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"comment déployer seulement en cas de fusion de modifications sur la branche \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main\"}]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"La faiblesse de notre application actuelle est que la seule application qui est visible sur le cloud par les utilisateurs est déployée avant même d'avoir réalisé les tests e2e. Cela peut poser des problèmes si les tests e2e ne passent pas. Il est recommandé de réaliser les tests e2e avant de déployer l'application sur le cloud pour les utilisateurs finaux.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Il va donc prochainement falloir créer un nouvel environnement de production pour déployer notre application seulement après avoir réalisé et réussi les tests e2e. Nous verrons cela plus tard 😉.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"D'abord, nous allons nous attaquer à la gestion d'un autre type d'images, les photos des pizzas. Nous allons voir comment stocker les photos des pizzas.\"}]]\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Déploiement\"}]]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script></body></html>